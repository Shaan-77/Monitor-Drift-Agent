<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session caa9e966-8dec-4caf-afc1-e67529a5e2e9 (2026-01-14 20:30Z) -->

# Cloud and server metrics API (2026-01-14 20:30Z)

_**User**_

Tech Task 5: Set Up API Endpoint to Retrieve Metrics

Objective: Expose an API endpoint to retrieve the stored cloud and server metrics.

Steps:

Implement an API Endpoint to Retrieve Metrics:

In api/metrics.py, create a new API endpoint (e.g., /api/metrics/cloud-and-server) that allows users or external agents to query the stored cloud and server metrics.

Use a framework such as Flask or FastAPI to expose the endpoint and handle incoming requests.

Ensure the API can handle both GET requests and provide the metrics in a JSON format.

Example (Flask):

from flask import Flask, jsonify, request
from data_collection.database import get_metrics_from_db

app = Flask(__name__)

@app.route('/api/metrics/cloud-and-server', methods=['GET'])
def get_metrics():
    # Parse query parameters (e.g., timestamp, resource_type)
    timestamp = request.args.get('timestamp', default=None)
    resource_type = request.args.get('resource_type', default=None)
    metric_type = request.args.get('metric_type', default=None)

    # Fetch metrics from the database
    metrics = get_metrics_from_db(timestamp, resource_type, metric_type)

    return jsonify(metrics)


Support Filtering by Timestamp, Metric Type, and Resource Type:

Allow the API to filter metrics by timestamp, resource_type (e.g., Server, AWS, GCP, Azure), and metric_type (e.g., CPU, Memory, Network, Cloud Compute).

Use query parameters to specify the filters in the API request.

Example (filtering):

def get_metrics_from_db(timestamp=None, resource_type=None, metric_type=None):
    query = "SELECT * FROM cloud_server_metrics WHERE 1=1"
    params = []

    if timestamp:
        query += " AND timestamp >= %s"
        params.append(timestamp)
    if resource_type:
        query += " AND resource_type = %s"
        params.append(resource_type)
    if metric_type:
        query += " AND metric_name = %s"
        params.append(metric_type)

    # Execute query with filters
    conn = connect_to_db()
    cursor = conn.cursor()
    cursor.execute(query, params)
    result = cursor.fetchall()
    cursor.close()
    conn.close()

    return result


Implement Pagination or Batch Processing (Optional for Large Data Sets):

If there is a possibility of large data sets, implement pagination or batch processing to handle requests efficiently.

Use limit and offset query parameters to support pagination, and return a subset of data per request.

Example (pagination):

@app.route('/api/metrics/cloud-and-server', methods=['GET'])
def get_metrics():
    limit = int(request.args.get('limit', 50))
    offset = int(request.args.get('offset', 0))

    # Fetch metrics with pagination
    metrics = get_metrics_from_db(limit=limit, offset=offset)

    return jsonify(metrics)


Ensure API Security (Authorization):

Ensure that the API can only be accessed by authorized users or external agents.

Implement authentication using API keys, OAuth tokens, or any other secure method.

Reject unauthorized requests with a 401 (Unauthorized) status code.

Example (Flask with API Key Authorization):

from functools import wraps
from flask import request, jsonify

def require_api_key(f):
    @wraps(f)
    def decorated_function(*args, **kwargs):
        api_key = request.headers.get('X-API-KEY')
        if api_key != 'your-secure-api-key':
            return jsonify({"error": "Unauthorized"}), 401
        return f(*args, **kwargs)
    return decorated_function

@app.route('/api/metrics/cloud-and-server', methods=['GET'])
@require_api_key
def get_metrics():
    # Fetch and return metrics
    metrics = get_metrics_from_db()
    return jsonify(metrics)


File(s) to Edit/Create:

api/metrics.py

Implement the new endpoint /api/metrics/cloud-and-server to retrieve the cloud and server metrics from the database.

Done When:

An API endpoint /api/metrics/cloud-and-server is implemented and functional.

The API supports filtering by timestamp, resource_type, and metric_type.

Pagination or batch processing is implemented to handle large data sets if necessary.

The API is secured and only accessible by authorized users or agents.

Constraints:

No hardcoded API keys. Use a secure method for handling API keys or OAuth tokens.

Efficient query execution. Ensure that database queries are optimized for performance and can handle large datasets without overloading the system.

Minimal diffs. Focus on adding the API endpoint and filtering functionality, do not modify other unrelated parts of the codebase

---

_**Agent (model default, mode Plan)**_


Exploring the codebase to understand the structure, existing API setup, and database schema.


---

<tool-use data-tool-type="unknown" data-tool-name="list_dir_v2">
<details>
<summary>Tool use: **list_dir_v2**</summary>


Parameters:

```json
{
  "targetDirectory": "a:\\MonitorDrift Agent"
}
```
Result:

```json
{
  "directoryTreeRoot": {
    "absPath": "a:\\MonitorDrift Agent",
    "childrenDirs": [
      {
        "absPath": "a:\\MonitorDrift Agent\\.specstory",
        "childrenDirs": [
          {
            "absPath": "a:\\MonitorDrift Agent\\.specstory\\history",
            "childrenFiles": [
              {
                "name": "2026-01-14_18-59Z-untitled.md"
              }
            ],
            "childrenWereProcessed": true
          }
        ],
        "childrenFiles": [
          {
            "name": ".gitignore"
          }
        ],
        "childrenWereProcessed": true
      },
      {
        "absPath": "a:\\MonitorDrift Agent\\alerting",
        "childrenFiles": [
          {
            "name": "__init__.py"
          },
          {
            "name": "alert_history.py"
          },
          {
            "name": "alert_logging.py"
          },
          {
            "name": "alert_system.py"
          }
        ],
        "childrenWereProcessed": true
      },
      {
        "absPath": "a:\\MonitorDrift Agent\\anomaly_detection",
        "childrenFiles": [
          {
            "name": "__init__.py"
          },
          {
            "name": "alert_trigger.py"
          },
          {
            "name": "machine_learning.py"
          },
          {
            "name": "threshold_detection.py"
          }
        ],
        "childrenWereProcessed": true
      },
      {
        "absPath": "a:\\MonitorDrift Agent\\api",
        "childrenFiles": [
          {
            "name": "__init__.py"
          },
          {
            "name": "alerts.py"
          },
          {
            "name": "main.py"
          },
          {
            "name": "metrics.py"
          },
          {
            "name": "policies.py"
          }
        ],
        "childrenWereProcessed": true
      },
      {
        "absPath": "a:\\MonitorDrift Agent\\config",
        "childrenFiles": [
          {
            "name": "__init__.py"
          },
          {
            "name": "logging_config.py"
          },
          {
            "name": "settings.py"
          }
        ],
        "childrenWereProcessed": true
      },
      {
        "absPath": "a:\\MonitorDrift Agent\\data_collection",
        "childrenFiles": [
          {
            "name": "__init__.py"
          },
          {
            "name": "cloud_metrics.py"
          },
          {
            "name": "database.py"
          },
          {
            "name": "system_metrics.py"
          }
        ],
        "childrenWereProcessed": true
      },
      {
        "absPath": "a:\\MonitorDrift Agent\\docker",
        "childrenFiles": [
          {
            "name": "docker-compose.yml"
          },
          {
            "name": "Dockerfile"
          },
          {
            "name": "entrypoint.sh"
          }
        ],
        "childrenWereProcessed": true
      },
      {
        "absPath": "a:\\MonitorDrift Agent\\policy_management",
        "childrenFiles": [
          {
            "name": "__init__.py"
          },
          {
            "name": "policy_definition.py"
          },
          {
            "name": "policy_enforcement.py"
          }
        ],
        "childrenWereProcessed": true
      },
      {
        "absPath": "a:\\MonitorDrift Agent\\self_healing",
        "childrenFiles": [
          {
            "name": "__init__.py"
          },
          {
            "name": "auto_scaling.py"
          }
        ],
        "childrenWereProcessed": true
      },
      {
        "absPath": "a:\\MonitorDrift Agent\\tests",
        "childrenFiles": [
          {
            "name": "__init__.py"
          },
          {
            "name": "test_alerting.py"
          },
          {
            "name": "test_anomaly_detection.py"
          },
          {
            "name": "test_data_collection.py"
          },
          {
            "name": "test_integration.py"
          },
          {
            "name": "test_performance.py"
          },
          {
            "name": "test_policy_management.py"
          },
          {
            "name": "test_self_healing.py"
          }
        ],
        "childrenWereProcessed": true
      },
      {
        "absPath": "a:\\MonitorDrift Agent\\utils",
        "childrenFiles": [
          {
            "name": "__init__.py"
          },
          {
            "name": "logger.py"
          }
        ],
        "childrenWereProcessed": true
      }
    ],
    "childrenFiles": [
      {
        "name": ".cursorindexingignore"
      },
      {
        "name": "collect_metrics.py"
      },
      {
        "name": "README.md"
      }
    ],
    "childrenWereProcessed": true
  }
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="glob_file_search">
<details>
<summary>Tool use: **glob_file_search** • Searched codebase "undefined" • **5** results in **1** directory</summary>

Directory: **undefined** (5 files)

| File |
|------|
| `.\api\main.py` |
| `.\api\metrics.py` |
| `.\api\policies.py` |
| `.\api\alerts.py` |
| `.\api\__init__.py` |

</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="glob_file_search">
<details>
<summary>Tool use: **glob_file_search** • Searched codebase "undefined" • **1** result in **1** directory</summary>

Directory: **undefined** (1 file)

| File |
|------|
| `.\data_collection\database.py` |

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "How are cloud and server metrics stored in the database?",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 882,
            "column": 24
          },
          "endPosition": {
            "line": 1024
          }
        },
        "contents": "def store_all_metrics_unified(all_metrics: Dict) -&gt; bool:\n    \"\"\"\n    Store unified metrics from collect_all_metrics() structure into cloud_server_metrics table.\n    \n    This function aggregates server and cloud metrics and stores them in the\n    unified cloud_server_metrics table, creating one row per resource type\n    (Server, AWS, GCP, Azure).\n    \n    Args:\n        all_metrics: Dictionary from collect_all_metrics() containing:\n            - timestamp: str (ISO format)\n            - server_metrics: Dict (CPU and memory usage with timestamp)\n            - cloud_metrics: Dict (AWS, GCP, Azure metrics by provider)\n    \n    Returns:\n        True if storage successful (at least some metrics stored), False otherwise\n    \"\"\"\n    storage_success = False\n    \n    try:\n        # Extract server metrics\n        server_metrics = all_metrics.get('server_metrics', {})\n        if not server_metrics or 'error' in server_metrics:\n            print(\"Server metrics not available or contain errors\")\n            return False\n        \n        # Get server metric values\n        cpu_usage = server_metrics.get('cpu_usage')\n        memory_usage = server_metrics.get('memory_usage')\n        server_timestamp = server_metrics.get('timestamp')\n        \n        # Convert server timestamp if needed\n        if isinstance(server_timestamp, str):\n            try:\n                server_timestamp = datetime.fromisoformat(server_timestamp.replace('Z', '+00:00'))\n            except (ValueError, AttributeError):\n                server_timestamp = datetime.now()\n        elif not isinstance(server_timestamp, datetime):\n            server_timestamp = datetime.now()\n        \n        # For network_traffic, we need to get it from server metrics or use 0\n        # Since get_server_metrics() doesn't include network, we'll use 0 or fetch separately\n        network_traffic = 0.0  # Default to 0, could be enhanced to get from network metrics\n        \n        # Store Server row (server metrics only)\n        if",
        "signatures": {},
        "detailedLines": [
          {
            "text": "def store_all_metrics_unified(all_metrics: Dict) -&gt; bool:",
            "lineNumber": 886,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 887
          },
          {
            "text": "    Store unified metrics from collect_all_metrics() structure into cloud_server_metrics table.",
            "lineNumber": 888
          },
          {
            "text": "    ",
            "lineNumber": 889
          },
          {
            "text": "    This function aggregates server and cloud metrics and stores them in the",
            "lineNumber": 890
          },
          {
            "text": "    unified cloud_server_metrics table, creating one row per resource type",
            "lineNumber": 891
          },
          {
            "text": "    (Server, AWS, GCP, Azure).",
            "lineNumber": 892
          },
          {
            "text": "    ",
            "lineNumber": 893
          },
          {
            "text": "    Args:",
            "lineNumber": 894
          },
          {
            "text": "        all_metrics: Dictionary from collect_all_metrics() containing:",
            "lineNumber": 895
          },
          {
            "text": "            - timestamp: str (ISO format)",
            "lineNumber": 896
          },
          {
            "text": "            - server_metrics: Dict (CPU and memory usage with timestamp)",
            "lineNumber": 897
          },
          {
            "text": "            - cloud_metrics: Dict (AWS, GCP, Azure metrics by provider)",
            "lineNumber": 898
          },
          {
            "text": "    ",
            "lineNumber": 899
          },
          {
            "text": "    Returns:",
            "lineNumber": 900
          },
          {
            "text": "        True if storage successful (at least some metrics stored), False otherwise",
            "lineNumber": 901
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 902
          },
          {
            "text": "    storage_success = False",
            "lineNumber": 903
          },
          {
            "text": "    ",
            "lineNumber": 904
          },
          {
            "text": "    try:",
            "lineNumber": 905
          },
          {
            "text": "        # Extract server metrics",
            "lineNumber": 906
          },
          {
            "text": "        server_metrics = all_metrics.get('server_metrics', {})",
            "lineNumber": 907
          },
          {
            "text": "        if not server_metrics or 'error' in server_metrics:",
            "lineNumber": 908
          },
          {
            "text": "            print(\"Server metrics not available or contain errors\")",
            "lineNumber": 909
          },
          {
            "text": "            return False",
            "lineNumber": 910
          },
          {
            "text": "        ",
            "lineNumber": 911
          },
          {
            "text": "        # Get server metric values",
            "lineNumber": 912
          },
          {
            "text": "        cpu_usage = server_metrics.get('cpu_usage')",
            "lineNumber": 913
          },
          {
            "text": "        memory_usage = server_metrics.get('memory_usage')",
            "lineNumber": 914
          },
          {
            "text": "        server_timestamp = server_metrics.get('timestamp')",
            "lineNumber": 915
          },
          {
            "text": "        ",
            "lineNumber": 916
          },
          {
            "text": "        # Convert server timestamp if needed",
            "lineNumber": 917
          },
          {
            "text": "        if isinstance(server_timestamp, str):",
            "lineNumber": 918
          },
          {
            "text": "            try:",
            "lineNumber": 919
          },
          {
            "text": "                server_timestamp = datetime.fromisoformat(server_timestamp.replace('Z', '+00:00'))",
            "lineNumber": 920
          },
          {
            "text": "            except (ValueError, AttributeError):",
            "lineNumber": 921
          },
          {
            "text": "                server_timestamp = datetime.now()",
            "lineNumber": 922
          },
          {
            "text": "        elif not isinstance(server_timestamp, datetime):",
            "lineNumber": 923
          },
          {
            "text": "            server_timestamp = datetime.now()",
            "lineNumber": 924
          },
          {
            "text": "        ",
            "lineNumber": 925
          },
          {
            "text": "        # For network_traffic, we need to get it from server metrics or use 0",
            "lineNumber": 926
          },
          {
            "text": "        # Since get_server_metrics() doesn't include network, we'll use 0 or fetch separately",
            "lineNumber": 927
          },
          {
            "text": "        network_traffic = 0.0  # Default to 0, could be enhanced to get from network metrics",
            "lineNumber": 928
          },
          {
            "text": "        ",
            "lineNumber": 929
          },
          {
            "text": "        # Store Server row (server metrics only)",
            "lineNumber": 930
          },
          {
            "text": "        if",
            "lineNumber": 931
          }
        ]
      },
      "score": 0.5969688296318054
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 758,
            "column": 24
          },
          "endPosition": {
            "line": 882
          }
        },
        "contents": "def store_unified_metrics(\n    cpu_usage: float,\n    memory_usage: float,\n    network_traffic: float,\n    resource_type: str,\n    cloud_compute: Optional[float] = None,\n    cloud_storage: Optional[float] = None,\n    cloud_bandwidth: Optional[float] = None,\n    timestamp: Optional[datetime] = None\n) -&gt; bool:\n    \"\"\"\n    Store unified metrics (server + cloud) in the cloud_server_metrics table.\n    \n    This function stores both server metrics and optional cloud metrics in\n    a single row in the unified cloud_server_metrics table.\n    \n    Args:\n        cpu_usage: Server CPU usage as percentage (required)\n        memory_usage: Server memory usage as percentage or bytes (required)\n        network_traffic: Server network bandwidth in bytes (required)\n        resource_type: Resource type identifier (Server, AWS, GCP, Azure) (required)\n        cloud_compute: Cloud compute usage (optional)\n        cloud_storage: Cloud storage usage (optional)\n        cloud_bandwidth: Cloud bandwidth usage (optional)\n        timestamp: Timestamp when metrics were collected (optional, defaults to current time)\n    \n    Returns:\n        True if storage successful, False otherwise\n    \"\"\"\n    conn = None\n    \n    try:\n        # Validate required parameters\n        if",
        "signatures": {},
        "detailedLines": [
          {
            "text": "def store_unified_metrics(",
            "lineNumber": 762,
            "isSignature": true
          },
          {
            "text": "    cpu_usage: float,",
            "lineNumber": 763,
            "isSignature": true
          },
          {
            "text": "    memory_usage: float,",
            "lineNumber": 764,
            "isSignature": true
          },
          {
            "text": "    network_traffic: float,",
            "lineNumber": 765,
            "isSignature": true
          },
          {
            "text": "    resource_type: str,",
            "lineNumber": 766,
            "isSignature": true
          },
          {
            "text": "    cloud_compute: Optional[float] = None,",
            "lineNumber": 767,
            "isSignature": true
          },
          {
            "text": "    cloud_storage: Optional[float] = None,",
            "lineNumber": 768,
            "isSignature": true
          },
          {
            "text": "    cloud_bandwidth: Optional[float] = None,",
            "lineNumber": 769,
            "isSignature": true
          },
          {
            "text": "    timestamp: Optional[datetime] = None",
            "lineNumber": 770,
            "isSignature": true
          },
          {
            "text": ") -&gt; bool:",
            "lineNumber": 771,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 772
          },
          {
            "text": "    Store unified metrics (server + cloud) in the cloud_server_metrics table.",
            "lineNumber": 773
          },
          {
            "text": "    ",
            "lineNumber": 774
          },
          {
            "text": "    This function stores both server metrics and optional cloud metrics in",
            "lineNumber": 775
          },
          {
            "text": "    a single row in the unified cloud_server_metrics table.",
            "lineNumber": 776
          },
          {
            "text": "    ",
            "lineNumber": 777
          },
          {
            "text": "    Args:",
            "lineNumber": 778
          },
          {
            "text": "        cpu_usage: Server CPU usage as percentage (required)",
            "lineNumber": 779
          },
          {
            "text": "        memory_usage: Server memory usage as percentage or bytes (required)",
            "lineNumber": 780
          },
          {
            "text": "        network_traffic: Server network bandwidth in bytes (required)",
            "lineNumber": 781
          },
          {
            "text": "        resource_type: Resource type identifier (Server, AWS, GCP, Azure) (required)",
            "lineNumber": 782
          },
          {
            "text": "        cloud_compute: Cloud compute usage (optional)",
            "lineNumber": 783
          },
          {
            "text": "        cloud_storage: Cloud storage usage (optional)",
            "lineNumber": 784
          },
          {
            "text": "        cloud_bandwidth: Cloud bandwidth usage (optional)",
            "lineNumber": 785
          },
          {
            "text": "        timestamp: Timestamp when metrics were collected (optional, defaults to current time)",
            "lineNumber": 786
          },
          {
            "text": "    ",
            "lineNumber": 787
          },
          {
            "text": "    Returns:",
            "lineNumber": 788
          },
          {
            "text": "        True if storage successful, False otherwise",
            "lineNumber": 789
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 790
          },
          {
            "text": "    conn = None",
            "lineNumber": 791
          },
          {
            "text": "    ",
            "lineNumber": 792
          },
          {
            "text": "    try:",
            "lineNumber": 793
          },
          {
            "text": "        # Validate required parameters",
            "lineNumber": 794
          },
          {
            "text": "        if",
            "lineNumber": 795
          }
        ]
      },
      "score": 0.5904366970062256
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 761
          },
          "endPosition": {
            "line": 882
          }
        },
        "contents": "def store_unified_metrics(\n    cpu_usage: float,\n    memory_usage: float,\n    network_traffic: float,\n    resource_type: str,\n    cloud_compute: Optional[float] = None,\n    cloud_storage: Optional[float] = None,\n    cloud_bandwidth: Optional[float] = None,\n    timestamp: Optional[datetime] = None\n) -&gt; bool:\n\"\"\"\n    conn = None\n    \n    try:\n        # Validate required parameters\n        if cpu_usage is None or memory_usage is None or network_traffic is None:\n            print(\"Error: cpu_usage, memory_usage, and network_traffic are required\")\n            return False\n        \n        if not resource_type:\n            print(\"Error: resource_type is required\")\n            return False\n        \n        # Validate resource_type\n        valid_resource_types = ['Server', 'AWS', 'GCP', 'Azure']\n        if resource_type not in valid_resource_types:\n            print(f\"Error: resource_type must be one of {valid_resource_types}\")\n            return False\n        \n        # Establish database connection\n        conn = connect_to_db()\n        if conn is None:\n            print(\"Failed to establish database connection\")\n            return False\n        \n        # Ensure schema exists\n        if not create_unified_metrics_schema(conn):\n            print(\"Failed to create/verify unified metrics schema\")\n            return False\n        \n        cursor = conn.cursor()\n        \n        # Use provided timestamp or default to current time\n        if timestamp is None:\n            metric_timestamp = datetime.now()\n        elif isinstance(timestamp, str):\n            try:\n                metric_timestamp = datetime.fromisoformat(timestamp.replace('Z', '+00:00'))\n            except (ValueError, AttributeError):\n                metric_timestamp = datetime.now()\n        elif isinstance(timestamp, datetime):\n            metric_timestamp = timestamp\n        else:\n            metric_timestamp = datetime.now()\n        \n        # Insert query\n        insert_query = \"\"\"\n            INSERT INTO cloud_server_metrics (\n                cpu_usage, memory_usage, network_traffic,\n                cloud_compute, cloud_storage, cloud_bandwidth,\n                timestamp, resource_type\n            )\n            VALUES (%s, %s, %s, %s, %s, %s, %s, %s);\n        \"\"\"\n        \n        # Convert to appropriate types\n        cpu_usage_float = float(cpu_usage)\n        memory_usage_float = float(memory_usage)\n        network_traffic_float = float(network_traffic)",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 762,
                "column": 1
              },
              "endPosition": {
                "line": 772,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "def store_unified_metrics(",
            "lineNumber": 762,
            "isSignature": true
          },
          {
            "text": "    cpu_usage: float,",
            "lineNumber": 763,
            "isSignature": true
          },
          {
            "text": "    memory_usage: float,",
            "lineNumber": 764,
            "isSignature": true
          },
          {
            "text": "    network_traffic: float,",
            "lineNumber": 765,
            "isSignature": true
          },
          {
            "text": "    resource_type: str,",
            "lineNumber": 766,
            "isSignature": true
          },
          {
            "text": "    cloud_compute: Optional[float] = None,",
            "lineNumber": 767,
            "isSignature": true
          },
          {
            "text": "    cloud_storage: Optional[float] = None,",
            "lineNumber": 768,
            "isSignature": true
          },
          {
            "text": "    cloud_bandwidth: Optional[float] = None,",
            "lineNumber": 769,
            "isSignature": true
          },
          {
            "text": "    timestamp: Optional[datetime] = None",
            "lineNumber": 770,
            "isSignature": true
          },
          {
            "text": ") -&gt; bool:",
            "lineNumber": 771,
            "isSignature": true
          },
          {
            "text": "\"\"\"",
            "lineNumber": 790
          },
          {
            "text": "    conn = None",
            "lineNumber": 791
          },
          {
            "text": "    ",
            "lineNumber": 792
          },
          {
            "text": "    try:",
            "lineNumber": 793
          },
          {
            "text": "        # Validate required parameters",
            "lineNumber": 794
          },
          {
            "text": "        if cpu_usage is None or memory_usage is None or network_traffic is None:",
            "lineNumber": 795
          },
          {
            "text": "            print(\"Error: cpu_usage, memory_usage, and network_traffic are required\")",
            "lineNumber": 796
          },
          {
            "text": "            return False",
            "lineNumber": 797
          },
          {
            "text": "        ",
            "lineNumber": 798
          },
          {
            "text": "        if not resource_type:",
            "lineNumber": 799
          },
          {
            "text": "            print(\"Error: resource_type is required\")",
            "lineNumber": 800
          },
          {
            "text": "            return False",
            "lineNumber": 801
          },
          {
            "text": "        ",
            "lineNumber": 802
          },
          {
            "text": "        # Validate resource_type",
            "lineNumber": 803
          },
          {
            "text": "        valid_resource_types = ['Server', 'AWS', 'GCP', 'Azure']",
            "lineNumber": 804
          },
          {
            "text": "        if resource_type not in valid_resource_types:",
            "lineNumber": 805
          },
          {
            "text": "            print(f\"Error: resource_type must be one of {valid_resource_types}\")",
            "lineNumber": 806
          },
          {
            "text": "            return False",
            "lineNumber": 807
          },
          {
            "text": "        ",
            "lineNumber": 808
          },
          {
            "text": "        # Establish database connection",
            "lineNumber": 809
          },
          {
            "text": "        conn = connect_to_db()",
            "lineNumber": 810
          },
          {
            "text": "        if conn is None:",
            "lineNumber": 811
          },
          {
            "text": "            print(\"Failed to establish database connection\")",
            "lineNumber": 812
          },
          {
            "text": "            return False",
            "lineNumber": 813
          },
          {
            "text": "        ",
            "lineNumber": 814
          },
          {
            "text": "        # Ensure schema exists",
            "lineNumber": 815
          },
          {
            "text": "        if not create_unified_metrics_schema(conn):",
            "lineNumber": 816
          },
          {
            "text": "            print(\"Failed to create/verify unified metrics schema\")",
            "lineNumber": 817
          },
          {
            "text": "            return False",
            "lineNumber": 818
          },
          {
            "text": "        ",
            "lineNumber": 819
          },
          {
            "text": "        cursor = conn.cursor()",
            "lineNumber": 820
          },
          {
            "text": "        ",
            "lineNumber": 821
          },
          {
            "text": "        # Use provided timestamp or default to current time",
            "lineNumber": 822
          },
          {
            "text": "        if timestamp is None:",
            "lineNumber": 823
          },
          {
            "text": "            metric_timestamp = datetime.now()",
            "lineNumber": 824
          },
          {
            "text": "        elif isinstance(timestamp, str):",
            "lineNumber": 825
          },
          {
            "text": "            try:",
            "lineNumber": 826
          },
          {
            "text": "                metric_timestamp = datetime.fromisoformat(timestamp.replace('Z', '+00:00'))",
            "lineNumber": 827
          },
          {
            "text": "            except (ValueError, AttributeError):",
            "lineNumber": 828
          },
          {
            "text": "                metric_timestamp = datetime.now()",
            "lineNumber": 829
          },
          {
            "text": "        elif isinstance(timestamp, datetime):",
            "lineNumber": 830
          },
          {
            "text": "            metric_timestamp = timestamp",
            "lineNumber": 831
          },
          {
            "text": "        else:",
            "lineNumber": 832
          },
          {
            "text": "            metric_timestamp = datetime.now()",
            "lineNumber": 833
          },
          {
            "text": "        ",
            "lineNumber": 834
          },
          {
            "text": "        # Insert query",
            "lineNumber": 835
          },
          {
            "text": "        insert_query = \"\"\"",
            "lineNumber": 836
          },
          {
            "text": "            INSERT INTO cloud_server_metrics (",
            "lineNumber": 837
          },
          {
            "text": "                cpu_usage, memory_usage, network_traffic,",
            "lineNumber": 838
          },
          {
            "text": "                cloud_compute, cloud_storage, cloud_bandwidth,",
            "lineNumber": 839
          },
          {
            "text": "                timestamp, resource_type",
            "lineNumber": 840
          },
          {
            "text": "            )",
            "lineNumber": 841
          },
          {
            "text": "            VALUES (%s, %s, %s, %s, %s, %s, %s, %s);",
            "lineNumber": 842
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 843
          },
          {
            "text": "        ",
            "lineNumber": 844
          },
          {
            "text": "        # Convert to appropriate types",
            "lineNumber": 845
          },
          {
            "text": "        cpu_usage_float = float(cpu_usage)",
            "lineNumber": 846
          },
          {
            "text": "        memory_usage_float = float(memory_usage)",
            "lineNumber": 847
          },
          {
            "text": "        network_traffic_float = float(network_traffic)",
            "lineNumber": 848
          }
        ]
      },
      "score": 0.5857738852500916
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 360,
            "column": 20
          },
          "endPosition": {
            "line": 496
          }
        },
        "contents": "def create_unified_metrics_schema(conn) -&gt; bool:\n    \"\"\"\n    Create the database schema for storing unified cloud and server metrics.\n    \n    Creates a table called cloud_server_metrics with columns for both\n    server metrics (CPU, memory, network) and cloud metrics (compute,\n    storage, bandwidth) in a single row.\n    \n    Args:\n        conn: psycopg2 connection object\n    \n    Returns:\n        True if schema creation successful, False otherwise\n    \"\"\"\n    if conn is None:\n        print(\"Error: Database connection is None\")\n        return False\n    \n    try:\n        cursor = conn.cursor()\n        \n        # Create cloud_server_metrics table\n        create_table_query = \"\"\"\n        CREATE TABLE IF NOT EXISTS cloud_server_metrics (\n            id SERIAL PRIMARY KEY,\n            cpu_usage NUMERIC NOT NULL,\n            memory_usage NUMERIC NOT NULL,\n            network_traffic NUMERIC NOT NULL,\n            cloud_compute NUMERIC,\n            cloud_storage NUMERIC,\n            cloud_bandwidth NUMERIC,\n            timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n            resource_type TEXT NOT NULL\n        );\n        \"\"\"\n        \n        cursor.execute(create_table_query)\n        conn.commit()\n        cursor.close()\n        \n        return True\n    \n    except Error as e:\n        print(f\"Error creating unified metrics schema: {e}\")\n        if conn:\n            conn.rollback()\n        return False\n    except Exception as e:\n        print(f\"Unexpected error creating unified metrics schema: {e}\")\n        if conn:\n            conn.rollback()\n        return False\n\n\ndef create_schema(conn) -&gt; bool:\n    \"\"\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "def create_unified_metrics_schema(conn) -&gt; bool:",
            "lineNumber": 364,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 365
          },
          {
            "text": "    Create the database schema for storing unified cloud and server metrics.",
            "lineNumber": 366
          },
          {
            "text": "    ",
            "lineNumber": 367
          },
          {
            "text": "    Creates a table called cloud_server_metrics with columns for both",
            "lineNumber": 368
          },
          {
            "text": "    server metrics (CPU, memory, network) and cloud metrics (compute,",
            "lineNumber": 369
          },
          {
            "text": "    storage, bandwidth) in a single row.",
            "lineNumber": 370
          },
          {
            "text": "    ",
            "lineNumber": 371
          },
          {
            "text": "    Args:",
            "lineNumber": 372
          },
          {
            "text": "        conn: psycopg2 connection object",
            "lineNumber": 373
          },
          {
            "text": "    ",
            "lineNumber": 374
          },
          {
            "text": "    Returns:",
            "lineNumber": 375
          },
          {
            "text": "        True if schema creation successful, False otherwise",
            "lineNumber": 376
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 377
          },
          {
            "text": "    if conn is None:",
            "lineNumber": 378
          },
          {
            "text": "        print(\"Error: Database connection is None\")",
            "lineNumber": 379
          },
          {
            "text": "        return False",
            "lineNumber": 380
          },
          {
            "text": "    ",
            "lineNumber": 381
          },
          {
            "text": "    try:",
            "lineNumber": 382
          },
          {
            "text": "        cursor = conn.cursor()",
            "lineNumber": 383
          },
          {
            "text": "        ",
            "lineNumber": 384
          },
          {
            "text": "        # Create cloud_server_metrics table",
            "lineNumber": 385
          },
          {
            "text": "        create_table_query = \"\"\"",
            "lineNumber": 386
          },
          {
            "text": "        CREATE TABLE IF NOT EXISTS cloud_server_metrics (",
            "lineNumber": 387
          },
          {
            "text": "            id SERIAL PRIMARY KEY,",
            "lineNumber": 388
          },
          {
            "text": "            cpu_usage NUMERIC NOT NULL,",
            "lineNumber": 389
          },
          {
            "text": "            memory_usage NUMERIC NOT NULL,",
            "lineNumber": 390
          },
          {
            "text": "            network_traffic NUMERIC NOT NULL,",
            "lineNumber": 391
          },
          {
            "text": "            cloud_compute NUMERIC,",
            "lineNumber": 392
          },
          {
            "text": "            cloud_storage NUMERIC,",
            "lineNumber": 393
          },
          {
            "text": "            cloud_bandwidth NUMERIC,",
            "lineNumber": 394
          },
          {
            "text": "            timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,",
            "lineNumber": 395
          },
          {
            "text": "            resource_type TEXT NOT NULL",
            "lineNumber": 396
          },
          {
            "text": "        );",
            "lineNumber": 397
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 398
          },
          {
            "text": "        ",
            "lineNumber": 399
          },
          {
            "text": "        cursor.execute(create_table_query)",
            "lineNumber": 400
          },
          {
            "text": "        conn.commit()",
            "lineNumber": 401
          },
          {
            "text": "        cursor.close()",
            "lineNumber": 402
          },
          {
            "text": "        ",
            "lineNumber": 403
          },
          {
            "text": "        return True",
            "lineNumber": 404
          },
          {
            "text": "    ",
            "lineNumber": 405
          },
          {
            "text": "    except Error as e:",
            "lineNumber": 406
          },
          {
            "text": "        print(f\"Error creating unified metrics schema: {e}\")",
            "lineNumber": 407
          },
          {
            "text": "        if conn:",
            "lineNumber": 408
          },
          {
            "text": "            conn.rollback()",
            "lineNumber": 409
          },
          {
            "text": "        return False",
            "lineNumber": 410
          },
          {
            "text": "    except Exception as e:",
            "lineNumber": 411
          },
          {
            "text": "        print(f\"Unexpected error creating unified metrics schema: {e}\")",
            "lineNumber": 412
          },
          {
            "text": "        if conn:",
            "lineNumber": 413
          },
          {
            "text": "            conn.rollback()",
            "lineNumber": 414
          },
          {
            "text": "        return False",
            "lineNumber": 415,
            "isSignature": true
          },
          {
            "lineNumber": 416
          },
          {
            "lineNumber": 417
          },
          {
            "text": "def create_schema(conn) -&gt; bool:",
            "lineNumber": 418,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 419
          }
        ]
      },
      "score": 0.5681849718093872
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 414,
            "column": 20
          },
          "endPosition": {
            "line": 496
          }
        },
        "contents": "def create_schema(conn) -&gt; bool:\n    \"\"\"\n    Define and create the database schema for storing system metrics.\n    \n    Creates a table called system_metrics with columns for CPU, memory,\n    network metrics, timestamp, and resource type.\n    Also creates the cloud_metrics table.\n    \n    Args:\n        conn: psycopg2 connection object\n    \n    Returns:\n        True if schema creation successful, False otherwise\n    \"\"\"\n    if conn is None:\n        print(\"Error: Database connection is None\")\n        return False\n    \n    try:\n        cursor = conn.cursor()\n        \n        # Create system_metrics table\n        create_table_query = \"\"\"\n        CREATE TABLE IF NOT EXISTS system_metrics (\n            id SERIAL PRIMARY KEY,\n            cpu_usage NUMERIC,\n            memory_usage NUMERIC,\n            network_traffic NUMERIC,\n            timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n            resource_type TEXT NOT NULL\n        );\n        \"\"\"\n        \n        cursor.execute(create_table_query)\n        \n        # Also create cloud_metrics table\n        create_cloud_table_query = \"\"\"\n        CREATE TABLE IF NOT EXISTS cloud_metrics (\n            id SERIAL PRIMARY KEY,\n            provider TEXT NOT NULL,\n            metric_name TEXT NOT NULL,\n            metric_value NUMERIC,\n            timestamp TIMESTAMP,\n            resource_type TEXT NOT NULL\n        );\n        \"\"\"\n        \n        cursor.execute(create_cloud_table_query)\n        \n        # Also create unified cloud_server_metrics table\n        create_unified_table_query = \"\"\"\n        CREATE TABLE IF NOT EXISTS cloud_server_metrics (\n            id SERIAL PRIMARY KEY,\n            cpu_usage NUMERIC NOT NULL,\n            memory_usage NUMERIC NOT NULL,\n            network_traffic NUMERIC NOT NULL,\n            cloud_compute NUMERIC,\n            cloud_storage NUMERIC,\n            cloud_bandwidth NUMERIC,\n            timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n            resource_type TEXT NOT NULL\n        );\n        \"\"\"\n        \n        cursor.execute(create_unified_table_query)\n        conn.commit()",
        "signatures": {},
        "detailedLines": [
          {
            "text": "def create_schema(conn) -&gt; bool:",
            "lineNumber": 418,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 419
          },
          {
            "text": "    Define and create the database schema for storing system metrics.",
            "lineNumber": 420
          },
          {
            "text": "    ",
            "lineNumber": 421
          },
          {
            "text": "    Creates a table called system_metrics with columns for CPU, memory,",
            "lineNumber": 422
          },
          {
            "text": "    network metrics, timestamp, and resource type.",
            "lineNumber": 423
          },
          {
            "text": "    Also creates the cloud_metrics table.",
            "lineNumber": 424
          },
          {
            "text": "    ",
            "lineNumber": 425
          },
          {
            "text": "    Args:",
            "lineNumber": 426
          },
          {
            "text": "        conn: psycopg2 connection object",
            "lineNumber": 427
          },
          {
            "text": "    ",
            "lineNumber": 428
          },
          {
            "text": "    Returns:",
            "lineNumber": 429
          },
          {
            "text": "        True if schema creation successful, False otherwise",
            "lineNumber": 430
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 431
          },
          {
            "text": "    if conn is None:",
            "lineNumber": 432
          },
          {
            "text": "        print(\"Error: Database connection is None\")",
            "lineNumber": 433
          },
          {
            "text": "        return False",
            "lineNumber": 434
          },
          {
            "text": "    ",
            "lineNumber": 435
          },
          {
            "text": "    try:",
            "lineNumber": 436
          },
          {
            "text": "        cursor = conn.cursor()",
            "lineNumber": 437
          },
          {
            "text": "        ",
            "lineNumber": 438
          },
          {
            "text": "        # Create system_metrics table",
            "lineNumber": 439
          },
          {
            "text": "        create_table_query = \"\"\"",
            "lineNumber": 440
          },
          {
            "text": "        CREATE TABLE IF NOT EXISTS system_metrics (",
            "lineNumber": 441
          },
          {
            "text": "            id SERIAL PRIMARY KEY,",
            "lineNumber": 442
          },
          {
            "text": "            cpu_usage NUMERIC,",
            "lineNumber": 443
          },
          {
            "text": "            memory_usage NUMERIC,",
            "lineNumber": 444
          },
          {
            "text": "            network_traffic NUMERIC,",
            "lineNumber": 445
          },
          {
            "text": "            timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,",
            "lineNumber": 446
          },
          {
            "text": "            resource_type TEXT NOT NULL",
            "lineNumber": 447
          },
          {
            "text": "        );",
            "lineNumber": 448
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 449
          },
          {
            "text": "        ",
            "lineNumber": 450
          },
          {
            "text": "        cursor.execute(create_table_query)",
            "lineNumber": 451
          },
          {
            "text": "        ",
            "lineNumber": 452
          },
          {
            "text": "        # Also create cloud_metrics table",
            "lineNumber": 453
          },
          {
            "text": "        create_cloud_table_query = \"\"\"",
            "lineNumber": 454
          },
          {
            "text": "        CREATE TABLE IF NOT EXISTS cloud_metrics (",
            "lineNumber": 455
          },
          {
            "text": "            id SERIAL PRIMARY KEY,",
            "lineNumber": 456
          },
          {
            "text": "            provider TEXT NOT NULL,",
            "lineNumber": 457
          },
          {
            "text": "            metric_name TEXT NOT NULL,",
            "lineNumber": 458
          },
          {
            "text": "            metric_value NUMERIC,",
            "lineNumber": 459
          },
          {
            "text": "            timestamp TIMESTAMP,",
            "lineNumber": 460
          },
          {
            "text": "            resource_type TEXT NOT NULL",
            "lineNumber": 461
          },
          {
            "text": "        );",
            "lineNumber": 462
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 463
          },
          {
            "text": "        ",
            "lineNumber": 464
          },
          {
            "text": "        cursor.execute(create_cloud_table_query)",
            "lineNumber": 465
          },
          {
            "text": "        ",
            "lineNumber": 466
          },
          {
            "text": "        # Also create unified cloud_server_metrics table",
            "lineNumber": 467
          },
          {
            "text": "        create_unified_table_query = \"\"\"",
            "lineNumber": 468
          },
          {
            "text": "        CREATE TABLE IF NOT EXISTS cloud_server_metrics (",
            "lineNumber": 469
          },
          {
            "text": "            id SERIAL PRIMARY KEY,",
            "lineNumber": 470
          },
          {
            "text": "            cpu_usage NUMERIC NOT NULL,",
            "lineNumber": 471
          },
          {
            "text": "            memory_usage NUMERIC NOT NULL,",
            "lineNumber": 472
          },
          {
            "text": "            network_traffic NUMERIC NOT NULL,",
            "lineNumber": 473
          },
          {
            "text": "            cloud_compute NUMERIC,",
            "lineNumber": 474
          },
          {
            "text": "            cloud_storage NUMERIC,",
            "lineNumber": 475
          },
          {
            "text": "            cloud_bandwidth NUMERIC,",
            "lineNumber": 476
          },
          {
            "text": "            timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,",
            "lineNumber": 477
          },
          {
            "text": "            resource_type TEXT NOT NULL",
            "lineNumber": 478
          },
          {
            "text": "        );",
            "lineNumber": 479
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 480
          },
          {
            "text": "        ",
            "lineNumber": 481
          },
          {
            "text": "        cursor.execute(create_unified_table_query)",
            "lineNumber": 482
          },
          {
            "text": "        conn.commit()",
            "lineNumber": 483
          }
        ]
      },
      "score": 0.5617871880531311
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 605
          },
          "endPosition": {
            "line": 758
          }
        },
        "contents": "def store_all_metrics(all_metrics: Dict) -&gt; bool:\n\n                \n                # Insert Memory metric\n                if memory_usage is not None:\n                    cursor.execute(\n                        insert_query,\n                        (None, float(memory_usage), None, server_timestamp, 'Memory')\n                    )\n                \n                storage_success = True\n            except Exception as e:\n                print(f\"Error storing server metrics: {e}\")\n                # Continue with cloud metrics even if server metrics fail\n        \n        # Store cloud metrics if available\n        cloud_metrics = all_metrics.get('cloud_metrics', {})\n        if cloud_metrics and 'error' not in cloud_metrics:\n            # Insert query for cloud metrics\n            cloud_insert_query = \"\"\"\n                INSERT INTO cloud_metrics (provider, metric_name, metric_value, timestamp, resource_type)\n                VALUES (%s, %s, %s, %s, %s);\n            \"\"\"\n            \n            # Process each provider's metrics\n            for",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 606,
                "column": 1
              },
              "endPosition": {
                "line": 607,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "def store_all_metrics(all_metrics: Dict) -&gt; bool:",
            "lineNumber": 606,
            "isSignature": true
          },
          {
            "lineNumber": 670
          },
          {
            "text": "                ",
            "lineNumber": 671
          },
          {
            "text": "                # Insert Memory metric",
            "lineNumber": 672
          },
          {
            "text": "                if memory_usage is not None:",
            "lineNumber": 673
          },
          {
            "text": "                    cursor.execute(",
            "lineNumber": 674
          },
          {
            "text": "                        insert_query,",
            "lineNumber": 675
          },
          {
            "text": "                        (None, float(memory_usage), None, server_timestamp, 'Memory')",
            "lineNumber": 676
          },
          {
            "text": "                    )",
            "lineNumber": 677
          },
          {
            "text": "                ",
            "lineNumber": 678
          },
          {
            "text": "                storage_success = True",
            "lineNumber": 679
          },
          {
            "text": "            except Exception as e:",
            "lineNumber": 680
          },
          {
            "text": "                print(f\"Error storing server metrics: {e}\")",
            "lineNumber": 681
          },
          {
            "text": "                # Continue with cloud metrics even if server metrics fail",
            "lineNumber": 682
          },
          {
            "text": "        ",
            "lineNumber": 683
          },
          {
            "text": "        # Store cloud metrics if available",
            "lineNumber": 684
          },
          {
            "text": "        cloud_metrics = all_metrics.get('cloud_metrics', {})",
            "lineNumber": 685
          },
          {
            "text": "        if cloud_metrics and 'error' not in cloud_metrics:",
            "lineNumber": 686
          },
          {
            "text": "            # Insert query for cloud metrics",
            "lineNumber": 687
          },
          {
            "text": "            cloud_insert_query = \"\"\"",
            "lineNumber": 688
          },
          {
            "text": "                INSERT INTO cloud_metrics (provider, metric_name, metric_value, timestamp, resource_type)",
            "lineNumber": 689
          },
          {
            "text": "                VALUES (%s, %s, %s, %s, %s);",
            "lineNumber": 690
          },
          {
            "text": "            \"\"\"",
            "lineNumber": 691
          },
          {
            "text": "            ",
            "lineNumber": 692
          },
          {
            "text": "            # Process each provider's metrics",
            "lineNumber": 693
          },
          {
            "text": "            for",
            "lineNumber": 694
          }
        ]
      },
      "score": 0.5581548810005188
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 602,
            "column": 24
          },
          "endPosition": {
            "line": 758
          }
        },
        "contents": "def store_all_metrics(all_metrics: Dict) -&gt; bool:\n    \"\"\"\n    Store unified metrics (server + cloud) in the database.\n    \n    This function stores both server metrics and cloud metrics from the\n    unified structure returned by collect_all_metrics(). Server metrics\n    are stored in the system_metrics table, and cloud metrics are stored\n    in the cloud_metrics table.\n    \n    Args:\n        all_metrics: Dictionary from collect_all_metrics() containing:\n            - timestamp: str (ISO format)\n            - server_metrics: Dict (CPU and memory usage with timestamp)\n            - cloud_metrics: Dict (AWS, GCP, Azure metrics by provider)\n    \n    Returns:\n        True if storage successful (at least some metrics stored), False otherwise\n    \"\"\"\n    conn = None\n    storage_success = False\n    \n    try:\n        # Establish database connection\n        conn = connect_to_db()",
        "signatures": {},
        "detailedLines": [
          {
            "text": "def store_all_metrics(all_metrics: Dict) -&gt; bool:",
            "lineNumber": 606,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 607
          },
          {
            "text": "    Store unified metrics (server + cloud) in the database.",
            "lineNumber": 608
          },
          {
            "text": "    ",
            "lineNumber": 609
          },
          {
            "text": "    This function stores both server metrics and cloud metrics from the",
            "lineNumber": 610
          },
          {
            "text": "    unified structure returned by collect_all_metrics(). Server metrics",
            "lineNumber": 611
          },
          {
            "text": "    are stored in the system_metrics table, and cloud metrics are stored",
            "lineNumber": 612
          },
          {
            "text": "    in the cloud_metrics table.",
            "lineNumber": 613
          },
          {
            "text": "    ",
            "lineNumber": 614
          },
          {
            "text": "    Args:",
            "lineNumber": 615
          },
          {
            "text": "        all_metrics: Dictionary from collect_all_metrics() containing:",
            "lineNumber": 616
          },
          {
            "text": "            - timestamp: str (ISO format)",
            "lineNumber": 617
          },
          {
            "text": "            - server_metrics: Dict (CPU and memory usage with timestamp)",
            "lineNumber": 618
          },
          {
            "text": "            - cloud_metrics: Dict (AWS, GCP, Azure metrics by provider)",
            "lineNumber": 619
          },
          {
            "text": "    ",
            "lineNumber": 620
          },
          {
            "text": "    Returns:",
            "lineNumber": 621
          },
          {
            "text": "        True if storage successful (at least some metrics stored), False otherwise",
            "lineNumber": 622
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 623
          },
          {
            "text": "    conn = None",
            "lineNumber": 624
          },
          {
            "text": "    storage_success = False",
            "lineNumber": 625
          },
          {
            "text": "    ",
            "lineNumber": 626
          },
          {
            "text": "    try:",
            "lineNumber": 627
          },
          {
            "text": "        # Establish database connection",
            "lineNumber": 628
          },
          {
            "text": "        conn = connect_to_db()",
            "lineNumber": 629
          }
        ]
      },
      "score": 0.5465779304504395
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 885
          },
          "endPosition": {
            "line": 1024
          }
        },
        "contents": "def store_all_metrics_unified(all_metrics: Dict) -&gt; bool:\n\n        \n        # Store Server row (server metrics only)\n        if cpu_usage is not None and memory_usage is not None:\n            success = store_unified_metrics(\n                cpu_usage=float(cpu_usage),\n                memory_usage=float(memory_usage),\n                network_traffic=network_traffic,\n                resource_type='Server',\n                timestamp=server_timestamp\n            )\n            if success:\n                storage_success = True\n        \n        # Process cloud metrics by provider\n        cloud_metrics = all_metrics.get('cloud_metrics', {})\n        if cloud_metrics and 'error' not in cloud_metrics:\n            # Aggregate metrics for each provider\n            for provider, metrics_list in cloud_metrics.items():\n                if not isinstance(metrics_list, list) or len(metrics_list) == 0:\n                    continue\n                \n                try:",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 886,
                "column": 1
              },
              "endPosition": {
                "line": 887,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "def store_all_metrics_unified(all_metrics: Dict) -&gt; bool:",
            "lineNumber": 886,
            "isSignature": true
          },
          {
            "lineNumber": 928
          },
          {
            "text": "        ",
            "lineNumber": 929
          },
          {
            "text": "        # Store Server row (server metrics only)",
            "lineNumber": 930
          },
          {
            "text": "        if cpu_usage is not None and memory_usage is not None:",
            "lineNumber": 931
          },
          {
            "text": "            success = store_unified_metrics(",
            "lineNumber": 932
          },
          {
            "text": "                cpu_usage=float(cpu_usage),",
            "lineNumber": 933
          },
          {
            "text": "                memory_usage=float(memory_usage),",
            "lineNumber": 934
          },
          {
            "text": "                network_traffic=network_traffic,",
            "lineNumber": 935
          },
          {
            "text": "                resource_type='Server',",
            "lineNumber": 936
          },
          {
            "text": "                timestamp=server_timestamp",
            "lineNumber": 937
          },
          {
            "text": "            )",
            "lineNumber": 938
          },
          {
            "text": "            if success:",
            "lineNumber": 939
          },
          {
            "text": "                storage_success = True",
            "lineNumber": 940
          },
          {
            "text": "        ",
            "lineNumber": 941
          },
          {
            "text": "        # Process cloud metrics by provider",
            "lineNumber": 942
          },
          {
            "text": "        cloud_metrics = all_metrics.get('cloud_metrics', {})",
            "lineNumber": 943
          },
          {
            "text": "        if cloud_metrics and 'error' not in cloud_metrics:",
            "lineNumber": 944
          },
          {
            "text": "            # Aggregate metrics for each provider",
            "lineNumber": 945
          },
          {
            "text": "            for provider, metrics_list in cloud_metrics.items():",
            "lineNumber": 946
          },
          {
            "text": "                if not isinstance(metrics_list, list) or len(metrics_list) == 0:",
            "lineNumber": 947
          },
          {
            "text": "                    continue",
            "lineNumber": 948
          },
          {
            "text": "                ",
            "lineNumber": 949
          },
          {
            "text": "                try:",
            "lineNumber": 950
          }
        ]
      },
      "score": 0.5378062129020691
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 605
          },
          "endPosition": {
            "line": 758
          }
        },
        "contents": "def store_all_metrics(all_metrics: Dict) -&gt; bool:\n\n    \n    try:\n        # Establish database connection\n        conn = connect_to_db()\n        if conn is None:\n            print(\"Failed to establish database connection\")\n            return False\n        \n        # Ensure schemas exist\n        if not create_schema(conn):\n            print(\"Failed to create/verify database schemas\")\n            return False\n        \n        cursor = conn.cursor()\n        \n        # Store server metrics if available\n        server_metrics = all_metrics.get('server_metrics', {})\n        if server_metrics and 'error' not in server_metrics:\n            try:\n                cpu_usage = server_metrics.get('cpu_usage')\n                memory_usage = server_metrics.get('memory_usage')\n                server_timestamp = server_metrics.get('timestamp')\n                \n                # Convert timestamp if needed\n                if isinstance(server_timestamp, str):\n                    try:\n                        # Try ISO format parsing (Python 3.7+)\n                        server_timestamp = datetime.fromisoformat(server_timestamp.replace('Z', '+00:00'))\n                    except (ValueError, AttributeError):\n                        server_timestamp = datetime.now()\n                elif not isinstance(server_timestamp, datetime):\n                    server_timestamp = datetime.now()\n                \n                # Insert server metrics into system_metrics table\n                insert_query = \"\"\"\n                    INSERT INTO system_metrics (cpu_usage, memory_usage, network_traffic, timestamp, resource_type)\n                    VALUES (%s, %s, %s, %s, %s);\n                \"\"\"\n                \n                # Insert CPU metric\n                if cpu_usage is not None:\n                    cursor.execute(\n                        insert_query,\n                        (float(cpu_usage), None, None, server_timestamp, 'CPU')\n                    )\n                \n                # Insert Memory metric\n                if",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 606,
                "column": 1
              },
              "endPosition": {
                "line": 607,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "def store_all_metrics(all_metrics: Dict) -&gt; bool:",
            "lineNumber": 606,
            "isSignature": true
          },
          {
            "lineNumber": 625
          },
          {
            "text": "    ",
            "lineNumber": 626
          },
          {
            "text": "    try:",
            "lineNumber": 627
          },
          {
            "text": "        # Establish database connection",
            "lineNumber": 628
          },
          {
            "text": "        conn = connect_to_db()",
            "lineNumber": 629
          },
          {
            "text": "        if conn is None:",
            "lineNumber": 630
          },
          {
            "text": "            print(\"Failed to establish database connection\")",
            "lineNumber": 631
          },
          {
            "text": "            return False",
            "lineNumber": 632
          },
          {
            "text": "        ",
            "lineNumber": 633
          },
          {
            "text": "        # Ensure schemas exist",
            "lineNumber": 634
          },
          {
            "text": "        if not create_schema(conn):",
            "lineNumber": 635
          },
          {
            "text": "            print(\"Failed to create/verify database schemas\")",
            "lineNumber": 636
          },
          {
            "text": "            return False",
            "lineNumber": 637
          },
          {
            "text": "        ",
            "lineNumber": 638
          },
          {
            "text": "        cursor = conn.cursor()",
            "lineNumber": 639
          },
          {
            "text": "        ",
            "lineNumber": 640
          },
          {
            "text": "        # Store server metrics if available",
            "lineNumber": 641
          },
          {
            "text": "        server_metrics = all_metrics.get('server_metrics', {})",
            "lineNumber": 642
          },
          {
            "text": "        if server_metrics and 'error' not in server_metrics:",
            "lineNumber": 643
          },
          {
            "text": "            try:",
            "lineNumber": 644
          },
          {
            "text": "                cpu_usage = server_metrics.get('cpu_usage')",
            "lineNumber": 645
          },
          {
            "text": "                memory_usage = server_metrics.get('memory_usage')",
            "lineNumber": 646
          },
          {
            "text": "                server_timestamp = server_metrics.get('timestamp')",
            "lineNumber": 647
          },
          {
            "text": "                ",
            "lineNumber": 648
          },
          {
            "text": "                # Convert timestamp if needed",
            "lineNumber": 649
          },
          {
            "text": "                if isinstance(server_timestamp, str):",
            "lineNumber": 650
          },
          {
            "text": "                    try:",
            "lineNumber": 651
          },
          {
            "text": "                        # Try ISO format parsing (Python 3.7+)",
            "lineNumber": 652
          },
          {
            "text": "                        server_timestamp = datetime.fromisoformat(server_timestamp.replace('Z', '+00:00'))",
            "lineNumber": 653
          },
          {
            "text": "                    except (ValueError, AttributeError):",
            "lineNumber": 654
          },
          {
            "text": "                        server_timestamp = datetime.now()",
            "lineNumber": 655
          },
          {
            "text": "                elif not isinstance(server_timestamp, datetime):",
            "lineNumber": 656
          },
          {
            "text": "                    server_timestamp = datetime.now()",
            "lineNumber": 657
          },
          {
            "text": "                ",
            "lineNumber": 658
          },
          {
            "text": "                # Insert server metrics into system_metrics table",
            "lineNumber": 659
          },
          {
            "text": "                insert_query = \"\"\"",
            "lineNumber": 660
          },
          {
            "text": "                    INSERT INTO system_metrics (cpu_usage, memory_usage, network_traffic, timestamp, resource_type)",
            "lineNumber": 661
          },
          {
            "text": "                    VALUES (%s, %s, %s, %s, %s);",
            "lineNumber": 662
          },
          {
            "text": "                \"\"\"",
            "lineNumber": 663
          },
          {
            "text": "                ",
            "lineNumber": 664
          },
          {
            "text": "                # Insert CPU metric",
            "lineNumber": 665
          },
          {
            "text": "                if cpu_usage is not None:",
            "lineNumber": 666
          },
          {
            "text": "                    cursor.execute(",
            "lineNumber": 667
          },
          {
            "text": "                        insert_query,",
            "lineNumber": 668
          },
          {
            "text": "                        (float(cpu_usage), None, None, server_timestamp, 'CPU')",
            "lineNumber": 669
          },
          {
            "text": "                    )",
            "lineNumber": 670
          },
          {
            "text": "                ",
            "lineNumber": 671
          },
          {
            "text": "                # Insert Memory metric",
            "lineNumber": 672
          },
          {
            "text": "                if",
            "lineNumber": 673
          }
        ]
      },
      "score": 0.5355896353721619
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 605
          },
          "endPosition": {
            "line": 758
          }
        },
        "contents": "def store_all_metrics(all_metrics: Dict) -&gt; bool:\n\"\"\"\n            \n            # Process each provider's metrics\n            for provider, metrics_list in cloud_metrics.items():\n                if not isinstance(metrics_list, list):\n                    continue\n                \n                try:\n                    for metric in metrics_list:\n                        if not isinstance(metric, dict):\n                            continue\n                        \n                        provider_name = metric.get('provider', provider)\n                        metric_name = metric.get('metric_name', '')\n                        metric_value = metric.get('metric_value')\n                        metric_timestamp = metric.get('timestamp')\n                        resource_type = metric.get('resource_type', 'Unknown')\n                        \n                        # Convert timestamp if needed\n                        if isinstance(metric_timestamp, str):\n                            try:\n                                # Try ISO format parsing (Python 3.7+)\n                                metric_timestamp = datetime.fromisoformat(metric_timestamp.replace('Z', '+00:00'))\n                            except (ValueError, AttributeError):\n                                metric_timestamp = datetime.now()\n                        elif not isinstance(metric_timestamp, datetime):\n                            metric_timestamp = datetime.now()\n                        \n                        # Insert cloud metric\n                        if metric_value is not None and metric_name:\n                            cursor.execute(\n                                cloud_insert_query,\n                                (\n                                    provider_name,\n                                    metric_name,\n                                    float(metric_value),\n                                    metric_timestamp,\n                                    resource_type\n                                )\n                            )\n                    \n                    storage_success = True",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 606,
                "column": 1
              },
              "endPosition": {
                "line": 607,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "def store_all_metrics(all_metrics: Dict) -&gt; bool:",
            "lineNumber": 606,
            "isSignature": true
          },
          {
            "text": "\"\"\"",
            "lineNumber": 691
          },
          {
            "text": "            ",
            "lineNumber": 692
          },
          {
            "text": "            # Process each provider's metrics",
            "lineNumber": 693
          },
          {
            "text": "            for provider, metrics_list in cloud_metrics.items():",
            "lineNumber": 694
          },
          {
            "text": "                if not isinstance(metrics_list, list):",
            "lineNumber": 695
          },
          {
            "text": "                    continue",
            "lineNumber": 696
          },
          {
            "text": "                ",
            "lineNumber": 697
          },
          {
            "text": "                try:",
            "lineNumber": 698
          },
          {
            "text": "                    for metric in metrics_list:",
            "lineNumber": 699
          },
          {
            "text": "                        if not isinstance(metric, dict):",
            "lineNumber": 700
          },
          {
            "text": "                            continue",
            "lineNumber": 701
          },
          {
            "text": "                        ",
            "lineNumber": 702
          },
          {
            "text": "                        provider_name = metric.get('provider', provider)",
            "lineNumber": 703
          },
          {
            "text": "                        metric_name = metric.get('metric_name', '')",
            "lineNumber": 704
          },
          {
            "text": "                        metric_value = metric.get('metric_value')",
            "lineNumber": 705
          },
          {
            "text": "                        metric_timestamp = metric.get('timestamp')",
            "lineNumber": 706
          },
          {
            "text": "                        resource_type = metric.get('resource_type', 'Unknown')",
            "lineNumber": 707
          },
          {
            "text": "                        ",
            "lineNumber": 708
          },
          {
            "text": "                        # Convert timestamp if needed",
            "lineNumber": 709
          },
          {
            "text": "                        if isinstance(metric_timestamp, str):",
            "lineNumber": 710
          },
          {
            "text": "                            try:",
            "lineNumber": 711
          },
          {
            "text": "                                # Try ISO format parsing (Python 3.7+)",
            "lineNumber": 712
          },
          {
            "text": "                                metric_timestamp = datetime.fromisoformat(metric_timestamp.replace('Z', '+00:00'))",
            "lineNumber": 713
          },
          {
            "text": "                            except (ValueError, AttributeError):",
            "lineNumber": 714
          },
          {
            "text": "                                metric_timestamp = datetime.now()",
            "lineNumber": 715
          },
          {
            "text": "                        elif not isinstance(metric_timestamp, datetime):",
            "lineNumber": 716
          },
          {
            "text": "                            metric_timestamp = datetime.now()",
            "lineNumber": 717
          },
          {
            "text": "                        ",
            "lineNumber": 718
          },
          {
            "text": "                        # Insert cloud metric",
            "lineNumber": 719
          },
          {
            "text": "                        if metric_value is not None and metric_name:",
            "lineNumber": 720
          },
          {
            "text": "                            cursor.execute(",
            "lineNumber": 721
          },
          {
            "text": "                                cloud_insert_query,",
            "lineNumber": 722
          },
          {
            "text": "                                (",
            "lineNumber": 723
          },
          {
            "text": "                                    provider_name,",
            "lineNumber": 724
          },
          {
            "text": "                                    metric_name,",
            "lineNumber": 725
          },
          {
            "text": "                                    float(metric_value),",
            "lineNumber": 726
          },
          {
            "text": "                                    metric_timestamp,",
            "lineNumber": 727
          },
          {
            "text": "                                    resource_type",
            "lineNumber": 728
          },
          {
            "text": "                                )",
            "lineNumber": 729
          },
          {
            "text": "                            )",
            "lineNumber": 730
          },
          {
            "text": "                    ",
            "lineNumber": 731
          },
          {
            "text": "                    storage_success = True",
            "lineNumber": 732
          }
        ]
      },
      "score": 0.5337896347045898
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\collect_metrics.py",
        "range": {
          "startPosition": {
            "line": 61,
            "column": 75
          },
          "endPosition": {
            "line": 110
          }
        },
        "contents": "def run_all_metrics_collection():\n    \"\"\"\n    Job function to collect all metrics (server and cloud).\n    \n    This function is called by the scheduler at regular intervals.\n    It collects both server and cloud metrics into a unified structure\n    and stores them in the database.\n    \"\"\"\n    logger = logging.getLogger(__name__)\n    try:\n        logger.info(f\"Starting all metrics collection (server + cloud) at {datetime.now()}\")\n        all_metrics = collect_all_metrics()\n        \n        # Log summary of collected metrics\n        server_ok = 'error' not in all_metrics.get('server_metrics', {})\n        cloud_providers = len([k for k, v in all_metrics.get('cloud_metrics', {}).items() if v and not isinstance(v, list) or len(v) &gt; 0])\n        \n        logger.info(\n            f\"All metrics collection completed. Server metrics: {'OK' if server_ok else 'Failed'}, \"\n            f\"Cloud providers with metrics: {cloud_providers}\"\n        )\n        \n        # Log metric counts per provider\n        for provider, metrics in all_metrics.get('cloud_metrics', {}).items():\n            if isinstance(metrics, list):\n                logger.info(f\"  {provider.upper()}: {len(metrics)} metrics collected\")\n            elif metrics:\n                logger.debug(f\"  {provider.upper()}: {metrics}\")\n        \n        # Store metrics in database\n        try:\n            from data_collection.database import store_all_metrics\n            storage_success = store_all_metrics(all_metrics)\n            if storage_success:\n                logger.info(\"All metrics stored in database successfully\")\n            else:\n                logger.warning(\"Failed to store all metrics in database\")\n        except ImportError as e:\n            logger.warning(f\"Database storage module not available: {str(e)}\")\n        except Exception as e:\n            logger.error(f\"Error storing metrics: {e}\", exc_info=True)\n        \n        return all_metrics\n        \n    except Exception as e:\n        logger.error",
        "signatures": {},
        "detailedLines": [
          {
            "text": "def run_all_metrics_collection():",
            "lineNumber": 65,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 66
          },
          {
            "text": "    Job function to collect all metrics (server and cloud).",
            "lineNumber": 67
          },
          {
            "text": "    ",
            "lineNumber": 68
          },
          {
            "text": "    This function is called by the scheduler at regular intervals.",
            "lineNumber": 69
          },
          {
            "text": "    It collects both server and cloud metrics into a unified structure",
            "lineNumber": 70
          },
          {
            "text": "    and stores them in the database.",
            "lineNumber": 71
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 72
          },
          {
            "text": "    logger = logging.getLogger(__name__)",
            "lineNumber": 73
          },
          {
            "text": "    try:",
            "lineNumber": 74
          },
          {
            "text": "        logger.info(f\"Starting all metrics collection (server + cloud) at {datetime.now()}\")",
            "lineNumber": 75
          },
          {
            "text": "        all_metrics = collect_all_metrics()",
            "lineNumber": 76
          },
          {
            "text": "        ",
            "lineNumber": 77
          },
          {
            "text": "        # Log summary of collected metrics",
            "lineNumber": 78
          },
          {
            "text": "        server_ok = 'error' not in all_metrics.get('server_metrics', {})",
            "lineNumber": 79
          },
          {
            "text": "        cloud_providers = len([k for k, v in all_metrics.get('cloud_metrics', {}).items() if v and not isinstance(v, list) or len(v) &gt; 0])",
            "lineNumber": 80
          },
          {
            "text": "        ",
            "lineNumber": 81
          },
          {
            "text": "        logger.info(",
            "lineNumber": 82
          },
          {
            "text": "            f\"All metrics collection completed. Server metrics: {'OK' if server_ok else 'Failed'}, \"",
            "lineNumber": 83
          },
          {
            "text": "            f\"Cloud providers with metrics: {cloud_providers}\"",
            "lineNumber": 84
          },
          {
            "text": "        )",
            "lineNumber": 85
          },
          {
            "text": "        ",
            "lineNumber": 86
          },
          {
            "text": "        # Log metric counts per provider",
            "lineNumber": 87
          },
          {
            "text": "        for provider, metrics in all_metrics.get('cloud_metrics', {}).items():",
            "lineNumber": 88
          },
          {
            "text": "            if isinstance(metrics, list):",
            "lineNumber": 89
          },
          {
            "text": "                logger.info(f\"  {provider.upper()}: {len(metrics)} metrics collected\")",
            "lineNumber": 90
          },
          {
            "text": "            elif metrics:",
            "lineNumber": 91
          },
          {
            "text": "                logger.debug(f\"  {provider.upper()}: {metrics}\")",
            "lineNumber": 92
          },
          {
            "text": "        ",
            "lineNumber": 93
          },
          {
            "text": "        # Store metrics in database",
            "lineNumber": 94
          },
          {
            "text": "        try:",
            "lineNumber": 95
          },
          {
            "text": "            from data_collection.database import store_all_metrics",
            "lineNumber": 96
          },
          {
            "text": "            storage_success = store_all_metrics(all_metrics)",
            "lineNumber": 97
          },
          {
            "text": "            if storage_success:",
            "lineNumber": 98
          },
          {
            "text": "                logger.info(\"All metrics stored in database successfully\")",
            "lineNumber": 99
          },
          {
            "text": "            else:",
            "lineNumber": 100
          },
          {
            "text": "                logger.warning(\"Failed to store all metrics in database\")",
            "lineNumber": 101
          },
          {
            "text": "        except ImportError as e:",
            "lineNumber": 102
          },
          {
            "text": "            logger.warning(f\"Database storage module not available: {str(e)}\")",
            "lineNumber": 103
          },
          {
            "text": "        except Exception as e:",
            "lineNumber": 104
          },
          {
            "text": "            logger.error(f\"Error storing metrics: {e}\", exc_info=True)",
            "lineNumber": 105
          },
          {
            "text": "        ",
            "lineNumber": 106
          },
          {
            "text": "        return all_metrics",
            "lineNumber": 107
          },
          {
            "text": "        ",
            "lineNumber": 108
          },
          {
            "text": "    except Exception as e:",
            "lineNumber": 109
          },
          {
            "text": "        logger.error",
            "lineNumber": 110
          }
        ]
      },
      "score": 0.507020890712738
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 496,
            "column": 20
          },
          "endPosition": {
            "line": 602
          }
        },
        "contents": "def store_metrics(cpu_data: Dict, memory_data: Dict, network_data: Dict) -&gt; bool:\n    \"\"\"\n    Store system metrics (CPU, memory, network) in the PostgreSQL database.\n    \n    Each metric type is stored as a separate row with the appropriate\n    resource_type. The function uses a single transaction to ensure\n    all three inserts succeed or fail together.\n    \n    Args:\n        cpu_data: Dictionary from get_cpu_usage() containing cpu_percent and timestamp\n        memory_data: Dictionary from get_memory_usage() containing percent/used and timestamp\n        network_data: Dictionary from get_network_traffic() containing bytes_sent/bytes_recv and timestamp\n    \n    Returns:\n        True if all metrics stored successfully, False otherwise\n    \"\"\"\n    conn = None\n    try:\n        # Establish database connection\n        conn = connect_to_db()\n        if conn is None:\n            print(\"Failed to establish database connection\")\n            return False\n        \n        cursor = conn.cursor()\n        \n        # Extract values from metric dictionaries\n        # CPU metric\n        cpu_usage = cpu_data.get('cpu_percent', 0.0)\n        cpu_timestamp = cpu_data.get('timestamp')\n        if isinstance(cpu_timestamp, datetime):\n            cpu_timestamp = cpu_timestamp\n        else:\n            cpu_timestamp = datetime.now()\n        \n        # Memory metric - use percent if available, otherwise use used bytes\n        memory_usage = memory_data.get('percent')\n        if memory_usage is None:\n            memory_usage = memory_data.get('used', 0)\n        memory_timestamp = memory_data.get('timestamp')\n        if isinstance(memory_timestamp, datetime):\n            memory_timestamp = memory_timestamp\n        else:\n            memory_timestamp = datetime.now()\n        \n        # Network metric - sum of bytes sent and received\n        bytes_sent = network_data.get('bytes_sent', 0)\n        bytes_recv = network_data.get('bytes_recv', 0)\n        network_traffic = bytes_sent + bytes_recv\n        network_timestamp = network_data.get('timestamp')\n        if isinstance(network_timestamp, datetime):",
        "signatures": {},
        "detailedLines": [
          {
            "text": "def store_metrics(cpu_data: Dict, memory_data: Dict, network_data: Dict) -&gt; bool:",
            "lineNumber": 500,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 501
          },
          {
            "text": "    Store system metrics (CPU, memory, network) in the PostgreSQL database.",
            "lineNumber": 502
          },
          {
            "text": "    ",
            "lineNumber": 503
          },
          {
            "text": "    Each metric type is stored as a separate row with the appropriate",
            "lineNumber": 504
          },
          {
            "text": "    resource_type. The function uses a single transaction to ensure",
            "lineNumber": 505
          },
          {
            "text": "    all three inserts succeed or fail together.",
            "lineNumber": 506
          },
          {
            "text": "    ",
            "lineNumber": 507
          },
          {
            "text": "    Args:",
            "lineNumber": 508
          },
          {
            "text": "        cpu_data: Dictionary from get_cpu_usage() containing cpu_percent and timestamp",
            "lineNumber": 509
          },
          {
            "text": "        memory_data: Dictionary from get_memory_usage() containing percent/used and timestamp",
            "lineNumber": 510
          },
          {
            "text": "        network_data: Dictionary from get_network_traffic() containing bytes_sent/bytes_recv and timestamp",
            "lineNumber": 511
          },
          {
            "text": "    ",
            "lineNumber": 512
          },
          {
            "text": "    Returns:",
            "lineNumber": 513
          },
          {
            "text": "        True if all metrics stored successfully, False otherwise",
            "lineNumber": 514
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 515
          },
          {
            "text": "    conn = None",
            "lineNumber": 516
          },
          {
            "text": "    try:",
            "lineNumber": 517
          },
          {
            "text": "        # Establish database connection",
            "lineNumber": 518
          },
          {
            "text": "        conn = connect_to_db()",
            "lineNumber": 519
          },
          {
            "text": "        if conn is None:",
            "lineNumber": 520
          },
          {
            "text": "            print(\"Failed to establish database connection\")",
            "lineNumber": 521
          },
          {
            "text": "            return False",
            "lineNumber": 522
          },
          {
            "text": "        ",
            "lineNumber": 523
          },
          {
            "text": "        cursor = conn.cursor()",
            "lineNumber": 524
          },
          {
            "text": "        ",
            "lineNumber": 525
          },
          {
            "text": "        # Extract values from metric dictionaries",
            "lineNumber": 526
          },
          {
            "text": "        # CPU metric",
            "lineNumber": 527
          },
          {
            "text": "        cpu_usage = cpu_data.get('cpu_percent', 0.0)",
            "lineNumber": 528
          },
          {
            "text": "        cpu_timestamp = cpu_data.get('timestamp')",
            "lineNumber": 529
          },
          {
            "text": "        if isinstance(cpu_timestamp, datetime):",
            "lineNumber": 530
          },
          {
            "text": "            cpu_timestamp = cpu_timestamp",
            "lineNumber": 531
          },
          {
            "text": "        else:",
            "lineNumber": 532
          },
          {
            "text": "            cpu_timestamp = datetime.now()",
            "lineNumber": 533
          },
          {
            "text": "        ",
            "lineNumber": 534
          },
          {
            "text": "        # Memory metric - use percent if available, otherwise use used bytes",
            "lineNumber": 535
          },
          {
            "text": "        memory_usage = memory_data.get('percent')",
            "lineNumber": 536
          },
          {
            "text": "        if memory_usage is None:",
            "lineNumber": 537
          },
          {
            "text": "            memory_usage = memory_data.get('used', 0)",
            "lineNumber": 538
          },
          {
            "text": "        memory_timestamp = memory_data.get('timestamp')",
            "lineNumber": 539
          },
          {
            "text": "        if isinstance(memory_timestamp, datetime):",
            "lineNumber": 540
          },
          {
            "text": "            memory_timestamp = memory_timestamp",
            "lineNumber": 541
          },
          {
            "text": "        else:",
            "lineNumber": 542
          },
          {
            "text": "            memory_timestamp = datetime.now()",
            "lineNumber": 543
          },
          {
            "text": "        ",
            "lineNumber": 544
          },
          {
            "text": "        # Network metric - sum of bytes sent and received",
            "lineNumber": 545
          },
          {
            "text": "        bytes_sent = network_data.get('bytes_sent', 0)",
            "lineNumber": 546
          },
          {
            "text": "        bytes_recv = network_data.get('bytes_recv', 0)",
            "lineNumber": 547
          },
          {
            "text": "        network_traffic = bytes_sent + bytes_recv",
            "lineNumber": 548
          },
          {
            "text": "        network_timestamp = network_data.get('timestamp')",
            "lineNumber": 549
          },
          {
            "text": "        if isinstance(network_timestamp, datetime):",
            "lineNumber": 550
          }
        ]
      },
      "score": 0.5063190460205078
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 310,
            "column": 19
          },
          "endPosition": {
            "line": 414
          }
        },
        "contents": "def create_cloud_metrics_schema(conn) -&gt; bool:\n    \"\"\"\n    Create the database schema for storing cloud metrics.\n    \n    Creates a table called cloud_metrics with columns for provider,\n    metric_name, metric_value, timestamp, and resource_type.\n    \n    Args:\n        conn: psycopg2 connection object\n    \n    Returns:\n        True if schema creation successful, False otherwise\n    \"\"\"\n    if conn is None:\n        print(\"Error: Database connection is None\")\n        return False\n    \n    try:\n        cursor = conn.cursor()\n        \n        # Create cloud_metrics table\n        create_table_query = \"\"\"\n        CREATE TABLE IF NOT EXISTS cloud_metrics (\n            id SERIAL PRIMARY KEY,\n            provider TEXT NOT NULL,\n            metric_name TEXT NOT NULL,\n            metric_value NUMERIC,\n            timestamp TIMESTAMP,\n            resource_type TEXT NOT NULL\n        );\n        \"\"\"\n        \n        cursor.execute(create_table_query)\n        conn.commit()\n        cursor.close()\n        \n        return True\n    \n    except Error as e:\n        print(f\"Error creating cloud metrics schema: {e}\")\n        if conn:\n            conn.rollback()\n        return False\n    except Exception as e:\n        print(f\"Unexpected error creating cloud metrics schema: {e}\")\n        if conn:\n            conn.rollback()\n        return False\n\n\ndef create_unified_metrics_schema(conn) -&gt; bool:\n    \"\"\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "def create_cloud_metrics_schema(conn) -&gt; bool:",
            "lineNumber": 314,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 315
          },
          {
            "text": "    Create the database schema for storing cloud metrics.",
            "lineNumber": 316
          },
          {
            "text": "    ",
            "lineNumber": 317
          },
          {
            "text": "    Creates a table called cloud_metrics with columns for provider,",
            "lineNumber": 318
          },
          {
            "text": "    metric_name, metric_value, timestamp, and resource_type.",
            "lineNumber": 319
          },
          {
            "text": "    ",
            "lineNumber": 320
          },
          {
            "text": "    Args:",
            "lineNumber": 321
          },
          {
            "text": "        conn: psycopg2 connection object",
            "lineNumber": 322
          },
          {
            "text": "    ",
            "lineNumber": 323
          },
          {
            "text": "    Returns:",
            "lineNumber": 324
          },
          {
            "text": "        True if schema creation successful, False otherwise",
            "lineNumber": 325
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 326
          },
          {
            "text": "    if conn is None:",
            "lineNumber": 327
          },
          {
            "text": "        print(\"Error: Database connection is None\")",
            "lineNumber": 328
          },
          {
            "text": "        return False",
            "lineNumber": 329
          },
          {
            "text": "    ",
            "lineNumber": 330
          },
          {
            "text": "    try:",
            "lineNumber": 331
          },
          {
            "text": "        cursor = conn.cursor()",
            "lineNumber": 332
          },
          {
            "text": "        ",
            "lineNumber": 333
          },
          {
            "text": "        # Create cloud_metrics table",
            "lineNumber": 334
          },
          {
            "text": "        create_table_query = \"\"\"",
            "lineNumber": 335
          },
          {
            "text": "        CREATE TABLE IF NOT EXISTS cloud_metrics (",
            "lineNumber": 336
          },
          {
            "text": "            id SERIAL PRIMARY KEY,",
            "lineNumber": 337
          },
          {
            "text": "            provider TEXT NOT NULL,",
            "lineNumber": 338
          },
          {
            "text": "            metric_name TEXT NOT NULL,",
            "lineNumber": 339
          },
          {
            "text": "            metric_value NUMERIC,",
            "lineNumber": 340
          },
          {
            "text": "            timestamp TIMESTAMP,",
            "lineNumber": 341
          },
          {
            "text": "            resource_type TEXT NOT NULL",
            "lineNumber": 342
          },
          {
            "text": "        );",
            "lineNumber": 343
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 344
          },
          {
            "text": "        ",
            "lineNumber": 345
          },
          {
            "text": "        cursor.execute(create_table_query)",
            "lineNumber": 346
          },
          {
            "text": "        conn.commit()",
            "lineNumber": 347
          },
          {
            "text": "        cursor.close()",
            "lineNumber": 348
          },
          {
            "text": "        ",
            "lineNumber": 349
          },
          {
            "text": "        return True",
            "lineNumber": 350
          },
          {
            "text": "    ",
            "lineNumber": 351
          },
          {
            "text": "    except Error as e:",
            "lineNumber": 352
          },
          {
            "text": "        print(f\"Error creating cloud metrics schema: {e}\")",
            "lineNumber": 353
          },
          {
            "text": "        if conn:",
            "lineNumber": 354
          },
          {
            "text": "            conn.rollback()",
            "lineNumber": 355
          },
          {
            "text": "        return False",
            "lineNumber": 356
          },
          {
            "text": "    except Exception as e:",
            "lineNumber": 357
          },
          {
            "text": "        print(f\"Unexpected error creating cloud metrics schema: {e}\")",
            "lineNumber": 358
          },
          {
            "text": "        if conn:",
            "lineNumber": 359
          },
          {
            "text": "            conn.rollback()",
            "lineNumber": 360
          },
          {
            "text": "        return False",
            "lineNumber": 361,
            "isSignature": true
          },
          {
            "lineNumber": 362
          },
          {
            "lineNumber": 363
          },
          {
            "text": "def create_unified_metrics_schema(conn) -&gt; bool:",
            "lineNumber": 364,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 365
          }
        ]
      },
      "score": 0.4995630979537964
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 761
          },
          "endPosition": {
            "line": 1024
          }
        },
        "contents": "def store_unified_metrics(\n    cpu_usage: float,\n    memory_usage: float,\n    network_traffic: float,\n    resource_type: str,\n    cloud_compute: Optional[float] = None,\n    cloud_storage: Optional[float] = None,\n    cloud_bandwidth: Optional[float] = None,\n    timestamp: Optional[datetime] = None\n) -&gt; bool:\n\n        memory_usage_float = float(memory_usage)\n        network_traffic_float = float(network_traffic)\n        \n        # Execute insert\n        cursor.execute(\n            insert_query,\n            (\n                cpu_usage_float,\n                memory_usage_float,\n                network_traffic_float,\n                float(cloud_compute) if cloud_compute is not None else None,\n                float(cloud_storage) if cloud_storage is not None else None,\n                float(cloud_bandwidth) if cloud_bandwidth is not None else None,\n                metric_timestamp,\n                resource_type\n            )\n        )\n        \n        conn.commit()\n        cursor.close()\n        \n        return True\n    \n    except (Error, ValueError, TypeError) as e:\n        print(f\"Error storing unified metrics in database: {e}\")\n        if conn:\n            conn.rollback()\n        return False\n    except Exception as e:\n        print(f\"Unexpected error storing unified metrics: {e}\")\n        if conn:\n            conn.rollback()\n        return False\n    finally:\n        # Ensure connection is closed\n        if conn:\n            conn.close()\n\n\ndef store_all_metrics_unified(all_metrics: Dict) -&gt; bool:\n    \"\"\"",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 762,
                "column": 1
              },
              "endPosition": {
                "line": 772,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "def store_unified_metrics(",
            "lineNumber": 762,
            "isSignature": true
          },
          {
            "text": "    cpu_usage: float,",
            "lineNumber": 763,
            "isSignature": true
          },
          {
            "text": "    memory_usage: float,",
            "lineNumber": 764,
            "isSignature": true
          },
          {
            "text": "    network_traffic: float,",
            "lineNumber": 765,
            "isSignature": true
          },
          {
            "text": "    resource_type: str,",
            "lineNumber": 766,
            "isSignature": true
          },
          {
            "text": "    cloud_compute: Optional[float] = None,",
            "lineNumber": 767,
            "isSignature": true
          },
          {
            "text": "    cloud_storage: Optional[float] = None,",
            "lineNumber": 768,
            "isSignature": true
          },
          {
            "text": "    cloud_bandwidth: Optional[float] = None,",
            "lineNumber": 769,
            "isSignature": true
          },
          {
            "text": "    timestamp: Optional[datetime] = None",
            "lineNumber": 770,
            "isSignature": true
          },
          {
            "text": ") -&gt; bool:",
            "lineNumber": 771,
            "isSignature": true
          },
          {
            "lineNumber": 846
          },
          {
            "text": "        memory_usage_float = float(memory_usage)",
            "lineNumber": 847
          },
          {
            "text": "        network_traffic_float = float(network_traffic)",
            "lineNumber": 848
          },
          {
            "text": "        ",
            "lineNumber": 849
          },
          {
            "text": "        # Execute insert",
            "lineNumber": 850
          },
          {
            "text": "        cursor.execute(",
            "lineNumber": 851
          },
          {
            "text": "            insert_query,",
            "lineNumber": 852
          },
          {
            "text": "            (",
            "lineNumber": 853
          },
          {
            "text": "                cpu_usage_float,",
            "lineNumber": 854
          },
          {
            "text": "                memory_usage_float,",
            "lineNumber": 855
          },
          {
            "text": "                network_traffic_float,",
            "lineNumber": 856
          },
          {
            "text": "                float(cloud_compute) if cloud_compute is not None else None,",
            "lineNumber": 857
          },
          {
            "text": "                float(cloud_storage) if cloud_storage is not None else None,",
            "lineNumber": 858
          },
          {
            "text": "                float(cloud_bandwidth) if cloud_bandwidth is not None else None,",
            "lineNumber": 859
          },
          {
            "text": "                metric_timestamp,",
            "lineNumber": 860
          },
          {
            "text": "                resource_type",
            "lineNumber": 861
          },
          {
            "text": "            )",
            "lineNumber": 862
          },
          {
            "text": "        )",
            "lineNumber": 863
          },
          {
            "text": "        ",
            "lineNumber": 864
          },
          {
            "text": "        conn.commit()",
            "lineNumber": 865
          },
          {
            "text": "        cursor.close()",
            "lineNumber": 866
          },
          {
            "text": "        ",
            "lineNumber": 867
          },
          {
            "text": "        return True",
            "lineNumber": 868
          },
          {
            "text": "    ",
            "lineNumber": 869
          },
          {
            "text": "    except (Error, ValueError, TypeError) as e:",
            "lineNumber": 870
          },
          {
            "text": "        print(f\"Error storing unified metrics in database: {e}\")",
            "lineNumber": 871
          },
          {
            "text": "        if conn:",
            "lineNumber": 872
          },
          {
            "text": "            conn.rollback()",
            "lineNumber": 873
          },
          {
            "text": "        return False",
            "lineNumber": 874
          },
          {
            "text": "    except Exception as e:",
            "lineNumber": 875
          },
          {
            "text": "        print(f\"Unexpected error storing unified metrics: {e}\")",
            "lineNumber": 876
          },
          {
            "text": "        if conn:",
            "lineNumber": 877
          },
          {
            "text": "            conn.rollback()",
            "lineNumber": 878
          },
          {
            "text": "        return False",
            "lineNumber": 879
          },
          {
            "text": "    finally:",
            "lineNumber": 880
          },
          {
            "text": "        # Ensure connection is closed",
            "lineNumber": 881
          },
          {
            "text": "        if conn:",
            "lineNumber": 882
          },
          {
            "text": "            conn.close()",
            "lineNumber": 883,
            "isSignature": true
          },
          {
            "lineNumber": 884
          },
          {
            "lineNumber": 885
          },
          {
            "text": "def store_all_metrics_unified(all_metrics: Dict) -&gt; bool:",
            "lineNumber": 886,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 887
          }
        ]
      },
      "score": 0.4973278045654297
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 499
          },
          "endPosition": {
            "line": 758
          }
        },
        "contents": "def store_metrics(cpu_data: Dict, memory_data: Dict, network_data: Dict) -&gt; bool:\n\n        network_timestamp = network_data.get('timestamp')\n        if isinstance(network_timestamp, datetime):\n            network_timestamp = network_timestamp\n        else:\n            network_timestamp = datetime.now()\n        \n        # Use the earliest timestamp from all metrics (or current time)\n        # This ensures all three rows have the same timestamp\n        timestamps = [cpu_timestamp, memory_timestamp, network_timestamp]\n        metric_timestamp = min(timestamps) if timestamps else datetime.now()\n        \n        # Insert query template\n        insert_query = \"\"\"\n            INSERT INTO system_metrics (cpu_usage, memory_usage, network_traffic, timestamp, resource_type)\n            VALUES (%s, %s, %s, %s, %s);\n        \"\"\"\n        \n        # Insert CPU metric\n        cursor.execute(\n            insert_query,\n            (cpu_usage, None, None, metric_timestamp, 'CPU')\n        )\n        \n        # Insert Memory metric\n        cursor.execute(\n            insert_query,\n            (None, memory_usage, None, metric_timestamp, 'Memory')\n        )\n        \n        # Insert Network metric\n        cursor.execute(\n            insert_query,\n            (None, None, network_traffic, metric_timestamp, 'Network')\n        )\n        \n        # Commit transaction only after all three inserts succeed\n        conn.commit()\n        cursor.close()\n        \n        return True\n    \n    except Error as e:\n        print(f\"Error storing metrics in database: {e}\")\n        if conn:\n            conn.rollback()\n        return False\n    except Exception as e:\n        print(f\"Unexpected error storing metrics: {e}\")\n        if conn:\n            conn.rollback()\n        return False\n    finally:\n        # Ensure connection is closed\n        if conn:\n            conn.close()\n\n\ndef store_all_metrics(all_metrics: Dict) -&gt; bool:\n    \"\"\"",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 500,
                "column": 1
              },
              "endPosition": {
                "line": 501,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "def store_metrics(cpu_data: Dict, memory_data: Dict, network_data: Dict) -&gt; bool:",
            "lineNumber": 500,
            "isSignature": true
          },
          {
            "lineNumber": 548
          },
          {
            "text": "        network_timestamp = network_data.get('timestamp')",
            "lineNumber": 549
          },
          {
            "text": "        if isinstance(network_timestamp, datetime):",
            "lineNumber": 550
          },
          {
            "text": "            network_timestamp = network_timestamp",
            "lineNumber": 551
          },
          {
            "text": "        else:",
            "lineNumber": 552
          },
          {
            "text": "            network_timestamp = datetime.now()",
            "lineNumber": 553
          },
          {
            "text": "        ",
            "lineNumber": 554
          },
          {
            "text": "        # Use the earliest timestamp from all metrics (or current time)",
            "lineNumber": 555
          },
          {
            "text": "        # This ensures all three rows have the same timestamp",
            "lineNumber": 556
          },
          {
            "text": "        timestamps = [cpu_timestamp, memory_timestamp, network_timestamp]",
            "lineNumber": 557
          },
          {
            "text": "        metric_timestamp = min(timestamps) if timestamps else datetime.now()",
            "lineNumber": 558
          },
          {
            "text": "        ",
            "lineNumber": 559
          },
          {
            "text": "        # Insert query template",
            "lineNumber": 560
          },
          {
            "text": "        insert_query = \"\"\"",
            "lineNumber": 561
          },
          {
            "text": "            INSERT INTO system_metrics (cpu_usage, memory_usage, network_traffic, timestamp, resource_type)",
            "lineNumber": 562
          },
          {
            "text": "            VALUES (%s, %s, %s, %s, %s);",
            "lineNumber": 563
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 564
          },
          {
            "text": "        ",
            "lineNumber": 565
          },
          {
            "text": "        # Insert CPU metric",
            "lineNumber": 566
          },
          {
            "text": "        cursor.execute(",
            "lineNumber": 567
          },
          {
            "text": "            insert_query,",
            "lineNumber": 568
          },
          {
            "text": "            (cpu_usage, None, None, metric_timestamp, 'CPU')",
            "lineNumber": 569
          },
          {
            "text": "        )",
            "lineNumber": 570
          },
          {
            "text": "        ",
            "lineNumber": 571
          },
          {
            "text": "        # Insert Memory metric",
            "lineNumber": 572
          },
          {
            "text": "        cursor.execute(",
            "lineNumber": 573
          },
          {
            "text": "            insert_query,",
            "lineNumber": 574
          },
          {
            "text": "            (None, memory_usage, None, metric_timestamp, 'Memory')",
            "lineNumber": 575
          },
          {
            "text": "        )",
            "lineNumber": 576
          },
          {
            "text": "        ",
            "lineNumber": 577
          },
          {
            "text": "        # Insert Network metric",
            "lineNumber": 578
          },
          {
            "text": "        cursor.execute(",
            "lineNumber": 579
          },
          {
            "text": "            insert_query,",
            "lineNumber": 580
          },
          {
            "text": "            (None, None, network_traffic, metric_timestamp, 'Network')",
            "lineNumber": 581
          },
          {
            "text": "        )",
            "lineNumber": 582
          },
          {
            "text": "        ",
            "lineNumber": 583
          },
          {
            "text": "        # Commit transaction only after all three inserts succeed",
            "lineNumber": 584
          },
          {
            "text": "        conn.commit()",
            "lineNumber": 585
          },
          {
            "text": "        cursor.close()",
            "lineNumber": 586
          },
          {
            "text": "        ",
            "lineNumber": 587
          },
          {
            "text": "        return True",
            "lineNumber": 588
          },
          {
            "text": "    ",
            "lineNumber": 589
          },
          {
            "text": "    except Error as e:",
            "lineNumber": 590
          },
          {
            "text": "        print(f\"Error storing metrics in database: {e}\")",
            "lineNumber": 591
          },
          {
            "text": "        if conn:",
            "lineNumber": 592
          },
          {
            "text": "            conn.rollback()",
            "lineNumber": 593
          },
          {
            "text": "        return False",
            "lineNumber": 594
          },
          {
            "text": "    except Exception as e:",
            "lineNumber": 595
          },
          {
            "text": "        print(f\"Unexpected error storing metrics: {e}\")",
            "lineNumber": 596
          },
          {
            "text": "        if conn:",
            "lineNumber": 597
          },
          {
            "text": "            conn.rollback()",
            "lineNumber": 598
          },
          {
            "text": "        return False",
            "lineNumber": 599
          },
          {
            "text": "    finally:",
            "lineNumber": 600
          },
          {
            "text": "        # Ensure connection is closed",
            "lineNumber": 601
          },
          {
            "text": "        if conn:",
            "lineNumber": 602
          },
          {
            "text": "            conn.close()",
            "lineNumber": 603,
            "isSignature": true
          },
          {
            "lineNumber": 604
          },
          {
            "lineNumber": 605
          },
          {
            "text": "def store_all_metrics(all_metrics: Dict) -&gt; bool:",
            "lineNumber": 606,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 607
          }
        ]
      },
      "score": 0.48293590545654297
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 885
          },
          "endPosition": {
            "line": 1040
          }
        },
        "contents": "def store_all_metrics_unified(all_metrics: Dict) -&gt; bool:\n\n                    \n                    # Store cloud provider row (server metrics + cloud metrics)\n                    if cpu_usage is not None and memory_usage is not None:\n                        success = store_unified_metrics(\n                            cpu_usage=float(cpu_usage),\n                            memory_usage=float(memory_usage),\n                            network_traffic=network_traffic,\n                            resource_type=resource_type_name,\n                            cloud_compute=cloud_compute_sum if cloud_compute_sum &gt; 0 else None,\n                            cloud_storage=cloud_storage_sum if cloud_storage_sum &gt; 0 else None,\n                            cloud_bandwidth=cloud_bandwidth_sum if cloud_bandwidth_sum &gt; 0 else None,\n                            timestamp=provider_timestamp\n                        )\n                        if success:\n                            storage_success = True\n                \n                except Exception as e:\n                    print(f\"Error aggregating and storing {provider} metrics: {e}\")\n                    # Continue with other providers even if one fails\n        \n        return storage_success\n    \n    except Exception as e:\n        print(f\"Unexpected error in store_all_metrics_unified: {e}\")\n        return False\n\n\ndef get_database_connection(connection_string: str) -&gt; DatabaseConnection:\n    \"\"\"",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 886,
                "column": 1
              },
              "endPosition": {
                "line": 887,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "def store_all_metrics_unified(all_metrics: Dict) -&gt; bool:",
            "lineNumber": 886,
            "isSignature": true
          },
          {
            "lineNumber": 1000
          },
          {
            "text": "                    ",
            "lineNumber": 1001
          },
          {
            "text": "                    # Store cloud provider row (server metrics + cloud metrics)",
            "lineNumber": 1002
          },
          {
            "text": "                    if cpu_usage is not None and memory_usage is not None:",
            "lineNumber": 1003
          },
          {
            "text": "                        success = store_unified_metrics(",
            "lineNumber": 1004
          },
          {
            "text": "                            cpu_usage=float(cpu_usage),",
            "lineNumber": 1005
          },
          {
            "text": "                            memory_usage=float(memory_usage),",
            "lineNumber": 1006
          },
          {
            "text": "                            network_traffic=network_traffic,",
            "lineNumber": 1007
          },
          {
            "text": "                            resource_type=resource_type_name,",
            "lineNumber": 1008
          },
          {
            "text": "                            cloud_compute=cloud_compute_sum if cloud_compute_sum &gt; 0 else None,",
            "lineNumber": 1009
          },
          {
            "text": "                            cloud_storage=cloud_storage_sum if cloud_storage_sum &gt; 0 else None,",
            "lineNumber": 1010
          },
          {
            "text": "                            cloud_bandwidth=cloud_bandwidth_sum if cloud_bandwidth_sum &gt; 0 else None,",
            "lineNumber": 1011
          },
          {
            "text": "                            timestamp=provider_timestamp",
            "lineNumber": 1012
          },
          {
            "text": "                        )",
            "lineNumber": 1013
          },
          {
            "text": "                        if success:",
            "lineNumber": 1014
          },
          {
            "text": "                            storage_success = True",
            "lineNumber": 1015
          },
          {
            "text": "                ",
            "lineNumber": 1016
          },
          {
            "text": "                except Exception as e:",
            "lineNumber": 1017
          },
          {
            "text": "                    print(f\"Error aggregating and storing {provider} metrics: {e}\")",
            "lineNumber": 1018
          },
          {
            "text": "                    # Continue with other providers even if one fails",
            "lineNumber": 1019
          },
          {
            "text": "        ",
            "lineNumber": 1020
          },
          {
            "text": "        return storage_success",
            "lineNumber": 1021
          },
          {
            "text": "    ",
            "lineNumber": 1022
          },
          {
            "text": "    except Exception as e:",
            "lineNumber": 1023
          },
          {
            "text": "        print(f\"Unexpected error in store_all_metrics_unified: {e}\")",
            "lineNumber": 1024
          },
          {
            "text": "        return False",
            "lineNumber": 1025,
            "isSignature": true
          },
          {
            "lineNumber": 1026
          },
          {
            "lineNumber": 1027
          },
          {
            "text": "def get_database_connection(connection_string: str) -&gt; DatabaseConnection:",
            "lineNumber": 1028,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 1029
          }
        ]
      },
      "score": 0.4819391965866089
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 885
          },
          "endPosition": {
            "line": 1024
          }
        },
        "contents": "def store_all_metrics_unified(all_metrics: Dict) -&gt; bool:\n\n                if not isinstance(metrics_list, list) or len(metrics_list) == 0:\n                    continue\n                \n                try:\n                    # Initialize aggregation variables\n                    cloud_compute_sum = 0.0\n                    cloud_storage_sum = 0.0\n                    cloud_bandwidth_sum = 0.0\n                    provider_timestamp = server_timestamp  # Default to server timestamp\n                    \n                    # Aggregate cloud metrics by resource type\n                    for metric in metrics_list:\n                        if not isinstance(metric, dict):\n                            continue\n                        \n                        resource_type = metric.get('resource_type', '').lower()\n                        metric_name = metric.get('metric_name', '').lower()\n                        metric_value = metric.get('metric_value', 0.0)\n                        \n                        # Get timestamp from first metric (or use server timestamp)\n                        metric_timestamp = metric.get('timestamp')\n                        if metric_timestamp and provider_timestamp == server_timestamp:\n                            if isinstance(metric_timestamp, str):\n                                try:\n                                    provider_timestamp = datetime.fromisoformat(metric_timestamp.replace('Z', '+00:00'))\n                                except (ValueError, AttributeError):\n                                    pass\n                            elif isinstance(metric_timestamp, datetime):\n                                provider_timestamp = metric_timestamp\n                        \n                        ",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 886,
                "column": 1
              },
              "endPosition": {
                "line": 887,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "def store_all_metrics_unified(all_metrics: Dict) -&gt; bool:",
            "lineNumber": 886,
            "isSignature": true
          },
          {
            "lineNumber": 946
          },
          {
            "text": "                if not isinstance(metrics_list, list) or len(metrics_list) == 0:",
            "lineNumber": 947
          },
          {
            "text": "                    continue",
            "lineNumber": 948
          },
          {
            "text": "                ",
            "lineNumber": 949
          },
          {
            "text": "                try:",
            "lineNumber": 950
          },
          {
            "text": "                    # Initialize aggregation variables",
            "lineNumber": 951
          },
          {
            "text": "                    cloud_compute_sum = 0.0",
            "lineNumber": 952
          },
          {
            "text": "                    cloud_storage_sum = 0.0",
            "lineNumber": 953
          },
          {
            "text": "                    cloud_bandwidth_sum = 0.0",
            "lineNumber": 954
          },
          {
            "text": "                    provider_timestamp = server_timestamp  # Default to server timestamp",
            "lineNumber": 955
          },
          {
            "text": "                    ",
            "lineNumber": 956
          },
          {
            "text": "                    # Aggregate cloud metrics by resource type",
            "lineNumber": 957
          },
          {
            "text": "                    for metric in metrics_list:",
            "lineNumber": 958
          },
          {
            "text": "                        if not isinstance(metric, dict):",
            "lineNumber": 959
          },
          {
            "text": "                            continue",
            "lineNumber": 960
          },
          {
            "text": "                        ",
            "lineNumber": 961
          },
          {
            "text": "                        resource_type = metric.get('resource_type', '').lower()",
            "lineNumber": 962
          },
          {
            "text": "                        metric_name = metric.get('metric_name', '').lower()",
            "lineNumber": 963
          },
          {
            "text": "                        metric_value = metric.get('metric_value', 0.0)",
            "lineNumber": 964
          },
          {
            "text": "                        ",
            "lineNumber": 965
          },
          {
            "text": "                        # Get timestamp from first metric (or use server timestamp)",
            "lineNumber": 966
          },
          {
            "text": "                        metric_timestamp = metric.get('timestamp')",
            "lineNumber": 967
          },
          {
            "text": "                        if metric_timestamp and provider_timestamp == server_timestamp:",
            "lineNumber": 968
          },
          {
            "text": "                            if isinstance(metric_timestamp, str):",
            "lineNumber": 969
          },
          {
            "text": "                                try:",
            "lineNumber": 970
          },
          {
            "text": "                                    provider_timestamp = datetime.fromisoformat(metric_timestamp.replace('Z', '+00:00'))",
            "lineNumber": 971
          },
          {
            "text": "                                except (ValueError, AttributeError):",
            "lineNumber": 972
          },
          {
            "text": "                                    pass",
            "lineNumber": 973
          },
          {
            "text": "                            elif isinstance(metric_timestamp, datetime):",
            "lineNumber": 974
          },
          {
            "text": "                                provider_timestamp = metric_timestamp",
            "lineNumber": 975
          },
          {
            "text": "                        ",
            "lineNumber": 976
          },
          {
            "text": "                        ",
            "lineNumber": 977
          }
        ]
      },
      "score": 0.4622916877269745
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\system_metrics.py",
        "range": {
          "startPosition": {
            "line": 347,
            "column": 20
          },
          "endPosition": {
            "line": 435
          }
        },
        "contents": "def collect_all_metrics() -&gt; Dict:\n    \"\"\"\n    Collect both server and cloud metrics into a unified structure.\n    \n    Coordinates collection of:\n    - Server metrics (CPU usage, memory usage)\n    - Cloud metrics (AWS, GCP, Azure)\n    \n    Returns:\n        Dictionary containing:\n            - timestamp: str (ISO format timestamp when collection started)\n            - server_metrics: Dict (CPU and memory usage with timestamp)\n            - cloud_metrics: Dict (AWS, GCP, Azure metrics by provider)\n    \n    Errors are handled gracefully - if a cloud provider is not configured\n    or fails, it will be omitted from results rather than causing failure.\n    \"\"\"\n    from utils.logger import get_logger\n    logger = get_logger(__name__)\n    \n    # Capture collection start timestamp\n    collection_timestamp = datetime.now()\n    \n    # Initialize result structure\n    result = {\n        'timestamp': collection_timestamp.isoformat(),\n        'server_metrics': {},\n        'cloud_metrics': {}\n    }\n    \n    # Collect server metrics\n    try:\n        result['server_metrics'] = get_server_metrics()\n        logger.info(\"Server metrics collected successfully\")\n    except RuntimeError as e:\n        logger.error(f\"Failed to collect server metrics: {str(e)}\")\n        result['server_metrics'] = {'error': str(e)}\n    except Exception as e:\n        logger.error(f\"Unexpected error collecting server metrics: {str(e)}\", exc_info=True)\n        result['server_metrics'] = {'error': str(e)}\n    \n    # Collect cloud metrics - handle each provider independently\n    try:\n        from data_collection.cloud_metrics import get_aws_metrics, get_gcp_metrics, get_azure_metrics\n    except ImportError as e:\n        logger.warning(f\"Cloud metrics module not available: {str(e)}\")\n        result['cloud_metrics'] = {'error': 'Cloud metrics module not available'}\n        return result\n    \n    # Collect AWS metrics\n    try:\n        aws_metrics = get_aws_metrics()",
        "signatures": {},
        "detailedLines": [
          {
            "text": "def collect_all_metrics() -&gt; Dict:",
            "lineNumber": 351,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 352
          },
          {
            "text": "    Collect both server and cloud metrics into a unified structure.",
            "lineNumber": 353
          },
          {
            "text": "    ",
            "lineNumber": 354
          },
          {
            "text": "    Coordinates collection of:",
            "lineNumber": 355
          },
          {
            "text": "    - Server metrics (CPU usage, memory usage)",
            "lineNumber": 356
          },
          {
            "text": "    - Cloud metrics (AWS, GCP, Azure)",
            "lineNumber": 357
          },
          {
            "text": "    ",
            "lineNumber": 358
          },
          {
            "text": "    Returns:",
            "lineNumber": 359
          },
          {
            "text": "        Dictionary containing:",
            "lineNumber": 360
          },
          {
            "text": "            - timestamp: str (ISO format timestamp when collection started)",
            "lineNumber": 361
          },
          {
            "text": "            - server_metrics: Dict (CPU and memory usage with timestamp)",
            "lineNumber": 362
          },
          {
            "text": "            - cloud_metrics: Dict (AWS, GCP, Azure metrics by provider)",
            "lineNumber": 363
          },
          {
            "text": "    ",
            "lineNumber": 364
          },
          {
            "text": "    Errors are handled gracefully - if a cloud provider is not configured",
            "lineNumber": 365
          },
          {
            "text": "    or fails, it will be omitted from results rather than causing failure.",
            "lineNumber": 366
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 367
          },
          {
            "text": "    from utils.logger import get_logger",
            "lineNumber": 368
          },
          {
            "text": "    logger = get_logger(__name__)",
            "lineNumber": 369
          },
          {
            "text": "    ",
            "lineNumber": 370
          },
          {
            "text": "    # Capture collection start timestamp",
            "lineNumber": 371
          },
          {
            "text": "    collection_timestamp = datetime.now()",
            "lineNumber": 372
          },
          {
            "text": "    ",
            "lineNumber": 373
          },
          {
            "text": "    # Initialize result structure",
            "lineNumber": 374
          },
          {
            "text": "    result = {",
            "lineNumber": 375
          },
          {
            "text": "        'timestamp': collection_timestamp.isoformat(),",
            "lineNumber": 376
          },
          {
            "text": "        'server_metrics': {},",
            "lineNumber": 377
          },
          {
            "text": "        'cloud_metrics': {}",
            "lineNumber": 378
          },
          {
            "text": "    }",
            "lineNumber": 379
          },
          {
            "text": "    ",
            "lineNumber": 380
          },
          {
            "text": "    # Collect server metrics",
            "lineNumber": 381
          },
          {
            "text": "    try:",
            "lineNumber": 382
          },
          {
            "text": "        result['server_metrics'] = get_server_metrics()",
            "lineNumber": 383
          },
          {
            "text": "        logger.info(\"Server metrics collected successfully\")",
            "lineNumber": 384
          },
          {
            "text": "    except RuntimeError as e:",
            "lineNumber": 385
          },
          {
            "text": "        logger.error(f\"Failed to collect server metrics: {str(e)}\")",
            "lineNumber": 386
          },
          {
            "text": "        result['server_metrics'] = {'error': str(e)}",
            "lineNumber": 387
          },
          {
            "text": "    except Exception as e:",
            "lineNumber": 388
          },
          {
            "text": "        logger.error(f\"Unexpected error collecting server metrics: {str(e)}\", exc_info=True)",
            "lineNumber": 389
          },
          {
            "text": "        result['server_metrics'] = {'error': str(e)}",
            "lineNumber": 390
          },
          {
            "text": "    ",
            "lineNumber": 391
          },
          {
            "text": "    # Collect cloud metrics - handle each provider independently",
            "lineNumber": 392
          },
          {
            "text": "    try:",
            "lineNumber": 393
          },
          {
            "text": "        from data_collection.cloud_metrics import get_aws_metrics, get_gcp_metrics, get_azure_metrics",
            "lineNumber": 394
          },
          {
            "text": "    except ImportError as e:",
            "lineNumber": 395
          },
          {
            "text": "        logger.warning(f\"Cloud metrics module not available: {str(e)}\")",
            "lineNumber": 396
          },
          {
            "text": "        result['cloud_metrics'] = {'error': 'Cloud metrics module not available'}",
            "lineNumber": 397
          },
          {
            "text": "        return result",
            "lineNumber": 398
          },
          {
            "text": "    ",
            "lineNumber": 399
          },
          {
            "text": "    # Collect AWS metrics",
            "lineNumber": 400
          },
          {
            "text": "    try:",
            "lineNumber": 401
          },
          {
            "text": "        aws_metrics = get_aws_metrics()",
            "lineNumber": 402
          }
        ]
      },
      "score": 0.4267176389694214
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\cloud_metrics.py",
        "range": {
          "startPosition": {
            "line": 54,
            "column": 33
          },
          "endPosition": {
            "line": 114
          }
        },
        "contents": "    AzureError = Exception\n\n# Import settings and logger\ntry:\n    from config.settings import get_settings\n    from utils.logger import get_logger\nexcept ImportError:\n    def get_settings():\n        return None\n    def get_logger(name):\n        import logging\n        return logging.getLogger(name)\n\n\ndef standardize_metrics(\n    provider: str,\n    metric_name: str,\n    metric_value: float,\n    timestamp: datetime,\n    resource_type: str\n) -&gt; Dict:\n    \"\"\"\n    Standardize cloud metrics into a consistent format.\n    \n    Args:\n        provider: Cloud provider name ('aws', 'azure', 'gcp')\n        metric_name: Name of the metric (e.g., 'CPUUtilization', 'DiskWrite')\n        metric_value: Metric value (numeric)\n        timestamp: Timestamp when metric was collected\n        resource_type: Type of resource ('Compute', 'Storage', 'Network')\n    \n    Returns:\n        Standardized dictionary with provider, metric_name, metric_value, timestamp, resource_type\n    \"\"\"\n    return {\n        'provider': provider,\n        'metric_name': metric_name,\n        'metric_value': float(metric_value) if metric_value is not None else 0.0,\n        'timestamp': timestamp.isoformat() if isinstance(timestamp, datetime) else timestamp,\n        'resource_type': resource_type\n    }\n\n\nclass CloudProvider(ABC):\n    \"\"\"Abstract base class for cloud provider integrations.\"\"\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "    AzureError = Exception",
            "lineNumber": 56
          },
          {
            "lineNumber": 57
          },
          {
            "text": "# Import settings and logger",
            "lineNumber": 58
          },
          {
            "text": "try:",
            "lineNumber": 59
          },
          {
            "text": "    from config.settings import get_settings",
            "lineNumber": 60
          },
          {
            "text": "    from utils.logger import get_logger",
            "lineNumber": 61
          },
          {
            "text": "except ImportError:",
            "lineNumber": 62
          },
          {
            "text": "    def get_settings():",
            "lineNumber": 63
          },
          {
            "text": "        return None",
            "lineNumber": 64
          },
          {
            "text": "    def get_logger(name):",
            "lineNumber": 65
          },
          {
            "text": "        import logging",
            "lineNumber": 66
          },
          {
            "text": "        return logging.getLogger(name)",
            "lineNumber": 67
          },
          {
            "lineNumber": 68
          },
          {
            "lineNumber": 69
          },
          {
            "text": "def standardize_metrics(",
            "lineNumber": 70,
            "isSignature": true
          },
          {
            "text": "    provider: str,",
            "lineNumber": 71,
            "isSignature": true
          },
          {
            "text": "    metric_name: str,",
            "lineNumber": 72,
            "isSignature": true
          },
          {
            "text": "    metric_value: float,",
            "lineNumber": 73,
            "isSignature": true
          },
          {
            "text": "    timestamp: datetime,",
            "lineNumber": 74,
            "isSignature": true
          },
          {
            "text": "    resource_type: str",
            "lineNumber": 75,
            "isSignature": true
          },
          {
            "text": ") -&gt; Dict:",
            "lineNumber": 76,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 77
          },
          {
            "text": "    Standardize cloud metrics into a consistent format.",
            "lineNumber": 78
          },
          {
            "text": "    ",
            "lineNumber": 79
          },
          {
            "text": "    Args:",
            "lineNumber": 80
          },
          {
            "text": "        provider: Cloud provider name ('aws', 'azure', 'gcp')",
            "lineNumber": 81
          },
          {
            "text": "        metric_name: Name of the metric (e.g., 'CPUUtilization', 'DiskWrite')",
            "lineNumber": 82
          },
          {
            "text": "        metric_value: Metric value (numeric)",
            "lineNumber": 83
          },
          {
            "text": "        timestamp: Timestamp when metric was collected",
            "lineNumber": 84
          },
          {
            "text": "        resource_type: Type of resource ('Compute', 'Storage', 'Network')",
            "lineNumber": 85
          },
          {
            "text": "    ",
            "lineNumber": 86
          },
          {
            "text": "    Returns:",
            "lineNumber": 87
          },
          {
            "text": "        Standardized dictionary with provider, metric_name, metric_value, timestamp, resource_type",
            "lineNumber": 88
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 89
          },
          {
            "text": "    return {",
            "lineNumber": 90
          },
          {
            "text": "        'provider': provider,",
            "lineNumber": 91
          },
          {
            "text": "        'metric_name': metric_name,",
            "lineNumber": 92
          },
          {
            "text": "        'metric_value': float(metric_value) if metric_value is not None else 0.0,",
            "lineNumber": 93
          },
          {
            "text": "        'timestamp': timestamp.isoformat() if isinstance(timestamp, datetime) else timestamp,",
            "lineNumber": 94
          },
          {
            "text": "        'resource_type': resource_type",
            "lineNumber": 95
          },
          {
            "text": "    }",
            "lineNumber": 96,
            "isSignature": true
          },
          {
            "lineNumber": 97
          },
          {
            "lineNumber": 98
          },
          {
            "text": "class CloudProvider(ABC):",
            "lineNumber": 99,
            "isSignature": true
          },
          {
            "text": "    \"\"\"Abstract base class for cloud provider integrations.\"\"\"",
            "lineNumber": 100
          }
        ]
      },
      "score": 0.39397042989730835
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 885
          },
          "endPosition": {
            "line": 1024
          }
        },
        "contents": "def store_all_metrics_unified(all_metrics: Dict) -&gt; bool:\n\n                        \n                        # Aggregate by resource type\n                        if resource_type == 'compute' or 'cpu' in metric_name:\n                            try:\n                                cloud_compute_sum += float(metric_value)\n                            except (ValueError, TypeError):\n                                pass\n                        elif resource_type == 'storage' or 'storage' in metric_name or 'bucket' in metric_name or 'size' in metric_name:\n                            try:\n                                cloud_storage_sum += float(metric_value)\n                            except (ValueError, TypeError):\n                                pass\n                        elif resource_type == 'network' or 'network' in metric_name or 'bandwidth' in metric_name or 'egress' in metric_name:\n                            try:\n                                cloud_bandwidth_sum += float(metric_value)\n                            except (ValueError, TypeError):\n                                pass\n                    \n                    # Map provider name to resource_type\n                    provider_map = {\n                        'aws': 'AWS',\n                        'gcp': 'GCP',\n                        'azure': 'Azure'\n                    }\n                    resource_type_name = provider_map.get(provider.lower(), provider.upper())\n                    \n                    ",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 886,
                "column": 1
              },
              "endPosition": {
                "line": 887,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "def store_all_metrics_unified(all_metrics: Dict) -&gt; bool:",
            "lineNumber": 886,
            "isSignature": true
          },
          {
            "lineNumber": 975
          },
          {
            "text": "                        ",
            "lineNumber": 976
          },
          {
            "text": "                        # Aggregate by resource type",
            "lineNumber": 977
          },
          {
            "text": "                        if resource_type == 'compute' or 'cpu' in metric_name:",
            "lineNumber": 978
          },
          {
            "text": "                            try:",
            "lineNumber": 979
          },
          {
            "text": "                                cloud_compute_sum += float(metric_value)",
            "lineNumber": 980
          },
          {
            "text": "                            except (ValueError, TypeError):",
            "lineNumber": 981
          },
          {
            "text": "                                pass",
            "lineNumber": 982
          },
          {
            "text": "                        elif resource_type == 'storage' or 'storage' in metric_name or 'bucket' in metric_name or 'size' in metric_name:",
            "lineNumber": 983
          },
          {
            "text": "                            try:",
            "lineNumber": 984
          },
          {
            "text": "                                cloud_storage_sum += float(metric_value)",
            "lineNumber": 985
          },
          {
            "text": "                            except (ValueError, TypeError):",
            "lineNumber": 986
          },
          {
            "text": "                                pass",
            "lineNumber": 987
          },
          {
            "text": "                        elif resource_type == 'network' or 'network' in metric_name or 'bandwidth' in metric_name or 'egress' in metric_name:",
            "lineNumber": 988
          },
          {
            "text": "                            try:",
            "lineNumber": 989
          },
          {
            "text": "                                cloud_bandwidth_sum += float(metric_value)",
            "lineNumber": 990
          },
          {
            "text": "                            except (ValueError, TypeError):",
            "lineNumber": 991
          },
          {
            "text": "                                pass",
            "lineNumber": 992
          },
          {
            "text": "                    ",
            "lineNumber": 993
          },
          {
            "text": "                    # Map provider name to resource_type",
            "lineNumber": 994
          },
          {
            "text": "                    provider_map = {",
            "lineNumber": 995
          },
          {
            "text": "                        'aws': 'AWS',",
            "lineNumber": 996
          },
          {
            "text": "                        'gcp': 'GCP',",
            "lineNumber": 997
          },
          {
            "text": "                        'azure': 'Azure'",
            "lineNumber": 998
          },
          {
            "text": "                    }",
            "lineNumber": 999
          },
          {
            "text": "                    resource_type_name = provider_map.get(provider.lower(), provider.upper())",
            "lineNumber": 1000
          },
          {
            "text": "                    ",
            "lineNumber": 1001
          },
          {
            "text": "                    ",
            "lineNumber": 1002
          }
        ]
      },
      "score": 0.38640159368515015
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\system_metrics.py",
        "range": {
          "startPosition": {
            "line": 292,
            "column": 73
          },
          "endPosition": {
            "line": 435
          }
        },
        "contents": "def collect_and_store_metrics() -&gt; bool:\n    \"\"\"\n    Collect system metrics and store them in the database.\n    \n    This function collects CPU, memory, and network metrics using\n    the individual collection functions and stores them in PostgreSQL.\n    \n    Returns:\n        True if collection and storage successful, False otherwise\n    \"\"\"\n    try:\n        # Import here to avoid circular dependencies\n        from data_collection.database import store_metrics\n        from utils.logger import get_logger\n        \n        logger = get_logger(__name__)\n        \n        # Collect all metrics\n        logger.info(\"Collecting system metrics...\")\n        cpu_data = get_cpu_usage()\n        memory_data = get_memory_usage()\n        network_data = get_network_traffic()\n        \n        # Store metrics in database\n        logger.info(\"Storing metrics in database...\")\n        success = store_metrics(cpu_data, memory_data, network_data)\n        \n        if success:\n            logger.info(\"Metrics collected and stored successfully\")\n        else:\n            logger.error(\"Failed to store metrics in database\")\n        \n        return success\n    \n    except RuntimeError as e:\n        # Handle errors from metric collection (e.g., psutil not available)\n        try:\n            from utils.logger import get_logger\n            logger = get_logger(__name__)\n            logger.error(f\"Failed to collect metrics: {str(e)}\")\n        except ImportError:\n            print(f\"Failed to collect metrics: {str(e)}\")\n        return False\n    \n    except Exception as e:\n        # Handle any other unexpected errors\n        try:\n            from utils.logger import get_logger\n            logger = get_logger(__name__)\n            logger.error(f\"Unexpected error during metric collection: {str(e)}\", exc_info=True)\n        except ImportError:\n            print(f\"Unexpected error during metric collection: {str(e)}\")\n        return False\n\n\ndef collect_all_metrics() -&gt; Dict:\n    \"\"\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "def collect_and_store_metrics() -&gt; bool:",
            "lineNumber": 296,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 297
          },
          {
            "text": "    Collect system metrics and store them in the database.",
            "lineNumber": 298
          },
          {
            "text": "    ",
            "lineNumber": 299
          },
          {
            "text": "    This function collects CPU, memory, and network metrics using",
            "lineNumber": 300
          },
          {
            "text": "    the individual collection functions and stores them in PostgreSQL.",
            "lineNumber": 301
          },
          {
            "text": "    ",
            "lineNumber": 302
          },
          {
            "text": "    Returns:",
            "lineNumber": 303
          },
          {
            "text": "        True if collection and storage successful, False otherwise",
            "lineNumber": 304
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 305
          },
          {
            "text": "    try:",
            "lineNumber": 306
          },
          {
            "text": "        # Import here to avoid circular dependencies",
            "lineNumber": 307
          },
          {
            "text": "        from data_collection.database import store_metrics",
            "lineNumber": 308
          },
          {
            "text": "        from utils.logger import get_logger",
            "lineNumber": 309
          },
          {
            "text": "        ",
            "lineNumber": 310
          },
          {
            "text": "        logger = get_logger(__name__)",
            "lineNumber": 311
          },
          {
            "text": "        ",
            "lineNumber": 312
          },
          {
            "text": "        # Collect all metrics",
            "lineNumber": 313
          },
          {
            "text": "        logger.info(\"Collecting system metrics...\")",
            "lineNumber": 314
          },
          {
            "text": "        cpu_data = get_cpu_usage()",
            "lineNumber": 315
          },
          {
            "text": "        memory_data = get_memory_usage()",
            "lineNumber": 316
          },
          {
            "text": "        network_data = get_network_traffic()",
            "lineNumber": 317
          },
          {
            "text": "        ",
            "lineNumber": 318
          },
          {
            "text": "        # Store metrics in database",
            "lineNumber": 319
          },
          {
            "text": "        logger.info(\"Storing metrics in database...\")",
            "lineNumber": 320
          },
          {
            "text": "        success = store_metrics(cpu_data, memory_data, network_data)",
            "lineNumber": 321
          },
          {
            "text": "        ",
            "lineNumber": 322
          },
          {
            "text": "        if success:",
            "lineNumber": 323
          },
          {
            "text": "            logger.info(\"Metrics collected and stored successfully\")",
            "lineNumber": 324
          },
          {
            "text": "        else:",
            "lineNumber": 325
          },
          {
            "text": "            logger.error(\"Failed to store metrics in database\")",
            "lineNumber": 326
          },
          {
            "text": "        ",
            "lineNumber": 327
          },
          {
            "text": "        return success",
            "lineNumber": 328
          },
          {
            "text": "    ",
            "lineNumber": 329
          },
          {
            "text": "    except RuntimeError as e:",
            "lineNumber": 330
          },
          {
            "text": "        # Handle errors from metric collection (e.g., psutil not available)",
            "lineNumber": 331
          },
          {
            "text": "        try:",
            "lineNumber": 332
          },
          {
            "text": "            from utils.logger import get_logger",
            "lineNumber": 333
          },
          {
            "text": "            logger = get_logger(__name__)",
            "lineNumber": 334
          },
          {
            "text": "            logger.error(f\"Failed to collect metrics: {str(e)}\")",
            "lineNumber": 335
          },
          {
            "text": "        except ImportError:",
            "lineNumber": 336
          },
          {
            "text": "            print(f\"Failed to collect metrics: {str(e)}\")",
            "lineNumber": 337
          },
          {
            "text": "        return False",
            "lineNumber": 338
          },
          {
            "text": "    ",
            "lineNumber": 339
          },
          {
            "text": "    except Exception as e:",
            "lineNumber": 340
          },
          {
            "text": "        # Handle any other unexpected errors",
            "lineNumber": 341
          },
          {
            "text": "        try:",
            "lineNumber": 342
          },
          {
            "text": "            from utils.logger import get_logger",
            "lineNumber": 343
          },
          {
            "text": "            logger = get_logger(__name__)",
            "lineNumber": 344
          },
          {
            "text": "            logger.error(f\"Unexpected error during metric collection: {str(e)}\", exc_info=True)",
            "lineNumber": 345
          },
          {
            "text": "        except ImportError:",
            "lineNumber": 346
          },
          {
            "text": "            print(f\"Unexpected error during metric collection: {str(e)}\")",
            "lineNumber": 347
          },
          {
            "text": "        return False",
            "lineNumber": 348,
            "isSignature": true
          },
          {
            "lineNumber": 349
          },
          {
            "lineNumber": 350
          },
          {
            "text": "def collect_all_metrics() -&gt; Dict:",
            "lineNumber": 351,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 352
          }
        ]
      },
      "score": 0.3819456696510315
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 605
          },
          "endPosition": {
            "line": 882
          }
        },
        "contents": "def store_all_metrics(all_metrics: Dict) -&gt; bool:\n\n                    \n                    storage_success = True\n                except Exception as e:\n                    print(f\"Error storing {provider} cloud metrics: {e}\")\n                    # Continue with other providers even if one fails\n        \n        # Commit transaction only if at least some metrics were stored\n        if storage_success:\n            conn.commit()\n        else:\n            conn.rollback()\n        \n        cursor.close()\n        return storage_success\n    \n    except Error as e:\n        print(f\"Error storing all metrics in database: {e}\")\n        if conn:\n            conn.rollback()\n        return False\n    except Exception as e:\n        print(f\"Unexpected error storing all metrics: {e}\")\n        if conn:\n            conn.rollback()\n        return False\n    finally:\n        # Ensure connection is closed\n        if conn:\n            conn.close()\n\n\ndef store_unified_metrics(\n    cpu_usage: float,\n    memory_usage: float,\n    network_traffic: float,\n    resource_type: str,\n    cloud_compute: Optional[float] = None,\n    cloud_storage: Optional[float] = None,\n    cloud_bandwidth: Optional[float] = None,\n    timestamp: Optional[datetime] = None\n) -&gt; bool:\n    ",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 606,
                "column": 1
              },
              "endPosition": {
                "line": 607,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "def store_all_metrics(all_metrics: Dict) -&gt; bool:",
            "lineNumber": 606,
            "isSignature": true
          },
          {
            "lineNumber": 730
          },
          {
            "text": "                    ",
            "lineNumber": 731
          },
          {
            "text": "                    storage_success = True",
            "lineNumber": 732
          },
          {
            "text": "                except Exception as e:",
            "lineNumber": 733
          },
          {
            "text": "                    print(f\"Error storing {provider} cloud metrics: {e}\")",
            "lineNumber": 734
          },
          {
            "text": "                    # Continue with other providers even if one fails",
            "lineNumber": 735
          },
          {
            "text": "        ",
            "lineNumber": 736
          },
          {
            "text": "        # Commit transaction only if at least some metrics were stored",
            "lineNumber": 737
          },
          {
            "text": "        if storage_success:",
            "lineNumber": 738
          },
          {
            "text": "            conn.commit()",
            "lineNumber": 739
          },
          {
            "text": "        else:",
            "lineNumber": 740
          },
          {
            "text": "            conn.rollback()",
            "lineNumber": 741
          },
          {
            "text": "        ",
            "lineNumber": 742
          },
          {
            "text": "        cursor.close()",
            "lineNumber": 743
          },
          {
            "text": "        return storage_success",
            "lineNumber": 744
          },
          {
            "text": "    ",
            "lineNumber": 745
          },
          {
            "text": "    except Error as e:",
            "lineNumber": 746
          },
          {
            "text": "        print(f\"Error storing all metrics in database: {e}\")",
            "lineNumber": 747
          },
          {
            "text": "        if conn:",
            "lineNumber": 748
          },
          {
            "text": "            conn.rollback()",
            "lineNumber": 749
          },
          {
            "text": "        return False",
            "lineNumber": 750
          },
          {
            "text": "    except Exception as e:",
            "lineNumber": 751
          },
          {
            "text": "        print(f\"Unexpected error storing all metrics: {e}\")",
            "lineNumber": 752
          },
          {
            "text": "        if conn:",
            "lineNumber": 753
          },
          {
            "text": "            conn.rollback()",
            "lineNumber": 754
          },
          {
            "text": "        return False",
            "lineNumber": 755
          },
          {
            "text": "    finally:",
            "lineNumber": 756
          },
          {
            "text": "        # Ensure connection is closed",
            "lineNumber": 757
          },
          {
            "text": "        if conn:",
            "lineNumber": 758
          },
          {
            "text": "            conn.close()",
            "lineNumber": 759,
            "isSignature": true
          },
          {
            "lineNumber": 760
          },
          {
            "lineNumber": 761
          },
          {
            "text": "def store_unified_metrics(",
            "lineNumber": 762,
            "isSignature": true
          },
          {
            "text": "    cpu_usage: float,",
            "lineNumber": 763,
            "isSignature": true
          },
          {
            "text": "    memory_usage: float,",
            "lineNumber": 764,
            "isSignature": true
          },
          {
            "text": "    network_traffic: float,",
            "lineNumber": 765,
            "isSignature": true
          },
          {
            "text": "    resource_type: str,",
            "lineNumber": 766,
            "isSignature": true
          },
          {
            "text": "    cloud_compute: Optional[float] = None,",
            "lineNumber": 767,
            "isSignature": true
          },
          {
            "text": "    cloud_storage: Optional[float] = None,",
            "lineNumber": 768,
            "isSignature": true
          },
          {
            "text": "    cloud_bandwidth: Optional[float] = None,",
            "lineNumber": 769,
            "isSignature": true
          },
          {
            "text": "    timestamp: Optional[datetime] = None",
            "lineNumber": 770,
            "isSignature": true
          },
          {
            "text": ") -&gt; bool:",
            "lineNumber": 771,
            "isSignature": true
          },
          {
            "text": "    ",
            "lineNumber": 772
          }
        ]
      },
      "score": 0.37850624322891235
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\config\\settings.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 178
          }
        },
        "contents": "\"\"\"\nConfiguration settings for Monitor/Drift Agent.\n\nThis module provides configuration management for the agent including\nthresholds, alert channels, database connections, and other settings.\n\"\"\"\n\nimport os\nfrom typing import Dict, Optional, Any\n\n\nclass Settings:\n    \"\"\"Manages application settings.\"\"\"\n    \n    def __init__(self):\n        \"\"\"Initialize settings from environment variables and defaults.\"\"\"\n        # Database settings\n        self.database_url = os.getenv(\n            \"DATABASE_URL\",\n            \"postgresql://user:password@localhost:5432/monitor_drift\"\n        )\n        \n        # Metric collection settings\n        self.metric_collection_interval = int(\n            os.getenv(\"METRIC_COLLECTION_INTERVAL\", \"60\")\n        )  # seconds\n        \n        # Threshold settings\n        self.default_cpu_threshold = float(\n            os.getenv(\"DEFAULT_CPU_THRESHOLD\", \"80.0\")\n        )\n        self.default_memory_threshold = float(\n            os.getenv(\"DEFAULT_MEMORY_THRESHOLD\", \"80.0\")\n        )\n        self.default_disk_threshold = float(\n            os.getenv(\"DEFAULT_DISK_THRESHOLD\", \"80.0\")\n        )\n        \n        # Cloud provider settings\n        self.aws_access_key = os.getenv(\"AWS_ACCESS_KEY_ID\", \"\")\n        self.aws_secret_key = os.getenv(\"AWS_SECRET_ACCESS_KEY\", \"\")\n        self.aws_region = os.getenv(\"AWS_REGION\", \"us-east-1\")\n        \n        self.azure_subscription_id = os.getenv(\"AZURE_SUBSCRIPTION_ID\", \"\")\n        self.azure_client_id = os.getenv(\"AZURE_CLIENT_ID\", \"\")\n        self.azure_client_secret = os.getenv(\"AZURE_CLIENT_SECRET\", \"\")\n        self.azure_tenant_id = os.getenv(\"AZURE_TENANT_ID\", \"\")\n        \n        self.gcp_project_id = os.getenv(\"GCP_PROJECT_ID\", \"\")\n        self.gcp_credentials_path = os.getenv(\"GCP_CREDENTIALS_PATH\", \"\")\n        \n        # Cloud metrics collection settings\n        self.cloud_metrics_time_window_minutes = int(\n            os.getenv(\"CLOUD_METRICS_TIME_WINDOW_MINUTES\", \"5\")\n        )\n        self.enable_cloud_metrics = os.getenv(\n            \"ENABLE_CLOUD_METRICS\", \"false\"\n        ).lower() == \"true\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "\"\"\"",
            "lineNumber": 1
          },
          {
            "text": "Configuration settings for Monitor/Drift Agent.",
            "lineNumber": 2
          },
          {
            "lineNumber": 3
          },
          {
            "text": "This module provides configuration management for the agent including",
            "lineNumber": 4
          },
          {
            "text": "thresholds, alert channels, database connections, and other settings.",
            "lineNumber": 5
          },
          {
            "text": "\"\"\"",
            "lineNumber": 6
          },
          {
            "lineNumber": 7
          },
          {
            "text": "import os",
            "lineNumber": 8
          },
          {
            "text": "from typing import Dict, Optional, Any",
            "lineNumber": 9
          },
          {
            "lineNumber": 10
          },
          {
            "lineNumber": 11
          },
          {
            "text": "class Settings:",
            "lineNumber": 12,
            "isSignature": true
          },
          {
            "text": "    \"\"\"Manages application settings.\"\"\"",
            "lineNumber": 13
          },
          {
            "text": "    ",
            "lineNumber": 14
          },
          {
            "text": "    def __init__(self):",
            "lineNumber": 15
          },
          {
            "text": "        \"\"\"Initialize settings from environment variables and defaults.\"\"\"",
            "lineNumber": 16
          },
          {
            "text": "        # Database settings",
            "lineNumber": 17
          },
          {
            "text": "        self.database_url = os.getenv(",
            "lineNumber": 18
          },
          {
            "text": "            \"DATABASE_URL\",",
            "lineNumber": 19
          },
          {
            "text": "            \"postgresql://user:password@localhost:5432/monitor_drift\"",
            "lineNumber": 20
          },
          {
            "text": "        )",
            "lineNumber": 21
          },
          {
            "text": "        ",
            "lineNumber": 22
          },
          {
            "text": "        # Metric collection settings",
            "lineNumber": 23
          },
          {
            "text": "        self.metric_collection_interval = int(",
            "lineNumber": 24
          },
          {
            "text": "            os.getenv(\"METRIC_COLLECTION_INTERVAL\", \"60\")",
            "lineNumber": 25
          },
          {
            "text": "        )  # seconds",
            "lineNumber": 26
          },
          {
            "text": "        ",
            "lineNumber": 27
          },
          {
            "text": "        # Threshold settings",
            "lineNumber": 28
          },
          {
            "text": "        self.default_cpu_threshold = float(",
            "lineNumber": 29
          },
          {
            "text": "            os.getenv(\"DEFAULT_CPU_THRESHOLD\", \"80.0\")",
            "lineNumber": 30
          },
          {
            "text": "        )",
            "lineNumber": 31
          },
          {
            "text": "        self.default_memory_threshold = float(",
            "lineNumber": 32
          },
          {
            "text": "            os.getenv(\"DEFAULT_MEMORY_THRESHOLD\", \"80.0\")",
            "lineNumber": 33
          },
          {
            "text": "        )",
            "lineNumber": 34
          },
          {
            "text": "        self.default_disk_threshold = float(",
            "lineNumber": 35
          },
          {
            "text": "            os.getenv(\"DEFAULT_DISK_THRESHOLD\", \"80.0\")",
            "lineNumber": 36
          },
          {
            "text": "        )",
            "lineNumber": 37
          },
          {
            "text": "        ",
            "lineNumber": 38
          },
          {
            "text": "        # Cloud provider settings",
            "lineNumber": 39
          },
          {
            "text": "        self.aws_access_key = os.getenv(\"AWS_ACCESS_KEY_ID\", \"\")",
            "lineNumber": 40
          },
          {
            "text": "        self.aws_secret_key = os.getenv(\"AWS_SECRET_ACCESS_KEY\", \"\")",
            "lineNumber": 41
          },
          {
            "text": "        self.aws_region = os.getenv(\"AWS_REGION\", \"us-east-1\")",
            "lineNumber": 42
          },
          {
            "text": "        ",
            "lineNumber": 43
          },
          {
            "text": "        self.azure_subscription_id = os.getenv(\"AZURE_SUBSCRIPTION_ID\", \"\")",
            "lineNumber": 44
          },
          {
            "text": "        self.azure_client_id = os.getenv(\"AZURE_CLIENT_ID\", \"\")",
            "lineNumber": 45
          },
          {
            "text": "        self.azure_client_secret = os.getenv(\"AZURE_CLIENT_SECRET\", \"\")",
            "lineNumber": 46
          },
          {
            "text": "        self.azure_tenant_id = os.getenv(\"AZURE_TENANT_ID\", \"\")",
            "lineNumber": 47
          },
          {
            "text": "        ",
            "lineNumber": 48
          },
          {
            "text": "        self.gcp_project_id = os.getenv(\"GCP_PROJECT_ID\", \"\")",
            "lineNumber": 49
          },
          {
            "text": "        self.gcp_credentials_path = os.getenv(\"GCP_CREDENTIALS_PATH\", \"\")",
            "lineNumber": 50
          },
          {
            "text": "        ",
            "lineNumber": 51
          },
          {
            "text": "        # Cloud metrics collection settings",
            "lineNumber": 52
          },
          {
            "text": "        self.cloud_metrics_time_window_minutes = int(",
            "lineNumber": 53
          },
          {
            "text": "            os.getenv(\"CLOUD_METRICS_TIME_WINDOW_MINUTES\", \"5\")",
            "lineNumber": 54
          },
          {
            "text": "        )",
            "lineNumber": 55
          },
          {
            "text": "        self.enable_cloud_metrics = os.getenv(",
            "lineNumber": 56
          },
          {
            "text": "            \"ENABLE_CLOUD_METRICS\", \"false\"",
            "lineNumber": 57
          },
          {
            "text": "        ).lower() == \"true\"",
            "lineNumber": 58
          }
        ]
      },
      "score": 0.3538016974925995
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\collect_metrics.py",
        "range": {
          "startPosition": {
            "line": 42,
            "column": 9
          },
          "endPosition": {
            "line": 110
          }
        },
        "contents": "def run_metric_collection():\n    \"\"\"\n    Job function to collect and store metrics.\n    \n    This function is called by the scheduler at regular intervals.\n    It collects system metrics and stores them in the database.\n    \"\"\"\n    logger = logging.getLogger(__name__)\n    try:\n        logger.info(f\"Starting metric collection at {datetime.now()}\")\n        success = collect_and_store_metrics()\n        if success:\n            logger.info(\"Metric collection completed successfully\")\n        else:\n            logger.warning(\"Metric collection completed but storage may have failed\")\n    except Exception as e:\n        logger.error(f\"Error during metric collection: {e}\", exc_info=True)\n\n\ndef run_all_metrics_collection():\n    \"\"\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "def run_metric_collection():",
            "lineNumber": 46,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 47
          },
          {
            "text": "    Job function to collect and store metrics.",
            "lineNumber": 48
          },
          {
            "text": "    ",
            "lineNumber": 49
          },
          {
            "text": "    This function is called by the scheduler at regular intervals.",
            "lineNumber": 50
          },
          {
            "text": "    It collects system metrics and stores them in the database.",
            "lineNumber": 51
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 52
          },
          {
            "text": "    logger = logging.getLogger(__name__)",
            "lineNumber": 53
          },
          {
            "text": "    try:",
            "lineNumber": 54
          },
          {
            "text": "        logger.info(f\"Starting metric collection at {datetime.now()}\")",
            "lineNumber": 55
          },
          {
            "text": "        success = collect_and_store_metrics()",
            "lineNumber": 56
          },
          {
            "text": "        if success:",
            "lineNumber": 57
          },
          {
            "text": "            logger.info(\"Metric collection completed successfully\")",
            "lineNumber": 58
          },
          {
            "text": "        else:",
            "lineNumber": 59
          },
          {
            "text": "            logger.warning(\"Metric collection completed but storage may have failed\")",
            "lineNumber": 60
          },
          {
            "text": "    except Exception as e:",
            "lineNumber": 61
          },
          {
            "text": "        logger.error(f\"Error during metric collection: {e}\", exc_info=True)",
            "lineNumber": 62,
            "isSignature": true
          },
          {
            "lineNumber": 63
          },
          {
            "lineNumber": 64
          },
          {
            "text": "def run_all_metrics_collection():",
            "lineNumber": 65,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 66
          }
        ]
      },
      "score": 0.34984755516052246
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\system_metrics.py",
        "range": {
          "startPosition": {
            "line": 256,
            "column": 71
          },
          "endPosition": {
            "line": 347
          }
        },
        "contents": "def get_server_metrics() -&gt; Dict:\n    \"\"\"\n    Collect server load metrics (CPU and memory) with timestamp.\n    \n    Returns:\n        Dictionary containing:\n            - cpu_usage: float (CPU usage percentage)\n            - memory_usage: float (Memory usage percentage)\n            - timestamp: datetime (exact capture time)\n    \n    Raises:\n        RuntimeError: If psutil is not available or metrics cannot be collected\n    \"\"\"\n    if not PSUTIL_AVAILABLE:\n        raise RuntimeError(\"psutil library is not available. Please install it using: pip install psutil\")\n    \n    try:\n        # Collect CPU and memory usage percentages\n        cpu_usage = get_cpu_usage_percent()\n        memory_usage = get_memory_usage_percent()\n        \n        # Capture timestamp when metrics are collected\n        timestamp = datetime.now()\n        \n        return {\n            'cpu_usage': cpu_usage,\n            'memory_usage': memory_usage,\n            'timestamp': timestamp\n        }\n    except RuntimeError:\n        # Re-raise RuntimeError from helper functions\n        raise\n    except Exception as e:\n        raise RuntimeError(f\"Failed to collect server metrics: {str(e)}\")\n\n\ndef collect_and_store_metrics() -&gt; bool:\n    \"\"\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "def get_server_metrics() -&gt; Dict:",
            "lineNumber": 260,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 261
          },
          {
            "text": "    Collect server load metrics (CPU and memory) with timestamp.",
            "lineNumber": 262
          },
          {
            "text": "    ",
            "lineNumber": 263
          },
          {
            "text": "    Returns:",
            "lineNumber": 264
          },
          {
            "text": "        Dictionary containing:",
            "lineNumber": 265
          },
          {
            "text": "            - cpu_usage: float (CPU usage percentage)",
            "lineNumber": 266
          },
          {
            "text": "            - memory_usage: float (Memory usage percentage)",
            "lineNumber": 267
          },
          {
            "text": "            - timestamp: datetime (exact capture time)",
            "lineNumber": 268
          },
          {
            "text": "    ",
            "lineNumber": 269
          },
          {
            "text": "    Raises:",
            "lineNumber": 270
          },
          {
            "text": "        RuntimeError: If psutil is not available or metrics cannot be collected",
            "lineNumber": 271
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 272
          },
          {
            "text": "    if not PSUTIL_AVAILABLE:",
            "lineNumber": 273
          },
          {
            "text": "        raise RuntimeError(\"psutil library is not available. Please install it using: pip install psutil\")",
            "lineNumber": 274
          },
          {
            "text": "    ",
            "lineNumber": 275
          },
          {
            "text": "    try:",
            "lineNumber": 276
          },
          {
            "text": "        # Collect CPU and memory usage percentages",
            "lineNumber": 277
          },
          {
            "text": "        cpu_usage = get_cpu_usage_percent()",
            "lineNumber": 278
          },
          {
            "text": "        memory_usage = get_memory_usage_percent()",
            "lineNumber": 279
          },
          {
            "text": "        ",
            "lineNumber": 280
          },
          {
            "text": "        # Capture timestamp when metrics are collected",
            "lineNumber": 281
          },
          {
            "text": "        timestamp = datetime.now()",
            "lineNumber": 282
          },
          {
            "text": "        ",
            "lineNumber": 283
          },
          {
            "text": "        return {",
            "lineNumber": 284
          },
          {
            "text": "            'cpu_usage': cpu_usage,",
            "lineNumber": 285
          },
          {
            "text": "            'memory_usage': memory_usage,",
            "lineNumber": 286
          },
          {
            "text": "            'timestamp': timestamp",
            "lineNumber": 287
          },
          {
            "text": "        }",
            "lineNumber": 288
          },
          {
            "text": "    except RuntimeError:",
            "lineNumber": 289
          },
          {
            "text": "        # Re-raise RuntimeError from helper functions",
            "lineNumber": 290
          },
          {
            "text": "        raise",
            "lineNumber": 291
          },
          {
            "text": "    except Exception as e:",
            "lineNumber": 292
          },
          {
            "text": "        raise RuntimeError(f\"Failed to collect server metrics: {str(e)}\")",
            "lineNumber": 293,
            "isSignature": true
          },
          {
            "lineNumber": 294
          },
          {
            "lineNumber": 295
          },
          {
            "text": "def collect_and_store_metrics() -&gt; bool:",
            "lineNumber": 296,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 297
          }
        ]
      },
      "score": 0.3460400104522705
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---





---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: a:\MonitorDrift Agent\api\metrics.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: a:\MonitorDrift Agent\api\main.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: a:\MonitorDrift Agent\data_collection\database.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: a:\MonitorDrift Agent\config\settings.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "How is API authentication or authorization implemented?",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\api\\main.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 70,
            "column": 56
          }
        },
        "contents": "\"\"\"\nMain FastAPI application for Monitor/Drift Agent.\n\nThis module creates and configures the FastAPI application,\nincluding all routers and middleware.\n\"\"\"\n\nfrom fastapi import FastAPI, Request\nfrom fastapi.responses import JSONResponse\nfrom fastapi.middleware.cors import CORSMiddleware\n\n# Try to import slowapi for rate limiting error handling\ntry:\n    from slowapi import Limiter, _rate_limit_exceeded_handler\n    from slowapi.errors import RateLimitExceeded\n    SLOWAPI_AVAILABLE = True\nexcept ImportError:\n    SLOWAPI_AVAILABLE = False\n    RateLimitExceeded = Exception\n\n# Import routers\nfrom api.metrics import router as metrics_router\n\n# Import settings\ntry:\n    from config.settings import get_settings\nexcept ImportError:\n    def get_settings():\n        return None\n\n# Create FastAPI app\napp = FastAPI(\n    title=\"Monitor/Drift Agent API\",\n    description=\"API for collecting and managing system metrics, alerts, and policies\",\n    version=\"1.0.0\"\n)\n\n# Add CORS middleware\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[\"*\"],  # Configure as needed\n    allow_credentials=True,\n    allow_methods=[\"*\"],\n    allow_headers=[\"*\"],\n)\n\n# Register rate limit error handler if slowapi is available\nif SLOWAPI_AVAILABLE:\n    @app.exception_handler(RateLimitExceeded)\n    async def rate_limit_handler(request: Request, exc: RateLimitExceeded):\n        \"\"\"\n        Handle rate limit exceeded errors.\n        \n        Returns:\n            JSON response with 429 status code\n        \"\"\"\n        response = JSONResponse(\n            status_code=429,\n            content={\n                \"error\": \"Rate limit exceeded\",\n                \"message\": str(exc),\n                \"detail\": \"Too many requests. Please try again later.\"\n            }\n        )\n        try:\n            response = _rate_limit_exceeded_handler(request, exc, response)\n        except Exception:\n            pass  # If handler fails, use our default response\n        return response\n\n# Initialize rate limiter and attach to app if available",
        "signatures": {},
        "detailedLines": [
          {
            "text": "\"\"\"",
            "lineNumber": 1
          },
          {
            "text": "Main FastAPI application for Monitor/Drift Agent.",
            "lineNumber": 2
          },
          {
            "lineNumber": 3
          },
          {
            "text": "This module creates and configures the FastAPI application,",
            "lineNumber": 4
          },
          {
            "text": "including all routers and middleware.",
            "lineNumber": 5
          },
          {
            "text": "\"\"\"",
            "lineNumber": 6
          },
          {
            "lineNumber": 7
          },
          {
            "text": "from fastapi import FastAPI, Request",
            "lineNumber": 8
          },
          {
            "text": "from fastapi.responses import JSONResponse",
            "lineNumber": 9
          },
          {
            "text": "from fastapi.middleware.cors import CORSMiddleware",
            "lineNumber": 10
          },
          {
            "lineNumber": 11
          },
          {
            "text": "# Try to import slowapi for rate limiting error handling",
            "lineNumber": 12
          },
          {
            "text": "try:",
            "lineNumber": 13
          },
          {
            "text": "    from slowapi import Limiter, _rate_limit_exceeded_handler",
            "lineNumber": 14
          },
          {
            "text": "    from slowapi.errors import RateLimitExceeded",
            "lineNumber": 15
          },
          {
            "text": "    SLOWAPI_AVAILABLE = True",
            "lineNumber": 16
          },
          {
            "text": "except ImportError:",
            "lineNumber": 17
          },
          {
            "text": "    SLOWAPI_AVAILABLE = False",
            "lineNumber": 18
          },
          {
            "text": "    RateLimitExceeded = Exception",
            "lineNumber": 19
          },
          {
            "lineNumber": 20
          },
          {
            "text": "# Import routers",
            "lineNumber": 21
          },
          {
            "text": "from api.metrics import router as metrics_router",
            "lineNumber": 22
          },
          {
            "lineNumber": 23
          },
          {
            "text": "# Import settings",
            "lineNumber": 24
          },
          {
            "text": "try:",
            "lineNumber": 25
          },
          {
            "text": "    from config.settings import get_settings",
            "lineNumber": 26
          },
          {
            "text": "except ImportError:",
            "lineNumber": 27
          },
          {
            "text": "    def get_settings():",
            "lineNumber": 28
          },
          {
            "text": "        return None",
            "lineNumber": 29
          },
          {
            "lineNumber": 30
          },
          {
            "text": "# Create FastAPI app",
            "lineNumber": 31
          },
          {
            "text": "app = FastAPI(",
            "lineNumber": 32
          },
          {
            "text": "    title=\"Monitor/Drift Agent API\",",
            "lineNumber": 33
          },
          {
            "text": "    description=\"API for collecting and managing system metrics, alerts, and policies\",",
            "lineNumber": 34
          },
          {
            "text": "    version=\"1.0.0\"",
            "lineNumber": 35
          },
          {
            "text": ")",
            "lineNumber": 36
          },
          {
            "lineNumber": 37
          },
          {
            "text": "# Add CORS middleware",
            "lineNumber": 38
          },
          {
            "text": "app.add_middleware(",
            "lineNumber": 39
          },
          {
            "text": "    CORSMiddleware,",
            "lineNumber": 40
          },
          {
            "text": "    allow_origins=[\"*\"],  # Configure as needed",
            "lineNumber": 41
          },
          {
            "text": "    allow_credentials=True,",
            "lineNumber": 42
          },
          {
            "text": "    allow_methods=[\"*\"],",
            "lineNumber": 43
          },
          {
            "text": "    allow_headers=[\"*\"],",
            "lineNumber": 44
          },
          {
            "text": ")",
            "lineNumber": 45
          },
          {
            "lineNumber": 46
          },
          {
            "text": "# Register rate limit error handler if slowapi is available",
            "lineNumber": 47
          },
          {
            "text": "if SLOWAPI_AVAILABLE:",
            "lineNumber": 48
          },
          {
            "text": "    @app.exception_handler(RateLimitExceeded)",
            "lineNumber": 49
          },
          {
            "text": "    async def rate_limit_handler(request: Request, exc: RateLimitExceeded):",
            "lineNumber": 50
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 51
          },
          {
            "text": "        Handle rate limit exceeded errors.",
            "lineNumber": 52
          },
          {
            "text": "        ",
            "lineNumber": 53
          },
          {
            "text": "        Returns:",
            "lineNumber": 54
          },
          {
            "text": "            JSON response with 429 status code",
            "lineNumber": 55
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 56
          },
          {
            "text": "        response = JSONResponse(",
            "lineNumber": 57
          },
          {
            "text": "            status_code=429,",
            "lineNumber": 58
          },
          {
            "text": "            content={",
            "lineNumber": 59
          },
          {
            "text": "                \"error\": \"Rate limit exceeded\",",
            "lineNumber": 60
          },
          {
            "text": "                \"message\": str(exc),",
            "lineNumber": 61
          },
          {
            "text": "                \"detail\": \"Too many requests. Please try again later.\"",
            "lineNumber": 62
          },
          {
            "text": "            }",
            "lineNumber": 63
          },
          {
            "text": "        )",
            "lineNumber": 64
          },
          {
            "text": "        try:",
            "lineNumber": 65
          },
          {
            "text": "            response = _rate_limit_exceeded_handler(request, exc, response)",
            "lineNumber": 66
          },
          {
            "text": "        except Exception:",
            "lineNumber": 67
          },
          {
            "text": "            pass  # If handler fails, use our default response",
            "lineNumber": 68
          },
          {
            "text": "        return response",
            "lineNumber": 69
          },
          {
            "lineNumber": 70
          },
          {
            "text": "# Initialize rate limiter and attach to app if available",
            "lineNumber": 71
          }
        ]
      },
      "score": 0.3474886417388916
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\api\\policies.py",
        "range": {
          "startPosition": {
            "line": 121,
            "column": 5
          },
          "endPosition": {
            "line": 143,
            "column": 5
          }
        },
        "contents": "def enforce_policy(policy_id: str, context: Dict) -&gt; Dict:\n    \"\"\"\n    Enforce a policy against a given context.\n    \n    Args:\n        policy_id: Unique identifier for the policy\n        context: Context data to evaluate policy against\n    \n    Returns:\n        Dictionary containing enforcement result\n    \n    TODO: Implement policy enforcement logic\n    \"\"\"\n    # TODO: Implement policy enforcement in policy_management module\n    return {\n        \"policy_id\": policy_id,\n        \"enforced\": False,\n        \"violations\": [],\n        \"timestamp\": datetime.now().isoformat()\n    }",
        "signatures": {},
        "detailedLines": [
          {
            "text": "def enforce_policy(policy_id: str, context: Dict) -&gt; Dict:",
            "lineNumber": 125,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 126
          },
          {
            "text": "    Enforce a policy against a given context.",
            "lineNumber": 127
          },
          {
            "text": "    ",
            "lineNumber": 128
          },
          {
            "text": "    Args:",
            "lineNumber": 129
          },
          {
            "text": "        policy_id: Unique identifier for the policy",
            "lineNumber": 130
          },
          {
            "text": "        context: Context data to evaluate policy against",
            "lineNumber": 131
          },
          {
            "text": "    ",
            "lineNumber": 132
          },
          {
            "text": "    Returns:",
            "lineNumber": 133
          },
          {
            "text": "        Dictionary containing enforcement result",
            "lineNumber": 134
          },
          {
            "text": "    ",
            "lineNumber": 135
          },
          {
            "text": "    TODO: Implement policy enforcement logic",
            "lineNumber": 136
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 137
          },
          {
            "text": "    # TODO: Implement policy enforcement in policy_management module",
            "lineNumber": 138
          },
          {
            "text": "    return {",
            "lineNumber": 139
          },
          {
            "text": "        \"policy_id\": policy_id,",
            "lineNumber": 140
          },
          {
            "text": "        \"enforced\": False,",
            "lineNumber": 141
          },
          {
            "text": "        \"violations\": [],",
            "lineNumber": 142
          },
          {
            "text": "        \"timestamp\": datetime.now().isoformat()",
            "lineNumber": 143
          },
          {
            "text": "    }",
            "lineNumber": 144,
            "isSignature": true
          }
        ]
      },
      "score": 0.2751936912536621
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\cloud_metrics.py",
        "range": {
          "startPosition": {
            "line": 435
          },
          "endPosition": {
            "line": 762
          }
        },
        "contents": "class AzureMetricsCollector(CloudProvider):\ndef authenticate(self, credentials: Dict) -&gt; bool:\n\n            return False\n        \n        try:\n            subscription_id = credentials.get('subscription_id')\n            client_id = credentials.get('client_id')\n            client_secret = credentials.get('client_secret')\n            tenant_id = credentials.get('tenant_id')\n            \n            if not subscription_id:\n                self.logger.error(\"Azure subscription_id is required\")\n                return False\n            \n            self.subscription_id = subscription_id\n            \n            # Use service principal if credentials provided, otherwise use DefaultAzureCredential\n            if client_id and client_secret and tenant_id:\n                self.credential = ClientSecretCredential(\n                    tenant_id=tenant_id,\n                    client_id=client_id,\n                    client_secret=client_secret\n                )\n            else:\n                # Try DefaultAzureCredential (for managed identity, environment variables, etc.)\n                self.credential = DefaultAzureCredential()\n            \n            # Initialize clients\n            self.monitor_client = MonitorManagementClient(\n                self.credential,\n                subscription_id\n            )\n            self.compute_client = ComputeManagementClient(\n                self.credential,\n                subscription_id\n            )\n            self.storage_client = StorageManagementClient(\n                self.credential,\n                subscription_id\n            )\n            \n            # Test authentication by making a simple API call\n            list(self.compute_client.virtual_machines.list_all()[:1])\n            \n            return True\n        except AzureError as e:\n            self.logger.error(f\"Azure authentication failed: {str(e)}\")\n            return False\n        except Exception as e:\n            self.logger.error(f\"Unexpected error during Azure authentication: {str(e)}\")\n            return False\n    \n    def get_azure_metrics(self) -&gt; List[Dict]:\n        \"\"\"",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 436,
                "column": 1
              },
              "endPosition": {
                "line": 437,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 448,
                "column": 5
              },
              "endPosition": {
                "line": 449,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class AzureMetricsCollector(CloudProvider):",
            "lineNumber": 436,
            "isSignature": true
          },
          {
            "text": "def authenticate(self, credentials: Dict) -&gt; bool:",
            "lineNumber": 448
          },
          {
            "lineNumber": 459
          },
          {
            "text": "            return False",
            "lineNumber": 460
          },
          {
            "text": "        ",
            "lineNumber": 461
          },
          {
            "text": "        try:",
            "lineNumber": 462
          },
          {
            "text": "            subscription_id = credentials.get('subscription_id')",
            "lineNumber": 463
          },
          {
            "text": "            client_id = credentials.get('client_id')",
            "lineNumber": 464
          },
          {
            "text": "            client_secret = credentials.get('client_secret')",
            "lineNumber": 465
          },
          {
            "text": "            tenant_id = credentials.get('tenant_id')",
            "lineNumber": 466
          },
          {
            "text": "            ",
            "lineNumber": 467
          },
          {
            "text": "            if not subscription_id:",
            "lineNumber": 468
          },
          {
            "text": "                self.logger.error(\"Azure subscription_id is required\")",
            "lineNumber": 469
          },
          {
            "text": "                return False",
            "lineNumber": 470
          },
          {
            "text": "            ",
            "lineNumber": 471
          },
          {
            "text": "            self.subscription_id = subscription_id",
            "lineNumber": 472
          },
          {
            "text": "            ",
            "lineNumber": 473
          },
          {
            "text": "            # Use service principal if credentials provided, otherwise use DefaultAzureCredential",
            "lineNumber": 474
          },
          {
            "text": "            if client_id and client_secret and tenant_id:",
            "lineNumber": 475
          },
          {
            "text": "                self.credential = ClientSecretCredential(",
            "lineNumber": 476
          },
          {
            "text": "                    tenant_id=tenant_id,",
            "lineNumber": 477
          },
          {
            "text": "                    client_id=client_id,",
            "lineNumber": 478
          },
          {
            "text": "                    client_secret=client_secret",
            "lineNumber": 479
          },
          {
            "text": "                )",
            "lineNumber": 480
          },
          {
            "text": "            else:",
            "lineNumber": 481
          },
          {
            "text": "                # Try DefaultAzureCredential (for managed identity, environment variables, etc.)",
            "lineNumber": 482
          },
          {
            "text": "                self.credential = DefaultAzureCredential()",
            "lineNumber": 483
          },
          {
            "text": "            ",
            "lineNumber": 484
          },
          {
            "text": "            # Initialize clients",
            "lineNumber": 485
          },
          {
            "text": "            self.monitor_client = MonitorManagementClient(",
            "lineNumber": 486
          },
          {
            "text": "                self.credential,",
            "lineNumber": 487
          },
          {
            "text": "                subscription_id",
            "lineNumber": 488
          },
          {
            "text": "            )",
            "lineNumber": 489
          },
          {
            "text": "            self.compute_client = ComputeManagementClient(",
            "lineNumber": 490
          },
          {
            "text": "                self.credential,",
            "lineNumber": 491
          },
          {
            "text": "                subscription_id",
            "lineNumber": 492
          },
          {
            "text": "            )",
            "lineNumber": 493
          },
          {
            "text": "            self.storage_client = StorageManagementClient(",
            "lineNumber": 494
          },
          {
            "text": "                self.credential,",
            "lineNumber": 495
          },
          {
            "text": "                subscription_id",
            "lineNumber": 496
          },
          {
            "text": "            )",
            "lineNumber": 497
          },
          {
            "text": "            ",
            "lineNumber": 498
          },
          {
            "text": "            # Test authentication by making a simple API call",
            "lineNumber": 499
          },
          {
            "text": "            list(self.compute_client.virtual_machines.list_all()[:1])",
            "lineNumber": 500
          },
          {
            "text": "            ",
            "lineNumber": 501
          },
          {
            "text": "            return True",
            "lineNumber": 502
          },
          {
            "text": "        except AzureError as e:",
            "lineNumber": 503
          },
          {
            "text": "            self.logger.error(f\"Azure authentication failed: {str(e)}\")",
            "lineNumber": 504
          },
          {
            "text": "            return False",
            "lineNumber": 505
          },
          {
            "text": "        except Exception as e:",
            "lineNumber": 506
          },
          {
            "text": "            self.logger.error(f\"Unexpected error during Azure authentication: {str(e)}\")",
            "lineNumber": 507
          },
          {
            "text": "            return False",
            "lineNumber": 508
          },
          {
            "text": "    ",
            "lineNumber": 509
          },
          {
            "text": "    def get_azure_metrics(self) -&gt; List[Dict]:",
            "lineNumber": 510
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 511
          }
        ]
      },
      "score": 0.2745130956172943
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\api\\main.py",
        "range": {
          "startPosition": {
            "line": 48,
            "column": 4
          },
          "endPosition": {
            "line": 122
          }
        },
        "contents": "@app.exception_handler(RateLimitExceeded)\nasync def rate_limit_handler(request: Request, exc: RateLimitExceeded):\n\n        return response\n\n# Initialize rate limiter and attach to app if available\nif SLOWAPI_AVAILABLE:\n    from slowapi import Limiter\n    from slowapi.util import get_remote_address\n    from config.settings import get_settings as get_app_settings\n    \n    app_settings = get_app_settings()\n    if app_settings and app_settings.api_enable_rate_limit:\n        limiter = Limiter(\n            app=app,\n            key_func=get_remote_address\n        )\n        # Attach limiter to metrics router so it can be used in decorators\n        metrics_router.state.limiter = limiter\n        # Also make it available globally for the metrics module\n        import api.metrics as metrics_module\n        metrics_module.limiter = limiter\n\n# Include routers\napp.include_router(metrics_router)\n\n\n@app.get(\"/health\")\nasync def health_check():\n    \"\"\"\n    Health check endpoint for monitoring and load balancers.\n    \n    Returns:\n        JSON response indicating API health status\n    \"\"\"\n    return {\n        \"status\": \"healthy\",\n        \"service\": \"Monitor/Drift Agent API\",\n        \"version\": \"1.0.0\"\n    }\n\n\n@app.get(\"/\")\nasync def root():\n    \"\"\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "@app.exception_handler(RateLimitExceeded)",
            "lineNumber": 49
          },
          {
            "text": "async def rate_limit_handler(request: Request, exc: RateLimitExceeded):",
            "lineNumber": 50
          },
          {
            "lineNumber": 68
          },
          {
            "text": "        return response",
            "lineNumber": 69
          },
          {
            "lineNumber": 70
          },
          {
            "text": "# Initialize rate limiter and attach to app if available",
            "lineNumber": 71
          },
          {
            "text": "if SLOWAPI_AVAILABLE:",
            "lineNumber": 72
          },
          {
            "text": "    from slowapi import Limiter",
            "lineNumber": 73
          },
          {
            "text": "    from slowapi.util import get_remote_address",
            "lineNumber": 74
          },
          {
            "text": "    from config.settings import get_settings as get_app_settings",
            "lineNumber": 75
          },
          {
            "text": "    ",
            "lineNumber": 76
          },
          {
            "text": "    app_settings = get_app_settings()",
            "lineNumber": 77
          },
          {
            "text": "    if app_settings and app_settings.api_enable_rate_limit:",
            "lineNumber": 78
          },
          {
            "text": "        limiter = Limiter(",
            "lineNumber": 79
          },
          {
            "text": "            app=app,",
            "lineNumber": 80
          },
          {
            "text": "            key_func=get_remote_address",
            "lineNumber": 81
          },
          {
            "text": "        )",
            "lineNumber": 82
          },
          {
            "text": "        # Attach limiter to metrics router so it can be used in decorators",
            "lineNumber": 83
          },
          {
            "text": "        metrics_router.state.limiter = limiter",
            "lineNumber": 84
          },
          {
            "text": "        # Also make it available globally for the metrics module",
            "lineNumber": 85
          },
          {
            "text": "        import api.metrics as metrics_module",
            "lineNumber": 86
          },
          {
            "text": "        metrics_module.limiter = limiter",
            "lineNumber": 87
          },
          {
            "lineNumber": 88
          },
          {
            "text": "# Include routers",
            "lineNumber": 89
          },
          {
            "text": "app.include_router(metrics_router)",
            "lineNumber": 90
          },
          {
            "lineNumber": 91
          },
          {
            "lineNumber": 92
          },
          {
            "text": "@app.get(\"/health\")",
            "lineNumber": 93
          },
          {
            "text": "async def health_check():",
            "lineNumber": 94,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 95
          },
          {
            "text": "    Health check endpoint for monitoring and load balancers.",
            "lineNumber": 96
          },
          {
            "text": "    ",
            "lineNumber": 97
          },
          {
            "text": "    Returns:",
            "lineNumber": 98
          },
          {
            "text": "        JSON response indicating API health status",
            "lineNumber": 99
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 100
          },
          {
            "text": "    return {",
            "lineNumber": 101
          },
          {
            "text": "        \"status\": \"healthy\",",
            "lineNumber": 102
          },
          {
            "text": "        \"service\": \"Monitor/Drift Agent API\",",
            "lineNumber": 103
          },
          {
            "text": "        \"version\": \"1.0.0\"",
            "lineNumber": 104
          },
          {
            "text": "    }",
            "lineNumber": 105,
            "isSignature": true
          },
          {
            "lineNumber": 106
          },
          {
            "lineNumber": 107
          },
          {
            "text": "@app.get(\"/\")",
            "lineNumber": 108
          },
          {
            "text": "async def root():",
            "lineNumber": 109,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 110
          }
        ]
      },
      "score": 0.2680172324180603
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\api\\policies.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 56
          }
        },
        "contents": "\"\"\"\nAPI endpoints for managing policies.\n\nThis module provides REST API endpoints to create, retrieve,\nupdate, and enforce policies in the system.\n\"\"\"\n\nfrom typing import Dict, List, Optional\nfrom datetime import datetime\n\n\ndef create_policy(\n    name: str,\n    description: str,\n    rules: Dict,\n    enabled: bool = True\n) -&gt; Dict:\n    \"\"\"\n    Create a new policy.\n    \n    Args:\n        name: Policy name\n        description: Policy description\n        rules: Policy rules definition\n        enabled: Whether the policy is enabled\n    \n    Returns:\n        Dictionary containing created policy information\n    \n    TODO: Implement policy creation logic\n    \"\"\"\n    # TODO: Implement policy creation in policy_management module\n    return {\n        \"policy_id\": None,  # TODO: Generate unique policy ID\n        \"name\": name,\n        \"description\": description,\n        \"rules\": rules,\n        \"enabled\": enabled,\n        \"created_at\": datetime.now().isoformat(),\n        \"updated_at\": datetime.now().isoformat()\n    }\n\n\ndef get_policy(policy_id: str) -&gt; Dict:\n    \"\"\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "\"\"\"",
            "lineNumber": 1
          },
          {
            "text": "API endpoints for managing policies.",
            "lineNumber": 2
          },
          {
            "lineNumber": 3
          },
          {
            "text": "This module provides REST API endpoints to create, retrieve,",
            "lineNumber": 4
          },
          {
            "text": "update, and enforce policies in the system.",
            "lineNumber": 5
          },
          {
            "text": "\"\"\"",
            "lineNumber": 6
          },
          {
            "lineNumber": 7
          },
          {
            "text": "from typing import Dict, List, Optional",
            "lineNumber": 8
          },
          {
            "text": "from datetime import datetime",
            "lineNumber": 9
          },
          {
            "lineNumber": 10
          },
          {
            "lineNumber": 11
          },
          {
            "text": "def create_policy(",
            "lineNumber": 12,
            "isSignature": true
          },
          {
            "text": "    name: str,",
            "lineNumber": 13,
            "isSignature": true
          },
          {
            "text": "    description: str,",
            "lineNumber": 14,
            "isSignature": true
          },
          {
            "text": "    rules: Dict,",
            "lineNumber": 15,
            "isSignature": true
          },
          {
            "text": "    enabled: bool = True",
            "lineNumber": 16,
            "isSignature": true
          },
          {
            "text": ") -&gt; Dict:",
            "lineNumber": 17,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 18
          },
          {
            "text": "    Create a new policy.",
            "lineNumber": 19
          },
          {
            "text": "    ",
            "lineNumber": 20
          },
          {
            "text": "    Args:",
            "lineNumber": 21
          },
          {
            "text": "        name: Policy name",
            "lineNumber": 22
          },
          {
            "text": "        description: Policy description",
            "lineNumber": 23
          },
          {
            "text": "        rules: Policy rules definition",
            "lineNumber": 24
          },
          {
            "text": "        enabled: Whether the policy is enabled",
            "lineNumber": 25
          },
          {
            "text": "    ",
            "lineNumber": 26
          },
          {
            "text": "    Returns:",
            "lineNumber": 27
          },
          {
            "text": "        Dictionary containing created policy information",
            "lineNumber": 28
          },
          {
            "text": "    ",
            "lineNumber": 29
          },
          {
            "text": "    TODO: Implement policy creation logic",
            "lineNumber": 30
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 31
          },
          {
            "text": "    # TODO: Implement policy creation in policy_management module",
            "lineNumber": 32
          },
          {
            "text": "    return {",
            "lineNumber": 33
          },
          {
            "text": "        \"policy_id\": None,  # TODO: Generate unique policy ID",
            "lineNumber": 34
          },
          {
            "text": "        \"name\": name,",
            "lineNumber": 35
          },
          {
            "text": "        \"description\": description,",
            "lineNumber": 36
          },
          {
            "text": "        \"rules\": rules,",
            "lineNumber": 37
          },
          {
            "text": "        \"enabled\": enabled,",
            "lineNumber": 38
          },
          {
            "text": "        \"created_at\": datetime.now().isoformat(),",
            "lineNumber": 39
          },
          {
            "text": "        \"updated_at\": datetime.now().isoformat()",
            "lineNumber": 40
          },
          {
            "text": "    }",
            "lineNumber": 41,
            "isSignature": true
          },
          {
            "lineNumber": 42
          },
          {
            "lineNumber": 43
          },
          {
            "text": "def get_policy(policy_id: str) -&gt; Dict:",
            "lineNumber": 44,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 45
          }
        ]
      },
      "score": 0.2668873965740204
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\config\\settings.py",
        "range": {
          "startPosition": {
            "line": 11
          },
          "endPosition": {
            "line": 178
          }
        },
        "contents": "class Settings:\ndef __init__(self):\n\n        self.api_rate_limit = os.getenv(\"API_RATE_LIMIT\", \"1 per minute\")\n        self.api_enable_rate_limit = os.getenv(\n            \"API_ENABLE_RATE_LIMIT\", \"true\"\n        ).lower() == \"true\"\n    \n    def get_database_config(self) -&gt; Dict[str, str]:\n        \"\"\"Get database configuration.\"\"\"\n        return {\n            \"url\": self.database_url\n        }\n    \n    def get_cloud_config(self, provider: str) -&gt; Dict[str, str]:\n        \"\"\"\n        Get cloud provider configuration.\n        \n        Args:\n            provider: Cloud provider name ('aws', 'azure', 'gcp')\n        \n        Returns:\n            Dictionary containing provider-specific configuration\n        \"\"\"\n        configs = {\n            \"aws\": {\n                \"access_key\": self.aws_access_key,\n                \"secret_key\": self.aws_secret_key,\n                \"region\": self.aws_region\n            },\n            \"azure\": {\n                \"subscription_id\": self.azure_subscription_id,\n                \"client_id\": self.azure_client_id,\n                \"client_secret\": self.azure_client_secret,\n                \"tenant_id\": self.azure_tenant_id\n            },\n            \"gcp\": {\n                \"project_id\": self.gcp_project_id,\n                \"credentials_path\": self.gcp_credentials_path\n            }\n        }\n        return configs.get(provider, {})\n    \n    def get_alert_channel_config(self, channel: str) -&gt; Dict[str, Any]:\n        \"\"\"",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 12,
                "column": 1
              },
              "endPosition": {
                "line": 13,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 15,
                "column": 5
              },
              "endPosition": {
                "line": 16,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class Settings:",
            "lineNumber": 12,
            "isSignature": true
          },
          {
            "text": "def __init__(self):",
            "lineNumber": 15
          },
          {
            "lineNumber": 96
          },
          {
            "text": "        self.api_rate_limit = os.getenv(\"API_RATE_LIMIT\", \"1 per minute\")",
            "lineNumber": 97
          },
          {
            "text": "        self.api_enable_rate_limit = os.getenv(",
            "lineNumber": 98
          },
          {
            "text": "            \"API_ENABLE_RATE_LIMIT\", \"true\"",
            "lineNumber": 99
          },
          {
            "text": "        ).lower() == \"true\"",
            "lineNumber": 100
          },
          {
            "text": "    ",
            "lineNumber": 101
          },
          {
            "text": "    def get_database_config(self) -&gt; Dict[str, str]:",
            "lineNumber": 102
          },
          {
            "text": "        \"\"\"Get database configuration.\"\"\"",
            "lineNumber": 103
          },
          {
            "text": "        return {",
            "lineNumber": 104
          },
          {
            "text": "            \"url\": self.database_url",
            "lineNumber": 105
          },
          {
            "text": "        }",
            "lineNumber": 106
          },
          {
            "text": "    ",
            "lineNumber": 107
          },
          {
            "text": "    def get_cloud_config(self, provider: str) -&gt; Dict[str, str]:",
            "lineNumber": 108
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 109
          },
          {
            "text": "        Get cloud provider configuration.",
            "lineNumber": 110
          },
          {
            "text": "        ",
            "lineNumber": 111
          },
          {
            "text": "        Args:",
            "lineNumber": 112
          },
          {
            "text": "            provider: Cloud provider name ('aws', 'azure', 'gcp')",
            "lineNumber": 113
          },
          {
            "text": "        ",
            "lineNumber": 114
          },
          {
            "text": "        Returns:",
            "lineNumber": 115
          },
          {
            "text": "            Dictionary containing provider-specific configuration",
            "lineNumber": 116
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 117
          },
          {
            "text": "        configs = {",
            "lineNumber": 118
          },
          {
            "text": "            \"aws\": {",
            "lineNumber": 119
          },
          {
            "text": "                \"access_key\": self.aws_access_key,",
            "lineNumber": 120
          },
          {
            "text": "                \"secret_key\": self.aws_secret_key,",
            "lineNumber": 121
          },
          {
            "text": "                \"region\": self.aws_region",
            "lineNumber": 122
          },
          {
            "text": "            },",
            "lineNumber": 123
          },
          {
            "text": "            \"azure\": {",
            "lineNumber": 124
          },
          {
            "text": "                \"subscription_id\": self.azure_subscription_id,",
            "lineNumber": 125
          },
          {
            "text": "                \"client_id\": self.azure_client_id,",
            "lineNumber": 126
          },
          {
            "text": "                \"client_secret\": self.azure_client_secret,",
            "lineNumber": 127
          },
          {
            "text": "                \"tenant_id\": self.azure_tenant_id",
            "lineNumber": 128
          },
          {
            "text": "            },",
            "lineNumber": 129
          },
          {
            "text": "            \"gcp\": {",
            "lineNumber": 130
          },
          {
            "text": "                \"project_id\": self.gcp_project_id,",
            "lineNumber": 131
          },
          {
            "text": "                \"credentials_path\": self.gcp_credentials_path",
            "lineNumber": 132
          },
          {
            "text": "            }",
            "lineNumber": 133
          },
          {
            "text": "        }",
            "lineNumber": 134
          },
          {
            "text": "        return configs.get(provider, {})",
            "lineNumber": 135
          },
          {
            "text": "    ",
            "lineNumber": 136
          },
          {
            "text": "    def get_alert_channel_config(self, channel: str) -&gt; Dict[str, Any]:",
            "lineNumber": 137
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 138
          }
        ]
      },
      "score": 0.2659670114517212
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\README.md",
        "range": {
          "startPosition": {
            "line": 147
          },
          "endPosition": {
            "line": 213
          }
        },
        "contents": "   docker-compose logs -f agent\n   &#96;&#96;&#96;\n\n3. **Stop services**\n   &#96;&#96;&#96;bash\n   docker-compose down\n   &#96;&#96;&#96;\n\n## Configuration\n\nConfiguration is managed through environment variables. Key settings include:\n\n### Database Configuration\n- &#96;DATABASE_URL&#96;: PostgreSQL connection string\n\n### Metric Collection\n- &#96;METRIC_COLLECTION_INTERVAL&#96;: Collection interval in seconds (default: 60)\n\n### Thresholds\n- &#96;DEFAULT_CPU_THRESHOLD&#96;: Default CPU usage threshold (default: 80.0)\n- &#96;DEFAULT_MEMORY_THRESHOLD&#96;: Default memory usage threshold (default: 80.0)\n- &#96;DEFAULT_DISK_THRESHOLD&#96;: Default disk usage threshold (default: 80.0)\n\n### Cloud Provider Credentials\n- AWS: &#96;AWS_ACCESS_KEY_ID&#96;, &#96;AWS_SECRET_ACCESS_KEY&#96;, &#96;AWS_REGION&#96;\n- Azure: &#96;AZURE_SUBSCRIPTION_ID&#96;, &#96;AZURE_CLIENT_ID&#96;, &#96;AZURE_CLIENT_SECRET&#96;, &#96;AZURE_TENANT_ID&#96;\n- GCP: &#96;GCP_PROJECT_ID&#96;, &#96;GCP_CREDENTIALS_PATH&#96;\n\n### Alert Channels\n- Email: &#96;EMAIL_SMTP_SERVER&#96;, &#96;EMAIL_SMTP_PORT&#96;, &#96;EMAIL_USERNAME&#96;, &#96;EMAIL_PASSWORD&#96;\n- Slack: &#96;SLACK_WEBHOOK_URL&#96;\n- SMS: &#96;SMS_API_KEY&#96;, &#96;SMS_API_SECRET&#96;, &#96;SMS_FROM_NUMBER&#96;\n\n### Feature Flags\n- &#96;ANOMALY_DETECTION_ENABLED&#96;: Enable/disable anomaly detection (default: true)\n- &#96;ML_DETECTION_ENABLED&#96;: Enable/disable ML-based detection (default: false)\n- &#96;SELF_HEALING_ENABLED&#96;: Enable/disable self-healing (default: false)\n\n## Usage\n\n### Running the Agent\n\n&#96;&#96;&#96;bash\n# Local development\npython -m api\n\n# Docker\ndocker-compose up agent\n&#96;&#96;&#96;\n\n### API Endpoints\n\nThe agent provides REST API endpoints for:\n- **Metrics**: &#96;GET /api/metrics&#96;, &#96;POST /api/metrics/collect&#96;\n- **Alerts**: &#96;GET /api/alerts&#96;, &#96;POST /api/alerts&#96;, &#96;PUT /api/alerts/{id}&#96;\n- **Policies**: &#96;GET /api/policies&#96;, &#96;POST /api/policies&#96;, &#96;PUT /api/policies/{id}&#96;\n\n### Creating Policies\n\n&#96;&#96;&#96;python\nfrom policy_management.policy_definition import create_policy_manager\n\nmanager = create_policy_manager()\npolicy = manager.create_policy(\n    name=\"High CPU Alert\",\n    description=\"Alert when CPU usage exceeds 80%\",",
        "signatures": {},
        "detailedLines": [
          {
            "text": "   docker-compose logs -f agent",
            "lineNumber": 148
          },
          {
            "text": "   &#96;&#96;&#96;",
            "lineNumber": 149
          },
          {
            "lineNumber": 150
          },
          {
            "text": "3. **Stop services**",
            "lineNumber": 151
          },
          {
            "text": "   &#96;&#96;&#96;bash",
            "lineNumber": 152
          },
          {
            "text": "   docker-compose down",
            "lineNumber": 153
          },
          {
            "text": "   &#96;&#96;&#96;",
            "lineNumber": 154
          },
          {
            "lineNumber": 155
          },
          {
            "text": "## Configuration",
            "lineNumber": 156
          },
          {
            "lineNumber": 157
          },
          {
            "text": "Configuration is managed through environment variables. Key settings include:",
            "lineNumber": 158
          },
          {
            "lineNumber": 159
          },
          {
            "text": "### Database Configuration",
            "lineNumber": 160
          },
          {
            "text": "- &#96;DATABASE_URL&#96;: PostgreSQL connection string",
            "lineNumber": 161
          },
          {
            "lineNumber": 162
          },
          {
            "text": "### Metric Collection",
            "lineNumber": 163
          },
          {
            "text": "- &#96;METRIC_COLLECTION_INTERVAL&#96;: Collection interval in seconds (default: 60)",
            "lineNumber": 164
          },
          {
            "lineNumber": 165
          },
          {
            "text": "### Thresholds",
            "lineNumber": 166
          },
          {
            "text": "- &#96;DEFAULT_CPU_THRESHOLD&#96;: Default CPU usage threshold (default: 80.0)",
            "lineNumber": 167
          },
          {
            "text": "- &#96;DEFAULT_MEMORY_THRESHOLD&#96;: Default memory usage threshold (default: 80.0)",
            "lineNumber": 168
          },
          {
            "text": "- &#96;DEFAULT_DISK_THRESHOLD&#96;: Default disk usage threshold (default: 80.0)",
            "lineNumber": 169
          },
          {
            "lineNumber": 170
          },
          {
            "text": "### Cloud Provider Credentials",
            "lineNumber": 171
          },
          {
            "text": "- AWS: &#96;AWS_ACCESS_KEY_ID&#96;, &#96;AWS_SECRET_ACCESS_KEY&#96;, &#96;AWS_REGION&#96;",
            "lineNumber": 172
          },
          {
            "text": "- Azure: &#96;AZURE_SUBSCRIPTION_ID&#96;, &#96;AZURE_CLIENT_ID&#96;, &#96;AZURE_CLIENT_SECRET&#96;, &#96;AZURE_TENANT_ID&#96;",
            "lineNumber": 173
          },
          {
            "text": "- GCP: &#96;GCP_PROJECT_ID&#96;, &#96;GCP_CREDENTIALS_PATH&#96;",
            "lineNumber": 174
          },
          {
            "lineNumber": 175
          },
          {
            "text": "### Alert Channels",
            "lineNumber": 176
          },
          {
            "text": "- Email: &#96;EMAIL_SMTP_SERVER&#96;, &#96;EMAIL_SMTP_PORT&#96;, &#96;EMAIL_USERNAME&#96;, &#96;EMAIL_PASSWORD&#96;",
            "lineNumber": 177
          },
          {
            "text": "- Slack: &#96;SLACK_WEBHOOK_URL&#96;",
            "lineNumber": 178
          },
          {
            "text": "- SMS: &#96;SMS_API_KEY&#96;, &#96;SMS_API_SECRET&#96;, &#96;SMS_FROM_NUMBER&#96;",
            "lineNumber": 179
          },
          {
            "lineNumber": 180
          },
          {
            "text": "### Feature Flags",
            "lineNumber": 181
          },
          {
            "text": "- &#96;ANOMALY_DETECTION_ENABLED&#96;: Enable/disable anomaly detection (default: true)",
            "lineNumber": 182
          },
          {
            "text": "- &#96;ML_DETECTION_ENABLED&#96;: Enable/disable ML-based detection (default: false)",
            "lineNumber": 183
          },
          {
            "text": "- &#96;SELF_HEALING_ENABLED&#96;: Enable/disable self-healing (default: false)",
            "lineNumber": 184
          },
          {
            "lineNumber": 185
          },
          {
            "text": "## Usage",
            "lineNumber": 186
          },
          {
            "lineNumber": 187
          },
          {
            "text": "### Running the Agent",
            "lineNumber": 188
          },
          {
            "lineNumber": 189
          },
          {
            "text": "&#96;&#96;&#96;bash",
            "lineNumber": 190
          },
          {
            "text": "# Local development",
            "lineNumber": 191
          },
          {
            "text": "python -m api",
            "lineNumber": 192
          },
          {
            "lineNumber": 193
          },
          {
            "text": "# Docker",
            "lineNumber": 194
          },
          {
            "text": "docker-compose up agent",
            "lineNumber": 195
          },
          {
            "text": "&#96;&#96;&#96;",
            "lineNumber": 196
          },
          {
            "lineNumber": 197
          },
          {
            "text": "### API Endpoints",
            "lineNumber": 198
          },
          {
            "lineNumber": 199
          },
          {
            "text": "The agent provides REST API endpoints for:",
            "lineNumber": 200
          },
          {
            "text": "- **Metrics**: &#96;GET /api/metrics&#96;, &#96;POST /api/metrics/collect&#96;",
            "lineNumber": 201
          },
          {
            "text": "- **Alerts**: &#96;GET /api/alerts&#96;, &#96;POST /api/alerts&#96;, &#96;PUT /api/alerts/{id}&#96;",
            "lineNumber": 202
          },
          {
            "text": "- **Policies**: &#96;GET /api/policies&#96;, &#96;POST /api/policies&#96;, &#96;PUT /api/policies/{id}&#96;",
            "lineNumber": 203
          },
          {
            "lineNumber": 204
          },
          {
            "text": "### Creating Policies",
            "lineNumber": 205
          },
          {
            "lineNumber": 206
          },
          {
            "text": "&#96;&#96;&#96;python",
            "lineNumber": 207
          },
          {
            "text": "from policy_management.policy_definition import create_policy_manager",
            "lineNumber": 208
          },
          {
            "lineNumber": 209
          },
          {
            "text": "manager = create_policy_manager()",
            "lineNumber": 210
          },
          {
            "text": "policy = manager.create_policy(",
            "lineNumber": 211
          },
          {
            "text": "    name=\"High CPU Alert\",",
            "lineNumber": 212
          },
          {
            "text": "    description=\"Alert when CPU usage exceeds 80%\",",
            "lineNumber": 213
          }
        ]
      },
      "score": 0.2513847351074219
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\policy_management\\policy_enforcement.py",
        "range": {
          "startPosition": {
            "line": 70,
            "column": 63
          },
          "endPosition": {
            "line": 219
          }
        },
        "contents": "class PolicyEnforcer:\n    \"\"\"Enforces policies and triggers actions.\"\"\"\n    \n    def __init__(self, policy_manager=None, alert_system=None):\n        \"\"\"\n        Initialize policy enforcer.\n        \n        Args:\n            policy_manager: Optional policy definition manager\n            alert_system: Optional alerting system for triggering alerts\n        \"\"\"\n        self.policy_manager = policy_manager\n        self.alert_system = alert_system\n        self.evaluator = PolicyEvaluator()\n    \n    def enforce_policy(self, policy: Policy, context: Dict) -&gt; Dict:\n        \"\"\"\n        Enforce a policy against context data.\n        \n        Args:\n            policy: Policy instance to enforce\n            context: Context data to evaluate policy against\n        \n        Returns:\n            Dictionary containing enforcement result\n        \n        TODO: Implement policy enforcement logic\n        \"\"\"\n        if not policy.enabled:\n            return {\n                \"policy_id\": policy.policy_id,\n                \"enforced\": False,\n                \"reason\": \"Policy is disabled\",\n                \"violations\": [],\n                \"actions_taken\": []\n            }\n        \n        violations = []\n        actions_taken = []\n        \n        # Sort rules by priority (higher priority first)\n        sorted_rules = sorted(policy.rules, key=lambda r: r.priority, reverse=True)\n        \n        for rule in sorted_rules:\n            if self.evaluator.evaluate_rule(rule, context):\n                violations.append({\n                    \"rule\": rule.to_dict(),\n                    \"context\": context,\n                    \"timestamp\": datetime.now().isoformat()\n                })\n                \n                # Execute action\n                action_result = self._execute_action(rule.action, context, policy)\n                actions_taken.append(action_result)\n        \n        return {\n            \"policy_id\": policy.policy_id,",
        "signatures": {},
        "detailedLines": [
          {
            "text": "class PolicyEnforcer:",
            "lineNumber": 74,
            "isSignature": true
          },
          {
            "text": "    \"\"\"Enforces policies and triggers actions.\"\"\"",
            "lineNumber": 75
          },
          {
            "text": "    ",
            "lineNumber": 76
          },
          {
            "text": "    def __init__(self, policy_manager=None, alert_system=None):",
            "lineNumber": 77
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 78
          },
          {
            "text": "        Initialize policy enforcer.",
            "lineNumber": 79
          },
          {
            "text": "        ",
            "lineNumber": 80
          },
          {
            "text": "        Args:",
            "lineNumber": 81
          },
          {
            "text": "            policy_manager: Optional policy definition manager",
            "lineNumber": 82
          },
          {
            "text": "            alert_system: Optional alerting system for triggering alerts",
            "lineNumber": 83
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 84
          },
          {
            "text": "        self.policy_manager = policy_manager",
            "lineNumber": 85
          },
          {
            "text": "        self.alert_system = alert_system",
            "lineNumber": 86
          },
          {
            "text": "        self.evaluator = PolicyEvaluator()",
            "lineNumber": 87
          },
          {
            "text": "    ",
            "lineNumber": 88
          },
          {
            "text": "    def enforce_policy(self, policy: Policy, context: Dict) -&gt; Dict:",
            "lineNumber": 89
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 90
          },
          {
            "text": "        Enforce a policy against context data.",
            "lineNumber": 91
          },
          {
            "text": "        ",
            "lineNumber": 92
          },
          {
            "text": "        Args:",
            "lineNumber": 93
          },
          {
            "text": "            policy: Policy instance to enforce",
            "lineNumber": 94
          },
          {
            "text": "            context: Context data to evaluate policy against",
            "lineNumber": 95
          },
          {
            "text": "        ",
            "lineNumber": 96
          },
          {
            "text": "        Returns:",
            "lineNumber": 97
          },
          {
            "text": "            Dictionary containing enforcement result",
            "lineNumber": 98
          },
          {
            "text": "        ",
            "lineNumber": 99
          },
          {
            "text": "        TODO: Implement policy enforcement logic",
            "lineNumber": 100
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 101
          },
          {
            "text": "        if not policy.enabled:",
            "lineNumber": 102
          },
          {
            "text": "            return {",
            "lineNumber": 103
          },
          {
            "text": "                \"policy_id\": policy.policy_id,",
            "lineNumber": 104
          },
          {
            "text": "                \"enforced\": False,",
            "lineNumber": 105
          },
          {
            "text": "                \"reason\": \"Policy is disabled\",",
            "lineNumber": 106
          },
          {
            "text": "                \"violations\": [],",
            "lineNumber": 107
          },
          {
            "text": "                \"actions_taken\": []",
            "lineNumber": 108
          },
          {
            "text": "            }",
            "lineNumber": 109
          },
          {
            "text": "        ",
            "lineNumber": 110
          },
          {
            "text": "        violations = []",
            "lineNumber": 111
          },
          {
            "text": "        actions_taken = []",
            "lineNumber": 112
          },
          {
            "text": "        ",
            "lineNumber": 113
          },
          {
            "text": "        # Sort rules by priority (higher priority first)",
            "lineNumber": 114
          },
          {
            "text": "        sorted_rules = sorted(policy.rules, key=lambda r: r.priority, reverse=True)",
            "lineNumber": 115
          },
          {
            "text": "        ",
            "lineNumber": 116
          },
          {
            "text": "        for rule in sorted_rules:",
            "lineNumber": 117
          },
          {
            "text": "            if self.evaluator.evaluate_rule(rule, context):",
            "lineNumber": 118
          },
          {
            "text": "                violations.append({",
            "lineNumber": 119
          },
          {
            "text": "                    \"rule\": rule.to_dict(),",
            "lineNumber": 120
          },
          {
            "text": "                    \"context\": context,",
            "lineNumber": 121
          },
          {
            "text": "                    \"timestamp\": datetime.now().isoformat()",
            "lineNumber": 122
          },
          {
            "text": "                })",
            "lineNumber": 123
          },
          {
            "text": "                ",
            "lineNumber": 124
          },
          {
            "text": "                # Execute action",
            "lineNumber": 125
          },
          {
            "text": "                action_result = self._execute_action(rule.action, context, policy)",
            "lineNumber": 126
          },
          {
            "text": "                actions_taken.append(action_result)",
            "lineNumber": 127
          },
          {
            "text": "        ",
            "lineNumber": 128
          },
          {
            "text": "        return {",
            "lineNumber": 129
          },
          {
            "text": "            \"policy_id\": policy.policy_id,",
            "lineNumber": 130
          }
        ]
      },
      "score": 0.23892706632614136
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\config\\settings.py",
        "range": {
          "startPosition": {
            "line": 11
          },
          "endPosition": {
            "line": 178
          }
        },
        "contents": "class Settings:\ndef __init__(self):\n\n        self.enable_cloud_metrics = os.getenv(\n            \"ENABLE_CLOUD_METRICS\", \"false\"\n        ).lower() == \"true\"\n        self.aws_instance_ids = os.getenv(\"AWS_INSTANCE_IDS\", \"\").strip()\n        self.aws_s3_bucket_names = os.getenv(\"AWS_S3_BUCKET_NAMES\", \"\").strip()\n        self.gcp_instance_names = os.getenv(\"GCP_INSTANCE_NAMES\", \"\").strip()\n        self.gcp_bucket_names = os.getenv(\"GCP_BUCKET_NAMES\", \"\").strip()\n        self.azure_vm_names = os.getenv(\"AZURE_VM_NAMES\", \"\").strip()\n        \n        # Alert channel settings\n        self.email_smtp_server = os.getenv(\"EMAIL_SMTP_SERVER\", \"\")\n        self.email_smtp_port = int(os.getenv(\"EMAIL_SMTP_PORT\", \"587\"))\n        self.email_username = os.getenv(\"EMAIL_USERNAME\", \"\")\n        self.email_password = os.getenv(\"EMAIL_PASSWORD\", \"\")\n        self.email_recipients = os.getenv(\"EMAIL_RECIPIENTS\", \"\").split(\",\")\n        \n        self.slack_webhook_url = os.getenv(\"SLACK_WEBHOOK_URL\", \"\")\n        \n        self.sms_api_key = os.getenv(\"SMS_API_KEY\", \"\")\n        self.sms_api_secret = os.getenv(\"SMS_API_SECRET\", \"\")\n        self.sms_from_number = os.getenv(\"SMS_FROM_NUMBER\", \"\")\n        \n        # Anomaly detection settings\n        self.anomaly_detection_enabled = os.getenv(\n            \"ANOMALY_DETECTION_ENABLED\", \"true\"\n        ).lower() == \"true\"\n        self.ml_detection_enabled = os.getenv(\n            \"ML_DETECTION_ENABLED\", \"false\"\n        ).lower() == \"true\"\n        self.ml_model_path = os.getenv(\"ML_MODEL_PATH\", \"\")\n        \n        # Self-healing settings\n        self.self_healing_enabled = os.getenv(\n            \"SELF_HEALING_ENABLED\", \"false\"\n        ).lower() == \"true\"\n        self.min_scale_factor = float(os.getenv(\"MIN_SCALE_FACTOR\", \"0.1\"))\n        \n        # API settings\n        self.api_host = os.getenv(\"API_HOST\", \"0.0.0.0\")\n        self.api_port = int(os.getenv(\"API_PORT\", \"8000\"))\n        self.api_debug = os.getenv(\"API_DEBUG\", \"false\").lower() == \"true\"\n        self.api_rate_limit = os.getenv(\"API_RATE_LIMIT\", \"1 per minute\")\n        self.api_enable_rate_limit = os.getenv",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 12,
                "column": 1
              },
              "endPosition": {
                "line": 13,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 15,
                "column": 5
              },
              "endPosition": {
                "line": 16,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class Settings:",
            "lineNumber": 12,
            "isSignature": true
          },
          {
            "text": "def __init__(self):",
            "lineNumber": 15
          },
          {
            "lineNumber": 55
          },
          {
            "text": "        self.enable_cloud_metrics = os.getenv(",
            "lineNumber": 56
          },
          {
            "text": "            \"ENABLE_CLOUD_METRICS\", \"false\"",
            "lineNumber": 57
          },
          {
            "text": "        ).lower() == \"true\"",
            "lineNumber": 58
          },
          {
            "text": "        self.aws_instance_ids = os.getenv(\"AWS_INSTANCE_IDS\", \"\").strip()",
            "lineNumber": 59
          },
          {
            "text": "        self.aws_s3_bucket_names = os.getenv(\"AWS_S3_BUCKET_NAMES\", \"\").strip()",
            "lineNumber": 60
          },
          {
            "text": "        self.gcp_instance_names = os.getenv(\"GCP_INSTANCE_NAMES\", \"\").strip()",
            "lineNumber": 61
          },
          {
            "text": "        self.gcp_bucket_names = os.getenv(\"GCP_BUCKET_NAMES\", \"\").strip()",
            "lineNumber": 62
          },
          {
            "text": "        self.azure_vm_names = os.getenv(\"AZURE_VM_NAMES\", \"\").strip()",
            "lineNumber": 63
          },
          {
            "text": "        ",
            "lineNumber": 64
          },
          {
            "text": "        # Alert channel settings",
            "lineNumber": 65
          },
          {
            "text": "        self.email_smtp_server = os.getenv(\"EMAIL_SMTP_SERVER\", \"\")",
            "lineNumber": 66
          },
          {
            "text": "        self.email_smtp_port = int(os.getenv(\"EMAIL_SMTP_PORT\", \"587\"))",
            "lineNumber": 67
          },
          {
            "text": "        self.email_username = os.getenv(\"EMAIL_USERNAME\", \"\")",
            "lineNumber": 68
          },
          {
            "text": "        self.email_password = os.getenv(\"EMAIL_PASSWORD\", \"\")",
            "lineNumber": 69
          },
          {
            "text": "        self.email_recipients = os.getenv(\"EMAIL_RECIPIENTS\", \"\").split(\",\")",
            "lineNumber": 70
          },
          {
            "text": "        ",
            "lineNumber": 71
          },
          {
            "text": "        self.slack_webhook_url = os.getenv(\"SLACK_WEBHOOK_URL\", \"\")",
            "lineNumber": 72
          },
          {
            "text": "        ",
            "lineNumber": 73
          },
          {
            "text": "        self.sms_api_key = os.getenv(\"SMS_API_KEY\", \"\")",
            "lineNumber": 74
          },
          {
            "text": "        self.sms_api_secret = os.getenv(\"SMS_API_SECRET\", \"\")",
            "lineNumber": 75
          },
          {
            "text": "        self.sms_from_number = os.getenv(\"SMS_FROM_NUMBER\", \"\")",
            "lineNumber": 76
          },
          {
            "text": "        ",
            "lineNumber": 77
          },
          {
            "text": "        # Anomaly detection settings",
            "lineNumber": 78
          },
          {
            "text": "        self.anomaly_detection_enabled = os.getenv(",
            "lineNumber": 79
          },
          {
            "text": "            \"ANOMALY_DETECTION_ENABLED\", \"true\"",
            "lineNumber": 80
          },
          {
            "text": "        ).lower() == \"true\"",
            "lineNumber": 81
          },
          {
            "text": "        self.ml_detection_enabled = os.getenv(",
            "lineNumber": 82
          },
          {
            "text": "            \"ML_DETECTION_ENABLED\", \"false\"",
            "lineNumber": 83
          },
          {
            "text": "        ).lower() == \"true\"",
            "lineNumber": 84
          },
          {
            "text": "        self.ml_model_path = os.getenv(\"ML_MODEL_PATH\", \"\")",
            "lineNumber": 85
          },
          {
            "text": "        ",
            "lineNumber": 86
          },
          {
            "text": "        # Self-healing settings",
            "lineNumber": 87
          },
          {
            "text": "        self.self_healing_enabled = os.getenv(",
            "lineNumber": 88
          },
          {
            "text": "            \"SELF_HEALING_ENABLED\", \"false\"",
            "lineNumber": 89
          },
          {
            "text": "        ).lower() == \"true\"",
            "lineNumber": 90
          },
          {
            "text": "        self.min_scale_factor = float(os.getenv(\"MIN_SCALE_FACTOR\", \"0.1\"))",
            "lineNumber": 91
          },
          {
            "text": "        ",
            "lineNumber": 92
          },
          {
            "text": "        # API settings",
            "lineNumber": 93
          },
          {
            "text": "        self.api_host = os.getenv(\"API_HOST\", \"0.0.0.0\")",
            "lineNumber": 94
          },
          {
            "text": "        self.api_port = int(os.getenv(\"API_PORT\", \"8000\"))",
            "lineNumber": 95
          },
          {
            "text": "        self.api_debug = os.getenv(\"API_DEBUG\", \"false\").lower() == \"true\"",
            "lineNumber": 96
          },
          {
            "text": "        self.api_rate_limit = os.getenv(\"API_RATE_LIMIT\", \"1 per minute\")",
            "lineNumber": 97
          },
          {
            "text": "        self.api_enable_rate_limit = os.getenv",
            "lineNumber": 98
          }
        ]
      },
      "score": 0.23541605472564697
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\api\\__init__.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 11,
            "column": 43
          }
        },
        "contents": "\"\"\"\nAPI module for Monitor/Drift Agent.\n\nThis module provides REST API endpoints for agent communication,\nincluding metrics collection, alert management, and policy operations.\n\"\"\"\n\nfrom .metrics import *\nfrom .alerts import *\nfrom .policies import *\n\n__all__ = ['metrics', 'alerts', 'policies']",
        "signatures": {},
        "detailedLines": [
          {
            "text": "\"\"\"",
            "lineNumber": 1
          },
          {
            "text": "API module for Monitor/Drift Agent.",
            "lineNumber": 2
          },
          {
            "lineNumber": 3
          },
          {
            "text": "This module provides REST API endpoints for agent communication,",
            "lineNumber": 4
          },
          {
            "text": "including metrics collection, alert management, and policy operations.",
            "lineNumber": 5
          },
          {
            "text": "\"\"\"",
            "lineNumber": 6
          },
          {
            "lineNumber": 7
          },
          {
            "text": "from .metrics import *",
            "lineNumber": 8
          },
          {
            "text": "from .alerts import *",
            "lineNumber": 9
          },
          {
            "text": "from .policies import *",
            "lineNumber": 10
          },
          {
            "lineNumber": 11
          },
          {
            "text": "__all__ = ['metrics', 'alerts', 'policies']",
            "lineNumber": 12
          }
        ]
      },
      "score": 0.23115044832229614
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\api\\metrics.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 77
          }
        },
        "contents": "\"\"\"\nAPI endpoints for collecting system metrics.\n\nThis module provides REST API endpoints to collect and retrieve\nsystem metrics including CPU, memory, disk, and network statistics.\n\"\"\"\n\nfrom typing import Dict, Optional\nfrom datetime import datetime\nfrom fastapi import APIRouter, HTTPException, Request\nfrom fastapi.responses import JSONResponse\n\n# Try to import slowapi for rate limiting\ntry:\n    from slowapi import Limiter, _rate_limit_exceeded_handler\n    from slowapi.util import get_remote_address\n    from slowapi.errors import RateLimitExceeded\n    SLOWAPI_AVAILABLE = True\nexcept ImportError:\n    SLOWAPI_AVAILABLE = False\n    Limiter = None\n    get_remote_address = None\n    RateLimitExceeded = Exception\n\n# Import metric collection functions\ntry:\n    from data_collection.system_metrics import (\n        get_cpu_usage,\n        get_memory_usage,\n        get_network_traffic\n    )\nexcept ImportError:\n    # Fallback if module not available\n    def get_cpu_usage():\n        raise RuntimeError(\"System metrics module not available\")\n    def get_memory_usage():\n        raise RuntimeError(\"System metrics module not available\")\n    def get_network_traffic():\n        raise RuntimeError(\"System metrics module not available\")\n\n# Import settings for configuration\ntry:\n    from config.settings import get_settings\nexcept ImportError:\n    def get_settings():\n        return None\n\n# Create router\nrouter = APIRouter()\n\n# Rate limiter will be initialized in main.py and passed to router\n# For now, we'll use a simple approach that works with FastAPI\n\n\ndef get_rate_limit():\n    \"\"\"\n    Get the rate limit string from settings.\n    \n    Returns:\n        Rate limit string or None if rate limiting is disabled\n    \"\"\"\n    if not SLOWAPI_AVAILABLE:\n        return None\n    \n    settings = get_settings()\n    if settings and settings.api_enable_rate_limit:\n        return settings.api_rate_limit\n    \n    return None\n\n\n# Apply rate limiting decorator conditionally\ndef apply_rate_limit(func):\n    \"\"\"Apply rate limiting if enabled.\"\"\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "\"\"\"",
            "lineNumber": 1
          },
          {
            "text": "API endpoints for collecting system metrics.",
            "lineNumber": 2
          },
          {
            "lineNumber": 3
          },
          {
            "text": "This module provides REST API endpoints to collect and retrieve",
            "lineNumber": 4
          },
          {
            "text": "system metrics including CPU, memory, disk, and network statistics.",
            "lineNumber": 5
          },
          {
            "text": "\"\"\"",
            "lineNumber": 6
          },
          {
            "lineNumber": 7
          },
          {
            "text": "from typing import Dict, Optional",
            "lineNumber": 8
          },
          {
            "text": "from datetime import datetime",
            "lineNumber": 9
          },
          {
            "text": "from fastapi import APIRouter, HTTPException, Request",
            "lineNumber": 10
          },
          {
            "text": "from fastapi.responses import JSONResponse",
            "lineNumber": 11
          },
          {
            "lineNumber": 12
          },
          {
            "text": "# Try to import slowapi for rate limiting",
            "lineNumber": 13
          },
          {
            "text": "try:",
            "lineNumber": 14
          },
          {
            "text": "    from slowapi import Limiter, _rate_limit_exceeded_handler",
            "lineNumber": 15
          },
          {
            "text": "    from slowapi.util import get_remote_address",
            "lineNumber": 16
          },
          {
            "text": "    from slowapi.errors import RateLimitExceeded",
            "lineNumber": 17
          },
          {
            "text": "    SLOWAPI_AVAILABLE = True",
            "lineNumber": 18
          },
          {
            "text": "except ImportError:",
            "lineNumber": 19
          },
          {
            "text": "    SLOWAPI_AVAILABLE = False",
            "lineNumber": 20
          },
          {
            "text": "    Limiter = None",
            "lineNumber": 21
          },
          {
            "text": "    get_remote_address = None",
            "lineNumber": 22
          },
          {
            "text": "    RateLimitExceeded = Exception",
            "lineNumber": 23
          },
          {
            "lineNumber": 24
          },
          {
            "text": "# Import metric collection functions",
            "lineNumber": 25
          },
          {
            "text": "try:",
            "lineNumber": 26
          },
          {
            "text": "    from data_collection.system_metrics import (",
            "lineNumber": 27
          },
          {
            "text": "        get_cpu_usage,",
            "lineNumber": 28
          },
          {
            "text": "        get_memory_usage,",
            "lineNumber": 29
          },
          {
            "text": "        get_network_traffic",
            "lineNumber": 30
          },
          {
            "text": "    )",
            "lineNumber": 31
          },
          {
            "text": "except ImportError:",
            "lineNumber": 32
          },
          {
            "text": "    # Fallback if module not available",
            "lineNumber": 33
          },
          {
            "text": "    def get_cpu_usage():",
            "lineNumber": 34
          },
          {
            "text": "        raise RuntimeError(\"System metrics module not available\")",
            "lineNumber": 35
          },
          {
            "text": "    def get_memory_usage():",
            "lineNumber": 36
          },
          {
            "text": "        raise RuntimeError(\"System metrics module not available\")",
            "lineNumber": 37
          },
          {
            "text": "    def get_network_traffic():",
            "lineNumber": 38
          },
          {
            "text": "        raise RuntimeError(\"System metrics module not available\")",
            "lineNumber": 39
          },
          {
            "lineNumber": 40
          },
          {
            "text": "# Import settings for configuration",
            "lineNumber": 41
          },
          {
            "text": "try:",
            "lineNumber": 42
          },
          {
            "text": "    from config.settings import get_settings",
            "lineNumber": 43
          },
          {
            "text": "except ImportError:",
            "lineNumber": 44
          },
          {
            "text": "    def get_settings():",
            "lineNumber": 45
          },
          {
            "text": "        return None",
            "lineNumber": 46
          },
          {
            "lineNumber": 47
          },
          {
            "text": "# Create router",
            "lineNumber": 48
          },
          {
            "text": "router = APIRouter()",
            "lineNumber": 49
          },
          {
            "lineNumber": 50
          },
          {
            "text": "# Rate limiter will be initialized in main.py and passed to router",
            "lineNumber": 51
          },
          {
            "text": "# For now, we'll use a simple approach that works with FastAPI",
            "lineNumber": 52
          },
          {
            "lineNumber": 53
          },
          {
            "lineNumber": 54
          },
          {
            "text": "def get_rate_limit():",
            "lineNumber": 55,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 56
          },
          {
            "text": "    Get the rate limit string from settings.",
            "lineNumber": 57
          },
          {
            "text": "    ",
            "lineNumber": 58
          },
          {
            "text": "    Returns:",
            "lineNumber": 59
          },
          {
            "text": "        Rate limit string or None if rate limiting is disabled",
            "lineNumber": 60
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 61
          },
          {
            "text": "    if not SLOWAPI_AVAILABLE:",
            "lineNumber": 62
          },
          {
            "text": "        return None",
            "lineNumber": 63
          },
          {
            "text": "    ",
            "lineNumber": 64
          },
          {
            "text": "    settings = get_settings()",
            "lineNumber": 65
          },
          {
            "text": "    if settings and settings.api_enable_rate_limit:",
            "lineNumber": 66
          },
          {
            "text": "        return settings.api_rate_limit",
            "lineNumber": 67
          },
          {
            "text": "    ",
            "lineNumber": 68
          },
          {
            "text": "    return None",
            "lineNumber": 69,
            "isSignature": true
          },
          {
            "lineNumber": 70
          },
          {
            "lineNumber": 71
          },
          {
            "text": "# Apply rate limiting decorator conditionally",
            "lineNumber": 72
          },
          {
            "text": "def apply_rate_limit(func):",
            "lineNumber": 73,
            "isSignature": true
          },
          {
            "text": "    \"\"\"Apply rate limiting if enabled.\"\"\"",
            "lineNumber": 74
          }
        ]
      },
      "score": 0.23065656423568726
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\cloud_metrics.py",
        "range": {
          "startPosition": {
            "line": 765
          },
          "endPosition": {
            "line": 1080
          }
        },
        "contents": "class GCPMetricsCollector(CloudProvider):\ndef authenticate(self, credentials: Dict) -&gt; bool:\n\n            return False\n        \n        try:\n            project_id = credentials.get('project_id')\n            credentials_path = credentials.get('credentials_path')\n            \n            if not project_id:\n                self.logger.error(\"GCP project_id is required\")\n                return False\n            \n            self.project_id = project_id\n            \n            # Set credentials path if provided\n            if credentials_path:\n                os.environ['GOOGLE_APPLICATION_CREDENTIALS'] = credentials_path\n            \n            # Initialize clients\n            self.monitoring_client = monitoring_v3.MetricServiceClient()\n            self.compute_client = compute_v1.InstancesClient()\n            self.storage_client = gcp_storage.Client(project=project_id)\n            \n            # Test authentication by making a simple API call\n            project_name = f\"projects/{project_id}\"\n            list(self.monitoring_client.list_metric_descriptors(name=project_name, page_size=1))\n            \n            return True\n        except GoogleAuthError as e:\n            self.logger.error(f\"GCP authentication failed: {str(e)}\")\n            return False\n        except Exception as e:\n            self.logger.error(f\"Unexpected error during GCP authentication: {str(e)}\")\n            return False\n    \n    def get_gcp_metrics(self) -&gt; List[Dict]:\n        \"\"\"",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 766,
                "column": 1
              },
              "endPosition": {
                "line": 767,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 777,
                "column": 5
              },
              "endPosition": {
                "line": 778,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class GCPMetricsCollector(CloudProvider):",
            "lineNumber": 766,
            "isSignature": true
          },
          {
            "text": "def authenticate(self, credentials: Dict) -&gt; bool:",
            "lineNumber": 777
          },
          {
            "lineNumber": 788
          },
          {
            "text": "            return False",
            "lineNumber": 789
          },
          {
            "text": "        ",
            "lineNumber": 790
          },
          {
            "text": "        try:",
            "lineNumber": 791
          },
          {
            "text": "            project_id = credentials.get('project_id')",
            "lineNumber": 792
          },
          {
            "text": "            credentials_path = credentials.get('credentials_path')",
            "lineNumber": 793
          },
          {
            "text": "            ",
            "lineNumber": 794
          },
          {
            "text": "            if not project_id:",
            "lineNumber": 795
          },
          {
            "text": "                self.logger.error(\"GCP project_id is required\")",
            "lineNumber": 796
          },
          {
            "text": "                return False",
            "lineNumber": 797
          },
          {
            "text": "            ",
            "lineNumber": 798
          },
          {
            "text": "            self.project_id = project_id",
            "lineNumber": 799
          },
          {
            "text": "            ",
            "lineNumber": 800
          },
          {
            "text": "            # Set credentials path if provided",
            "lineNumber": 801
          },
          {
            "text": "            if credentials_path:",
            "lineNumber": 802
          },
          {
            "text": "                os.environ['GOOGLE_APPLICATION_CREDENTIALS'] = credentials_path",
            "lineNumber": 803
          },
          {
            "text": "            ",
            "lineNumber": 804
          },
          {
            "text": "            # Initialize clients",
            "lineNumber": 805
          },
          {
            "text": "            self.monitoring_client = monitoring_v3.MetricServiceClient()",
            "lineNumber": 806
          },
          {
            "text": "            self.compute_client = compute_v1.InstancesClient()",
            "lineNumber": 807
          },
          {
            "text": "            self.storage_client = gcp_storage.Client(project=project_id)",
            "lineNumber": 808
          },
          {
            "text": "            ",
            "lineNumber": 809
          },
          {
            "text": "            # Test authentication by making a simple API call",
            "lineNumber": 810
          },
          {
            "text": "            project_name = f\"projects/{project_id}\"",
            "lineNumber": 811
          },
          {
            "text": "            list(self.monitoring_client.list_metric_descriptors(name=project_name, page_size=1))",
            "lineNumber": 812
          },
          {
            "text": "            ",
            "lineNumber": 813
          },
          {
            "text": "            return True",
            "lineNumber": 814
          },
          {
            "text": "        except GoogleAuthError as e:",
            "lineNumber": 815
          },
          {
            "text": "            self.logger.error(f\"GCP authentication failed: {str(e)}\")",
            "lineNumber": 816
          },
          {
            "text": "            return False",
            "lineNumber": 817
          },
          {
            "text": "        except Exception as e:",
            "lineNumber": 818
          },
          {
            "text": "            self.logger.error(f\"Unexpected error during GCP authentication: {str(e)}\")",
            "lineNumber": 819
          },
          {
            "text": "            return False",
            "lineNumber": 820
          },
          {
            "text": "    ",
            "lineNumber": 821
          },
          {
            "text": "    def get_gcp_metrics(self) -&gt; List[Dict]:",
            "lineNumber": 822
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 823
          }
        ]
      },
      "score": 0.22487859427928925
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\docker\\docker-compose.yml",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 60
          }
        },
        "contents": "# Docker Compose configuration for Monitor/Drift Agent\nversion: '3.8'\n\nservices:\n  # Monitor/Drift Agent service\n  agent:\n    build:\n      context: ..\n      dockerfile: docker/Dockerfile\n    container_name: monitor_drift_agent\n    restart: unless-stopped\n    environment:\n      # Database configuration\n      - DATABASE_URL=postgresql://monitor_drift:password@postgres:5432/monitor_drift\n      \n      # Metric collection settings\n      - METRIC_COLLECTION_INTERVAL=60\n      \n      # Threshold settings\n      - DEFAULT_CPU_THRESHOLD=80.0\n      - DEFAULT_MEMORY_THRESHOLD=80.0\n      - DEFAULT_DISK_THRESHOLD=80.0\n      \n      # Cloud provider credentials (set via .env file or secrets)\n      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID:-}\n      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY:-}\n      - AWS_REGION=${AWS_REGION:-us-east-1}\n      \n      # Alert channel configuration\n      - EMAIL_SMTP_SERVER=${EMAIL_SMTP_SERVER:-}\n      - EMAIL_SMTP_PORT=${EMAIL_SMTP_PORT:-587}\n      - EMAIL_USERNAME=${EMAIL_USERNAME:-}\n      - EMAIL_PASSWORD=${EMAIL_PASSWORD:-}\n      - SLACK_WEBHOOK_URL=${SLACK_WEBHOOK_URL:-}\n      \n      # Feature flags\n      - ANOMALY_DETECTION_ENABLED=true\n      - ML_DETECTION_ENABLED=false\n      - SELF_HEALING_ENABLED=false\n      \n      # API settings\n      - API_HOST=0.0.0.0\n      - API_PORT=8000\n      - API_DEBUG=false\n      \n      # Logging\n      - LOG_LEVEL=INFO\n    ports:\n      - \"8000:8000\"\n    volumes:\n      - ../logs:/app/logs\n      - ../data:/app/data\n    depends_on:\n      - postgres\n    networks:\n      - monitor_drift_network\n\n  # PostgreSQL database service\n  postgres:\n    image: postgres:15-alpine",
        "signatures": {},
        "detailedLines": [
          {
            "text": "# Docker Compose configuration for Monitor/Drift Agent",
            "lineNumber": 1
          },
          {
            "text": "version: '3.8'",
            "lineNumber": 2
          },
          {
            "lineNumber": 3
          },
          {
            "text": "services:",
            "lineNumber": 4
          },
          {
            "text": "  # Monitor/Drift Agent service",
            "lineNumber": 5
          },
          {
            "text": "  agent:",
            "lineNumber": 6
          },
          {
            "text": "    build:",
            "lineNumber": 7
          },
          {
            "text": "      context: ..",
            "lineNumber": 8
          },
          {
            "text": "      dockerfile: docker/Dockerfile",
            "lineNumber": 9
          },
          {
            "text": "    container_name: monitor_drift_agent",
            "lineNumber": 10
          },
          {
            "text": "    restart: unless-stopped",
            "lineNumber": 11
          },
          {
            "text": "    environment:",
            "lineNumber": 12
          },
          {
            "text": "      # Database configuration",
            "lineNumber": 13
          },
          {
            "text": "      - DATABASE_URL=postgresql://monitor_drift:password@postgres:5432/monitor_drift",
            "lineNumber": 14
          },
          {
            "text": "      ",
            "lineNumber": 15
          },
          {
            "text": "      # Metric collection settings",
            "lineNumber": 16
          },
          {
            "text": "      - METRIC_COLLECTION_INTERVAL=60",
            "lineNumber": 17
          },
          {
            "text": "      ",
            "lineNumber": 18
          },
          {
            "text": "      # Threshold settings",
            "lineNumber": 19
          },
          {
            "text": "      - DEFAULT_CPU_THRESHOLD=80.0",
            "lineNumber": 20
          },
          {
            "text": "      - DEFAULT_MEMORY_THRESHOLD=80.0",
            "lineNumber": 21
          },
          {
            "text": "      - DEFAULT_DISK_THRESHOLD=80.0",
            "lineNumber": 22
          },
          {
            "text": "      ",
            "lineNumber": 23
          },
          {
            "text": "      # Cloud provider credentials (set via .env file or secrets)",
            "lineNumber": 24
          },
          {
            "text": "      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID:-}",
            "lineNumber": 25
          },
          {
            "text": "      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY:-}",
            "lineNumber": 26
          },
          {
            "text": "      - AWS_REGION=${AWS_REGION:-us-east-1}",
            "lineNumber": 27
          },
          {
            "text": "      ",
            "lineNumber": 28
          },
          {
            "text": "      # Alert channel configuration",
            "lineNumber": 29
          },
          {
            "text": "      - EMAIL_SMTP_SERVER=${EMAIL_SMTP_SERVER:-}",
            "lineNumber": 30
          },
          {
            "text": "      - EMAIL_SMTP_PORT=${EMAIL_SMTP_PORT:-587}",
            "lineNumber": 31
          },
          {
            "text": "      - EMAIL_USERNAME=${EMAIL_USERNAME:-}",
            "lineNumber": 32
          },
          {
            "text": "      - EMAIL_PASSWORD=${EMAIL_PASSWORD:-}",
            "lineNumber": 33
          },
          {
            "text": "      - SLACK_WEBHOOK_URL=${SLACK_WEBHOOK_URL:-}",
            "lineNumber": 34
          },
          {
            "text": "      ",
            "lineNumber": 35
          },
          {
            "text": "      # Feature flags",
            "lineNumber": 36
          },
          {
            "text": "      - ANOMALY_DETECTION_ENABLED=true",
            "lineNumber": 37
          },
          {
            "text": "      - ML_DETECTION_ENABLED=false",
            "lineNumber": 38
          },
          {
            "text": "      - SELF_HEALING_ENABLED=false",
            "lineNumber": 39
          },
          {
            "text": "      ",
            "lineNumber": 40
          },
          {
            "text": "      # API settings",
            "lineNumber": 41
          },
          {
            "text": "      - API_HOST=0.0.0.0",
            "lineNumber": 42
          },
          {
            "text": "      - API_PORT=8000",
            "lineNumber": 43
          },
          {
            "text": "      - API_DEBUG=false",
            "lineNumber": 44
          },
          {
            "text": "      ",
            "lineNumber": 45
          },
          {
            "text": "      # Logging",
            "lineNumber": 46
          },
          {
            "text": "      - LOG_LEVEL=INFO",
            "lineNumber": 47
          },
          {
            "text": "    ports:",
            "lineNumber": 48
          },
          {
            "text": "      - \"8000:8000\"",
            "lineNumber": 49
          },
          {
            "text": "    volumes:",
            "lineNumber": 50
          },
          {
            "text": "      - ../logs:/app/logs",
            "lineNumber": 51
          },
          {
            "text": "      - ../data:/app/data",
            "lineNumber": 52
          },
          {
            "text": "    depends_on:",
            "lineNumber": 53
          },
          {
            "text": "      - postgres",
            "lineNumber": 54
          },
          {
            "text": "    networks:",
            "lineNumber": 55
          },
          {
            "text": "      - monitor_drift_network",
            "lineNumber": 56
          },
          {
            "lineNumber": 57
          },
          {
            "text": "  # PostgreSQL database service",
            "lineNumber": 58
          },
          {
            "text": "  postgres:",
            "lineNumber": 59
          },
          {
            "text": "    image: postgres:15-alpine",
            "lineNumber": 60
          }
        ]
      },
      "score": 0.2212446928024292
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\cloud_metrics.py",
        "range": {
          "startPosition": {
            "line": 114,
            "column": 12
          },
          "endPosition": {
            "line": 432
          }
        },
        "contents": "class AWSMetricsCollector(CloudProvider):\n    \"\"\"Collector for AWS cloud metrics.\"\"\"\n    \n    def __init__(self):\n        \"\"\"Initialize AWS metrics collector.\"\"\"\n        self.cloudwatch_client = None\n        self.ec2_client = None\n        self.s3_client = None\n        self.logger = get_logger(__name__)\n    \n    def authenticate(self, credentials: Dict) -&gt; bool:\n        \"\"\"\n        Authenticate with AWS using provided credentials.\n        \n        Args:\n            credentials: Dictionary containing AWS credentials (access_key, secret_key, region)\n        \n        Returns:\n            True if authentication successful, False otherwise\n        \"\"\"\n        if not BOTO3_AVAILABLE:\n            self.logger.error(\"boto3 library is not available\")\n            return False\n        \n        try:\n            access_key = credentials.get('access_key')\n            secret_key = credentials.get('secret_key')\n            region = credentials.get('region', 'us-east-1')\n            \n            if not access_key or not secret_key:\n                self.logger.error(\"AWS credentials (access_key, secret_key) are required\")\n                return False\n            \n            # Create clients with explicit credentials\n            session = boto3.Session(\n                aws_access_key_id=access_key,\n                aws_secret_access_key=secret_key,\n                region_name=region\n            )\n            \n            self.cloudwatch_client = session.client('cloudwatch')\n            self.ec2_client = session.client('ec2')\n            self.s3_client = session.client('s3')\n            \n            # Test authentication by making a simple API call\n            self.ec2_client.describe_regions(MaxResults=1)\n            \n            return True\n        except (ClientError, BotoCoreError) as e:\n            self.logger.error(f\"AWS authentication failed: {str(e)}\")\n            return False\n        except Exception as e:\n            self.logger.error(f\"Unexpected error during AWS authentication: {str(e)}\")\n            return False\n    \n    def get_aws_metrics(self) -&gt; List[Dict]:\n        \"\"\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "class AWSMetricsCollector(CloudProvider):",
            "lineNumber": 118,
            "isSignature": true
          },
          {
            "text": "    \"\"\"Collector for AWS cloud metrics.\"\"\"",
            "lineNumber": 119
          },
          {
            "text": "    ",
            "lineNumber": 120
          },
          {
            "text": "    def __init__(self):",
            "lineNumber": 121
          },
          {
            "text": "        \"\"\"Initialize AWS metrics collector.\"\"\"",
            "lineNumber": 122
          },
          {
            "text": "        self.cloudwatch_client = None",
            "lineNumber": 123
          },
          {
            "text": "        self.ec2_client = None",
            "lineNumber": 124
          },
          {
            "text": "        self.s3_client = None",
            "lineNumber": 125
          },
          {
            "text": "        self.logger = get_logger(__name__)",
            "lineNumber": 126
          },
          {
            "text": "    ",
            "lineNumber": 127
          },
          {
            "text": "    def authenticate(self, credentials: Dict) -&gt; bool:",
            "lineNumber": 128
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 129
          },
          {
            "text": "        Authenticate with AWS using provided credentials.",
            "lineNumber": 130
          },
          {
            "text": "        ",
            "lineNumber": 131
          },
          {
            "text": "        Args:",
            "lineNumber": 132
          },
          {
            "text": "            credentials: Dictionary containing AWS credentials (access_key, secret_key, region)",
            "lineNumber": 133
          },
          {
            "text": "        ",
            "lineNumber": 134
          },
          {
            "text": "        Returns:",
            "lineNumber": 135
          },
          {
            "text": "            True if authentication successful, False otherwise",
            "lineNumber": 136
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 137
          },
          {
            "text": "        if not BOTO3_AVAILABLE:",
            "lineNumber": 138
          },
          {
            "text": "            self.logger.error(\"boto3 library is not available\")",
            "lineNumber": 139
          },
          {
            "text": "            return False",
            "lineNumber": 140
          },
          {
            "text": "        ",
            "lineNumber": 141
          },
          {
            "text": "        try:",
            "lineNumber": 142
          },
          {
            "text": "            access_key = credentials.get('access_key')",
            "lineNumber": 143
          },
          {
            "text": "            secret_key = credentials.get('secret_key')",
            "lineNumber": 144
          },
          {
            "text": "            region = credentials.get('region', 'us-east-1')",
            "lineNumber": 145
          },
          {
            "text": "            ",
            "lineNumber": 146
          },
          {
            "text": "            if not access_key or not secret_key:",
            "lineNumber": 147
          },
          {
            "text": "                self.logger.error(\"AWS credentials (access_key, secret_key) are required\")",
            "lineNumber": 148
          },
          {
            "text": "                return False",
            "lineNumber": 149
          },
          {
            "text": "            ",
            "lineNumber": 150
          },
          {
            "text": "            # Create clients with explicit credentials",
            "lineNumber": 151
          },
          {
            "text": "            session = boto3.Session(",
            "lineNumber": 152
          },
          {
            "text": "                aws_access_key_id=access_key,",
            "lineNumber": 153
          },
          {
            "text": "                aws_secret_access_key=secret_key,",
            "lineNumber": 154
          },
          {
            "text": "                region_name=region",
            "lineNumber": 155
          },
          {
            "text": "            )",
            "lineNumber": 156
          },
          {
            "text": "            ",
            "lineNumber": 157
          },
          {
            "text": "            self.cloudwatch_client = session.client('cloudwatch')",
            "lineNumber": 158
          },
          {
            "text": "            self.ec2_client = session.client('ec2')",
            "lineNumber": 159
          },
          {
            "text": "            self.s3_client = session.client('s3')",
            "lineNumber": 160
          },
          {
            "text": "            ",
            "lineNumber": 161
          },
          {
            "text": "            # Test authentication by making a simple API call",
            "lineNumber": 162
          },
          {
            "text": "            self.ec2_client.describe_regions(MaxResults=1)",
            "lineNumber": 163
          },
          {
            "text": "            ",
            "lineNumber": 164
          },
          {
            "text": "            return True",
            "lineNumber": 165
          },
          {
            "text": "        except (ClientError, BotoCoreError) as e:",
            "lineNumber": 166
          },
          {
            "text": "            self.logger.error(f\"AWS authentication failed: {str(e)}\")",
            "lineNumber": 167
          },
          {
            "text": "            return False",
            "lineNumber": 168
          },
          {
            "text": "        except Exception as e:",
            "lineNumber": 169
          },
          {
            "text": "            self.logger.error(f\"Unexpected error during AWS authentication: {str(e)}\")",
            "lineNumber": 170
          },
          {
            "text": "            return False",
            "lineNumber": 171
          },
          {
            "text": "    ",
            "lineNumber": 172
          },
          {
            "text": "    def get_aws_metrics(self) -&gt; List[Dict]:",
            "lineNumber": 173
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 174
          }
        ]
      },
      "score": 0.22086510062217712
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\config\\settings.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 178
          }
        },
        "contents": "\"\"\"\nConfiguration settings for Monitor/Drift Agent.\n\nThis module provides configuration management for the agent including\nthresholds, alert channels, database connections, and other settings.\n\"\"\"\n\nimport os\nfrom typing import Dict, Optional, Any\n\n\nclass Settings:\n    \"\"\"Manages application settings.\"\"\"\n    \n    def __init__(self):\n        \"\"\"Initialize settings from environment variables and defaults.\"\"\"\n        # Database settings\n        self.database_url = os.getenv(\n            \"DATABASE_URL\",\n            \"postgresql://user:password@localhost:5432/monitor_drift\"\n        )\n        \n        # Metric collection settings\n        self.metric_collection_interval = int(\n            os.getenv(\"METRIC_COLLECTION_INTERVAL\", \"60\")\n        )  # seconds\n        \n        # Threshold settings\n        self.default_cpu_threshold = float(\n            os.getenv(\"DEFAULT_CPU_THRESHOLD\", \"80.0\")\n        )\n        self.default_memory_threshold = float(\n            os.getenv(\"DEFAULT_MEMORY_THRESHOLD\", \"80.0\")\n        )\n        self.default_disk_threshold = float(\n            os.getenv(\"DEFAULT_DISK_THRESHOLD\", \"80.0\")\n        )\n        \n        # Cloud provider settings\n        self.aws_access_key = os.getenv(\"AWS_ACCESS_KEY_ID\", \"\")\n        self.aws_secret_key = os.getenv(\"AWS_SECRET_ACCESS_KEY\", \"\")\n        self.aws_region = os.getenv(\"AWS_REGION\", \"us-east-1\")\n        \n        self.azure_subscription_id = os.getenv(\"AZURE_SUBSCRIPTION_ID\", \"\")\n        self.azure_client_id = os.getenv(\"AZURE_CLIENT_ID\", \"\")\n        self.azure_client_secret = os.getenv(\"AZURE_CLIENT_SECRET\", \"\")\n        self.azure_tenant_id = os.getenv(\"AZURE_TENANT_ID\", \"\")\n        \n        self.gcp_project_id = os.getenv(\"GCP_PROJECT_ID\", \"\")\n        self.gcp_credentials_path = os.getenv(\"GCP_CREDENTIALS_PATH\", \"\")\n        \n        # Cloud metrics collection settings\n        self.cloud_metrics_time_window_minutes = int(\n            os.getenv(\"CLOUD_METRICS_TIME_WINDOW_MINUTES\", \"5\")\n        )\n        self.enable_cloud_metrics = os.getenv(\n            \"ENABLE_CLOUD_METRICS\", \"false\"\n        ).lower() == \"true\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "\"\"\"",
            "lineNumber": 1
          },
          {
            "text": "Configuration settings for Monitor/Drift Agent.",
            "lineNumber": 2
          },
          {
            "lineNumber": 3
          },
          {
            "text": "This module provides configuration management for the agent including",
            "lineNumber": 4
          },
          {
            "text": "thresholds, alert channels, database connections, and other settings.",
            "lineNumber": 5
          },
          {
            "text": "\"\"\"",
            "lineNumber": 6
          },
          {
            "lineNumber": 7
          },
          {
            "text": "import os",
            "lineNumber": 8
          },
          {
            "text": "from typing import Dict, Optional, Any",
            "lineNumber": 9
          },
          {
            "lineNumber": 10
          },
          {
            "lineNumber": 11
          },
          {
            "text": "class Settings:",
            "lineNumber": 12,
            "isSignature": true
          },
          {
            "text": "    \"\"\"Manages application settings.\"\"\"",
            "lineNumber": 13
          },
          {
            "text": "    ",
            "lineNumber": 14
          },
          {
            "text": "    def __init__(self):",
            "lineNumber": 15
          },
          {
            "text": "        \"\"\"Initialize settings from environment variables and defaults.\"\"\"",
            "lineNumber": 16
          },
          {
            "text": "        # Database settings",
            "lineNumber": 17
          },
          {
            "text": "        self.database_url = os.getenv(",
            "lineNumber": 18
          },
          {
            "text": "            \"DATABASE_URL\",",
            "lineNumber": 19
          },
          {
            "text": "            \"postgresql://user:password@localhost:5432/monitor_drift\"",
            "lineNumber": 20
          },
          {
            "text": "        )",
            "lineNumber": 21
          },
          {
            "text": "        ",
            "lineNumber": 22
          },
          {
            "text": "        # Metric collection settings",
            "lineNumber": 23
          },
          {
            "text": "        self.metric_collection_interval = int(",
            "lineNumber": 24
          },
          {
            "text": "            os.getenv(\"METRIC_COLLECTION_INTERVAL\", \"60\")",
            "lineNumber": 25
          },
          {
            "text": "        )  # seconds",
            "lineNumber": 26
          },
          {
            "text": "        ",
            "lineNumber": 27
          },
          {
            "text": "        # Threshold settings",
            "lineNumber": 28
          },
          {
            "text": "        self.default_cpu_threshold = float(",
            "lineNumber": 29
          },
          {
            "text": "            os.getenv(\"DEFAULT_CPU_THRESHOLD\", \"80.0\")",
            "lineNumber": 30
          },
          {
            "text": "        )",
            "lineNumber": 31
          },
          {
            "text": "        self.default_memory_threshold = float(",
            "lineNumber": 32
          },
          {
            "text": "            os.getenv(\"DEFAULT_MEMORY_THRESHOLD\", \"80.0\")",
            "lineNumber": 33
          },
          {
            "text": "        )",
            "lineNumber": 34
          },
          {
            "text": "        self.default_disk_threshold = float(",
            "lineNumber": 35
          },
          {
            "text": "            os.getenv(\"DEFAULT_DISK_THRESHOLD\", \"80.0\")",
            "lineNumber": 36
          },
          {
            "text": "        )",
            "lineNumber": 37
          },
          {
            "text": "        ",
            "lineNumber": 38
          },
          {
            "text": "        # Cloud provider settings",
            "lineNumber": 39
          },
          {
            "text": "        self.aws_access_key = os.getenv(\"AWS_ACCESS_KEY_ID\", \"\")",
            "lineNumber": 40
          },
          {
            "text": "        self.aws_secret_key = os.getenv(\"AWS_SECRET_ACCESS_KEY\", \"\")",
            "lineNumber": 41
          },
          {
            "text": "        self.aws_region = os.getenv(\"AWS_REGION\", \"us-east-1\")",
            "lineNumber": 42
          },
          {
            "text": "        ",
            "lineNumber": 43
          },
          {
            "text": "        self.azure_subscription_id = os.getenv(\"AZURE_SUBSCRIPTION_ID\", \"\")",
            "lineNumber": 44
          },
          {
            "text": "        self.azure_client_id = os.getenv(\"AZURE_CLIENT_ID\", \"\")",
            "lineNumber": 45
          },
          {
            "text": "        self.azure_client_secret = os.getenv(\"AZURE_CLIENT_SECRET\", \"\")",
            "lineNumber": 46
          },
          {
            "text": "        self.azure_tenant_id = os.getenv(\"AZURE_TENANT_ID\", \"\")",
            "lineNumber": 47
          },
          {
            "text": "        ",
            "lineNumber": 48
          },
          {
            "text": "        self.gcp_project_id = os.getenv(\"GCP_PROJECT_ID\", \"\")",
            "lineNumber": 49
          },
          {
            "text": "        self.gcp_credentials_path = os.getenv(\"GCP_CREDENTIALS_PATH\", \"\")",
            "lineNumber": 50
          },
          {
            "text": "        ",
            "lineNumber": 51
          },
          {
            "text": "        # Cloud metrics collection settings",
            "lineNumber": 52
          },
          {
            "text": "        self.cloud_metrics_time_window_minutes = int(",
            "lineNumber": 53
          },
          {
            "text": "            os.getenv(\"CLOUD_METRICS_TIME_WINDOW_MINUTES\", \"5\")",
            "lineNumber": 54
          },
          {
            "text": "        )",
            "lineNumber": 55
          },
          {
            "text": "        self.enable_cloud_metrics = os.getenv(",
            "lineNumber": 56
          },
          {
            "text": "            \"ENABLE_CLOUD_METRICS\", \"false\"",
            "lineNumber": 57
          },
          {
            "text": "        ).lower() == \"true\"",
            "lineNumber": 58
          }
        ]
      },
      "score": 0.22082209587097168
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\api\\metrics.py",
        "range": {
          "startPosition": {
            "line": 68,
            "column": 15
          },
          "endPosition": {
            "line": 127
          }
        },
        "contents": "# Apply rate limiting decorator conditionally\ndef apply_rate_limit(func):\n    \"\"\"Apply rate limiting if enabled.\"\"\"\n    rate_limit = get_rate_limit()\n    if rate_limit and limiter:\n        return limiter.limit(rate_limit)(func)\n    return func\n\n\n@router.get(\"/api/metrics\")\n@apply_rate_limit\nasync def get_metrics(request: Request):\n    \"\"\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "# Apply rate limiting decorator conditionally",
            "lineNumber": 72
          },
          {
            "text": "def apply_rate_limit(func):",
            "lineNumber": 73,
            "isSignature": true
          },
          {
            "text": "    \"\"\"Apply rate limiting if enabled.\"\"\"",
            "lineNumber": 74
          },
          {
            "text": "    rate_limit = get_rate_limit()",
            "lineNumber": 75
          },
          {
            "text": "    if rate_limit and limiter:",
            "lineNumber": 76
          },
          {
            "text": "        return limiter.limit(rate_limit)(func)",
            "lineNumber": 77
          },
          {
            "text": "    return func",
            "lineNumber": 78,
            "isSignature": true
          },
          {
            "lineNumber": 79
          },
          {
            "lineNumber": 80
          },
          {
            "text": "@router.get(\"/api/metrics\")",
            "lineNumber": 81
          },
          {
            "text": "@apply_rate_limit",
            "lineNumber": 82
          },
          {
            "text": "async def get_metrics(request: Request):",
            "lineNumber": 83,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 84
          }
        ]
      },
      "score": 0.22047364711761475
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\api\\alerts.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 56
          }
        },
        "contents": "\"\"\"\nAPI endpoints for triggering and managing alerts.\n\nThis module provides REST API endpoints to create, retrieve,\nand manage alerts in the system.\n\"\"\"\n\nfrom typing import Dict, List, Optional\nfrom datetime import datetime\n\n\ndef create_alert(\n    alert_type: str,\n    severity: str,\n    message: str,\n    metadata: Optional[Dict] = None\n) -&gt; Dict:\n    \"\"\"\n    Create a new alert.\n    \n    Args:\n        alert_type: Type of alert (e.g., 'threshold', 'anomaly', 'policy')\n        severity: Alert severity level (e.g., 'low', 'medium', 'high', 'critical')\n        message: Alert message description\n        metadata: Optional additional metadata for the alert\n    \n    Returns:\n        Dictionary containing created alert information\n    \n    TODO: Implement alert creation logic\n    \"\"\"\n    # TODO: Implement alert creation in alerting module\n    return {\n        \"alert_id\": None,  # TODO: Generate unique alert ID\n        \"alert_type\": alert_type,\n        \"severity\": severity,\n        \"message\": message,\n        \"metadata\": metadata or {},\n        \"timestamp\": datetime.now().isoformat(),\n        \"status\": \"created\"\n    }\n\n\ndef get_alert(alert_id: str) -&gt; Dict:\n    \"\"\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "\"\"\"",
            "lineNumber": 1
          },
          {
            "text": "API endpoints for triggering and managing alerts.",
            "lineNumber": 2
          },
          {
            "lineNumber": 3
          },
          {
            "text": "This module provides REST API endpoints to create, retrieve,",
            "lineNumber": 4
          },
          {
            "text": "and manage alerts in the system.",
            "lineNumber": 5
          },
          {
            "text": "\"\"\"",
            "lineNumber": 6
          },
          {
            "lineNumber": 7
          },
          {
            "text": "from typing import Dict, List, Optional",
            "lineNumber": 8
          },
          {
            "text": "from datetime import datetime",
            "lineNumber": 9
          },
          {
            "lineNumber": 10
          },
          {
            "lineNumber": 11
          },
          {
            "text": "def create_alert(",
            "lineNumber": 12,
            "isSignature": true
          },
          {
            "text": "    alert_type: str,",
            "lineNumber": 13,
            "isSignature": true
          },
          {
            "text": "    severity: str,",
            "lineNumber": 14,
            "isSignature": true
          },
          {
            "text": "    message: str,",
            "lineNumber": 15,
            "isSignature": true
          },
          {
            "text": "    metadata: Optional[Dict] = None",
            "lineNumber": 16,
            "isSignature": true
          },
          {
            "text": ") -&gt; Dict:",
            "lineNumber": 17,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 18
          },
          {
            "text": "    Create a new alert.",
            "lineNumber": 19
          },
          {
            "text": "    ",
            "lineNumber": 20
          },
          {
            "text": "    Args:",
            "lineNumber": 21
          },
          {
            "text": "        alert_type: Type of alert (e.g., 'threshold', 'anomaly', 'policy')",
            "lineNumber": 22
          },
          {
            "text": "        severity: Alert severity level (e.g., 'low', 'medium', 'high', 'critical')",
            "lineNumber": 23
          },
          {
            "text": "        message: Alert message description",
            "lineNumber": 24
          },
          {
            "text": "        metadata: Optional additional metadata for the alert",
            "lineNumber": 25
          },
          {
            "text": "    ",
            "lineNumber": 26
          },
          {
            "text": "    Returns:",
            "lineNumber": 27
          },
          {
            "text": "        Dictionary containing created alert information",
            "lineNumber": 28
          },
          {
            "text": "    ",
            "lineNumber": 29
          },
          {
            "text": "    TODO: Implement alert creation logic",
            "lineNumber": 30
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 31
          },
          {
            "text": "    # TODO: Implement alert creation in alerting module",
            "lineNumber": 32
          },
          {
            "text": "    return {",
            "lineNumber": 33
          },
          {
            "text": "        \"alert_id\": None,  # TODO: Generate unique alert ID",
            "lineNumber": 34
          },
          {
            "text": "        \"alert_type\": alert_type,",
            "lineNumber": 35
          },
          {
            "text": "        \"severity\": severity,",
            "lineNumber": 36
          },
          {
            "text": "        \"message\": message,",
            "lineNumber": 37
          },
          {
            "text": "        \"metadata\": metadata or {},",
            "lineNumber": 38
          },
          {
            "text": "        \"timestamp\": datetime.now().isoformat(),",
            "lineNumber": 39
          },
          {
            "text": "        \"status\": \"created\"",
            "lineNumber": 40
          },
          {
            "text": "    }",
            "lineNumber": 41,
            "isSignature": true
          },
          {
            "lineNumber": 42
          },
          {
            "lineNumber": 43
          },
          {
            "text": "def get_alert(alert_id: str) -&gt; Dict:",
            "lineNumber": 44,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 45
          }
        ]
      },
      "score": 0.1983650028705597
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\api\\metrics.py",
        "range": {
          "startPosition": {
            "line": 77,
            "column": 15
          },
          "endPosition": {
            "line": 148
          }
        },
        "contents": "@router.get(\"/api/metrics\")\n@apply_rate_limit\nasync def get_metrics(request: Request):\n    \"\"\"\n    Retrieve the most recent system metrics (CPU, memory, network).\n    \n    This endpoint is rate-limited based on configuration.\n    \n    Returns:\n        JSON response containing:\n            - cpu_usage: CPU metrics dictionary\n            - memory_usage: Memory metrics dictionary\n            - network_traffic: Network metrics dictionary\n            - timestamp: ISO format timestamp\n    \n    Raises:\n        HTTPException: 500 if metric collection fails\n        RateLimitExceeded: 429 if rate limit is exceeded (handled by main.py)\n    \"\"\"\n    try:\n        # Collect all metrics\n        cpu_data = get_cpu_usage()\n        memory_data = get_memory_usage()\n        network_data = get_network_traffic()\n        \n        # Get unified timestamp\n        current_timestamp = datetime.now().isoformat()\n        \n        # Return structured JSON response\n        return {\n            \"cpu_usage\": cpu_data,\n            \"memory_usage\": memory_data,\n            \"network_traffic\": network_data,\n            \"timestamp\": current_timestamp\n        }\n    \n    except RuntimeError as e:\n        # Handle runtime errors (e.g., psutil not available)\n        raise HTTPException(\n            status_code=500,\n            detail=f\"Failed to collect metrics: {str(e)}\"\n        )\n    except Exception as e:\n        # Handle any other unexpected errors\n        raise HTTPException(\n            status_code=500,\n            detail=f\"Unexpected error collecting metrics: {str(e)}\"\n        )\n\n\n# Legacy functions kept for backward compatibility\ndef get_metrics_legacy(metric_type: Optional[str] = None) -&gt; Dict:\n    \"\"\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "@router.get(\"/api/metrics\")",
            "lineNumber": 81
          },
          {
            "text": "@apply_rate_limit",
            "lineNumber": 82
          },
          {
            "text": "async def get_metrics(request: Request):",
            "lineNumber": 83,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 84
          },
          {
            "text": "    Retrieve the most recent system metrics (CPU, memory, network).",
            "lineNumber": 85
          },
          {
            "text": "    ",
            "lineNumber": 86
          },
          {
            "text": "    This endpoint is rate-limited based on configuration.",
            "lineNumber": 87
          },
          {
            "text": "    ",
            "lineNumber": 88
          },
          {
            "text": "    Returns:",
            "lineNumber": 89
          },
          {
            "text": "        JSON response containing:",
            "lineNumber": 90
          },
          {
            "text": "            - cpu_usage: CPU metrics dictionary",
            "lineNumber": 91
          },
          {
            "text": "            - memory_usage: Memory metrics dictionary",
            "lineNumber": 92
          },
          {
            "text": "            - network_traffic: Network metrics dictionary",
            "lineNumber": 93
          },
          {
            "text": "            - timestamp: ISO format timestamp",
            "lineNumber": 94
          },
          {
            "text": "    ",
            "lineNumber": 95
          },
          {
            "text": "    Raises:",
            "lineNumber": 96
          },
          {
            "text": "        HTTPException: 500 if metric collection fails",
            "lineNumber": 97
          },
          {
            "text": "        RateLimitExceeded: 429 if rate limit is exceeded (handled by main.py)",
            "lineNumber": 98
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 99
          },
          {
            "text": "    try:",
            "lineNumber": 100
          },
          {
            "text": "        # Collect all metrics",
            "lineNumber": 101
          },
          {
            "text": "        cpu_data = get_cpu_usage()",
            "lineNumber": 102
          },
          {
            "text": "        memory_data = get_memory_usage()",
            "lineNumber": 103
          },
          {
            "text": "        network_data = get_network_traffic()",
            "lineNumber": 104
          },
          {
            "text": "        ",
            "lineNumber": 105
          },
          {
            "text": "        # Get unified timestamp",
            "lineNumber": 106
          },
          {
            "text": "        current_timestamp = datetime.now().isoformat()",
            "lineNumber": 107
          },
          {
            "text": "        ",
            "lineNumber": 108
          },
          {
            "text": "        # Return structured JSON response",
            "lineNumber": 109
          },
          {
            "text": "        return {",
            "lineNumber": 110
          },
          {
            "text": "            \"cpu_usage\": cpu_data,",
            "lineNumber": 111
          },
          {
            "text": "            \"memory_usage\": memory_data,",
            "lineNumber": 112
          },
          {
            "text": "            \"network_traffic\": network_data,",
            "lineNumber": 113
          },
          {
            "text": "            \"timestamp\": current_timestamp",
            "lineNumber": 114
          },
          {
            "text": "        }",
            "lineNumber": 115
          },
          {
            "text": "    ",
            "lineNumber": 116
          },
          {
            "text": "    except RuntimeError as e:",
            "lineNumber": 117
          },
          {
            "text": "        # Handle runtime errors (e.g., psutil not available)",
            "lineNumber": 118
          },
          {
            "text": "        raise HTTPException(",
            "lineNumber": 119
          },
          {
            "text": "            status_code=500,",
            "lineNumber": 120
          },
          {
            "text": "            detail=f\"Failed to collect metrics: {str(e)}\"",
            "lineNumber": 121
          },
          {
            "text": "        )",
            "lineNumber": 122
          },
          {
            "text": "    except Exception as e:",
            "lineNumber": 123
          },
          {
            "text": "        # Handle any other unexpected errors",
            "lineNumber": 124
          },
          {
            "text": "        raise HTTPException(",
            "lineNumber": 125
          },
          {
            "text": "            status_code=500,",
            "lineNumber": 126
          },
          {
            "text": "            detail=f\"Unexpected error collecting metrics: {str(e)}\"",
            "lineNumber": 127
          },
          {
            "text": "        )",
            "lineNumber": 128,
            "isSignature": true
          },
          {
            "lineNumber": 129
          },
          {
            "lineNumber": 130
          },
          {
            "text": "# Legacy functions kept for backward compatibility",
            "lineNumber": 131
          },
          {
            "text": "def get_metrics_legacy(metric_type: Optional[str] = None) -&gt; Dict:",
            "lineNumber": 132,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 133
          }
        ]
      },
      "score": 0.19271859526634216
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\policy_management\\policy_definition.py",
        "range": {
          "startPosition": {
            "line": 106,
            "column": 40
          },
          "endPosition": {
            "line": 289
          }
        },
        "contents": "class PolicyDefinitionManager:\n    \"\"\"Manages policy definitions and storage.\"\"\"\n    \n    def __init__(self, database=None):\n        \"\"\"\n        Initialize policy definition manager.\n        \n        Args:\n            database: Optional database connection for persistence\n        \"\"\"\n        self.database = database\n        self.policies: Dict[str, Policy] = {}\n    \n    def create_policy(\n        self,\n        name: str,\n        description: str,\n        rules: List[Dict],\n        enabled: bool = True\n    ) -&gt; Policy:\n        \"\"\"\n        Create a new policy.\n        \n        Args:\n            name: Policy name\n            description: Policy description\n            rules: List of rule dictionaries\n            enabled: Whether the policy is enabled\n        \n        Returns:\n            Created Policy instance\n        \n        TODO: Implement policy creation with database persistence\n        \"\"\"\n        # TODO: Generate unique policy ID\n        policy_id = None  # TODO: Generate UUID or use database sequence\n        \n        # TODO: Convert rule dictionaries to PolicyRule objects\n        policy_rules = []\n        for rule_dict in rules:\n            rule = PolicyRule(\n                condition=rule_dict.get(\"condition\", {}),\n                action=rule_dict.get(\"action\", {}),\n                priority=rule_dict.get(\"priority\", 0)\n            )\n            policy_rules.append(rule)\n        \n        policy = Policy(\n            policy_id=policy_id,\n            name=name,\n            description=description,\n            rules=policy_rules,\n            enabled=enabled\n        )\n        \n        # TODO: Store policy in database if database connection available\n        if self.database:\n            # TODO: self.database.insert_policy(policy.to_dict())\n            pass\n        \n        if policy_id:\n            self.policies[policy_id] = policy\n        \n        return policy\n    \n    def get_policy(self, policy_id: str) -&gt; Optional[Policy]:\n        ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "class PolicyDefinitionManager:",
            "lineNumber": 110,
            "isSignature": true
          },
          {
            "text": "    \"\"\"Manages policy definitions and storage.\"\"\"",
            "lineNumber": 111
          },
          {
            "text": "    ",
            "lineNumber": 112
          },
          {
            "text": "    def __init__(self, database=None):",
            "lineNumber": 113
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 114
          },
          {
            "text": "        Initialize policy definition manager.",
            "lineNumber": 115
          },
          {
            "text": "        ",
            "lineNumber": 116
          },
          {
            "text": "        Args:",
            "lineNumber": 117
          },
          {
            "text": "            database: Optional database connection for persistence",
            "lineNumber": 118
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 119
          },
          {
            "text": "        self.database = database",
            "lineNumber": 120
          },
          {
            "text": "        self.policies: Dict[str, Policy] = {}",
            "lineNumber": 121
          },
          {
            "text": "    ",
            "lineNumber": 122
          },
          {
            "text": "    def create_policy(",
            "lineNumber": 123
          },
          {
            "text": "        self,",
            "lineNumber": 124
          },
          {
            "text": "        name: str,",
            "lineNumber": 125
          },
          {
            "text": "        description: str,",
            "lineNumber": 126
          },
          {
            "text": "        rules: List[Dict],",
            "lineNumber": 127
          },
          {
            "text": "        enabled: bool = True",
            "lineNumber": 128
          },
          {
            "text": "    ) -&gt; Policy:",
            "lineNumber": 129
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 130
          },
          {
            "text": "        Create a new policy.",
            "lineNumber": 131
          },
          {
            "text": "        ",
            "lineNumber": 132
          },
          {
            "text": "        Args:",
            "lineNumber": 133
          },
          {
            "text": "            name: Policy name",
            "lineNumber": 134
          },
          {
            "text": "            description: Policy description",
            "lineNumber": 135
          },
          {
            "text": "            rules: List of rule dictionaries",
            "lineNumber": 136
          },
          {
            "text": "            enabled: Whether the policy is enabled",
            "lineNumber": 137
          },
          {
            "text": "        ",
            "lineNumber": 138
          },
          {
            "text": "        Returns:",
            "lineNumber": 139
          },
          {
            "text": "            Created Policy instance",
            "lineNumber": 140
          },
          {
            "text": "        ",
            "lineNumber": 141
          },
          {
            "text": "        TODO: Implement policy creation with database persistence",
            "lineNumber": 142
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 143
          },
          {
            "text": "        # TODO: Generate unique policy ID",
            "lineNumber": 144
          },
          {
            "text": "        policy_id = None  # TODO: Generate UUID or use database sequence",
            "lineNumber": 145
          },
          {
            "text": "        ",
            "lineNumber": 146
          },
          {
            "text": "        # TODO: Convert rule dictionaries to PolicyRule objects",
            "lineNumber": 147
          },
          {
            "text": "        policy_rules = []",
            "lineNumber": 148
          },
          {
            "text": "        for rule_dict in rules:",
            "lineNumber": 149
          },
          {
            "text": "            rule = PolicyRule(",
            "lineNumber": 150
          },
          {
            "text": "                condition=rule_dict.get(\"condition\", {}),",
            "lineNumber": 151
          },
          {
            "text": "                action=rule_dict.get(\"action\", {}),",
            "lineNumber": 152
          },
          {
            "text": "                priority=rule_dict.get(\"priority\", 0)",
            "lineNumber": 153
          },
          {
            "text": "            )",
            "lineNumber": 154
          },
          {
            "text": "            policy_rules.append(rule)",
            "lineNumber": 155
          },
          {
            "text": "        ",
            "lineNumber": 156
          },
          {
            "text": "        policy = Policy(",
            "lineNumber": 157
          },
          {
            "text": "            policy_id=policy_id,",
            "lineNumber": 158
          },
          {
            "text": "            name=name,",
            "lineNumber": 159
          },
          {
            "text": "            description=description,",
            "lineNumber": 160
          },
          {
            "text": "            rules=policy_rules,",
            "lineNumber": 161
          },
          {
            "text": "            enabled=enabled",
            "lineNumber": 162
          },
          {
            "text": "        )",
            "lineNumber": 163
          },
          {
            "text": "        ",
            "lineNumber": 164
          },
          {
            "text": "        # TODO: Store policy in database if database connection available",
            "lineNumber": 165
          },
          {
            "text": "        if self.database:",
            "lineNumber": 166
          },
          {
            "text": "            # TODO: self.database.insert_policy(policy.to_dict())",
            "lineNumber": 167
          },
          {
            "text": "            pass",
            "lineNumber": 168
          },
          {
            "text": "        ",
            "lineNumber": 169
          },
          {
            "text": "        if policy_id:",
            "lineNumber": 170
          },
          {
            "text": "            self.policies[policy_id] = policy",
            "lineNumber": 171
          },
          {
            "text": "        ",
            "lineNumber": 172
          },
          {
            "text": "        return policy",
            "lineNumber": 173
          },
          {
            "text": "    ",
            "lineNumber": 174
          },
          {
            "text": "    def get_policy(self, policy_id: str) -&gt; Optional[Policy]:",
            "lineNumber": 175
          },
          {
            "text": "        ",
            "lineNumber": 176
          }
        ]
      },
      "score": 0.1913152039051056
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\api\\main.py",
        "range": {
          "startPosition": {
            "line": 122,
            "column": 5
          },
          "endPosition": {
            "line": 147,
            "column": 5
          }
        },
        "contents": "if __name__ == \"__main__\":\n    import uvicorn\n    \n    # Get settings\n    settings = get_settings()\n    if settings is None:\n        # Default values if settings not available\n        host = \"0.0.0.0\"\n        port = 8000\n        debug = False\n    else:\n        host = settings.api_host\n        port = settings.api_port\n        debug = settings.api_debug\n    \n    # Run the application\n    uvicorn.run(\n        \"api.main:app\",\n        host=host,\n        port=port,\n        reload=debug,\n        log_level=\"info\" if not debug else \"debug\"\n    )",
        "signatures": {},
        "detailedLines": [
          {
            "text": "if __name__ == \"__main__\":",
            "lineNumber": 126
          },
          {
            "text": "    import uvicorn",
            "lineNumber": 127
          },
          {
            "text": "    ",
            "lineNumber": 128
          },
          {
            "text": "    # Get settings",
            "lineNumber": 129
          },
          {
            "text": "    settings = get_settings()",
            "lineNumber": 130
          },
          {
            "text": "    if settings is None:",
            "lineNumber": 131
          },
          {
            "text": "        # Default values if settings not available",
            "lineNumber": 132
          },
          {
            "text": "        host = \"0.0.0.0\"",
            "lineNumber": 133
          },
          {
            "text": "        port = 8000",
            "lineNumber": 134
          },
          {
            "text": "        debug = False",
            "lineNumber": 135
          },
          {
            "text": "    else:",
            "lineNumber": 136
          },
          {
            "text": "        host = settings.api_host",
            "lineNumber": 137
          },
          {
            "text": "        port = settings.api_port",
            "lineNumber": 138
          },
          {
            "text": "        debug = settings.api_debug",
            "lineNumber": 139
          },
          {
            "text": "    ",
            "lineNumber": 140
          },
          {
            "text": "    # Run the application",
            "lineNumber": 141
          },
          {
            "text": "    uvicorn.run(",
            "lineNumber": 142
          },
          {
            "text": "        \"api.main:app\",",
            "lineNumber": 143
          },
          {
            "text": "        host=host,",
            "lineNumber": 144
          },
          {
            "text": "        port=port,",
            "lineNumber": 145
          },
          {
            "text": "        reload=debug,",
            "lineNumber": 146
          },
          {
            "text": "        log_level=\"info\" if not debug else \"debug\"",
            "lineNumber": 147
          },
          {
            "text": "    )",
            "lineNumber": 148
          }
        ]
      },
      "score": 0.1888808012008667
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\api\\policies.py",
        "range": {
          "startPosition": {
            "line": 40,
            "column": 5
          },
          "endPosition": {
            "line": 72
          }
        },
        "contents": "def get_policy(policy_id: str) -&gt; Dict:\n    \"\"\"\n    Retrieve a specific policy by ID.\n    \n    Args:\n        policy_id: Unique identifier for the policy\n    \n    Returns:\n        Dictionary containing policy information\n    \n    TODO: Implement policy retrieval from database\n    \"\"\"\n    # TODO: Implement policy retrieval\n    return {}\n\n\ndef list_policies(enabled_only: bool = False) -&gt; List[Dict]:\n    \"\"\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "def get_policy(policy_id: str) -&gt; Dict:",
            "lineNumber": 44,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 45
          },
          {
            "text": "    Retrieve a specific policy by ID.",
            "lineNumber": 46
          },
          {
            "text": "    ",
            "lineNumber": 47
          },
          {
            "text": "    Args:",
            "lineNumber": 48
          },
          {
            "text": "        policy_id: Unique identifier for the policy",
            "lineNumber": 49
          },
          {
            "text": "    ",
            "lineNumber": 50
          },
          {
            "text": "    Returns:",
            "lineNumber": 51
          },
          {
            "text": "        Dictionary containing policy information",
            "lineNumber": 52
          },
          {
            "text": "    ",
            "lineNumber": 53
          },
          {
            "text": "    TODO: Implement policy retrieval from database",
            "lineNumber": 54
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 55
          },
          {
            "text": "    # TODO: Implement policy retrieval",
            "lineNumber": 56
          },
          {
            "text": "    return {}",
            "lineNumber": 57,
            "isSignature": true
          },
          {
            "lineNumber": 58
          },
          {
            "lineNumber": 59
          },
          {
            "text": "def list_policies(enabled_only: bool = False) -&gt; List[Dict]:",
            "lineNumber": 60,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 61
          }
        ]
      },
      "score": 0.1884748339653015
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\docker\\Dockerfile",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 68
          }
        },
        "contents": "# Dockerfile for Monitor/Drift Agent\n# Multi-stage build for optimized image size\n\n# Stage 1: Build stage\nFROM python:3.11-slim as builder\n\n# Set working directory\nWORKDIR /app\n\n# Install build dependencies\nRUN apt-get update &amp;&amp; apt-get install -y \\\n    gcc \\\n    g++ \\\n    postgresql-client \\\n    &amp;&amp; rm -rf /var/lib/apt/lists/*\n\n# Copy requirements file (if exists)\n# TODO: Create requirements.txt with project dependencies\n# COPY requirements.txt .\n\n# Install Python dependencies\n# TODO: Uncomment when requirements.txt is available\n# RUN pip install --no-cache-dir --user -r requirements.txt\n\n# Stage 2: Runtime stage\nFROM python:3.11-slim\n\n# Set working directory\nWORKDIR /app\n\n# Install runtime dependencies\nRUN apt-get update &amp;&amp; apt-get install -y \\\n    postgresql-client \\\n    curl \\\n    &amp;&amp; rm -rf /var/lib/apt/lists/*\n\n# Copy Python dependencies from builder\n# TODO: Uncomment when requirements are installed\n# COPY --from=builder /root/.local /root/.local\n\n# Copy application code\nCOPY . .\n\n# Make sure scripts in .local are usable\nENV PATH=/root/.local/bin:$PATH\n\n# Set Python path\nENV PYTHONPATH=/app\n\n# Create non-root user for security\nRUN useradd -m -u 1000 agent &amp;&amp; \\\n    chown -R agent:agent /app\n\n# Switch to non-root user\nUSER agent\n\n# Expose API port\nEXPOSE 8000\n\n# Health check\nHEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \\\n    CMD curl -f http://localhost:8000/health || exit 1\n\n# Use entrypoint script\nENTRYPOINT [\"/app/docker/entrypoint.sh\"]\n\n# Default command\nCMD [\"python\", \"-m\", \"api\"]",
        "signatures": {},
        "detailedLines": [
          {
            "text": "# Dockerfile for Monitor/Drift Agent",
            "lineNumber": 1
          },
          {
            "text": "# Multi-stage build for optimized image size",
            "lineNumber": 2
          },
          {
            "lineNumber": 3
          },
          {
            "text": "# Stage 1: Build stage",
            "lineNumber": 4
          },
          {
            "text": "FROM python:3.11-slim as builder",
            "lineNumber": 5
          },
          {
            "lineNumber": 6
          },
          {
            "text": "# Set working directory",
            "lineNumber": 7
          },
          {
            "text": "WORKDIR /app",
            "lineNumber": 8
          },
          {
            "lineNumber": 9
          },
          {
            "text": "# Install build dependencies",
            "lineNumber": 10
          },
          {
            "text": "RUN apt-get update &amp;&amp; apt-get install -y \\",
            "lineNumber": 11
          },
          {
            "text": "    gcc \\",
            "lineNumber": 12
          },
          {
            "text": "    g++ \\",
            "lineNumber": 13
          },
          {
            "text": "    postgresql-client \\",
            "lineNumber": 14
          },
          {
            "text": "    &amp;&amp; rm -rf /var/lib/apt/lists/*",
            "lineNumber": 15
          },
          {
            "lineNumber": 16
          },
          {
            "text": "# Copy requirements file (if exists)",
            "lineNumber": 17
          },
          {
            "text": "# TODO: Create requirements.txt with project dependencies",
            "lineNumber": 18
          },
          {
            "text": "# COPY requirements.txt .",
            "lineNumber": 19
          },
          {
            "lineNumber": 20
          },
          {
            "text": "# Install Python dependencies",
            "lineNumber": 21
          },
          {
            "text": "# TODO: Uncomment when requirements.txt is available",
            "lineNumber": 22
          },
          {
            "text": "# RUN pip install --no-cache-dir --user -r requirements.txt",
            "lineNumber": 23
          },
          {
            "lineNumber": 24
          },
          {
            "text": "# Stage 2: Runtime stage",
            "lineNumber": 25
          },
          {
            "text": "FROM python:3.11-slim",
            "lineNumber": 26
          },
          {
            "lineNumber": 27
          },
          {
            "text": "# Set working directory",
            "lineNumber": 28
          },
          {
            "text": "WORKDIR /app",
            "lineNumber": 29
          },
          {
            "lineNumber": 30
          },
          {
            "text": "# Install runtime dependencies",
            "lineNumber": 31
          },
          {
            "text": "RUN apt-get update &amp;&amp; apt-get install -y \\",
            "lineNumber": 32
          },
          {
            "text": "    postgresql-client \\",
            "lineNumber": 33
          },
          {
            "text": "    curl \\",
            "lineNumber": 34
          },
          {
            "text": "    &amp;&amp; rm -rf /var/lib/apt/lists/*",
            "lineNumber": 35
          },
          {
            "lineNumber": 36
          },
          {
            "text": "# Copy Python dependencies from builder",
            "lineNumber": 37
          },
          {
            "text": "# TODO: Uncomment when requirements are installed",
            "lineNumber": 38
          },
          {
            "text": "# COPY --from=builder /root/.local /root/.local",
            "lineNumber": 39
          },
          {
            "lineNumber": 40
          },
          {
            "text": "# Copy application code",
            "lineNumber": 41
          },
          {
            "text": "COPY . .",
            "lineNumber": 42
          },
          {
            "lineNumber": 43
          },
          {
            "text": "# Make sure scripts in .local are usable",
            "lineNumber": 44
          },
          {
            "text": "ENV PATH=/root/.local/bin:$PATH",
            "lineNumber": 45
          },
          {
            "lineNumber": 46
          },
          {
            "text": "# Set Python path",
            "lineNumber": 47
          },
          {
            "text": "ENV PYTHONPATH=/app",
            "lineNumber": 48
          },
          {
            "lineNumber": 49
          },
          {
            "text": "# Create non-root user for security",
            "lineNumber": 50
          },
          {
            "text": "RUN useradd -m -u 1000 agent &amp;&amp; \\",
            "lineNumber": 51
          },
          {
            "text": "    chown -R agent:agent /app",
            "lineNumber": 52
          },
          {
            "lineNumber": 53
          },
          {
            "text": "# Switch to non-root user",
            "lineNumber": 54
          },
          {
            "text": "USER agent",
            "lineNumber": 55
          },
          {
            "lineNumber": 56
          },
          {
            "text": "# Expose API port",
            "lineNumber": 57
          },
          {
            "text": "EXPOSE 8000",
            "lineNumber": 58
          },
          {
            "lineNumber": 59
          },
          {
            "text": "# Health check",
            "lineNumber": 60
          },
          {
            "text": "HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \\",
            "lineNumber": 61
          },
          {
            "text": "    CMD curl -f http://localhost:8000/health || exit 1",
            "lineNumber": 62
          },
          {
            "lineNumber": 63
          },
          {
            "text": "# Use entrypoint script",
            "lineNumber": 64
          },
          {
            "text": "ENTRYPOINT [\"/app/docker/entrypoint.sh\"]",
            "lineNumber": 65
          },
          {
            "lineNumber": 66
          },
          {
            "text": "# Default command",
            "lineNumber": 67
          },
          {
            "text": "CMD [\"python\", \"-m\", \"api\"]",
            "lineNumber": 68
          }
        ]
      },
      "score": 0.18762683868408203
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\policy_management\\policy_enforcement.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 70
          }
        },
        "contents": "\"\"\"\nLogic for enforcing policies and triggering alerts.\n\nThis module provides functionality to evaluate policies against\ncurrent system state and trigger appropriate actions.\n\"\"\"\n\nfrom typing import Dict, List, Optional, Any\nfrom datetime import datetime\nfrom .policy_definition import Policy, PolicyRule\n\n\nclass PolicyEvaluator:\n    \"\"\"Evaluates policy rules against context data.\"\"\"\n    \n    def evaluate_condition(self, condition: Dict, context: Dict) -&gt; bool:\n        \"\"\"\n        Evaluate a condition against context data.\n        \n        Args:\n            condition: Condition definition dictionary\n            context: Context data to evaluate against\n        \n        Returns:\n            True if condition is met, False otherwise\n        \n        TODO: Implement condition evaluation logic\n        \"\"\"\n        # TODO: Implement various condition types:\n        # - Metric comparisons (threshold checks)\n        # - Time-based conditions\n        # - Aggregation conditions (average, max, min over time)\n        # - Logical operators (AND, OR, NOT)\n        \n        condition_type = condition.get(\"type\")\n        \n        if condition_type == \"metric_threshold\":\n            # TODO: Evaluate metric threshold condition\n            metric_name = condition.get(\"metric_name\")\n            operator = condition.get(\"operator\", \"gt\")\n            threshold = condition.get(\"threshold\")\n            \n            if metric_name in context:\n                metric_value = context[metric_name]\n                # TODO: Implement comparison logic\n                return False\n        \n        elif condition_type == \"time_range\":\n            # TODO: Evaluate time-based condition\n            pass\n        \n        elif condition_type == \"aggregation\":\n            # TODO: Evaluate aggregation condition\n            pass\n        \n        return False\n    \n    def evaluate_rule(self, rule: PolicyRule, context: Dict) -&gt; bool:\n        ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "\"\"\"",
            "lineNumber": 1
          },
          {
            "text": "Logic for enforcing policies and triggering alerts.",
            "lineNumber": 2
          },
          {
            "lineNumber": 3
          },
          {
            "text": "This module provides functionality to evaluate policies against",
            "lineNumber": 4
          },
          {
            "text": "current system state and trigger appropriate actions.",
            "lineNumber": 5
          },
          {
            "text": "\"\"\"",
            "lineNumber": 6
          },
          {
            "lineNumber": 7
          },
          {
            "text": "from typing import Dict, List, Optional, Any",
            "lineNumber": 8
          },
          {
            "text": "from datetime import datetime",
            "lineNumber": 9
          },
          {
            "text": "from .policy_definition import Policy, PolicyRule",
            "lineNumber": 10
          },
          {
            "lineNumber": 11
          },
          {
            "lineNumber": 12
          },
          {
            "text": "class PolicyEvaluator:",
            "lineNumber": 13,
            "isSignature": true
          },
          {
            "text": "    \"\"\"Evaluates policy rules against context data.\"\"\"",
            "lineNumber": 14
          },
          {
            "text": "    ",
            "lineNumber": 15
          },
          {
            "text": "    def evaluate_condition(self, condition: Dict, context: Dict) -&gt; bool:",
            "lineNumber": 16
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 17
          },
          {
            "text": "        Evaluate a condition against context data.",
            "lineNumber": 18
          },
          {
            "text": "        ",
            "lineNumber": 19
          },
          {
            "text": "        Args:",
            "lineNumber": 20
          },
          {
            "text": "            condition: Condition definition dictionary",
            "lineNumber": 21
          },
          {
            "text": "            context: Context data to evaluate against",
            "lineNumber": 22
          },
          {
            "text": "        ",
            "lineNumber": 23
          },
          {
            "text": "        Returns:",
            "lineNumber": 24
          },
          {
            "text": "            True if condition is met, False otherwise",
            "lineNumber": 25
          },
          {
            "text": "        ",
            "lineNumber": 26
          },
          {
            "text": "        TODO: Implement condition evaluation logic",
            "lineNumber": 27
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 28
          },
          {
            "text": "        # TODO: Implement various condition types:",
            "lineNumber": 29
          },
          {
            "text": "        # - Metric comparisons (threshold checks)",
            "lineNumber": 30
          },
          {
            "text": "        # - Time-based conditions",
            "lineNumber": 31
          },
          {
            "text": "        # - Aggregation conditions (average, max, min over time)",
            "lineNumber": 32
          },
          {
            "text": "        # - Logical operators (AND, OR, NOT)",
            "lineNumber": 33
          },
          {
            "text": "        ",
            "lineNumber": 34
          },
          {
            "text": "        condition_type = condition.get(\"type\")",
            "lineNumber": 35
          },
          {
            "text": "        ",
            "lineNumber": 36
          },
          {
            "text": "        if condition_type == \"metric_threshold\":",
            "lineNumber": 37
          },
          {
            "text": "            # TODO: Evaluate metric threshold condition",
            "lineNumber": 38
          },
          {
            "text": "            metric_name = condition.get(\"metric_name\")",
            "lineNumber": 39
          },
          {
            "text": "            operator = condition.get(\"operator\", \"gt\")",
            "lineNumber": 40
          },
          {
            "text": "            threshold = condition.get(\"threshold\")",
            "lineNumber": 41
          },
          {
            "text": "            ",
            "lineNumber": 42
          },
          {
            "text": "            if metric_name in context:",
            "lineNumber": 43
          },
          {
            "text": "                metric_value = context[metric_name]",
            "lineNumber": 44
          },
          {
            "text": "                # TODO: Implement comparison logic",
            "lineNumber": 45
          },
          {
            "text": "                return False",
            "lineNumber": 46
          },
          {
            "text": "        ",
            "lineNumber": 47
          },
          {
            "text": "        elif condition_type == \"time_range\":",
            "lineNumber": 48
          },
          {
            "text": "            # TODO: Evaluate time-based condition",
            "lineNumber": 49
          },
          {
            "text": "            pass",
            "lineNumber": 50
          },
          {
            "text": "        ",
            "lineNumber": 51
          },
          {
            "text": "        elif condition_type == \"aggregation\":",
            "lineNumber": 52
          },
          {
            "text": "            # TODO: Evaluate aggregation condition",
            "lineNumber": 53
          },
          {
            "text": "            pass",
            "lineNumber": 54
          },
          {
            "text": "        ",
            "lineNumber": 55
          },
          {
            "text": "        return False",
            "lineNumber": 56
          },
          {
            "text": "    ",
            "lineNumber": 57
          },
          {
            "text": "    def evaluate_rule(self, rule: PolicyRule, context: Dict) -&gt; bool:",
            "lineNumber": 58
          },
          {
            "text": "        ",
            "lineNumber": 59
          }
        ]
      },
      "score": 0.18365119397640228
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\api\\policies.py",
        "range": {
          "startPosition": {
            "line": 56,
            "column": 13
          },
          "endPosition": {
            "line": 101
          }
        },
        "contents": "def list_policies(enabled_only: bool = False) -&gt; List[Dict]:\n    \"\"\"\n    List all policies.\n    \n    Args:\n        enabled_only: If True, only return enabled policies\n    \n    Returns:\n        List of policy dictionaries\n    \n    TODO: Implement policy listing from database\n    \"\"\"\n    # TODO: Implement policy listing\n    return []\n\n\ndef update_policy(\n    policy_id: str,\n    name: Optional[str] = None,\n    description: Optional[str] = None,\n    rules: Optional[Dict] = None,\n    enabled: Optional[bool] = None\n) -&gt; Dict:\n    ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "def list_policies(enabled_only: bool = False) -&gt; List[Dict]:",
            "lineNumber": 60,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 61
          },
          {
            "text": "    List all policies.",
            "lineNumber": 62
          },
          {
            "text": "    ",
            "lineNumber": 63
          },
          {
            "text": "    Args:",
            "lineNumber": 64
          },
          {
            "text": "        enabled_only: If True, only return enabled policies",
            "lineNumber": 65
          },
          {
            "text": "    ",
            "lineNumber": 66
          },
          {
            "text": "    Returns:",
            "lineNumber": 67
          },
          {
            "text": "        List of policy dictionaries",
            "lineNumber": 68
          },
          {
            "text": "    ",
            "lineNumber": 69
          },
          {
            "text": "    TODO: Implement policy listing from database",
            "lineNumber": 70
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 71
          },
          {
            "text": "    # TODO: Implement policy listing",
            "lineNumber": 72
          },
          {
            "text": "    return []",
            "lineNumber": 73,
            "isSignature": true
          },
          {
            "lineNumber": 74
          },
          {
            "lineNumber": 75
          },
          {
            "text": "def update_policy(",
            "lineNumber": 76,
            "isSignature": true
          },
          {
            "text": "    policy_id: str,",
            "lineNumber": 77,
            "isSignature": true
          },
          {
            "text": "    name: Optional[str] = None,",
            "lineNumber": 78,
            "isSignature": true
          },
          {
            "text": "    description: Optional[str] = None,",
            "lineNumber": 79,
            "isSignature": true
          },
          {
            "text": "    rules: Optional[Dict] = None,",
            "lineNumber": 80,
            "isSignature": true
          },
          {
            "text": "    enabled: Optional[bool] = None",
            "lineNumber": 81,
            "isSignature": true
          },
          {
            "text": ") -&gt; Dict:",
            "lineNumber": 82,
            "isSignature": true
          },
          {
            "text": "    ",
            "lineNumber": 83
          }
        ]
      },
      "score": 0.18189109861850739
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\README.md",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 39
          }
        },
        "contents": "# Monitor/Drift Agent\n\nA comprehensive monitoring and anomaly detection agent for system metrics and cloud usage, with automated alerting and optional self-healing capabilities.\n\n## Overview\n\nThe Monitor/Drift Agent is designed to:\n- Collect system metrics (CPU, memory, disk, network) and cloud usage metrics\n- Detect anomalies using threshold-based and machine learning methods\n- Enforce policies for monitoring and alerting\n- Send alerts through multiple channels (email, Slack, SMS)\n- Optionally perform self-healing actions (auto-scaling, shutdown)\n\n## Project Structure\n\n&#96;&#96;&#96;\nmonitor_drift_agent/\n├── api/                           # API endpoints for agent communication\n│   ├── __init__.py\n│   ├── metrics.py                 # API to collect system metrics\n│   ├── alerts.py                 # API to trigger and manage alerts\n│   └── policies.py               # API to manage policies\n├── data_collection/               # Modules related to data collection\n│   ├── __init__.py\n│   ├── system_metrics.py         # Logic for collecting system metrics\n│   ├── cloud_metrics.py          # Logic for collecting cloud usage metrics\n│   └── database.py               # Database interactions (PostgreSQL)\n├── anomaly_detection/             # Anomaly detection logic\n│   ├── __init__.py\n│   ├── threshold_detection.py   # Threshold-based anomaly detection\n│   ├── machine_learning.py       # ML-based detection (Isolation Forest, Autoencoders)\n│   └── alert_trigger.py          # Logic for triggering alerts based on anomalies\n├── policy_management/             # Policy enforcement logic\n│   ├── __init__.py\n│   ├── policy_definition.py      # Logic for defining and storing policies\n│   └── policy_enforcement.py     # Logic for enforcing policies\n├── alerting/                      # Modules related to alerts and notifications\n│   ├── __init__.py\n│   ├── alert_system.py           # Alerting system (email, Slack, SMS)",
        "signatures": {},
        "detailedLines": [
          {
            "text": "# Monitor/Drift Agent",
            "lineNumber": 1
          },
          {
            "lineNumber": 2
          },
          {
            "text": "A comprehensive monitoring and anomaly detection agent for system metrics and cloud usage, with automated alerting and optional self-healing capabilities.",
            "lineNumber": 3
          },
          {
            "lineNumber": 4
          },
          {
            "text": "## Overview",
            "lineNumber": 5
          },
          {
            "lineNumber": 6
          },
          {
            "text": "The Monitor/Drift Agent is designed to:",
            "lineNumber": 7
          },
          {
            "text": "- Collect system metrics (CPU, memory, disk, network) and cloud usage metrics",
            "lineNumber": 8
          },
          {
            "text": "- Detect anomalies using threshold-based and machine learning methods",
            "lineNumber": 9
          },
          {
            "text": "- Enforce policies for monitoring and alerting",
            "lineNumber": 10
          },
          {
            "text": "- Send alerts through multiple channels (email, Slack, SMS)",
            "lineNumber": 11
          },
          {
            "text": "- Optionally perform self-healing actions (auto-scaling, shutdown)",
            "lineNumber": 12
          },
          {
            "lineNumber": 13
          },
          {
            "text": "## Project Structure",
            "lineNumber": 14
          },
          {
            "lineNumber": 15
          },
          {
            "text": "&#96;&#96;&#96;",
            "lineNumber": 16
          },
          {
            "text": "monitor_drift_agent/",
            "lineNumber": 17
          },
          {
            "text": "├── api/                           # API endpoints for agent communication",
            "lineNumber": 18
          },
          {
            "text": "│   ├── __init__.py",
            "lineNumber": 19
          },
          {
            "text": "│   ├── metrics.py                 # API to collect system metrics",
            "lineNumber": 20
          },
          {
            "text": "│   ├── alerts.py                 # API to trigger and manage alerts",
            "lineNumber": 21
          },
          {
            "text": "│   └── policies.py               # API to manage policies",
            "lineNumber": 22
          },
          {
            "text": "├── data_collection/               # Modules related to data collection",
            "lineNumber": 23
          },
          {
            "text": "│   ├── __init__.py",
            "lineNumber": 24
          },
          {
            "text": "│   ├── system_metrics.py         # Logic for collecting system metrics",
            "lineNumber": 25
          },
          {
            "text": "│   ├── cloud_metrics.py          # Logic for collecting cloud usage metrics",
            "lineNumber": 26
          },
          {
            "text": "│   └── database.py               # Database interactions (PostgreSQL)",
            "lineNumber": 27
          },
          {
            "text": "├── anomaly_detection/             # Anomaly detection logic",
            "lineNumber": 28
          },
          {
            "text": "│   ├── __init__.py",
            "lineNumber": 29
          },
          {
            "text": "│   ├── threshold_detection.py   # Threshold-based anomaly detection",
            "lineNumber": 30
          },
          {
            "text": "│   ├── machine_learning.py       # ML-based detection (Isolation Forest, Autoencoders)",
            "lineNumber": 31
          },
          {
            "text": "│   └── alert_trigger.py          # Logic for triggering alerts based on anomalies",
            "lineNumber": 32
          },
          {
            "text": "├── policy_management/             # Policy enforcement logic",
            "lineNumber": 33
          },
          {
            "text": "│   ├── __init__.py",
            "lineNumber": 34
          },
          {
            "text": "│   ├── policy_definition.py      # Logic for defining and storing policies",
            "lineNumber": 35
          },
          {
            "text": "│   └── policy_enforcement.py     # Logic for enforcing policies",
            "lineNumber": 36
          },
          {
            "text": "├── alerting/                      # Modules related to alerts and notifications",
            "lineNumber": 37
          },
          {
            "text": "│   ├── __init__.py",
            "lineNumber": 38
          },
          {
            "text": "│   ├── alert_system.py           # Alerting system (email, Slack, SMS)",
            "lineNumber": 39
          }
        ]
      },
      "score": 0.18102289736270905
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---


Checking for existing authentication patterns and reviewing the database structure:


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: a:\MonitorDrift Agent\api\alerts.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "API.*KEY|api.*key|X-API-KEY|authorization|auth",
  "caseInsensitive": true
}
```
Result:

```json
{
  "success": {
    "pattern": "API.*KEY|api.*key|X-API-KEY|authorization|auth",
    "outputMode": "content",
    "workspaceResults": {
      "a:\\MonitorDrift Agent": {
        "content": {
          "matches": [
            {
              "file": ".\\.specstory\\history\\2026-01-14_18-59Z-untitled.md",
              "matches": [
                {
                  "lineNumber": 710,
                  "content": "  \"plan\": \"# Monitor/Drift Agent Folder Structure Implementation\\n\\n## Overview\\nCreate a modular, scalable folder structure for the Monitor/Drift Agent project with skeleton implementations in all files. The structure will support data collection, anomaly detection, alerting, policy management, and optional self-healing capabilities.\\n\\n## Folder Structure to Create\\n\\n### Core Modules\\n\\n**api/** - REST API endpoints for agent communication\\n- &amp;#96;__init__.py&amp;#96; - Module initialization\\n- &amp;#96;metrics.py&amp;#96; - API endpoints for collecting system metrics\\n- &amp;#96;alerts.py&amp;#96; - API endpoints for triggering and managing alerts\\n- &amp;#96;policies.py&amp;#96; - API endpoints for policy management (create, retrieve, enforce)\\n\\n**data_collection/** - Data collection modules\\n- &amp;#96;__init__.py&amp;#96; - Module initialization\\n- &amp;#96;system_metrics.py&amp;#96; - Logic for collecting system metrics (CPU, memory, disk, network)\\n- &amp;#96;cloud_metrics.py&amp;#96; - Logic for collecting cloud usage metrics [... omitted end of long line]"
                },
                {
                  "lineNumber": 3253,
                  "content": "        \"contents\": \"def collect_cloud_metrics(provider: str, credentials: Dict) -&amp;gt; Dict:\\n    \\\"\\\"\\\"\\n    Collect cloud metrics for a specific provider.\\n    \\n    Args:\\n        provider: Cloud provider name ('aws', 'azure', 'gcp')\\n        credentials: Provider-specific credentials\\n    \\n    Returns:\\n        Dictionary containing cloud metrics\\n    \\n    TODO: Implement provider selection and metric collection\\n    \\\"\\\"\\\"\\n    # TODO: Implement provider selection and collection\\n    collectors = {\\n        \\\"aws\\\": AWSMetricsCollector(),\\n        \\\"azure\\\": AzureMetricsCollector(),\\n        \\\"gcp\\\": GCPMetricsCollector()\\n    }\\n    \\n    if provider not in collectors:\\n        raise ValueError(f\\\"Unsupported cloud provider: {provider}\\\")\\n    \\n    collector = collectors[provider]\\n    if not collector.authenticate(credentials):\\n        raise ValueError(f\\\"Authentication failed for {provider}\\\")\\n    \\n    return {\\n        \\\"cost_metrics\\\": collector.collect_cost_metrics(\\n  [... omitted end of long line]"
                },
                {
                  "lineNumber": 3354,
                  "content": "            \"text\": \"    if not collector.authenticate(credentials):\","
                },
                {
                  "lineNumber": 3358,
                  "content": "            \"text\": \"        raise ValueError(f\\\"Authentication failed for {provider}\\\")\","
                },
                {
                  "lineNumber": 3522,
                  "content": "        \"contents\": \"class AWSMetricsCollector(CloudProvider):\\n    \\\"\\\"\\\"Collector for AWS cloud metrics.\\\"\\\"\\\"\\n    \\n    def authenticate(self, credentials: Dict) -&amp;gt; bool:\\n        \\\"\\\"\\\"\\n        Authenticate with AWS using provided credentials.\\n        \\n        Args:\\n            credentials: Dictionary containing AWS credentials (access_key, secret_key, region)\\n        \\n        Returns:\\n            True if authentication successful, False otherwise\\n        \\n        TODO: Implement AWS authentication using boto3\\n        \\\"\\\"\\\"\\n        # TODO: Implement AWS authentication\\n        return False\\n    \\n    def collect_cost_metrics(self, start_date: datetime, end_date: datetime) -&amp;gt; Dict:\\n        \\\"\\\"\\\"\\n        Collect AWS cost metrics for a date range.\\n        \\n        Args:\\n            start_date: Start of date range\\n            end_date: End of date range\\n        \\n        Returns:\\n            Dictionary containing cost metrics\\n        \\n        TODO: Impleme [... omitted end of long line]"
                },
                {
                  "lineNumber": 3539,
                  "content": "            \"text\": \"    def authenticate(self, credentials: Dict) -&amp;gt; bool:\","
                },
                {
                  "lineNumber": 3547,
                  "content": "            \"text\": \"        Authenticate with AWS using provided credentials.\","
                },
                {
                  "lineNumber": 3571,
                  "content": "            \"text\": \"            True if authentication successful, False otherwise\","
                },
                {
                  "lineNumber": 3579,
                  "content": "            \"text\": \"        TODO: Implement AWS authentication using boto3\","
                },
                {
                  "lineNumber": 3587,
                  "content": "            \"text\": \"        # TODO: Implement AWS authentication\","
                },
                {
                  "lineNumber": 3794,
                  "content": "        \"contents\": \"class GCPMetricsCollector(CloudProvider):\\n    \\\"\\\"\\\"Collector for GCP cloud metrics.\\\"\\\"\\\"\\n    \\n    def authenticate(self, credentials: Dict) -&amp;gt; bool:\\n        \\\"\\\"\\\"\\n        Authenticate with GCP using provided credentials.\\n        \\n        Args:\\n            credentials: Dictionary containing GCP credentials\\n        \\n        Returns:\\n            True if authentication successful, False otherwise\\n        \\n        TODO: Implement GCP authentication\\n        \\\"\\\"\\\"\\n        # TODO: Implement GCP authentication\\n        return False\\n    \\n    def collect_cost_metrics(self, start_date: datetime, end_date: datetime) -&amp;gt; Dict:\\n        \\\"\\\"\\\"\\n        Collect GCP cost metrics for a date range.\\n        \\n        Args:\\n            start_date: Start of date range\\n            end_date: End of date range\\n        \\n        Returns:\\n            Dictionary containing cost metrics\\n        \\n        TODO: Implement GCP Billing API integration\\n        \\\"\\\"\\ [... omitted end of long line]"
                },
                {
                  "lineNumber": 3811,
                  "content": "            \"text\": \"    def authenticate(self, credentials: Dict) -&amp;gt; bool:\","
                },
                {
                  "lineNumber": 3819,
                  "content": "            \"text\": \"        Authenticate with GCP using provided credentials.\","
                },
                {
                  "lineNumber": 3843,
                  "content": "            \"text\": \"            True if authentication successful, False otherwise\","
                },
                {
                  "lineNumber": 3851,
                  "content": "            \"text\": \"        TODO: Implement GCP authentication\","
                },
                {
                  "lineNumber": 3859,
                  "content": "            \"text\": \"        # TODO: Implement GCP authentication\","
                },
                {
                  "lineNumber": 4059,
                  "content": "        \"contents\": \"\\\"\\\"\\\"\\nLogic for collecting cloud usage metrics.\\n\\nThis module provides functionality to collect cloud usage metrics from\\nvarious cloud providers (AWS, Azure, GCP) including cost, resource usage,\\nand billing information.\\n\\\"\\\"\\\"\\n\\nfrom typing import Dict, List, Optional\\nfrom datetime import datetime\\nfrom abc import ABC, abstractmethod\\n\\n\\nclass CloudProvider(ABC):\\n    \\\"\\\"\\\"Abstract base class for cloud provider integrations.\\\"\\\"\\\"\\n    \\n    @abstractmethod\\n    def authenticate(self, credentials: Dict) -&amp;gt; bool:\\n        \\\"\\\"\\\"Authenticate with cloud provider.\\\"\\\"\\\"\\n        pass\\n    \\n    @abstractmethod\\n    def collect_cost_metrics(self, start_date: datetime, end_date: datetime) -&amp;gt; Dict:\\n        \\\"\\\"\\\"Collect cost metrics for a date range.\\\"\\\"\\\"\\n        pass\\n    \\n    @abstractmethod\\n    def collect_resource_metrics(self) -&amp;gt; Dict:\\n        \\\"\\\"\\\"Collect current resource usage metrics.\\\"\\\"\\\"\\n        pass\\n\\n\\nclass AWSMetricsCollector(Clo [... omitted end of long line]"
                },
                {
                  "lineNumber": 4128,
                  "content": "            \"text\": \"    def authenticate(self, credentials: Dict) -&amp;gt; bool:\","
                },
                {
                  "lineNumber": 4132,
                  "content": "            \"text\": \"        \\\"\\\"\\\"Authenticate with cloud provider.\\\"\\\"\\\"\","
                },
                {
                  "lineNumber": 4459,
                  "content": "        \"contents\": \"class AzureMetricsCollector(CloudProvider):\\n    \\\"\\\"\\\"Collector for Azure cloud metrics.\\\"\\\"\\\"\\n    \\n    def authenticate(self, credentials: Dict) -&amp;gt; bool:\\n        \\\"\\\"\\\"\\n        Authenticate with Azure using provided credentials.\\n        \\n        Args:\\n            credentials: Dictionary containing Azure credentials\\n        \\n        Returns:\\n            True if authentication successful, False otherwise\\n        \\n        TODO: Implement Azure authentication\\n        \\\"\\\"\\\"\\n        # TODO: Implement Azure authentication\\n        return False\\n    \\n    def collect_cost_metrics(self, start_date: datetime, end_date: datetime) -&amp;gt; Dict:\\n        \\\"\\\"\\\"\\n        Collect Azure cost metrics for a date range.\\n        \\n        Args:\\n            start_date: Start of date range\\n            end_date: End of date range\\n        \\n        Returns:\\n            Dictionary containing cost metrics\\n        \\n        TODO: Implement Azure Cost Management API in [... omitted end of long line]"
                },
                {
                  "lineNumber": 4476,
                  "content": "            \"text\": \"    def authenticate(self, credentials: Dict) -&amp;gt; bool:\","
                },
                {
                  "lineNumber": 4484,
                  "content": "            \"text\": \"        Authenticate with Azure using provided credentials.\","
                },
                {
                  "lineNumber": 4508,
                  "content": "            \"text\": \"            True if authentication successful, False otherwise\","
                },
                {
                  "lineNumber": 4516,
                  "content": "            \"text\": \"        TODO: Implement Azure authentication\","
                },
                {
                  "lineNumber": 4524,
                  "content": "            \"text\": \"        # TODO: Implement Azure authentication\","
                },
                {
                  "lineNumber": 5688,
                  "content": "        \"contents\": \"class Settings:\\ndef __init__(self):\\n = os.getenv(\\\"EMAIL_SMTP_SERVER\\\", \\\"\\\")\\n        self.email_smtp_port = int(os.getenv(\\\"EMAIL_SMTP_PORT\\\", \\\"587\\\"))\\n        self.email_username = os.getenv(\\\"EMAIL_USERNAME\\\", \\\"\\\")\\n        self.email_password = os.getenv(\\\"EMAIL_PASSWORD\\\", \\\"\\\")\\n        self.email_recipients = os.getenv(\\\"EMAIL_RECIPIENTS\\\", \\\"\\\").split(\\\",\\\")\\n        \\n        self.slack_webhook_url = os.getenv(\\\"SLACK_WEBHOOK_URL\\\", \\\"\\\")\\n        \\n        self.sms_api_key = os.getenv(\\\"SMS_API_KEY\\\", \\\"\\\")\\n        self.sms_api_secret = os.getenv(\\\"SMS_API_SECRET\\\", \\\"\\\")\\n        self.sms_from_number = os.getenv(\\\"SMS_FROM_NUMBER\\\", \\\"\\\")\\n        \\n        # Anomaly detection settings\\n        self.anomaly_detection_enabled = os.getenv(\\n            \\\"ANOMALY_DETECTION_ENABLED\\\", \\\"true\\\"\\n        ).lower() == \\\"true\\\"\\n        self.ml_detection_enabled = os.getenv(\\n            \\\"ML_DETECTION_ENABLED\\\", \\\"false\\\"\\n        ).lower() == \\\"true\\\"\\n [... omitted end of long line]"
                },
                {
                  "lineNumber": 5756,
                  "content": "            \"text\": \"        self.sms_api_key = os.getenv(\\\"SMS_API_KEY\\\", \\\"\\\")\","
                },
                {
                  "lineNumber": 7684,
                  "content": "        \"contents\": \"class Settings:\\ndef __init__(self):\\n = os.getenv(\\\"EMAIL_SMTP_SERVER\\\", \\\"\\\")\\n        self.email_smtp_port = int(os.getenv(\\\"EMAIL_SMTP_PORT\\\", \\\"587\\\"))\\n        self.email_username = os.getenv(\\\"EMAIL_USERNAME\\\", \\\"\\\")\\n        self.email_password = os.getenv(\\\"EMAIL_PASSWORD\\\", \\\"\\\")\\n        self.email_recipients = os.getenv(\\\"EMAIL_RECIPIENTS\\\", \\\"\\\").split(\\\",\\\")\\n        \\n        self.slack_webhook_url = os.getenv(\\\"SLACK_WEBHOOK_URL\\\", \\\"\\\")\\n        \\n        self.sms_api_key = os.getenv(\\\"SMS_API_KEY\\\", \\\"\\\")\\n        self.sms_api_secret = os.getenv(\\\"SMS_API_SECRET\\\", \\\"\\\")\\n        self.sms_from_number = os.getenv(\\\"SMS_FROM_NUMBER\\\", \\\"\\\")\\n        \\n        # Anomaly detection settings\\n        self.anomaly_detection_enabled = os.getenv(\\n            \\\"ANOMALY_DETECTION_ENABLED\\\", \\\"true\\\"\\n        ).lower() == \\\"true\\\"\\n        self.ml_detection_enabled = os.getenv(\\n            \\\"ML_DETECTION_ENABLED\\\", \\\"false\\\"\\n        ).lower() == \\\"true\\\"\\n [... omitted end of long line]"
                },
                {
                  "lineNumber": 7752,
                  "content": "            \"text\": \"        self.sms_api_key = os.getenv(\\\"SMS_API_KEY\\\", \\\"\\\")\","
                },
                {
                  "lineNumber": 7894,
                  "content": "        \"contents\": \"   docker-compose logs -f agent\\n   &amp;#96;&amp;#96;&amp;#96;\\n\\n3. **Stop services**\\n   &amp;#96;&amp;#96;&amp;#96;bash\\n   docker-compose down\\n   &amp;#96;&amp;#96;&amp;#96;\\n\\n## Configuration\\n\\nConfiguration is managed through environment variables. Key settings include:\\n\\n### Database Configuration\\n- &amp;#96;DATABASE_URL&amp;#96;: PostgreSQL connection string\\n\\n### Metric Collection\\n- &amp;#96;METRIC_COLLECTION_INTERVAL&amp;#96;: Collection interval in seconds (default: 60)\\n\\n### Thresholds\\n- &amp;#96;DEFAULT_CPU_THRESHOLD&amp;#96;: Default CPU usage threshold (default: 80.0)\\n- &amp;#96;DEFAULT_MEMORY_THRESHOLD&amp;#96;: Default memory usage threshold (default: 80.0)\\n- &amp;#96;DEFAULT_DISK_THRESHOLD&amp;#96;: Default disk usage threshold (default: 80.0)\\n\\n### Cloud Provider Credentials\\n- AWS: &amp;#96;AWS_ACCESS_KEY_ID&amp;#96;, &amp;#96;AWS_SECRET_ACCESS_KEY&amp;#96;, &amp;#96;AWS_REGION&amp;#96;\\n- Azure: &amp;#96;AZURE_SUBSCRIPTION_ID&amp;#96;, &amp;#96;AZURE_CLIENT_ID&amp;#96;, &amp;#96;AZURE_CLIENT_SECRET&amp;#96;, &amp;#96;AZURE_TENANT_ID&amp;#96;\\n- GCP: &amp;#96;GCP_PR [... omitted end of long line]"
                },
                {
                  "lineNumber": 8014,
                  "content": "            \"text\": \"- SMS: &amp;#96;SMS_API_KEY&amp;#96;, &amp;#96;SMS_API_SECRET&amp;#96;, &amp;#96;SMS_FROM_NUMBER&amp;#96;\","
                },
                {
                  "lineNumber": 12386,
                  "content": "  \"plan\": \"# Set Up API Endpoint for Metric Collection\\n\\n## Overview\\nImplement a FastAPI endpoint in &amp;#96;api/metrics.py&amp;#96; to expose system metrics (CPU, memory, network) via REST API. Include rate limiting, JSON responses, and create a main FastAPI application file.\\n\\n## Implementation Details\\n\\n### 1. FastAPI Router Module (&amp;#96;api/metrics.py&amp;#96;)\\n\\n**Create FastAPI router with endpoint:**\\n- Import FastAPI &amp;#96;APIRouter&amp;#96;\\n- Create router instance\\n- Define &amp;#96;GET /api/metrics&amp;#96; endpoint\\n- Integrate with existing &amp;#96;get_cpu_usage()&amp;#96;, &amp;#96;get_memory_usage()&amp;#96;, &amp;#96;get_network_traffic()&amp;#96; functions from &amp;#96;data_collection.system_metrics&amp;#96;\\n- Return structured JSON response with all three metrics\\n- Include timestamp in response\\n\\n**Response format:**\\n&amp;#96;&amp;#96;&amp;#96;json\\n{\\n  \\\"cpu_usage\\\": {...},\\n  \\\"memory_usage\\\": {...},\\n  \\\"network_traffic\\\": {...},\\n  \\\"timestamp\\\": \\\"ISO format\\\"\\n}\\n&amp;#96;&amp;#96;&amp;#96;\\n\\n### 2. Rate Limiting Implementatio [... omitted end of long line]"
                },
                {
                  "lineNumber": 14060,
                  "content": "Authenticate using AWS credentials (via environment variables or configuration files)."
                },
                {
                  "lineNumber": 14099,
                  "content": "Authenticate using Google Cloud credentials (via google-auth or service account)."
                },
                {
                  "lineNumber": 14126,
                  "content": "Authenticate using Azure service principal or managed identities."
                },
                {
                  "lineNumber": 14190,
                  "content": "No hardcoded values. Ensure that the cloud provider configurations (API keys, region, etc.) are dynamically configurable."
                },
                {
                  "lineNumber": 14194,
                  "content": "Authentication management. Use secure authentication methods, including environment variables or service accounts, for accessing cloud services."
                },
                {
                  "lineNumber": 14485,
                  "content": "        \"contents\": \"class Settings:\\ndef __init__(self):\\n = os.getenv(\\\"EMAIL_SMTP_SERVER\\\", \\\"\\\")\\n        self.email_smtp_port = int(os.getenv(\\\"EMAIL_SMTP_PORT\\\", \\\"587\\\"))\\n        self.email_username = os.getenv(\\\"EMAIL_USERNAME\\\", \\\"\\\")\\n        self.email_password = os.getenv(\\\"EMAIL_PASSWORD\\\", \\\"\\\")\\n        self.email_recipients = os.getenv(\\\"EMAIL_RECIPIENTS\\\", \\\"\\\").split(\\\",\\\")\\n        \\n        self.slack_webhook_url = os.getenv(\\\"SLACK_WEBHOOK_URL\\\", \\\"\\\")\\n        \\n        self.sms_api_key = os.getenv(\\\"SMS_API_KEY\\\", \\\"\\\")\\n        self.sms_api_secret = os.getenv(\\\"SMS_API_SECRET\\\", \\\"\\\")\\n        self.sms_from_number = os.getenv(\\\"SMS_FROM_NUMBER\\\", \\\"\\\")\\n        \\n        # Anomaly detection settings\\n        self.anomaly_detection_enabled = os.getenv(\\n            \\\"ANOMALY_DETECTION_ENABLED\\\", \\\"true\\\"\\n        ).lower() == \\\"true\\\"\\n        self.ml_detection_enabled = os.getenv(\\n            \\\"ML_DETECTION_ENABLED\\\", \\\"false\\\"\\n        ).lower() == \\\"true\\\"\\n [... omitted end of long line]"
                },
                {
                  "lineNumber": 14553,
                  "content": "            \"text\": \"        self.sms_api_key = os.getenv(\\\"SMS_API_KEY\\\", \\\"\\\")\","
                },
                {
                  "lineNumber": 14711,
                  "content": "        \"contents\": \"   docker-compose logs -f agent\\n   &amp;#96;&amp;#96;&amp;#96;\\n\\n3. **Stop services**\\n   &amp;#96;&amp;#96;&amp;#96;bash\\n   docker-compose down\\n   &amp;#96;&amp;#96;&amp;#96;\\n\\n## Configuration\\n\\nConfiguration is managed through environment variables. Key settings include:\\n\\n### Database Configuration\\n- &amp;#96;DATABASE_URL&amp;#96;: PostgreSQL connection string\\n\\n### Metric Collection\\n- &amp;#96;METRIC_COLLECTION_INTERVAL&amp;#96;: Collection interval in seconds (default: 60)\\n\\n### Thresholds\\n- &amp;#96;DEFAULT_CPU_THRESHOLD&amp;#96;: Default CPU usage threshold (default: 80.0)\\n- &amp;#96;DEFAULT_MEMORY_THRESHOLD&amp;#96;: Default memory usage threshold (default: 80.0)\\n- &amp;#96;DEFAULT_DISK_THRESHOLD&amp;#96;: Default disk usage threshold (default: 80.0)\\n\\n### Cloud Provider Credentials\\n- AWS: &amp;#96;AWS_ACCESS_KEY_ID&amp;#96;, &amp;#96;AWS_SECRET_ACCESS_KEY&amp;#96;, &amp;#96;AWS_REGION&amp;#96;\\n- Azure: &amp;#96;AZURE_SUBSCRIPTION_ID&amp;#96;, &amp;#96;AZURE_CLIENT_ID&amp;#96;, &amp;#96;AZURE_CLIENT_SECRET&amp;#96;, &amp;#96;AZURE_TENANT_ID&amp;#96;\\n- GCP: &amp;#96;GCP_PR [... omitted end of long line]"
                },
                {
                  "lineNumber": 14831,
                  "content": "            \"text\": \"- SMS: &amp;#96;SMS_API_KEY&amp;#96;, &amp;#96;SMS_API_SECRET&amp;#96;, &amp;#96;SMS_FROM_NUMBER&amp;#96;\","
                },
                {
                  "lineNumber": 15297,
                  "content": "        \"contents\": \"class Settings:\\n\\n    \\n    def get_cloud_config(self, provider: str) -&amp;gt; Dict[str, str]:\\n        \\\"\\\"\\\"\\n        Get cloud provider configuration.\\n        \\n        Args:\\n            provider: Cloud provider name ('aws', 'azure', 'gcp')\\n        \\n        Returns:\\n            Dictionary containing provider-specific configuration\\n        \\\"\\\"\\\"\\n        configs = {\\n            \\\"aws\\\": {\\n                \\\"access_key\\\": self.aws_access_key,\\n                \\\"secret_key\\\": self.aws_secret_key,\\n                \\\"region\\\": self.aws_region\\n            },\\n            \\\"azure\\\": {\\n                \\\"subscription_id\\\": self.azure_subscription_id,\\n                \\\"client_id\\\": self.azure_client_id,\\n                \\\"client_secret\\\": self.azure_client_secret,\\n                \\\"tenant_id\\\": self.azure_tenant_id\\n            },\\n            \\\"gcp\\\": {\\n                \\\"project_id\\\": self.gcp_project_id,\\n                \\\"credentials_path\\\": self.gcp_credent [... omitted end of long line]"
                },
                {
                  "lineNumber": 15530,
                  "content": "            \"text\": \"                \\\"api_key\\\": self.sms_api_key,\","
                },
                {
                  "lineNumber": 19070,
                  "content": "        \"contents\": \"@app.exception_handler(RateLimitExceeded)\\nasync def rate_limit_handler(request: Request, exc: RateLimitExceeded):\\n\\n        return response\\n\\n# Initialize rate limiter and attach to app if available\\nif SLOWAPI_AVAILABLE:\\n    from slowapi import Limiter\\n    from slowapi.util import get_remote_address\\n    from config.settings import get_settings as get_app_settings\\n    \\n    app_settings = get_app_settings()\\n    if app_settings and app_settings.api_enable_rate_limit:\\n        limiter = Limiter(\\n            app=app,\\n            key_func=get_remote_address\\n        )\\n        # Attach limiter to metrics router so it can be used in decorators\\n        metrics_router.state.limiter = limiter\\n        # Also make it available globally for the metrics module\\n        import api.metrics as metrics_module\\n        metrics_module.limiter = limiter\\n\\n# Include routers\\napp.include_router(metrics_router)\\n\\n\\n@app.get(\\\"/health\\\")\\nasync def health_check():\\n    \\\"\\\" [... omitted end of long line]"
                },
                {
                  "lineNumber": 19709,
                  "content": "  \"plan\": \"# Cloud Usage Metrics Collection Implementation\\n\\n## Overview\\nExtend the existing &amp;#96;cloud_metrics.py&amp;#96; file to add usage metrics collection functions for AWS, GCP, and Azure. These functions will fetch compute (CPU utilization), storage consumption, and network bandwidth metrics from all resources automatically, returning data in a standardized format.\\n\\n## Implementation Details\\n\\n### 1. Extend AWSMetricsCollector Class\\n\\n**Add method: &amp;#96;get_aws_metrics()&amp;#96;**\\n- Use Boto3 to interact with AWS CloudWatch\\n- Authenticate using credentials from &amp;#96;config.settings&amp;#96; (AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY, AWS_REGION)\\n- Fetch metrics for all EC2 instances (CPU utilization)\\n- Fetch S3 storage metrics (bucket size, object count)\\n- Fetch network bandwidth metrics (NetworkIn, NetworkOut)\\n- Use configurable time window (default: last 5 minutes)\\n- Return standardized format with provider, metric_name, metric_value, timestamp, resource_type\\n\\n**Key implem [... omitted end of long line]"
                },
                {
                  "lineNumber": 19738,
                  "content": "      \"content\": \"Implement comprehensive error handling for API failures, rate limits, and authentication\","
                },
                {
                  "lineNumber": 19819,
                  "content": "- [ ] Implement comprehensive error handling for API failures, rate limits, and authentication"
                },
                {
                  "lineNumber": 19915,
                  "content": "- [ ] Implement comprehensive error handling for API failures, rate limits, and authentication"
                },
                {
                  "lineNumber": 19947,
                  "content": "- [x] Implement comprehensive error handling for API failures, rate limits, and authentication"
                },
                {
                  "lineNumber": 20121,
                  "content": "  - Authenticates using credentials from &#96;config.settings&#96;"
                },
                {
                  "lineNumber": 20131,
                  "content": "  - Authenticates using service account credentials"
                },
                {
                  "lineNumber": 20141,
                  "content": "  - Authenticates using service principal or DefaultAzureCredential"
                },
                {
                  "lineNumber": 20177,
                  "content": "- Handles authentication failures with RuntimeError"
                },
                {
                  "lineNumber": 20193,
                  "content": "- Comprehensive error handling: Handles API failures, rate limits, and authentication errors"
                },
                {
                  "lineNumber": 22614,
                  "content": "        \"contents\": \"def get_aws_metrics() -&amp;gt; List[Dict]:\\n    \\\"\\\"\\\"\\n    Fetch AWS cloud usage metrics (compute, storage, network).\\n    \\n    This is a standalone function that collects metrics from AWS CloudWatch\\n    for all EC2 instances (CPU utilization), S3 buckets (storage), and\\n    network bandwidth metrics.\\n    \\n    Returns:\\n        List of standardized metric dictionaries with format:\\n        {\\n            'provider': 'aws',\\n            'metric_name': str,\\n            'metric_value': float,\\n            'timestamp': str (ISO format),\\n            'resource_type': str ('Compute', 'Storage', 'Network')\\n        }\\n    \\n    Raises:\\n        RuntimeError: If boto3 not available or authentication fails\\n    \\\"\\\"\\\"\\n    settings = get_settings()\\n    if settings is None:\\n        raise RuntimeError(\\\"Settings not available\\\")\\n    \\n    aws_config = settings.get_cloud_config('aws')\\n    collector = AWSMetricsCollector()\\n    \\n    if not collector.authenticate(aws_con [... omitted end of long line]"
                },
                {
                  "lineNumber": 22695,
                  "content": "            \"text\": \"        RuntimeError: If boto3 not available or authentication fails\","
                },
                {
                  "lineNumber": 22731,
                  "content": "            \"text\": \"    if not collector.authenticate(aws_config):\","
                },
                {
                  "lineNumber": 22735,
                  "content": "            \"text\": \"        raise RuntimeError(\\\"AWS authentication failed. Check your AWS credentials.\\\")\","
                },
                {
                  "lineNumber": 22779,
                  "content": "        \"contents\": \"def collect_cloud_metrics(provider: str, credentials: Dict) -&amp;gt; Dict:\\n    \\\"\\\"\\\"\\n    Collect cloud metrics for a specific provider.\\n    \\n    Args:\\n        provider: Cloud provider name ('aws', 'azure', 'gcp')\\n        credentials: Provider-specific credentials\\n    \\n    Returns:\\n        Dictionary containing cloud metrics\\n    \\n    TODO: Implement provider selection and metric collection\\n    \\\"\\\"\\\"\\n    # TODO: Implement provider selection and collection\\n    collectors = {\\n        \\\"aws\\\": AWSMetricsCollector(),\\n        \\\"azure\\\": AzureMetricsCollector(),\\n        \\\"gcp\\\": GCPMetricsCollector()\\n    }\\n    \\n    if provider not in collectors:\\n        raise ValueError(f\\\"Unsupported cloud provider: {provider}\\\")\\n    \\n    collector = collectors[provider]\\n    if not collector.authenticate(credentials):\\n        raise ValueError(f\\\"Authentication failed for {provider}\\\")\\n    \\n    return {\\n        \\\"cost_metrics\\\": collector.collect_cost_metrics(\\n  [... omitted end of long line]"
                },
                {
                  "lineNumber": 22880,
                  "content": "            \"text\": \"    if not collector.authenticate(credentials):\","
                },
                {
                  "lineNumber": 22884,
                  "content": "            \"text\": \"        raise ValueError(f\\\"Authentication failed for {provider}\\\")\","
                },
                {
                  "lineNumber": 23418,
                  "content": "        \"contents\": \"def get_azure_metrics() -&amp;gt; List[Dict]:\\n    \\\"\\\"\\\"\\n    Fetch Azure cloud usage metrics (compute, storage, network).\\n    \\n    This is a standalone function that collects metrics from Azure Monitor\\n    for all Virtual Machines (CPU utilization), Blob Storage accounts\\n    (storage consumption), and network bandwidth metrics.\\n    \\n    Returns:\\n        List of standardized metric dictionaries with format:\\n        {\\n            'provider': 'azure',\\n            'metric_name': str,\\n            'metric_value': float,\\n            'timestamp': str (ISO format),\\n            'resource_type': str ('Compute', 'Storage', 'Network')\\n        }\\n    \\n    Raises:\\n        RuntimeError: If Azure Monitor not available or authentication fails\\n    \\\"\\\"\\\"\\n    settings = get_settings()\\n    if settings is None:\\n        raise RuntimeError(\\\"Settings not available\\\")\\n    \\n    azure_config = settings.get_cloud_config('azure')\\n    collector = AzureMetricsCollector()\\n   [... omitted end of long line]"
                },
                {
                  "lineNumber": 23499,
                  "content": "            \"text\": \"        RuntimeError: If Azure Monitor not available or authentication fails\","
                },
                {
                  "lineNumber": 23535,
                  "content": "            \"text\": \"    if not collector.authenticate(azure_config):\","
                },
                {
                  "lineNumber": 23539,
                  "content": "            \"text\": \"        raise RuntimeError(\\\"Azure authentication failed. Check your Azure credentials.\\\")\","
                },
                {
                  "lineNumber": 24032,
                  "content": "        \"contents\": \"class AWSMetricsCollector(CloudProvider):\\n\\n    \\n    def get_aws_metrics(self) -&amp;gt; List[Dict]:\\n        \\\"\\\"\\\"\\n        Fetch AWS cloud usage metrics (compute, storage, network).\\n        \\n        Collects metrics from:\\n        - EC2 instances: CPU utilization\\n        - S3 buckets: Storage consumption\\n        - EC2 instances: Network bandwidth (NetworkIn, NetworkOut)\\n        \\n        Returns:\\n            List of standardized metric dictionaries\\n        \\n        Raises:\\n            RuntimeError: If boto3 not available or authentication fails\\n        \\\"\\\"\\\"\\n        if not BOTO3_AVAILABLE:\\n            raise RuntimeError(\\n                \\\"boto3 library is not available. Please install it using: pip install boto3\\\"\\n            )\\n        \\n        try:\\n            settings = get_settings()\\n            if settings is None:\\n                raise RuntimeError(\\\"Settings not available\\\")\\n            \\n            # Get AWS configuration\\n             [... omitted end of long line]"
                },
                {
                  "lineNumber": 24113,
                  "content": "            \"text\": \"            RuntimeError: If boto3 not available or authentication fails\","
                },
                {
                  "lineNumber": 24189,
                  "content": "            \"text\": \"            # Authenticate if not already done\","
                },
                {
                  "lineNumber": 24197,
                  "content": "            \"text\": \"                if not self.authenticate(aws_config):\","
                },
                {
                  "lineNumber": 24201,
                  "content": "            \"text\": \"                    raise RuntimeError(\\\"AWS authentication failed\\\")\","
                },
                {
                  "lineNumber": 24388,
                  "content": "        \"contents\": \"def get_gcp_metrics() -&amp;gt; List[Dict]:\\n    \\\"\\\"\\\"\\n    Fetch GCP cloud usage metrics (compute, storage, network).\\n    \\n    This is a standalone function that collects metrics from Google Cloud\\n    Monitoring for all Compute Engine instances (CPU utilization), Cloud\\n    Storage buckets (storage), and network egress metrics.\\n    \\n    Returns:\\n        List of standardized metric dictionaries with format:\\n        {\\n            'provider': 'gcp',\\n            'metric_name': str,\\n            'metric_value': float,\\n            'timestamp': str (ISO format),\\n            'resource_type': str ('Compute', 'Storage', 'Network')\\n        }\\n    \\n    Raises:\\n        RuntimeError: If Google Cloud Monitoring not available or authentication fails\\n    \\\"\\\"\\\"\\n    settings = get_settings()\\n    if settings is None:\\n        raise RuntimeError(\\\"Settings not available\\\")\\n    \\n    gcp_config = settings.get_cloud_config('gcp')\\n    collector = GCPMetricsCollector()\\n  [... omitted end of long line]"
                },
                {
                  "lineNumber": 24469,
                  "content": "            \"text\": \"        RuntimeError: If Google Cloud Monitoring not available or authentication fails\","
                },
                {
                  "lineNumber": 24505,
                  "content": "            \"text\": \"    if not collector.authenticate(gcp_config):\","
                },
                {
                  "lineNumber": 24509,
                  "content": "            \"text\": \"        raise RuntimeError(\\\"GCP authentication failed. Check your GCP credentials.\\\")\","
                },
                {
                  "lineNumber": 25475,
                  "content": "        \"contents\": \"\\\"\\\"\\\"\\nLogic for collecting cloud usage metrics.\\n\\nThis module provides functionality to collect cloud usage metrics from\\nvarious cloud providers (AWS, Azure, GCP) including cost, resource usage,\\nand billing information.\\n\\\"\\\"\\\"\\n\\nimport os\\nfrom typing import Dict, List, Optional\\nfrom datetime import datetime, timedelta\\nfrom abc import ABC, abstractmethod\\n\\n# Try to import boto3, handle gracefully if not available\\ntry:\\n    import boto3\\n    from botocore.exceptions import ClientError, BotoCoreError\\n    BOTO3_AVAILABLE = True\\nexcept ImportError:\\n    BOTO3_AVAILABLE = False\\n    boto3 = None\\n    ClientError = Exception\\n    BotoCoreError = Exception\\n\\n# Try to import Google Cloud Monitoring, handle gracefully if not available\\ntry:\\n    from google.cloud import monitoring_v3\\n    from google.cloud import compute_v1\\n    from google.cloud import storage as gcp_storage\\n    from google.auth.exceptions import GoogleAuthError\\n    from google.api_core imp [... omitted end of long line]"
                },
                {
                  "lineNumber": 25591,
                  "content": "            \"text\": \"    from google.auth.exceptions import GoogleAuthError\","
                },
                {
                  "lineNumber": 25623,
                  "content": "            \"text\": \"    GoogleAuthError = Exception\","
                },
                {
                  "lineNumber": 27299,
                  "content": "Ensure API Security (Authorization):"
                },
                {
                  "lineNumber": 27301,
                  "content": "Ensure that the API can only be accessed by authorized users or external agents."
                },
                {
                  "lineNumber": 27303,
                  "content": "Implement authentication using API keys, OAuth tokens, or any other secure method."
                },
                {
                  "lineNumber": 27305,
                  "content": "Reject unauthorized requests with a 401 (Unauthorized) status code."
                },
                {
                  "lineNumber": 27307,
                  "content": "Example (Flask with API Key Authorization):"
                },
                {
                  "lineNumber": 27312,
                  "content": "def require_api_key(f):"
                },
                {
                  "lineNumber": 27315,
                  "content": "        api_key = request.headers.get('X-API-KEY')"
                },
                {
                  "lineNumber": 27316,
                  "content": "        if api_key != 'your-secure-api-key':"
                },
                {
                  "lineNumber": 27317,
                  "content": "            return jsonify({\"error\": \"Unauthorized\"}), 401"
                },
                {
                  "lineNumber": 27322,
                  "content": "@require_api_key"
                },
                {
                  "lineNumber": 27343,
                  "content": "The API is secured and only accessible by authorized users or agents."
                },
                {
                  "lineNumber": 27347,
                  "content": "No hardcoded API keys. Use a secure method for handling API keys or OAuth tokens."
                },
                {
                  "lineNumber": 27449,
                  "content": "Ensure API Security (Authorization):"
                },
                {
                  "lineNumber": 27451,
                  "content": "Ensure that the API can only be accessed by authorized users or external agents."
                },
                {
                  "lineNumber": 27453,
                  "content": "Implement authentication using API keys, OAuth tokens, or any other secure method."
                },
                {
                  "lineNumber": 27455,
                  "content": "Reject unauthorized requests with a 401 (Unauthorized) status code."
                },
                {
                  "lineNumber": 27457,
                  "content": "Example (Flask with API Key Authorization):"
                },
                {
                  "lineNumber": 27462,
                  "content": "def require_api_key(f):"
                },
                {
                  "lineNumber": 27465,
                  "content": "        api_key = request.headers.get('X-API-KEY')"
                },
                {
                  "lineNumber": 27466,
                  "content": "        if api_key != 'your-secure-api-key':"
                },
                {
                  "lineNumber": 27467,
                  "content": "            return jsonify({\"error\": \"Unauthorized\"}), 401"
                },
                {
                  "lineNumber": 27472,
                  "content": "@require_api_key"
                },
                {
                  "lineNumber": 27493,
                  "content": "The API is secured and only accessible by authorized users or agents."
                },
                {
                  "lineNumber": 27497,
                  "content": "No hardcoded API keys. Use a secure method for handling API keys or OAuth tokens."
                }
              ]
            },
            {
              "file": ".\\config\\settings.py",
              "matches": [
                {
                  "lineNumber": 74,
                  "content": "        self.sms_api_key = os.getenv(\"SMS_API_KEY\", \"\")"
                },
                {
                  "lineNumber": 159,
                  "content": "                \"api_key\": self.sms_api_key,"
                }
              ]
            },
            {
              "file": ".\\tests\\test_data_collection.py",
              "matches": [
                {
                  "lineNumber": 447,
                  "content": "    def test_aws_authentication(self):"
                },
                {
                  "lineNumber": 448,
                  "content": "        \"\"\"Test AWS authentication.\"\"\""
                },
                {
                  "lineNumber": 449,
                  "content": "        # TODO: Implement test for AWS authentication"
                },
                {
                  "lineNumber": 457,
                  "content": "    def test_azure_authentication(self):"
                },
                {
                  "lineNumber": 458,
                  "content": "        \"\"\"Test Azure authentication.\"\"\""
                },
                {
                  "lineNumber": 459,
                  "content": "        # TODO: Implement test for Azure authentication"
                },
                {
                  "lineNumber": 462,
                  "content": "    def test_gcp_authentication(self):"
                },
                {
                  "lineNumber": 463,
                  "content": "        \"\"\"Test GCP authentication.\"\"\""
                },
                {
                  "lineNumber": 464,
                  "content": "        # TODO: Implement test for GCP authentication"
                }
              ]
            },
            {
              "file": ".\\data_collection\\cloud_metrics.py",
              "matches": [
                {
                  "lineNumber": 30,
                  "content": "    from google.auth.exceptions import GoogleAuthError"
                },
                {
                  "lineNumber": 38,
                  "content": "    GoogleAuthError = Exception"
                },
                {
                  "lineNumber": 103,
                  "content": "    def authenticate(self, credentials: Dict) -&gt; bool:"
                },
                {
                  "lineNumber": 104,
                  "content": "        \"\"\"Authenticate with cloud provider.\"\"\""
                },
                {
                  "lineNumber": 128,
                  "content": "    def authenticate(self, credentials: Dict) -&gt; bool:"
                },
                {
                  "lineNumber": 130,
                  "content": "        Authenticate with AWS using provided credentials."
                },
                {
                  "lineNumber": 136,
                  "content": "            True if authentication successful, False otherwise"
                },
                {
                  "lineNumber": 162,
                  "content": "            # Test authentication by making a simple API call"
                },
                {
                  "lineNumber": 167,
                  "content": "            self.logger.error(f\"AWS authentication failed: {str(e)}\")"
                },
                {
                  "lineNumber": 170,
                  "content": "            self.logger.error(f\"Unexpected error during AWS authentication: {str(e)}\")"
                },
                {
                  "lineNumber": 186,
                  "content": "            RuntimeError: If boto3 not available or authentication fails"
                },
                {
                  "lineNumber": 205,
                  "content": "            # Authenticate if not already done"
                },
                {
                  "lineNumber": 207,
                  "content": "                if not self.authenticate(aws_config):"
                },
                {
                  "lineNumber": 208,
                  "content": "                    raise RuntimeError(\"AWS authentication failed\")"
                },
                {
                  "lineNumber": 448,
                  "content": "    def authenticate(self, credentials: Dict) -&gt; bool:"
                },
                {
                  "lineNumber": 450,
                  "content": "        Authenticate with Azure using provided credentials."
                },
                {
                  "lineNumber": 456,
                  "content": "            True if authentication successful, False otherwise"
                },
                {
                  "lineNumber": 499,
                  "content": "            # Test authentication by making a simple API call"
                },
                {
                  "lineNumber": 504,
                  "content": "            self.logger.error(f\"Azure authentication failed: {str(e)}\")"
                },
                {
                  "lineNumber": 507,
                  "content": "            self.logger.error(f\"Unexpected error during Azure authentication: {str(e)}\")"
                },
                {
                  "lineNumber": 523,
                  "content": "            RuntimeError: If Azure Monitor not available or authentication fails"
                },
                {
                  "lineNumber": 543,
                  "content": "            # Authenticate if not already done"
                },
                {
                  "lineNumber": 545,
                  "content": "                if not self.authenticate(azure_config):"
                },
                {
                  "lineNumber": 546,
                  "content": "                    raise RuntimeError(\"Azure authentication failed\")"
                },
                {
                  "lineNumber": 777,
                  "content": "    def authenticate(self, credentials: Dict) -&gt; bool:"
                },
                {
                  "lineNumber": 779,
                  "content": "        Authenticate with GCP using provided credentials."
                },
                {
                  "lineNumber": 785,
                  "content": "            True if authentication successful, False otherwise"
                },
                {
                  "lineNumber": 810,
                  "content": "            # Test authentication by making a simple API call"
                },
                {
                  "lineNumber": 815,
                  "content": "        except GoogleAuthError as e:"
                },
                {
                  "lineNumber": 816,
                  "content": "            self.logger.error(f\"GCP authentication failed: {str(e)}\")"
                },
                {
                  "lineNumber": 819,
                  "content": "            self.logger.error(f\"Unexpected error during GCP authentication: {str(e)}\")"
                },
                {
                  "lineNumber": 835,
                  "content": "            RuntimeError: If Google Cloud Monitoring not available or authentication fails"
                },
                {
                  "lineNumber": 855,
                  "content": "            # Authenticate if not already done"
                },
                {
                  "lineNumber": 857,
                  "content": "                if not self.authenticate(gcp_config):"
                },
                {
                  "lineNumber": 858,
                  "content": "                    raise RuntimeError(\"GCP authentication failed\")"
                },
                {
                  "lineNumber": 1033,
                  "content": "        except GoogleAuthError as e:"
                },
                {
                  "lineNumber": 1034,
                  "content": "            error_msg = f\"GCP authentication error: {str(e)}\""
                },
                {
                  "lineNumber": 1103,
                  "content": "        RuntimeError: If boto3 not available or authentication fails"
                },
                {
                  "lineNumber": 1112,
                  "content": "    if not collector.authenticate(aws_config):"
                },
                {
                  "lineNumber": 1113,
                  "content": "        raise RuntimeError(\"AWS authentication failed. Check your AWS credentials.\")"
                },
                {
                  "lineNumber": 1137,
                  "content": "        RuntimeError: If Google Cloud Monitoring not available or authentication fails"
                },
                {
                  "lineNumber": 1146,
                  "content": "    if not collector.authenticate(gcp_config):"
                },
                {
                  "lineNumber": 1147,
                  "content": "        raise RuntimeError(\"GCP authentication failed. Check your GCP credentials.\")"
                },
                {
                  "lineNumber": 1171,
                  "content": "        RuntimeError: If Azure Monitor not available or authentication fails"
                },
                {
                  "lineNumber": 1180,
                  "content": "    if not collector.authenticate(azure_config):"
                },
                {
                  "lineNumber": 1181,
                  "content": "        raise RuntimeError(\"Azure authentication failed. Check your Azure credentials.\")"
                },
                {
                  "lineNumber": 1210,
                  "content": "    if not collector.authenticate(credentials):"
                },
                {
                  "lineNumber": 1211,
                  "content": "        raise ValueError(f\"Authentication failed for {provider}\")"
                }
              ]
            },
            {
              "file": ".\\README.md",
              "matches": [
                {
                  "lineNumber": 179,
                  "content": "- SMS: &#96;SMS_API_KEY&#96;, &#96;SMS_API_SECRET&#96;, &#96;SMS_FROM_NUMBER&#96;"
                }
              ]
            },
            {
              "file": ".\\alerting\\alert_system.py",
              "matches": [
                {
                  "lineNumber": 131,
                  "content": "    def __init__(self, api_key: str, api_secret: str, from_number: str):"
                },
                {
                  "lineNumber": 136,
                  "content": "            api_key: SMS service API key (e.g., Twilio)"
                },
                {
                  "lineNumber": 142,
                  "content": "        self.api_key = api_key"
                },
                {
                  "lineNumber": 145,
                  "content": "        self.configured = bool(api_key and api_secret and from_number)"
                },
                {
                  "lineNumber": 169,
                  "content": "        # client = Client(self.api_key, self.api_secret)"
                }
              ]
            }
          ],
          "totalLines": 166,
          "totalMatchedLines": 166
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "How to query cloud_server_metrics table from database?",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 360,
            "column": 20
          },
          "endPosition": {
            "line": 496
          }
        },
        "contents": "def create_unified_metrics_schema(conn) -&gt; bool:\n    \"\"\"\n    Create the database schema for storing unified cloud and server metrics.\n    \n    Creates a table called cloud_server_metrics with columns for both\n    server metrics (CPU, memory, network) and cloud metrics (compute,\n    storage, bandwidth) in a single row.\n    \n    Args:\n        conn: psycopg2 connection object\n    \n    Returns:\n        True if schema creation successful, False otherwise\n    \"\"\"\n    if conn is None:\n        print(\"Error: Database connection is None\")\n        return False\n    \n    try:\n        cursor = conn.cursor()\n        \n        # Create cloud_server_metrics table\n        create_table_query = \"\"\"\n        CREATE TABLE IF NOT EXISTS cloud_server_metrics (\n            id SERIAL PRIMARY KEY,\n            cpu_usage NUMERIC NOT NULL,\n            memory_usage NUMERIC NOT NULL,\n            network_traffic NUMERIC NOT NULL,\n            cloud_compute NUMERIC,\n            cloud_storage NUMERIC,\n            cloud_bandwidth NUMERIC,\n            timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n            resource_type TEXT NOT NULL\n        );\n        \"\"\"\n        \n        cursor.execute(create_table_query)\n        conn.commit()\n        cursor.close()\n        \n        return True\n    \n    except Error as e:\n        print(f\"Error creating unified metrics schema: {e}\")\n        if conn:\n            conn.rollback()\n        return False\n    except Exception as e:\n        print(f\"Unexpected error creating unified metrics schema: {e}\")\n        if conn:\n            conn.rollback()\n        return False\n\n\ndef create_schema(conn) -&gt; bool:\n    \"\"\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "def create_unified_metrics_schema(conn) -&gt; bool:",
            "lineNumber": 364,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 365
          },
          {
            "text": "    Create the database schema for storing unified cloud and server metrics.",
            "lineNumber": 366
          },
          {
            "text": "    ",
            "lineNumber": 367
          },
          {
            "text": "    Creates a table called cloud_server_metrics with columns for both",
            "lineNumber": 368
          },
          {
            "text": "    server metrics (CPU, memory, network) and cloud metrics (compute,",
            "lineNumber": 369
          },
          {
            "text": "    storage, bandwidth) in a single row.",
            "lineNumber": 370
          },
          {
            "text": "    ",
            "lineNumber": 371
          },
          {
            "text": "    Args:",
            "lineNumber": 372
          },
          {
            "text": "        conn: psycopg2 connection object",
            "lineNumber": 373
          },
          {
            "text": "    ",
            "lineNumber": 374
          },
          {
            "text": "    Returns:",
            "lineNumber": 375
          },
          {
            "text": "        True if schema creation successful, False otherwise",
            "lineNumber": 376
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 377
          },
          {
            "text": "    if conn is None:",
            "lineNumber": 378
          },
          {
            "text": "        print(\"Error: Database connection is None\")",
            "lineNumber": 379
          },
          {
            "text": "        return False",
            "lineNumber": 380
          },
          {
            "text": "    ",
            "lineNumber": 381
          },
          {
            "text": "    try:",
            "lineNumber": 382
          },
          {
            "text": "        cursor = conn.cursor()",
            "lineNumber": 383
          },
          {
            "text": "        ",
            "lineNumber": 384
          },
          {
            "text": "        # Create cloud_server_metrics table",
            "lineNumber": 385
          },
          {
            "text": "        create_table_query = \"\"\"",
            "lineNumber": 386
          },
          {
            "text": "        CREATE TABLE IF NOT EXISTS cloud_server_metrics (",
            "lineNumber": 387
          },
          {
            "text": "            id SERIAL PRIMARY KEY,",
            "lineNumber": 388
          },
          {
            "text": "            cpu_usage NUMERIC NOT NULL,",
            "lineNumber": 389
          },
          {
            "text": "            memory_usage NUMERIC NOT NULL,",
            "lineNumber": 390
          },
          {
            "text": "            network_traffic NUMERIC NOT NULL,",
            "lineNumber": 391
          },
          {
            "text": "            cloud_compute NUMERIC,",
            "lineNumber": 392
          },
          {
            "text": "            cloud_storage NUMERIC,",
            "lineNumber": 393
          },
          {
            "text": "            cloud_bandwidth NUMERIC,",
            "lineNumber": 394
          },
          {
            "text": "            timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,",
            "lineNumber": 395
          },
          {
            "text": "            resource_type TEXT NOT NULL",
            "lineNumber": 396
          },
          {
            "text": "        );",
            "lineNumber": 397
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 398
          },
          {
            "text": "        ",
            "lineNumber": 399
          },
          {
            "text": "        cursor.execute(create_table_query)",
            "lineNumber": 400
          },
          {
            "text": "        conn.commit()",
            "lineNumber": 401
          },
          {
            "text": "        cursor.close()",
            "lineNumber": 402
          },
          {
            "text": "        ",
            "lineNumber": 403
          },
          {
            "text": "        return True",
            "lineNumber": 404
          },
          {
            "text": "    ",
            "lineNumber": 405
          },
          {
            "text": "    except Error as e:",
            "lineNumber": 406
          },
          {
            "text": "        print(f\"Error creating unified metrics schema: {e}\")",
            "lineNumber": 407
          },
          {
            "text": "        if conn:",
            "lineNumber": 408
          },
          {
            "text": "            conn.rollback()",
            "lineNumber": 409
          },
          {
            "text": "        return False",
            "lineNumber": 410
          },
          {
            "text": "    except Exception as e:",
            "lineNumber": 411
          },
          {
            "text": "        print(f\"Unexpected error creating unified metrics schema: {e}\")",
            "lineNumber": 412
          },
          {
            "text": "        if conn:",
            "lineNumber": 413
          },
          {
            "text": "            conn.rollback()",
            "lineNumber": 414
          },
          {
            "text": "        return False",
            "lineNumber": 415,
            "isSignature": true
          },
          {
            "lineNumber": 416
          },
          {
            "lineNumber": 417
          },
          {
            "text": "def create_schema(conn) -&gt; bool:",
            "lineNumber": 418,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 419
          }
        ]
      },
      "score": 0.4956226050853729
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 414,
            "column": 20
          },
          "endPosition": {
            "line": 496
          }
        },
        "contents": "def create_schema(conn) -&gt; bool:\n    \"\"\"\n    Define and create the database schema for storing system metrics.\n    \n    Creates a table called system_metrics with columns for CPU, memory,\n    network metrics, timestamp, and resource type.\n    Also creates the cloud_metrics table.\n    \n    Args:\n        conn: psycopg2 connection object\n    \n    Returns:\n        True if schema creation successful, False otherwise\n    \"\"\"\n    if conn is None:\n        print(\"Error: Database connection is None\")\n        return False\n    \n    try:\n        cursor = conn.cursor()\n        \n        # Create system_metrics table\n        create_table_query = \"\"\"\n        CREATE TABLE IF NOT EXISTS system_metrics (\n            id SERIAL PRIMARY KEY,\n            cpu_usage NUMERIC,\n            memory_usage NUMERIC,\n            network_traffic NUMERIC,\n            timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n            resource_type TEXT NOT NULL\n        );\n        \"\"\"\n        \n        cursor.execute(create_table_query)\n        \n        # Also create cloud_metrics table\n        create_cloud_table_query = \"\"\"\n        CREATE TABLE IF NOT EXISTS cloud_metrics (\n            id SERIAL PRIMARY KEY,\n            provider TEXT NOT NULL,\n            metric_name TEXT NOT NULL,\n            metric_value NUMERIC,\n            timestamp TIMESTAMP,\n            resource_type TEXT NOT NULL\n        );\n        \"\"\"\n        \n        cursor.execute(create_cloud_table_query)\n        \n        # Also create unified cloud_server_metrics table\n        create_unified_table_query = \"\"\"\n        CREATE TABLE IF NOT EXISTS cloud_server_metrics (\n            id SERIAL PRIMARY KEY,\n            cpu_usage NUMERIC NOT NULL,\n            memory_usage NUMERIC NOT NULL,\n            network_traffic NUMERIC NOT NULL,\n            cloud_compute NUMERIC,\n            cloud_storage NUMERIC,\n            cloud_bandwidth NUMERIC,\n            timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n            resource_type TEXT NOT NULL\n        );\n        \"\"\"\n        \n        cursor.execute(create_unified_table_query)\n        conn.commit()",
        "signatures": {},
        "detailedLines": [
          {
            "text": "def create_schema(conn) -&gt; bool:",
            "lineNumber": 418,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 419
          },
          {
            "text": "    Define and create the database schema for storing system metrics.",
            "lineNumber": 420
          },
          {
            "text": "    ",
            "lineNumber": 421
          },
          {
            "text": "    Creates a table called system_metrics with columns for CPU, memory,",
            "lineNumber": 422
          },
          {
            "text": "    network metrics, timestamp, and resource type.",
            "lineNumber": 423
          },
          {
            "text": "    Also creates the cloud_metrics table.",
            "lineNumber": 424
          },
          {
            "text": "    ",
            "lineNumber": 425
          },
          {
            "text": "    Args:",
            "lineNumber": 426
          },
          {
            "text": "        conn: psycopg2 connection object",
            "lineNumber": 427
          },
          {
            "text": "    ",
            "lineNumber": 428
          },
          {
            "text": "    Returns:",
            "lineNumber": 429
          },
          {
            "text": "        True if schema creation successful, False otherwise",
            "lineNumber": 430
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 431
          },
          {
            "text": "    if conn is None:",
            "lineNumber": 432
          },
          {
            "text": "        print(\"Error: Database connection is None\")",
            "lineNumber": 433
          },
          {
            "text": "        return False",
            "lineNumber": 434
          },
          {
            "text": "    ",
            "lineNumber": 435
          },
          {
            "text": "    try:",
            "lineNumber": 436
          },
          {
            "text": "        cursor = conn.cursor()",
            "lineNumber": 437
          },
          {
            "text": "        ",
            "lineNumber": 438
          },
          {
            "text": "        # Create system_metrics table",
            "lineNumber": 439
          },
          {
            "text": "        create_table_query = \"\"\"",
            "lineNumber": 440
          },
          {
            "text": "        CREATE TABLE IF NOT EXISTS system_metrics (",
            "lineNumber": 441
          },
          {
            "text": "            id SERIAL PRIMARY KEY,",
            "lineNumber": 442
          },
          {
            "text": "            cpu_usage NUMERIC,",
            "lineNumber": 443
          },
          {
            "text": "            memory_usage NUMERIC,",
            "lineNumber": 444
          },
          {
            "text": "            network_traffic NUMERIC,",
            "lineNumber": 445
          },
          {
            "text": "            timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,",
            "lineNumber": 446
          },
          {
            "text": "            resource_type TEXT NOT NULL",
            "lineNumber": 447
          },
          {
            "text": "        );",
            "lineNumber": 448
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 449
          },
          {
            "text": "        ",
            "lineNumber": 450
          },
          {
            "text": "        cursor.execute(create_table_query)",
            "lineNumber": 451
          },
          {
            "text": "        ",
            "lineNumber": 452
          },
          {
            "text": "        # Also create cloud_metrics table",
            "lineNumber": 453
          },
          {
            "text": "        create_cloud_table_query = \"\"\"",
            "lineNumber": 454
          },
          {
            "text": "        CREATE TABLE IF NOT EXISTS cloud_metrics (",
            "lineNumber": 455
          },
          {
            "text": "            id SERIAL PRIMARY KEY,",
            "lineNumber": 456
          },
          {
            "text": "            provider TEXT NOT NULL,",
            "lineNumber": 457
          },
          {
            "text": "            metric_name TEXT NOT NULL,",
            "lineNumber": 458
          },
          {
            "text": "            metric_value NUMERIC,",
            "lineNumber": 459
          },
          {
            "text": "            timestamp TIMESTAMP,",
            "lineNumber": 460
          },
          {
            "text": "            resource_type TEXT NOT NULL",
            "lineNumber": 461
          },
          {
            "text": "        );",
            "lineNumber": 462
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 463
          },
          {
            "text": "        ",
            "lineNumber": 464
          },
          {
            "text": "        cursor.execute(create_cloud_table_query)",
            "lineNumber": 465
          },
          {
            "text": "        ",
            "lineNumber": 466
          },
          {
            "text": "        # Also create unified cloud_server_metrics table",
            "lineNumber": 467
          },
          {
            "text": "        create_unified_table_query = \"\"\"",
            "lineNumber": 468
          },
          {
            "text": "        CREATE TABLE IF NOT EXISTS cloud_server_metrics (",
            "lineNumber": 469
          },
          {
            "text": "            id SERIAL PRIMARY KEY,",
            "lineNumber": 470
          },
          {
            "text": "            cpu_usage NUMERIC NOT NULL,",
            "lineNumber": 471
          },
          {
            "text": "            memory_usage NUMERIC NOT NULL,",
            "lineNumber": 472
          },
          {
            "text": "            network_traffic NUMERIC NOT NULL,",
            "lineNumber": 473
          },
          {
            "text": "            cloud_compute NUMERIC,",
            "lineNumber": 474
          },
          {
            "text": "            cloud_storage NUMERIC,",
            "lineNumber": 475
          },
          {
            "text": "            cloud_bandwidth NUMERIC,",
            "lineNumber": 476
          },
          {
            "text": "            timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,",
            "lineNumber": 477
          },
          {
            "text": "            resource_type TEXT NOT NULL",
            "lineNumber": 478
          },
          {
            "text": "        );",
            "lineNumber": 479
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 480
          },
          {
            "text": "        ",
            "lineNumber": 481
          },
          {
            "text": "        cursor.execute(create_unified_table_query)",
            "lineNumber": 482
          },
          {
            "text": "        conn.commit()",
            "lineNumber": 483
          }
        ]
      },
      "score": 0.48956578969955444
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 761
          },
          "endPosition": {
            "line": 882
          }
        },
        "contents": "def store_unified_metrics(\n    cpu_usage: float,\n    memory_usage: float,\n    network_traffic: float,\n    resource_type: str,\n    cloud_compute: Optional[float] = None,\n    cloud_storage: Optional[float] = None,\n    cloud_bandwidth: Optional[float] = None,\n    timestamp: Optional[datetime] = None\n) -&gt; bool:\n\"\"\"\n    conn = None\n    \n    try:\n        # Validate required parameters\n        if cpu_usage is None or memory_usage is None or network_traffic is None:\n            print(\"Error: cpu_usage, memory_usage, and network_traffic are required\")\n            return False\n        \n        if not resource_type:\n            print(\"Error: resource_type is required\")\n            return False\n        \n        # Validate resource_type\n        valid_resource_types = ['Server', 'AWS', 'GCP', 'Azure']\n        if resource_type not in valid_resource_types:\n            print(f\"Error: resource_type must be one of {valid_resource_types}\")\n            return False\n        \n        # Establish database connection\n        conn = connect_to_db()\n        if conn is None:\n            print(\"Failed to establish database connection\")\n            return False\n        \n        # Ensure schema exists\n        if not create_unified_metrics_schema(conn):\n            print(\"Failed to create/verify unified metrics schema\")\n            return False\n        \n        cursor = conn.cursor()\n        \n        # Use provided timestamp or default to current time\n        if timestamp is None:\n            metric_timestamp = datetime.now()\n        elif isinstance(timestamp, str):\n            try:\n                metric_timestamp = datetime.fromisoformat(timestamp.replace('Z', '+00:00'))\n            except (ValueError, AttributeError):\n                metric_timestamp = datetime.now()\n        elif isinstance(timestamp, datetime):\n            metric_timestamp = timestamp\n        else:\n            metric_timestamp = datetime.now()\n        \n        # Insert query\n        insert_query = \"\"\"\n            INSERT INTO cloud_server_metrics (\n                cpu_usage, memory_usage, network_traffic,\n                cloud_compute, cloud_storage, cloud_bandwidth,\n                timestamp, resource_type\n            )\n            VALUES (%s, %s, %s, %s, %s, %s, %s, %s);\n        \"\"\"\n        \n        # Convert to appropriate types\n        cpu_usage_float = float(cpu_usage)\n        memory_usage_float = float(memory_usage)\n        network_traffic_float = float(network_traffic)",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 762,
                "column": 1
              },
              "endPosition": {
                "line": 772,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "def store_unified_metrics(",
            "lineNumber": 762,
            "isSignature": true
          },
          {
            "text": "    cpu_usage: float,",
            "lineNumber": 763,
            "isSignature": true
          },
          {
            "text": "    memory_usage: float,",
            "lineNumber": 764,
            "isSignature": true
          },
          {
            "text": "    network_traffic: float,",
            "lineNumber": 765,
            "isSignature": true
          },
          {
            "text": "    resource_type: str,",
            "lineNumber": 766,
            "isSignature": true
          },
          {
            "text": "    cloud_compute: Optional[float] = None,",
            "lineNumber": 767,
            "isSignature": true
          },
          {
            "text": "    cloud_storage: Optional[float] = None,",
            "lineNumber": 768,
            "isSignature": true
          },
          {
            "text": "    cloud_bandwidth: Optional[float] = None,",
            "lineNumber": 769,
            "isSignature": true
          },
          {
            "text": "    timestamp: Optional[datetime] = None",
            "lineNumber": 770,
            "isSignature": true
          },
          {
            "text": ") -&gt; bool:",
            "lineNumber": 771,
            "isSignature": true
          },
          {
            "text": "\"\"\"",
            "lineNumber": 790
          },
          {
            "text": "    conn = None",
            "lineNumber": 791
          },
          {
            "text": "    ",
            "lineNumber": 792
          },
          {
            "text": "    try:",
            "lineNumber": 793
          },
          {
            "text": "        # Validate required parameters",
            "lineNumber": 794
          },
          {
            "text": "        if cpu_usage is None or memory_usage is None or network_traffic is None:",
            "lineNumber": 795
          },
          {
            "text": "            print(\"Error: cpu_usage, memory_usage, and network_traffic are required\")",
            "lineNumber": 796
          },
          {
            "text": "            return False",
            "lineNumber": 797
          },
          {
            "text": "        ",
            "lineNumber": 798
          },
          {
            "text": "        if not resource_type:",
            "lineNumber": 799
          },
          {
            "text": "            print(\"Error: resource_type is required\")",
            "lineNumber": 800
          },
          {
            "text": "            return False",
            "lineNumber": 801
          },
          {
            "text": "        ",
            "lineNumber": 802
          },
          {
            "text": "        # Validate resource_type",
            "lineNumber": 803
          },
          {
            "text": "        valid_resource_types = ['Server', 'AWS', 'GCP', 'Azure']",
            "lineNumber": 804
          },
          {
            "text": "        if resource_type not in valid_resource_types:",
            "lineNumber": 805
          },
          {
            "text": "            print(f\"Error: resource_type must be one of {valid_resource_types}\")",
            "lineNumber": 806
          },
          {
            "text": "            return False",
            "lineNumber": 807
          },
          {
            "text": "        ",
            "lineNumber": 808
          },
          {
            "text": "        # Establish database connection",
            "lineNumber": 809
          },
          {
            "text": "        conn = connect_to_db()",
            "lineNumber": 810
          },
          {
            "text": "        if conn is None:",
            "lineNumber": 811
          },
          {
            "text": "            print(\"Failed to establish database connection\")",
            "lineNumber": 812
          },
          {
            "text": "            return False",
            "lineNumber": 813
          },
          {
            "text": "        ",
            "lineNumber": 814
          },
          {
            "text": "        # Ensure schema exists",
            "lineNumber": 815
          },
          {
            "text": "        if not create_unified_metrics_schema(conn):",
            "lineNumber": 816
          },
          {
            "text": "            print(\"Failed to create/verify unified metrics schema\")",
            "lineNumber": 817
          },
          {
            "text": "            return False",
            "lineNumber": 818
          },
          {
            "text": "        ",
            "lineNumber": 819
          },
          {
            "text": "        cursor = conn.cursor()",
            "lineNumber": 820
          },
          {
            "text": "        ",
            "lineNumber": 821
          },
          {
            "text": "        # Use provided timestamp or default to current time",
            "lineNumber": 822
          },
          {
            "text": "        if timestamp is None:",
            "lineNumber": 823
          },
          {
            "text": "            metric_timestamp = datetime.now()",
            "lineNumber": 824
          },
          {
            "text": "        elif isinstance(timestamp, str):",
            "lineNumber": 825
          },
          {
            "text": "            try:",
            "lineNumber": 826
          },
          {
            "text": "                metric_timestamp = datetime.fromisoformat(timestamp.replace('Z', '+00:00'))",
            "lineNumber": 827
          },
          {
            "text": "            except (ValueError, AttributeError):",
            "lineNumber": 828
          },
          {
            "text": "                metric_timestamp = datetime.now()",
            "lineNumber": 829
          },
          {
            "text": "        elif isinstance(timestamp, datetime):",
            "lineNumber": 830
          },
          {
            "text": "            metric_timestamp = timestamp",
            "lineNumber": 831
          },
          {
            "text": "        else:",
            "lineNumber": 832
          },
          {
            "text": "            metric_timestamp = datetime.now()",
            "lineNumber": 833
          },
          {
            "text": "        ",
            "lineNumber": 834
          },
          {
            "text": "        # Insert query",
            "lineNumber": 835
          },
          {
            "text": "        insert_query = \"\"\"",
            "lineNumber": 836
          },
          {
            "text": "            INSERT INTO cloud_server_metrics (",
            "lineNumber": 837
          },
          {
            "text": "                cpu_usage, memory_usage, network_traffic,",
            "lineNumber": 838
          },
          {
            "text": "                cloud_compute, cloud_storage, cloud_bandwidth,",
            "lineNumber": 839
          },
          {
            "text": "                timestamp, resource_type",
            "lineNumber": 840
          },
          {
            "text": "            )",
            "lineNumber": 841
          },
          {
            "text": "            VALUES (%s, %s, %s, %s, %s, %s, %s, %s);",
            "lineNumber": 842
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 843
          },
          {
            "text": "        ",
            "lineNumber": 844
          },
          {
            "text": "        # Convert to appropriate types",
            "lineNumber": 845
          },
          {
            "text": "        cpu_usage_float = float(cpu_usage)",
            "lineNumber": 846
          },
          {
            "text": "        memory_usage_float = float(memory_usage)",
            "lineNumber": 847
          },
          {
            "text": "        network_traffic_float = float(network_traffic)",
            "lineNumber": 848
          }
        ]
      },
      "score": 0.4395821988582611
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 882,
            "column": 24
          },
          "endPosition": {
            "line": 1024
          }
        },
        "contents": "def store_all_metrics_unified(all_metrics: Dict) -&gt; bool:\n    \"\"\"\n    Store unified metrics from collect_all_metrics() structure into cloud_server_metrics table.\n    \n    This function aggregates server and cloud metrics and stores them in the\n    unified cloud_server_metrics table, creating one row per resource type\n    (Server, AWS, GCP, Azure).\n    \n    Args:\n        all_metrics: Dictionary from collect_all_metrics() containing:\n            - timestamp: str (ISO format)\n            - server_metrics: Dict (CPU and memory usage with timestamp)\n            - cloud_metrics: Dict (AWS, GCP, Azure metrics by provider)\n    \n    Returns:\n        True if storage successful (at least some metrics stored), False otherwise\n    \"\"\"\n    storage_success = False\n    \n    try:\n        # Extract server metrics\n        server_metrics = all_metrics.get('server_metrics', {})\n        if not server_metrics or 'error' in server_metrics:\n            print(\"Server metrics not available or contain errors\")\n            return False\n        \n        # Get server metric values\n        cpu_usage = server_metrics.get('cpu_usage')\n        memory_usage = server_metrics.get('memory_usage')\n        server_timestamp = server_metrics.get('timestamp')\n        \n        # Convert server timestamp if needed\n        if isinstance(server_timestamp, str):\n            try:\n                server_timestamp = datetime.fromisoformat(server_timestamp.replace('Z', '+00:00'))\n            except (ValueError, AttributeError):\n                server_timestamp = datetime.now()\n        elif not isinstance(server_timestamp, datetime):\n            server_timestamp = datetime.now()\n        \n        # For network_traffic, we need to get it from server metrics or use 0\n        # Since get_server_metrics() doesn't include network, we'll use 0 or fetch separately\n        network_traffic = 0.0  # Default to 0, could be enhanced to get from network metrics\n        \n        # Store Server row (server metrics only)\n        if",
        "signatures": {},
        "detailedLines": [
          {
            "text": "def store_all_metrics_unified(all_metrics: Dict) -&gt; bool:",
            "lineNumber": 886,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 887
          },
          {
            "text": "    Store unified metrics from collect_all_metrics() structure into cloud_server_metrics table.",
            "lineNumber": 888
          },
          {
            "text": "    ",
            "lineNumber": 889
          },
          {
            "text": "    This function aggregates server and cloud metrics and stores them in the",
            "lineNumber": 890
          },
          {
            "text": "    unified cloud_server_metrics table, creating one row per resource type",
            "lineNumber": 891
          },
          {
            "text": "    (Server, AWS, GCP, Azure).",
            "lineNumber": 892
          },
          {
            "text": "    ",
            "lineNumber": 893
          },
          {
            "text": "    Args:",
            "lineNumber": 894
          },
          {
            "text": "        all_metrics: Dictionary from collect_all_metrics() containing:",
            "lineNumber": 895
          },
          {
            "text": "            - timestamp: str (ISO format)",
            "lineNumber": 896
          },
          {
            "text": "            - server_metrics: Dict (CPU and memory usage with timestamp)",
            "lineNumber": 897
          },
          {
            "text": "            - cloud_metrics: Dict (AWS, GCP, Azure metrics by provider)",
            "lineNumber": 898
          },
          {
            "text": "    ",
            "lineNumber": 899
          },
          {
            "text": "    Returns:",
            "lineNumber": 900
          },
          {
            "text": "        True if storage successful (at least some metrics stored), False otherwise",
            "lineNumber": 901
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 902
          },
          {
            "text": "    storage_success = False",
            "lineNumber": 903
          },
          {
            "text": "    ",
            "lineNumber": 904
          },
          {
            "text": "    try:",
            "lineNumber": 905
          },
          {
            "text": "        # Extract server metrics",
            "lineNumber": 906
          },
          {
            "text": "        server_metrics = all_metrics.get('server_metrics', {})",
            "lineNumber": 907
          },
          {
            "text": "        if not server_metrics or 'error' in server_metrics:",
            "lineNumber": 908
          },
          {
            "text": "            print(\"Server metrics not available or contain errors\")",
            "lineNumber": 909
          },
          {
            "text": "            return False",
            "lineNumber": 910
          },
          {
            "text": "        ",
            "lineNumber": 911
          },
          {
            "text": "        # Get server metric values",
            "lineNumber": 912
          },
          {
            "text": "        cpu_usage = server_metrics.get('cpu_usage')",
            "lineNumber": 913
          },
          {
            "text": "        memory_usage = server_metrics.get('memory_usage')",
            "lineNumber": 914
          },
          {
            "text": "        server_timestamp = server_metrics.get('timestamp')",
            "lineNumber": 915
          },
          {
            "text": "        ",
            "lineNumber": 916
          },
          {
            "text": "        # Convert server timestamp if needed",
            "lineNumber": 917
          },
          {
            "text": "        if isinstance(server_timestamp, str):",
            "lineNumber": 918
          },
          {
            "text": "            try:",
            "lineNumber": 919
          },
          {
            "text": "                server_timestamp = datetime.fromisoformat(server_timestamp.replace('Z', '+00:00'))",
            "lineNumber": 920
          },
          {
            "text": "            except (ValueError, AttributeError):",
            "lineNumber": 921
          },
          {
            "text": "                server_timestamp = datetime.now()",
            "lineNumber": 922
          },
          {
            "text": "        elif not isinstance(server_timestamp, datetime):",
            "lineNumber": 923
          },
          {
            "text": "            server_timestamp = datetime.now()",
            "lineNumber": 924
          },
          {
            "text": "        ",
            "lineNumber": 925
          },
          {
            "text": "        # For network_traffic, we need to get it from server metrics or use 0",
            "lineNumber": 926
          },
          {
            "text": "        # Since get_server_metrics() doesn't include network, we'll use 0 or fetch separately",
            "lineNumber": 927
          },
          {
            "text": "        network_traffic = 0.0  # Default to 0, could be enhanced to get from network metrics",
            "lineNumber": 928
          },
          {
            "text": "        ",
            "lineNumber": 929
          },
          {
            "text": "        # Store Server row (server metrics only)",
            "lineNumber": 930
          },
          {
            "text": "        if",
            "lineNumber": 931
          }
        ]
      },
      "score": 0.4389444589614868
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 310,
            "column": 19
          },
          "endPosition": {
            "line": 414
          }
        },
        "contents": "def create_cloud_metrics_schema(conn) -&gt; bool:\n    \"\"\"\n    Create the database schema for storing cloud metrics.\n    \n    Creates a table called cloud_metrics with columns for provider,\n    metric_name, metric_value, timestamp, and resource_type.\n    \n    Args:\n        conn: psycopg2 connection object\n    \n    Returns:\n        True if schema creation successful, False otherwise\n    \"\"\"\n    if conn is None:\n        print(\"Error: Database connection is None\")\n        return False\n    \n    try:\n        cursor = conn.cursor()\n        \n        # Create cloud_metrics table\n        create_table_query = \"\"\"\n        CREATE TABLE IF NOT EXISTS cloud_metrics (\n            id SERIAL PRIMARY KEY,\n            provider TEXT NOT NULL,\n            metric_name TEXT NOT NULL,\n            metric_value NUMERIC,\n            timestamp TIMESTAMP,\n            resource_type TEXT NOT NULL\n        );\n        \"\"\"\n        \n        cursor.execute(create_table_query)\n        conn.commit()\n        cursor.close()\n        \n        return True\n    \n    except Error as e:\n        print(f\"Error creating cloud metrics schema: {e}\")\n        if conn:\n            conn.rollback()\n        return False\n    except Exception as e:\n        print(f\"Unexpected error creating cloud metrics schema: {e}\")\n        if conn:\n            conn.rollback()\n        return False\n\n\ndef create_unified_metrics_schema(conn) -&gt; bool:\n    \"\"\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "def create_cloud_metrics_schema(conn) -&gt; bool:",
            "lineNumber": 314,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 315
          },
          {
            "text": "    Create the database schema for storing cloud metrics.",
            "lineNumber": 316
          },
          {
            "text": "    ",
            "lineNumber": 317
          },
          {
            "text": "    Creates a table called cloud_metrics with columns for provider,",
            "lineNumber": 318
          },
          {
            "text": "    metric_name, metric_value, timestamp, and resource_type.",
            "lineNumber": 319
          },
          {
            "text": "    ",
            "lineNumber": 320
          },
          {
            "text": "    Args:",
            "lineNumber": 321
          },
          {
            "text": "        conn: psycopg2 connection object",
            "lineNumber": 322
          },
          {
            "text": "    ",
            "lineNumber": 323
          },
          {
            "text": "    Returns:",
            "lineNumber": 324
          },
          {
            "text": "        True if schema creation successful, False otherwise",
            "lineNumber": 325
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 326
          },
          {
            "text": "    if conn is None:",
            "lineNumber": 327
          },
          {
            "text": "        print(\"Error: Database connection is None\")",
            "lineNumber": 328
          },
          {
            "text": "        return False",
            "lineNumber": 329
          },
          {
            "text": "    ",
            "lineNumber": 330
          },
          {
            "text": "    try:",
            "lineNumber": 331
          },
          {
            "text": "        cursor = conn.cursor()",
            "lineNumber": 332
          },
          {
            "text": "        ",
            "lineNumber": 333
          },
          {
            "text": "        # Create cloud_metrics table",
            "lineNumber": 334
          },
          {
            "text": "        create_table_query = \"\"\"",
            "lineNumber": 335
          },
          {
            "text": "        CREATE TABLE IF NOT EXISTS cloud_metrics (",
            "lineNumber": 336
          },
          {
            "text": "            id SERIAL PRIMARY KEY,",
            "lineNumber": 337
          },
          {
            "text": "            provider TEXT NOT NULL,",
            "lineNumber": 338
          },
          {
            "text": "            metric_name TEXT NOT NULL,",
            "lineNumber": 339
          },
          {
            "text": "            metric_value NUMERIC,",
            "lineNumber": 340
          },
          {
            "text": "            timestamp TIMESTAMP,",
            "lineNumber": 341
          },
          {
            "text": "            resource_type TEXT NOT NULL",
            "lineNumber": 342
          },
          {
            "text": "        );",
            "lineNumber": 343
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 344
          },
          {
            "text": "        ",
            "lineNumber": 345
          },
          {
            "text": "        cursor.execute(create_table_query)",
            "lineNumber": 346
          },
          {
            "text": "        conn.commit()",
            "lineNumber": 347
          },
          {
            "text": "        cursor.close()",
            "lineNumber": 348
          },
          {
            "text": "        ",
            "lineNumber": 349
          },
          {
            "text": "        return True",
            "lineNumber": 350
          },
          {
            "text": "    ",
            "lineNumber": 351
          },
          {
            "text": "    except Error as e:",
            "lineNumber": 352
          },
          {
            "text": "        print(f\"Error creating cloud metrics schema: {e}\")",
            "lineNumber": 353
          },
          {
            "text": "        if conn:",
            "lineNumber": 354
          },
          {
            "text": "            conn.rollback()",
            "lineNumber": 355
          },
          {
            "text": "        return False",
            "lineNumber": 356
          },
          {
            "text": "    except Exception as e:",
            "lineNumber": 357
          },
          {
            "text": "        print(f\"Unexpected error creating cloud metrics schema: {e}\")",
            "lineNumber": 358
          },
          {
            "text": "        if conn:",
            "lineNumber": 359
          },
          {
            "text": "            conn.rollback()",
            "lineNumber": 360
          },
          {
            "text": "        return False",
            "lineNumber": 361,
            "isSignature": true
          },
          {
            "lineNumber": 362
          },
          {
            "lineNumber": 363
          },
          {
            "text": "def create_unified_metrics_schema(conn) -&gt; bool:",
            "lineNumber": 364,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 365
          }
        ]
      },
      "score": 0.4259248971939087
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 758,
            "column": 24
          },
          "endPosition": {
            "line": 882
          }
        },
        "contents": "def store_unified_metrics(\n    cpu_usage: float,\n    memory_usage: float,\n    network_traffic: float,\n    resource_type: str,\n    cloud_compute: Optional[float] = None,\n    cloud_storage: Optional[float] = None,\n    cloud_bandwidth: Optional[float] = None,\n    timestamp: Optional[datetime] = None\n) -&gt; bool:\n    \"\"\"\n    Store unified metrics (server + cloud) in the cloud_server_metrics table.\n    \n    This function stores both server metrics and optional cloud metrics in\n    a single row in the unified cloud_server_metrics table.\n    \n    Args:\n        cpu_usage: Server CPU usage as percentage (required)\n        memory_usage: Server memory usage as percentage or bytes (required)\n        network_traffic: Server network bandwidth in bytes (required)\n        resource_type: Resource type identifier (Server, AWS, GCP, Azure) (required)\n        cloud_compute: Cloud compute usage (optional)\n        cloud_storage: Cloud storage usage (optional)\n        cloud_bandwidth: Cloud bandwidth usage (optional)\n        timestamp: Timestamp when metrics were collected (optional, defaults to current time)\n    \n    Returns:\n        True if storage successful, False otherwise\n    \"\"\"\n    conn = None\n    \n    try:\n        # Validate required parameters\n        if",
        "signatures": {},
        "detailedLines": [
          {
            "text": "def store_unified_metrics(",
            "lineNumber": 762,
            "isSignature": true
          },
          {
            "text": "    cpu_usage: float,",
            "lineNumber": 763,
            "isSignature": true
          },
          {
            "text": "    memory_usage: float,",
            "lineNumber": 764,
            "isSignature": true
          },
          {
            "text": "    network_traffic: float,",
            "lineNumber": 765,
            "isSignature": true
          },
          {
            "text": "    resource_type: str,",
            "lineNumber": 766,
            "isSignature": true
          },
          {
            "text": "    cloud_compute: Optional[float] = None,",
            "lineNumber": 767,
            "isSignature": true
          },
          {
            "text": "    cloud_storage: Optional[float] = None,",
            "lineNumber": 768,
            "isSignature": true
          },
          {
            "text": "    cloud_bandwidth: Optional[float] = None,",
            "lineNumber": 769,
            "isSignature": true
          },
          {
            "text": "    timestamp: Optional[datetime] = None",
            "lineNumber": 770,
            "isSignature": true
          },
          {
            "text": ") -&gt; bool:",
            "lineNumber": 771,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 772
          },
          {
            "text": "    Store unified metrics (server + cloud) in the cloud_server_metrics table.",
            "lineNumber": 773
          },
          {
            "text": "    ",
            "lineNumber": 774
          },
          {
            "text": "    This function stores both server metrics and optional cloud metrics in",
            "lineNumber": 775
          },
          {
            "text": "    a single row in the unified cloud_server_metrics table.",
            "lineNumber": 776
          },
          {
            "text": "    ",
            "lineNumber": 777
          },
          {
            "text": "    Args:",
            "lineNumber": 778
          },
          {
            "text": "        cpu_usage: Server CPU usage as percentage (required)",
            "lineNumber": 779
          },
          {
            "text": "        memory_usage: Server memory usage as percentage or bytes (required)",
            "lineNumber": 780
          },
          {
            "text": "        network_traffic: Server network bandwidth in bytes (required)",
            "lineNumber": 781
          },
          {
            "text": "        resource_type: Resource type identifier (Server, AWS, GCP, Azure) (required)",
            "lineNumber": 782
          },
          {
            "text": "        cloud_compute: Cloud compute usage (optional)",
            "lineNumber": 783
          },
          {
            "text": "        cloud_storage: Cloud storage usage (optional)",
            "lineNumber": 784
          },
          {
            "text": "        cloud_bandwidth: Cloud bandwidth usage (optional)",
            "lineNumber": 785
          },
          {
            "text": "        timestamp: Timestamp when metrics were collected (optional, defaults to current time)",
            "lineNumber": 786
          },
          {
            "text": "    ",
            "lineNumber": 787
          },
          {
            "text": "    Returns:",
            "lineNumber": 788
          },
          {
            "text": "        True if storage successful, False otherwise",
            "lineNumber": 789
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 790
          },
          {
            "text": "    conn = None",
            "lineNumber": 791
          },
          {
            "text": "    ",
            "lineNumber": 792
          },
          {
            "text": "    try:",
            "lineNumber": 793
          },
          {
            "text": "        # Validate required parameters",
            "lineNumber": 794
          },
          {
            "text": "        if",
            "lineNumber": 795
          }
        ]
      },
      "score": 0.42222535610198975
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\collect_metrics.py",
        "range": {
          "startPosition": {
            "line": 61,
            "column": 75
          },
          "endPosition": {
            "line": 110
          }
        },
        "contents": "def run_all_metrics_collection():\n    \"\"\"\n    Job function to collect all metrics (server and cloud).\n    \n    This function is called by the scheduler at regular intervals.\n    It collects both server and cloud metrics into a unified structure\n    and stores them in the database.\n    \"\"\"\n    logger = logging.getLogger(__name__)\n    try:\n        logger.info(f\"Starting all metrics collection (server + cloud) at {datetime.now()}\")\n        all_metrics = collect_all_metrics()\n        \n        # Log summary of collected metrics\n        server_ok = 'error' not in all_metrics.get('server_metrics', {})\n        cloud_providers = len([k for k, v in all_metrics.get('cloud_metrics', {}).items() if v and not isinstance(v, list) or len(v) &gt; 0])\n        \n        logger.info(\n            f\"All metrics collection completed. Server metrics: {'OK' if server_ok else 'Failed'}, \"\n            f\"Cloud providers with metrics: {cloud_providers}\"\n        )\n        \n        # Log metric counts per provider\n        for provider, metrics in all_metrics.get('cloud_metrics', {}).items():\n            if isinstance(metrics, list):\n                logger.info(f\"  {provider.upper()}: {len(metrics)} metrics collected\")\n            elif metrics:\n                logger.debug(f\"  {provider.upper()}: {metrics}\")\n        \n        # Store metrics in database\n        try:\n            from data_collection.database import store_all_metrics\n            storage_success = store_all_metrics(all_metrics)\n            if storage_success:\n                logger.info(\"All metrics stored in database successfully\")\n            else:\n                logger.warning(\"Failed to store all metrics in database\")\n        except ImportError as e:\n            logger.warning(f\"Database storage module not available: {str(e)}\")\n        except Exception as e:\n            logger.error(f\"Error storing metrics: {e}\", exc_info=True)\n        \n        return all_metrics\n        \n    except Exception as e:\n        logger.error",
        "signatures": {},
        "detailedLines": [
          {
            "text": "def run_all_metrics_collection():",
            "lineNumber": 65,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 66
          },
          {
            "text": "    Job function to collect all metrics (server and cloud).",
            "lineNumber": 67
          },
          {
            "text": "    ",
            "lineNumber": 68
          },
          {
            "text": "    This function is called by the scheduler at regular intervals.",
            "lineNumber": 69
          },
          {
            "text": "    It collects both server and cloud metrics into a unified structure",
            "lineNumber": 70
          },
          {
            "text": "    and stores them in the database.",
            "lineNumber": 71
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 72
          },
          {
            "text": "    logger = logging.getLogger(__name__)",
            "lineNumber": 73
          },
          {
            "text": "    try:",
            "lineNumber": 74
          },
          {
            "text": "        logger.info(f\"Starting all metrics collection (server + cloud) at {datetime.now()}\")",
            "lineNumber": 75
          },
          {
            "text": "        all_metrics = collect_all_metrics()",
            "lineNumber": 76
          },
          {
            "text": "        ",
            "lineNumber": 77
          },
          {
            "text": "        # Log summary of collected metrics",
            "lineNumber": 78
          },
          {
            "text": "        server_ok = 'error' not in all_metrics.get('server_metrics', {})",
            "lineNumber": 79
          },
          {
            "text": "        cloud_providers = len([k for k, v in all_metrics.get('cloud_metrics', {}).items() if v and not isinstance(v, list) or len(v) &gt; 0])",
            "lineNumber": 80
          },
          {
            "text": "        ",
            "lineNumber": 81
          },
          {
            "text": "        logger.info(",
            "lineNumber": 82
          },
          {
            "text": "            f\"All metrics collection completed. Server metrics: {'OK' if server_ok else 'Failed'}, \"",
            "lineNumber": 83
          },
          {
            "text": "            f\"Cloud providers with metrics: {cloud_providers}\"",
            "lineNumber": 84
          },
          {
            "text": "        )",
            "lineNumber": 85
          },
          {
            "text": "        ",
            "lineNumber": 86
          },
          {
            "text": "        # Log metric counts per provider",
            "lineNumber": 87
          },
          {
            "text": "        for provider, metrics in all_metrics.get('cloud_metrics', {}).items():",
            "lineNumber": 88
          },
          {
            "text": "            if isinstance(metrics, list):",
            "lineNumber": 89
          },
          {
            "text": "                logger.info(f\"  {provider.upper()}: {len(metrics)} metrics collected\")",
            "lineNumber": 90
          },
          {
            "text": "            elif metrics:",
            "lineNumber": 91
          },
          {
            "text": "                logger.debug(f\"  {provider.upper()}: {metrics}\")",
            "lineNumber": 92
          },
          {
            "text": "        ",
            "lineNumber": 93
          },
          {
            "text": "        # Store metrics in database",
            "lineNumber": 94
          },
          {
            "text": "        try:",
            "lineNumber": 95
          },
          {
            "text": "            from data_collection.database import store_all_metrics",
            "lineNumber": 96
          },
          {
            "text": "            storage_success = store_all_metrics(all_metrics)",
            "lineNumber": 97
          },
          {
            "text": "            if storage_success:",
            "lineNumber": 98
          },
          {
            "text": "                logger.info(\"All metrics stored in database successfully\")",
            "lineNumber": 99
          },
          {
            "text": "            else:",
            "lineNumber": 100
          },
          {
            "text": "                logger.warning(\"Failed to store all metrics in database\")",
            "lineNumber": 101
          },
          {
            "text": "        except ImportError as e:",
            "lineNumber": 102
          },
          {
            "text": "            logger.warning(f\"Database storage module not available: {str(e)}\")",
            "lineNumber": 103
          },
          {
            "text": "        except Exception as e:",
            "lineNumber": 104
          },
          {
            "text": "            logger.error(f\"Error storing metrics: {e}\", exc_info=True)",
            "lineNumber": 105
          },
          {
            "text": "        ",
            "lineNumber": 106
          },
          {
            "text": "        return all_metrics",
            "lineNumber": 107
          },
          {
            "text": "        ",
            "lineNumber": 108
          },
          {
            "text": "    except Exception as e:",
            "lineNumber": 109
          },
          {
            "text": "        logger.error",
            "lineNumber": 110
          }
        ]
      },
      "score": 0.40727418661117554
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 605
          },
          "endPosition": {
            "line": 758
          }
        },
        "contents": "def store_all_metrics(all_metrics: Dict) -&gt; bool:\n\n                \n                # Insert Memory metric\n                if memory_usage is not None:\n                    cursor.execute(\n                        insert_query,\n                        (None, float(memory_usage), None, server_timestamp, 'Memory')\n                    )\n                \n                storage_success = True\n            except Exception as e:\n                print(f\"Error storing server metrics: {e}\")\n                # Continue with cloud metrics even if server metrics fail\n        \n        # Store cloud metrics if available\n        cloud_metrics = all_metrics.get('cloud_metrics', {})\n        if cloud_metrics and 'error' not in cloud_metrics:\n            # Insert query for cloud metrics\n            cloud_insert_query = \"\"\"\n                INSERT INTO cloud_metrics (provider, metric_name, metric_value, timestamp, resource_type)\n                VALUES (%s, %s, %s, %s, %s);\n            \"\"\"\n            \n            # Process each provider's metrics\n            for",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 606,
                "column": 1
              },
              "endPosition": {
                "line": 607,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "def store_all_metrics(all_metrics: Dict) -&gt; bool:",
            "lineNumber": 606,
            "isSignature": true
          },
          {
            "lineNumber": 670
          },
          {
            "text": "                ",
            "lineNumber": 671
          },
          {
            "text": "                # Insert Memory metric",
            "lineNumber": 672
          },
          {
            "text": "                if memory_usage is not None:",
            "lineNumber": 673
          },
          {
            "text": "                    cursor.execute(",
            "lineNumber": 674
          },
          {
            "text": "                        insert_query,",
            "lineNumber": 675
          },
          {
            "text": "                        (None, float(memory_usage), None, server_timestamp, 'Memory')",
            "lineNumber": 676
          },
          {
            "text": "                    )",
            "lineNumber": 677
          },
          {
            "text": "                ",
            "lineNumber": 678
          },
          {
            "text": "                storage_success = True",
            "lineNumber": 679
          },
          {
            "text": "            except Exception as e:",
            "lineNumber": 680
          },
          {
            "text": "                print(f\"Error storing server metrics: {e}\")",
            "lineNumber": 681
          },
          {
            "text": "                # Continue with cloud metrics even if server metrics fail",
            "lineNumber": 682
          },
          {
            "text": "        ",
            "lineNumber": 683
          },
          {
            "text": "        # Store cloud metrics if available",
            "lineNumber": 684
          },
          {
            "text": "        cloud_metrics = all_metrics.get('cloud_metrics', {})",
            "lineNumber": 685
          },
          {
            "text": "        if cloud_metrics and 'error' not in cloud_metrics:",
            "lineNumber": 686
          },
          {
            "text": "            # Insert query for cloud metrics",
            "lineNumber": 687
          },
          {
            "text": "            cloud_insert_query = \"\"\"",
            "lineNumber": 688
          },
          {
            "text": "                INSERT INTO cloud_metrics (provider, metric_name, metric_value, timestamp, resource_type)",
            "lineNumber": 689
          },
          {
            "text": "                VALUES (%s, %s, %s, %s, %s);",
            "lineNumber": 690
          },
          {
            "text": "            \"\"\"",
            "lineNumber": 691
          },
          {
            "text": "            ",
            "lineNumber": 692
          },
          {
            "text": "            # Process each provider's metrics",
            "lineNumber": 693
          },
          {
            "text": "            for",
            "lineNumber": 694
          }
        ]
      },
      "score": 0.4024883508682251
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\system_metrics.py",
        "range": {
          "startPosition": {
            "line": 347,
            "column": 20
          },
          "endPosition": {
            "line": 435
          }
        },
        "contents": "def collect_all_metrics() -&gt; Dict:\n    \"\"\"\n    Collect both server and cloud metrics into a unified structure.\n    \n    Coordinates collection of:\n    - Server metrics (CPU usage, memory usage)\n    - Cloud metrics (AWS, GCP, Azure)\n    \n    Returns:\n        Dictionary containing:\n            - timestamp: str (ISO format timestamp when collection started)\n            - server_metrics: Dict (CPU and memory usage with timestamp)\n            - cloud_metrics: Dict (AWS, GCP, Azure metrics by provider)\n    \n    Errors are handled gracefully - if a cloud provider is not configured\n    or fails, it will be omitted from results rather than causing failure.\n    \"\"\"\n    from utils.logger import get_logger\n    logger = get_logger(__name__)\n    \n    # Capture collection start timestamp\n    collection_timestamp = datetime.now()\n    \n    # Initialize result structure\n    result = {\n        'timestamp': collection_timestamp.isoformat(),\n        'server_metrics': {},\n        'cloud_metrics': {}\n    }\n    \n    # Collect server metrics\n    try:\n        result['server_metrics'] = get_server_metrics()\n        logger.info(\"Server metrics collected successfully\")\n    except RuntimeError as e:\n        logger.error(f\"Failed to collect server metrics: {str(e)}\")\n        result['server_metrics'] = {'error': str(e)}\n    except Exception as e:\n        logger.error(f\"Unexpected error collecting server metrics: {str(e)}\", exc_info=True)\n        result['server_metrics'] = {'error': str(e)}\n    \n    # Collect cloud metrics - handle each provider independently\n    try:\n        from data_collection.cloud_metrics import get_aws_metrics, get_gcp_metrics, get_azure_metrics\n    except ImportError as e:\n        logger.warning(f\"Cloud metrics module not available: {str(e)}\")\n        result['cloud_metrics'] = {'error': 'Cloud metrics module not available'}\n        return result\n    \n    # Collect AWS metrics\n    try:\n        aws_metrics = get_aws_metrics()",
        "signatures": {},
        "detailedLines": [
          {
            "text": "def collect_all_metrics() -&gt; Dict:",
            "lineNumber": 351,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 352
          },
          {
            "text": "    Collect both server and cloud metrics into a unified structure.",
            "lineNumber": 353
          },
          {
            "text": "    ",
            "lineNumber": 354
          },
          {
            "text": "    Coordinates collection of:",
            "lineNumber": 355
          },
          {
            "text": "    - Server metrics (CPU usage, memory usage)",
            "lineNumber": 356
          },
          {
            "text": "    - Cloud metrics (AWS, GCP, Azure)",
            "lineNumber": 357
          },
          {
            "text": "    ",
            "lineNumber": 358
          },
          {
            "text": "    Returns:",
            "lineNumber": 359
          },
          {
            "text": "        Dictionary containing:",
            "lineNumber": 360
          },
          {
            "text": "            - timestamp: str (ISO format timestamp when collection started)",
            "lineNumber": 361
          },
          {
            "text": "            - server_metrics: Dict (CPU and memory usage with timestamp)",
            "lineNumber": 362
          },
          {
            "text": "            - cloud_metrics: Dict (AWS, GCP, Azure metrics by provider)",
            "lineNumber": 363
          },
          {
            "text": "    ",
            "lineNumber": 364
          },
          {
            "text": "    Errors are handled gracefully - if a cloud provider is not configured",
            "lineNumber": 365
          },
          {
            "text": "    or fails, it will be omitted from results rather than causing failure.",
            "lineNumber": 366
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 367
          },
          {
            "text": "    from utils.logger import get_logger",
            "lineNumber": 368
          },
          {
            "text": "    logger = get_logger(__name__)",
            "lineNumber": 369
          },
          {
            "text": "    ",
            "lineNumber": 370
          },
          {
            "text": "    # Capture collection start timestamp",
            "lineNumber": 371
          },
          {
            "text": "    collection_timestamp = datetime.now()",
            "lineNumber": 372
          },
          {
            "text": "    ",
            "lineNumber": 373
          },
          {
            "text": "    # Initialize result structure",
            "lineNumber": 374
          },
          {
            "text": "    result = {",
            "lineNumber": 375
          },
          {
            "text": "        'timestamp': collection_timestamp.isoformat(),",
            "lineNumber": 376
          },
          {
            "text": "        'server_metrics': {},",
            "lineNumber": 377
          },
          {
            "text": "        'cloud_metrics': {}",
            "lineNumber": 378
          },
          {
            "text": "    }",
            "lineNumber": 379
          },
          {
            "text": "    ",
            "lineNumber": 380
          },
          {
            "text": "    # Collect server metrics",
            "lineNumber": 381
          },
          {
            "text": "    try:",
            "lineNumber": 382
          },
          {
            "text": "        result['server_metrics'] = get_server_metrics()",
            "lineNumber": 383
          },
          {
            "text": "        logger.info(\"Server metrics collected successfully\")",
            "lineNumber": 384
          },
          {
            "text": "    except RuntimeError as e:",
            "lineNumber": 385
          },
          {
            "text": "        logger.error(f\"Failed to collect server metrics: {str(e)}\")",
            "lineNumber": 386
          },
          {
            "text": "        result['server_metrics'] = {'error': str(e)}",
            "lineNumber": 387
          },
          {
            "text": "    except Exception as e:",
            "lineNumber": 388
          },
          {
            "text": "        logger.error(f\"Unexpected error collecting server metrics: {str(e)}\", exc_info=True)",
            "lineNumber": 389
          },
          {
            "text": "        result['server_metrics'] = {'error': str(e)}",
            "lineNumber": 390
          },
          {
            "text": "    ",
            "lineNumber": 391
          },
          {
            "text": "    # Collect cloud metrics - handle each provider independently",
            "lineNumber": 392
          },
          {
            "text": "    try:",
            "lineNumber": 393
          },
          {
            "text": "        from data_collection.cloud_metrics import get_aws_metrics, get_gcp_metrics, get_azure_metrics",
            "lineNumber": 394
          },
          {
            "text": "    except ImportError as e:",
            "lineNumber": 395
          },
          {
            "text": "        logger.warning(f\"Cloud metrics module not available: {str(e)}\")",
            "lineNumber": 396
          },
          {
            "text": "        result['cloud_metrics'] = {'error': 'Cloud metrics module not available'}",
            "lineNumber": 397
          },
          {
            "text": "        return result",
            "lineNumber": 398
          },
          {
            "text": "    ",
            "lineNumber": 399
          },
          {
            "text": "    # Collect AWS metrics",
            "lineNumber": 400
          },
          {
            "text": "    try:",
            "lineNumber": 401
          },
          {
            "text": "        aws_metrics = get_aws_metrics()",
            "lineNumber": 402
          }
        ]
      },
      "score": 0.4000239372253418
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 605
          },
          "endPosition": {
            "line": 758
          }
        },
        "contents": "def store_all_metrics(all_metrics: Dict) -&gt; bool:\n\n    \n    try:\n        # Establish database connection\n        conn = connect_to_db()\n        if conn is None:\n            print(\"Failed to establish database connection\")\n            return False\n        \n        # Ensure schemas exist\n        if not create_schema(conn):\n            print(\"Failed to create/verify database schemas\")\n            return False\n        \n        cursor = conn.cursor()\n        \n        # Store server metrics if available\n        server_metrics = all_metrics.get('server_metrics', {})\n        if server_metrics and 'error' not in server_metrics:\n            try:\n                cpu_usage = server_metrics.get('cpu_usage')\n                memory_usage = server_metrics.get('memory_usage')\n                server_timestamp = server_metrics.get('timestamp')\n                \n                # Convert timestamp if needed\n                if isinstance(server_timestamp, str):\n                    try:\n                        # Try ISO format parsing (Python 3.7+)\n                        server_timestamp = datetime.fromisoformat(server_timestamp.replace('Z', '+00:00'))\n                    except (ValueError, AttributeError):\n                        server_timestamp = datetime.now()\n                elif not isinstance(server_timestamp, datetime):\n                    server_timestamp = datetime.now()\n                \n                # Insert server metrics into system_metrics table\n                insert_query = \"\"\"\n                    INSERT INTO system_metrics (cpu_usage, memory_usage, network_traffic, timestamp, resource_type)\n                    VALUES (%s, %s, %s, %s, %s);\n                \"\"\"\n                \n                # Insert CPU metric\n                if cpu_usage is not None:\n                    cursor.execute(\n                        insert_query,\n                        (float(cpu_usage), None, None, server_timestamp, 'CPU')\n                    )\n                \n                # Insert Memory metric\n                if",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 606,
                "column": 1
              },
              "endPosition": {
                "line": 607,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "def store_all_metrics(all_metrics: Dict) -&gt; bool:",
            "lineNumber": 606,
            "isSignature": true
          },
          {
            "lineNumber": 625
          },
          {
            "text": "    ",
            "lineNumber": 626
          },
          {
            "text": "    try:",
            "lineNumber": 627
          },
          {
            "text": "        # Establish database connection",
            "lineNumber": 628
          },
          {
            "text": "        conn = connect_to_db()",
            "lineNumber": 629
          },
          {
            "text": "        if conn is None:",
            "lineNumber": 630
          },
          {
            "text": "            print(\"Failed to establish database connection\")",
            "lineNumber": 631
          },
          {
            "text": "            return False",
            "lineNumber": 632
          },
          {
            "text": "        ",
            "lineNumber": 633
          },
          {
            "text": "        # Ensure schemas exist",
            "lineNumber": 634
          },
          {
            "text": "        if not create_schema(conn):",
            "lineNumber": 635
          },
          {
            "text": "            print(\"Failed to create/verify database schemas\")",
            "lineNumber": 636
          },
          {
            "text": "            return False",
            "lineNumber": 637
          },
          {
            "text": "        ",
            "lineNumber": 638
          },
          {
            "text": "        cursor = conn.cursor()",
            "lineNumber": 639
          },
          {
            "text": "        ",
            "lineNumber": 640
          },
          {
            "text": "        # Store server metrics if available",
            "lineNumber": 641
          },
          {
            "text": "        server_metrics = all_metrics.get('server_metrics', {})",
            "lineNumber": 642
          },
          {
            "text": "        if server_metrics and 'error' not in server_metrics:",
            "lineNumber": 643
          },
          {
            "text": "            try:",
            "lineNumber": 644
          },
          {
            "text": "                cpu_usage = server_metrics.get('cpu_usage')",
            "lineNumber": 645
          },
          {
            "text": "                memory_usage = server_metrics.get('memory_usage')",
            "lineNumber": 646
          },
          {
            "text": "                server_timestamp = server_metrics.get('timestamp')",
            "lineNumber": 647
          },
          {
            "text": "                ",
            "lineNumber": 648
          },
          {
            "text": "                # Convert timestamp if needed",
            "lineNumber": 649
          },
          {
            "text": "                if isinstance(server_timestamp, str):",
            "lineNumber": 650
          },
          {
            "text": "                    try:",
            "lineNumber": 651
          },
          {
            "text": "                        # Try ISO format parsing (Python 3.7+)",
            "lineNumber": 652
          },
          {
            "text": "                        server_timestamp = datetime.fromisoformat(server_timestamp.replace('Z', '+00:00'))",
            "lineNumber": 653
          },
          {
            "text": "                    except (ValueError, AttributeError):",
            "lineNumber": 654
          },
          {
            "text": "                        server_timestamp = datetime.now()",
            "lineNumber": 655
          },
          {
            "text": "                elif not isinstance(server_timestamp, datetime):",
            "lineNumber": 656
          },
          {
            "text": "                    server_timestamp = datetime.now()",
            "lineNumber": 657
          },
          {
            "text": "                ",
            "lineNumber": 658
          },
          {
            "text": "                # Insert server metrics into system_metrics table",
            "lineNumber": 659
          },
          {
            "text": "                insert_query = \"\"\"",
            "lineNumber": 660
          },
          {
            "text": "                    INSERT INTO system_metrics (cpu_usage, memory_usage, network_traffic, timestamp, resource_type)",
            "lineNumber": 661
          },
          {
            "text": "                    VALUES (%s, %s, %s, %s, %s);",
            "lineNumber": 662
          },
          {
            "text": "                \"\"\"",
            "lineNumber": 663
          },
          {
            "text": "                ",
            "lineNumber": 664
          },
          {
            "text": "                # Insert CPU metric",
            "lineNumber": 665
          },
          {
            "text": "                if cpu_usage is not None:",
            "lineNumber": 666
          },
          {
            "text": "                    cursor.execute(",
            "lineNumber": 667
          },
          {
            "text": "                        insert_query,",
            "lineNumber": 668
          },
          {
            "text": "                        (float(cpu_usage), None, None, server_timestamp, 'CPU')",
            "lineNumber": 669
          },
          {
            "text": "                    )",
            "lineNumber": 670
          },
          {
            "text": "                ",
            "lineNumber": 671
          },
          {
            "text": "                # Insert Memory metric",
            "lineNumber": 672
          },
          {
            "text": "                if",
            "lineNumber": 673
          }
        ]
      },
      "score": 0.3966921865940094
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 605
          },
          "endPosition": {
            "line": 758
          }
        },
        "contents": "def store_all_metrics(all_metrics: Dict) -&gt; bool:\n\"\"\"\n            \n            # Process each provider's metrics\n            for provider, metrics_list in cloud_metrics.items():\n                if not isinstance(metrics_list, list):\n                    continue\n                \n                try:\n                    for metric in metrics_list:\n                        if not isinstance(metric, dict):\n                            continue\n                        \n                        provider_name = metric.get('provider', provider)\n                        metric_name = metric.get('metric_name', '')\n                        metric_value = metric.get('metric_value')\n                        metric_timestamp = metric.get('timestamp')\n                        resource_type = metric.get('resource_type', 'Unknown')\n                        \n                        # Convert timestamp if needed\n                        if isinstance(metric_timestamp, str):\n                            try:\n                                # Try ISO format parsing (Python 3.7+)\n                                metric_timestamp = datetime.fromisoformat(metric_timestamp.replace('Z', '+00:00'))\n                            except (ValueError, AttributeError):\n                                metric_timestamp = datetime.now()\n                        elif not isinstance(metric_timestamp, datetime):\n                            metric_timestamp = datetime.now()\n                        \n                        # Insert cloud metric\n                        if metric_value is not None and metric_name:\n                            cursor.execute(\n                                cloud_insert_query,\n                                (\n                                    provider_name,\n                                    metric_name,\n                                    float(metric_value),\n                                    metric_timestamp,\n                                    resource_type\n                                )\n                            )\n                    \n                    storage_success = True",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 606,
                "column": 1
              },
              "endPosition": {
                "line": 607,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "def store_all_metrics(all_metrics: Dict) -&gt; bool:",
            "lineNumber": 606,
            "isSignature": true
          },
          {
            "text": "\"\"\"",
            "lineNumber": 691
          },
          {
            "text": "            ",
            "lineNumber": 692
          },
          {
            "text": "            # Process each provider's metrics",
            "lineNumber": 693
          },
          {
            "text": "            for provider, metrics_list in cloud_metrics.items():",
            "lineNumber": 694
          },
          {
            "text": "                if not isinstance(metrics_list, list):",
            "lineNumber": 695
          },
          {
            "text": "                    continue",
            "lineNumber": 696
          },
          {
            "text": "                ",
            "lineNumber": 697
          },
          {
            "text": "                try:",
            "lineNumber": 698
          },
          {
            "text": "                    for metric in metrics_list:",
            "lineNumber": 699
          },
          {
            "text": "                        if not isinstance(metric, dict):",
            "lineNumber": 700
          },
          {
            "text": "                            continue",
            "lineNumber": 701
          },
          {
            "text": "                        ",
            "lineNumber": 702
          },
          {
            "text": "                        provider_name = metric.get('provider', provider)",
            "lineNumber": 703
          },
          {
            "text": "                        metric_name = metric.get('metric_name', '')",
            "lineNumber": 704
          },
          {
            "text": "                        metric_value = metric.get('metric_value')",
            "lineNumber": 705
          },
          {
            "text": "                        metric_timestamp = metric.get('timestamp')",
            "lineNumber": 706
          },
          {
            "text": "                        resource_type = metric.get('resource_type', 'Unknown')",
            "lineNumber": 707
          },
          {
            "text": "                        ",
            "lineNumber": 708
          },
          {
            "text": "                        # Convert timestamp if needed",
            "lineNumber": 709
          },
          {
            "text": "                        if isinstance(metric_timestamp, str):",
            "lineNumber": 710
          },
          {
            "text": "                            try:",
            "lineNumber": 711
          },
          {
            "text": "                                # Try ISO format parsing (Python 3.7+)",
            "lineNumber": 712
          },
          {
            "text": "                                metric_timestamp = datetime.fromisoformat(metric_timestamp.replace('Z', '+00:00'))",
            "lineNumber": 713
          },
          {
            "text": "                            except (ValueError, AttributeError):",
            "lineNumber": 714
          },
          {
            "text": "                                metric_timestamp = datetime.now()",
            "lineNumber": 715
          },
          {
            "text": "                        elif not isinstance(metric_timestamp, datetime):",
            "lineNumber": 716
          },
          {
            "text": "                            metric_timestamp = datetime.now()",
            "lineNumber": 717
          },
          {
            "text": "                        ",
            "lineNumber": 718
          },
          {
            "text": "                        # Insert cloud metric",
            "lineNumber": 719
          },
          {
            "text": "                        if metric_value is not None and metric_name:",
            "lineNumber": 720
          },
          {
            "text": "                            cursor.execute(",
            "lineNumber": 721
          },
          {
            "text": "                                cloud_insert_query,",
            "lineNumber": 722
          },
          {
            "text": "                                (",
            "lineNumber": 723
          },
          {
            "text": "                                    provider_name,",
            "lineNumber": 724
          },
          {
            "text": "                                    metric_name,",
            "lineNumber": 725
          },
          {
            "text": "                                    float(metric_value),",
            "lineNumber": 726
          },
          {
            "text": "                                    metric_timestamp,",
            "lineNumber": 727
          },
          {
            "text": "                                    resource_type",
            "lineNumber": 728
          },
          {
            "text": "                                )",
            "lineNumber": 729
          },
          {
            "text": "                            )",
            "lineNumber": 730
          },
          {
            "text": "                    ",
            "lineNumber": 731
          },
          {
            "text": "                    storage_success = True",
            "lineNumber": 732
          }
        ]
      },
      "score": 0.37861716747283936
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 602,
            "column": 24
          },
          "endPosition": {
            "line": 758
          }
        },
        "contents": "def store_all_metrics(all_metrics: Dict) -&gt; bool:\n    \"\"\"\n    Store unified metrics (server + cloud) in the database.\n    \n    This function stores both server metrics and cloud metrics from the\n    unified structure returned by collect_all_metrics(). Server metrics\n    are stored in the system_metrics table, and cloud metrics are stored\n    in the cloud_metrics table.\n    \n    Args:\n        all_metrics: Dictionary from collect_all_metrics() containing:\n            - timestamp: str (ISO format)\n            - server_metrics: Dict (CPU and memory usage with timestamp)\n            - cloud_metrics: Dict (AWS, GCP, Azure metrics by provider)\n    \n    Returns:\n        True if storage successful (at least some metrics stored), False otherwise\n    \"\"\"\n    conn = None\n    storage_success = False\n    \n    try:\n        # Establish database connection\n        conn = connect_to_db()",
        "signatures": {},
        "detailedLines": [
          {
            "text": "def store_all_metrics(all_metrics: Dict) -&gt; bool:",
            "lineNumber": 606,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 607
          },
          {
            "text": "    Store unified metrics (server + cloud) in the database.",
            "lineNumber": 608
          },
          {
            "text": "    ",
            "lineNumber": 609
          },
          {
            "text": "    This function stores both server metrics and cloud metrics from the",
            "lineNumber": 610
          },
          {
            "text": "    unified structure returned by collect_all_metrics(). Server metrics",
            "lineNumber": 611
          },
          {
            "text": "    are stored in the system_metrics table, and cloud metrics are stored",
            "lineNumber": 612
          },
          {
            "text": "    in the cloud_metrics table.",
            "lineNumber": 613
          },
          {
            "text": "    ",
            "lineNumber": 614
          },
          {
            "text": "    Args:",
            "lineNumber": 615
          },
          {
            "text": "        all_metrics: Dictionary from collect_all_metrics() containing:",
            "lineNumber": 616
          },
          {
            "text": "            - timestamp: str (ISO format)",
            "lineNumber": 617
          },
          {
            "text": "            - server_metrics: Dict (CPU and memory usage with timestamp)",
            "lineNumber": 618
          },
          {
            "text": "            - cloud_metrics: Dict (AWS, GCP, Azure metrics by provider)",
            "lineNumber": 619
          },
          {
            "text": "    ",
            "lineNumber": 620
          },
          {
            "text": "    Returns:",
            "lineNumber": 621
          },
          {
            "text": "        True if storage successful (at least some metrics stored), False otherwise",
            "lineNumber": 622
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 623
          },
          {
            "text": "    conn = None",
            "lineNumber": 624
          },
          {
            "text": "    storage_success = False",
            "lineNumber": 625
          },
          {
            "text": "    ",
            "lineNumber": 626
          },
          {
            "text": "    try:",
            "lineNumber": 627
          },
          {
            "text": "        # Establish database connection",
            "lineNumber": 628
          },
          {
            "text": "        conn = connect_to_db()",
            "lineNumber": 629
          }
        ]
      },
      "score": 0.37304678559303284
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 885
          },
          "endPosition": {
            "line": 1024
          }
        },
        "contents": "def store_all_metrics_unified(all_metrics: Dict) -&gt; bool:\n\n        \n        # Store Server row (server metrics only)\n        if cpu_usage is not None and memory_usage is not None:\n            success = store_unified_metrics(\n                cpu_usage=float(cpu_usage),\n                memory_usage=float(memory_usage),\n                network_traffic=network_traffic,\n                resource_type='Server',\n                timestamp=server_timestamp\n            )\n            if success:\n                storage_success = True\n        \n        # Process cloud metrics by provider\n        cloud_metrics = all_metrics.get('cloud_metrics', {})\n        if cloud_metrics and 'error' not in cloud_metrics:\n            # Aggregate metrics for each provider\n            for provider, metrics_list in cloud_metrics.items():\n                if not isinstance(metrics_list, list) or len(metrics_list) == 0:\n                    continue\n                \n                try:",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 886,
                "column": 1
              },
              "endPosition": {
                "line": 887,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "def store_all_metrics_unified(all_metrics: Dict) -&gt; bool:",
            "lineNumber": 886,
            "isSignature": true
          },
          {
            "lineNumber": 928
          },
          {
            "text": "        ",
            "lineNumber": 929
          },
          {
            "text": "        # Store Server row (server metrics only)",
            "lineNumber": 930
          },
          {
            "text": "        if cpu_usage is not None and memory_usage is not None:",
            "lineNumber": 931
          },
          {
            "text": "            success = store_unified_metrics(",
            "lineNumber": 932
          },
          {
            "text": "                cpu_usage=float(cpu_usage),",
            "lineNumber": 933
          },
          {
            "text": "                memory_usage=float(memory_usage),",
            "lineNumber": 934
          },
          {
            "text": "                network_traffic=network_traffic,",
            "lineNumber": 935
          },
          {
            "text": "                resource_type='Server',",
            "lineNumber": 936
          },
          {
            "text": "                timestamp=server_timestamp",
            "lineNumber": 937
          },
          {
            "text": "            )",
            "lineNumber": 938
          },
          {
            "text": "            if success:",
            "lineNumber": 939
          },
          {
            "text": "                storage_success = True",
            "lineNumber": 940
          },
          {
            "text": "        ",
            "lineNumber": 941
          },
          {
            "text": "        # Process cloud metrics by provider",
            "lineNumber": 942
          },
          {
            "text": "        cloud_metrics = all_metrics.get('cloud_metrics', {})",
            "lineNumber": 943
          },
          {
            "text": "        if cloud_metrics and 'error' not in cloud_metrics:",
            "lineNumber": 944
          },
          {
            "text": "            # Aggregate metrics for each provider",
            "lineNumber": 945
          },
          {
            "text": "            for provider, metrics_list in cloud_metrics.items():",
            "lineNumber": 946
          },
          {
            "text": "                if not isinstance(metrics_list, list) or len(metrics_list) == 0:",
            "lineNumber": 947
          },
          {
            "text": "                    continue",
            "lineNumber": 948
          },
          {
            "text": "                ",
            "lineNumber": 949
          },
          {
            "text": "                try:",
            "lineNumber": 950
          }
        ]
      },
      "score": 0.36935821175575256
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 32
          },
          "endPosition": {
            "line": 246
          }
        },
        "contents": "class DatabaseConnection:\n\n    \n    def get_metrics(\n        self,\n        start_time: datetime,\n        end_time: datetime,\n        metric_type: Optional[str] = None\n    ) -&gt; List[Dict]:\n        \"\"\"\n        Retrieve metrics from database within a time range.\n        \n        Args:\n            start_time: Start of time range\n            end_time: End of time range\n            metric_type: Optional filter for specific metric type\n        \n        Returns:\n            List of metric dictionaries\n        \n        TODO: Implement metrics retrieval query\n        \"\"\"\n        # TODO: Implement metrics retrieval with time range filtering\n        return []\n    \n    def insert_alert(self, alert: Dict) -&gt; str:\n        \"\"\"\n        Insert an alert into database.\n        \n        Args:\n            alert: Dictionary containing alert data\n        \n        Returns:\n            Alert ID of inserted alert\n        \n        TODO: Implement alert insertion\n        \"\"\"\n        # TODO: Implement alert insertion into alerts table\n        return \"\"\n    \n    def get_alert(self, alert_id: str) -&gt; Optional[Dict]:\n        \"\"\"\n        Retrieve an alert by ID.\n        \n        Args:\n            alert_id: Unique identifier for the alert\n        \n        Returns:\n            Alert dictionary or None if not found\n        \n        TODO: Implement alert retrieval\n        \"\"\"\n        # TODO: Implement alert retrieval query\n        return None\n    \n    def list_alerts(\n        self,\n        status: Optional[str] = None,\n        severity: Optional[str] = None,\n        limit: int = 100\n    ) -&gt; List[Dict]:\n        ",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 33,
                "column": 1
              },
              "endPosition": {
                "line": 34,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class DatabaseConnection:",
            "lineNumber": 33,
            "isSignature": true
          },
          {
            "lineNumber": 97
          },
          {
            "text": "    ",
            "lineNumber": 98
          },
          {
            "text": "    def get_metrics(",
            "lineNumber": 99
          },
          {
            "text": "        self,",
            "lineNumber": 100
          },
          {
            "text": "        start_time: datetime,",
            "lineNumber": 101
          },
          {
            "text": "        end_time: datetime,",
            "lineNumber": 102
          },
          {
            "text": "        metric_type: Optional[str] = None",
            "lineNumber": 103
          },
          {
            "text": "    ) -&gt; List[Dict]:",
            "lineNumber": 104
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 105
          },
          {
            "text": "        Retrieve metrics from database within a time range.",
            "lineNumber": 106
          },
          {
            "text": "        ",
            "lineNumber": 107
          },
          {
            "text": "        Args:",
            "lineNumber": 108
          },
          {
            "text": "            start_time: Start of time range",
            "lineNumber": 109
          },
          {
            "text": "            end_time: End of time range",
            "lineNumber": 110
          },
          {
            "text": "            metric_type: Optional filter for specific metric type",
            "lineNumber": 111
          },
          {
            "text": "        ",
            "lineNumber": 112
          },
          {
            "text": "        Returns:",
            "lineNumber": 113
          },
          {
            "text": "            List of metric dictionaries",
            "lineNumber": 114
          },
          {
            "text": "        ",
            "lineNumber": 115
          },
          {
            "text": "        TODO: Implement metrics retrieval query",
            "lineNumber": 116
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 117
          },
          {
            "text": "        # TODO: Implement metrics retrieval with time range filtering",
            "lineNumber": 118
          },
          {
            "text": "        return []",
            "lineNumber": 119
          },
          {
            "text": "    ",
            "lineNumber": 120
          },
          {
            "text": "    def insert_alert(self, alert: Dict) -&gt; str:",
            "lineNumber": 121
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 122
          },
          {
            "text": "        Insert an alert into database.",
            "lineNumber": 123
          },
          {
            "text": "        ",
            "lineNumber": 124
          },
          {
            "text": "        Args:",
            "lineNumber": 125
          },
          {
            "text": "            alert: Dictionary containing alert data",
            "lineNumber": 126
          },
          {
            "text": "        ",
            "lineNumber": 127
          },
          {
            "text": "        Returns:",
            "lineNumber": 128
          },
          {
            "text": "            Alert ID of inserted alert",
            "lineNumber": 129
          },
          {
            "text": "        ",
            "lineNumber": 130
          },
          {
            "text": "        TODO: Implement alert insertion",
            "lineNumber": 131
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 132
          },
          {
            "text": "        # TODO: Implement alert insertion into alerts table",
            "lineNumber": 133
          },
          {
            "text": "        return \"\"",
            "lineNumber": 134
          },
          {
            "text": "    ",
            "lineNumber": 135
          },
          {
            "text": "    def get_alert(self, alert_id: str) -&gt; Optional[Dict]:",
            "lineNumber": 136
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 137
          },
          {
            "text": "        Retrieve an alert by ID.",
            "lineNumber": 138
          },
          {
            "text": "        ",
            "lineNumber": 139
          },
          {
            "text": "        Args:",
            "lineNumber": 140
          },
          {
            "text": "            alert_id: Unique identifier for the alert",
            "lineNumber": 141
          },
          {
            "text": "        ",
            "lineNumber": 142
          },
          {
            "text": "        Returns:",
            "lineNumber": 143
          },
          {
            "text": "            Alert dictionary or None if not found",
            "lineNumber": 144
          },
          {
            "text": "        ",
            "lineNumber": 145
          },
          {
            "text": "        TODO: Implement alert retrieval",
            "lineNumber": 146
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 147
          },
          {
            "text": "        # TODO: Implement alert retrieval query",
            "lineNumber": 148
          },
          {
            "text": "        return None",
            "lineNumber": 149
          },
          {
            "text": "    ",
            "lineNumber": 150
          },
          {
            "text": "    def list_alerts(",
            "lineNumber": 151
          },
          {
            "text": "        self,",
            "lineNumber": 152
          },
          {
            "text": "        status: Optional[str] = None,",
            "lineNumber": 153
          },
          {
            "text": "        severity: Optional[str] = None,",
            "lineNumber": 154
          },
          {
            "text": "        limit: int = 100",
            "lineNumber": 155
          },
          {
            "text": "    ) -&gt; List[Dict]:",
            "lineNumber": 156
          },
          {
            "text": "        ",
            "lineNumber": 157
          }
        ]
      },
      "score": 0.36748090386390686
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\cloud_metrics.py",
        "range": {
          "startPosition": {
            "line": 1080,
            "column": 9
          },
          "endPosition": {
            "line": 1148
          }
        },
        "contents": "def get_aws_metrics() -&gt; List[Dict]:\n    \"\"\"\n    Fetch AWS cloud usage metrics (compute, storage, network).\n    \n    This is a standalone function that collects metrics from AWS CloudWatch\n    for all EC2 instances (CPU utilization), S3 buckets (storage), and\n    network bandwidth metrics.\n    \n    Returns:\n        List of standardized metric dictionaries with format:\n        {\n            'provider': 'aws',\n            'metric_name': str,\n            'metric_value': float,\n            'timestamp': str (ISO format),\n            'resource_type': str ('Compute', 'Storage', 'Network')\n        }\n    \n    Raises:\n        RuntimeError: If boto3 not available or authentication fails\n    \"\"\"\n    settings = get_settings()\n    if settings is None:\n        raise RuntimeError(\"Settings not available\")\n    \n    aws_config = settings.get_cloud_config('aws')\n    collector = AWSMetricsCollector()\n    \n    if not collector.authenticate(aws_config):\n        raise RuntimeError(\"AWS authentication failed. Check your AWS credentials.\")\n    \n    return collector.get_aws_metrics()\n\n\ndef get_gcp_metrics() -&gt; List[Dict]:\n    \"\"\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "def get_aws_metrics() -&gt; List[Dict]:",
            "lineNumber": 1084,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 1085
          },
          {
            "text": "    Fetch AWS cloud usage metrics (compute, storage, network).",
            "lineNumber": 1086
          },
          {
            "text": "    ",
            "lineNumber": 1087
          },
          {
            "text": "    This is a standalone function that collects metrics from AWS CloudWatch",
            "lineNumber": 1088
          },
          {
            "text": "    for all EC2 instances (CPU utilization), S3 buckets (storage), and",
            "lineNumber": 1089
          },
          {
            "text": "    network bandwidth metrics.",
            "lineNumber": 1090
          },
          {
            "text": "    ",
            "lineNumber": 1091
          },
          {
            "text": "    Returns:",
            "lineNumber": 1092
          },
          {
            "text": "        List of standardized metric dictionaries with format:",
            "lineNumber": 1093
          },
          {
            "text": "        {",
            "lineNumber": 1094
          },
          {
            "text": "            'provider': 'aws',",
            "lineNumber": 1095
          },
          {
            "text": "            'metric_name': str,",
            "lineNumber": 1096
          },
          {
            "text": "            'metric_value': float,",
            "lineNumber": 1097
          },
          {
            "text": "            'timestamp': str (ISO format),",
            "lineNumber": 1098
          },
          {
            "text": "            'resource_type': str ('Compute', 'Storage', 'Network')",
            "lineNumber": 1099
          },
          {
            "text": "        }",
            "lineNumber": 1100
          },
          {
            "text": "    ",
            "lineNumber": 1101
          },
          {
            "text": "    Raises:",
            "lineNumber": 1102
          },
          {
            "text": "        RuntimeError: If boto3 not available or authentication fails",
            "lineNumber": 1103
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 1104
          },
          {
            "text": "    settings = get_settings()",
            "lineNumber": 1105
          },
          {
            "text": "    if settings is None:",
            "lineNumber": 1106
          },
          {
            "text": "        raise RuntimeError(\"Settings not available\")",
            "lineNumber": 1107
          },
          {
            "text": "    ",
            "lineNumber": 1108
          },
          {
            "text": "    aws_config = settings.get_cloud_config('aws')",
            "lineNumber": 1109
          },
          {
            "text": "    collector = AWSMetricsCollector()",
            "lineNumber": 1110
          },
          {
            "text": "    ",
            "lineNumber": 1111
          },
          {
            "text": "    if not collector.authenticate(aws_config):",
            "lineNumber": 1112
          },
          {
            "text": "        raise RuntimeError(\"AWS authentication failed. Check your AWS credentials.\")",
            "lineNumber": 1113
          },
          {
            "text": "    ",
            "lineNumber": 1114
          },
          {
            "text": "    return collector.get_aws_metrics()",
            "lineNumber": 1115,
            "isSignature": true
          },
          {
            "lineNumber": 1116
          },
          {
            "lineNumber": 1117
          },
          {
            "text": "def get_gcp_metrics() -&gt; List[Dict]:",
            "lineNumber": 1118,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 1119
          }
        ]
      },
      "score": 0.359521746635437
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\cloud_metrics.py",
        "range": {
          "startPosition": {
            "line": 117
          },
          "endPosition": {
            "line": 432
          }
        },
        "contents": "class AWSMetricsCollector(CloudProvider):\n\n    \n    def get_aws_metrics(self) -&gt; List[Dict]:\n        \"\"\"\n        Fetch AWS cloud usage metrics (compute, storage, network).\n        \n        Collects metrics from:\n        - EC2 instances: CPU utilization\n        - S3 buckets: Storage consumption\n        - EC2 instances: Network bandwidth (NetworkIn, NetworkOut)\n        \n        Returns:\n            List of standardized metric dictionaries\n        \n        Raises:\n            RuntimeError: If boto3 not available or authentication fails\n        \"\"\"\n        if not BOTO3_AVAILABLE:\n            raise RuntimeError(\n                \"boto3 library is not available. Please install it using: pip install boto3\"\n            )\n        \n        try:\n            settings = get_settings()\n            if settings is None:\n                raise RuntimeError(\"Settings not available\")\n            \n            # Get AWS configuration\n            aws_config = settings.get_cloud_config('aws')\n            if not aws_config.get('access_key') or not aws_config.get('secret_key'):\n                raise RuntimeError(\n                    \"AWS credentials not configured. Set AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY\"\n                )\n            \n            # Authenticate if not already done\n            if self.cloudwatch_client is None:\n                if not self.authenticate(aws_config):\n                    raise RuntimeError(\"AWS authentication failed\")\n            \n            # Get time window from settings\n            time_window_minutes = int(\n                os.getenv(\"CLOUD_METRICS_TIME_WINDOW_MINUTES\", \"5\")\n            )\n            end_time = datetime.utcnow()\n            start_time = end_time - timedelta(minutes=time_window_minutes)\n            \n            metrics = []\n            \n            # Get specific instance IDs from config if provided\n            instance_ids_filter = os.getenv(\"AWS_INSTANCE_IDS\", \"\").strip()\n            instance_ids = [i.strip() for i in instance_ids_filter.split(\",\") if i.strip()] if instance_ids_filter else None\n            \n            # Discover EC2 instances\n            try:",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 118,
                "column": 1
              },
              "endPosition": {
                "line": 119,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 128,
                "column": 5
              },
              "endPosition": {
                "line": 129,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class AWSMetricsCollector(CloudProvider):",
            "lineNumber": 118,
            "isSignature": true
          },
          {
            "lineNumber": 171
          },
          {
            "text": "    ",
            "lineNumber": 172
          },
          {
            "text": "    def get_aws_metrics(self) -&gt; List[Dict]:",
            "lineNumber": 173
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 174
          },
          {
            "text": "        Fetch AWS cloud usage metrics (compute, storage, network).",
            "lineNumber": 175
          },
          {
            "text": "        ",
            "lineNumber": 176
          },
          {
            "text": "        Collects metrics from:",
            "lineNumber": 177
          },
          {
            "text": "        - EC2 instances: CPU utilization",
            "lineNumber": 178
          },
          {
            "text": "        - S3 buckets: Storage consumption",
            "lineNumber": 179
          },
          {
            "text": "        - EC2 instances: Network bandwidth (NetworkIn, NetworkOut)",
            "lineNumber": 180
          },
          {
            "text": "        ",
            "lineNumber": 181
          },
          {
            "text": "        Returns:",
            "lineNumber": 182
          },
          {
            "text": "            List of standardized metric dictionaries",
            "lineNumber": 183
          },
          {
            "text": "        ",
            "lineNumber": 184
          },
          {
            "text": "        Raises:",
            "lineNumber": 185
          },
          {
            "text": "            RuntimeError: If boto3 not available or authentication fails",
            "lineNumber": 186
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 187
          },
          {
            "text": "        if not BOTO3_AVAILABLE:",
            "lineNumber": 188
          },
          {
            "text": "            raise RuntimeError(",
            "lineNumber": 189
          },
          {
            "text": "                \"boto3 library is not available. Please install it using: pip install boto3\"",
            "lineNumber": 190
          },
          {
            "text": "            )",
            "lineNumber": 191
          },
          {
            "text": "        ",
            "lineNumber": 192
          },
          {
            "text": "        try:",
            "lineNumber": 193
          },
          {
            "text": "            settings = get_settings()",
            "lineNumber": 194
          },
          {
            "text": "            if settings is None:",
            "lineNumber": 195
          },
          {
            "text": "                raise RuntimeError(\"Settings not available\")",
            "lineNumber": 196
          },
          {
            "text": "            ",
            "lineNumber": 197
          },
          {
            "text": "            # Get AWS configuration",
            "lineNumber": 198
          },
          {
            "text": "            aws_config = settings.get_cloud_config('aws')",
            "lineNumber": 199
          },
          {
            "text": "            if not aws_config.get('access_key') or not aws_config.get('secret_key'):",
            "lineNumber": 200
          },
          {
            "text": "                raise RuntimeError(",
            "lineNumber": 201
          },
          {
            "text": "                    \"AWS credentials not configured. Set AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY\"",
            "lineNumber": 202
          },
          {
            "text": "                )",
            "lineNumber": 203
          },
          {
            "text": "            ",
            "lineNumber": 204
          },
          {
            "text": "            # Authenticate if not already done",
            "lineNumber": 205
          },
          {
            "text": "            if self.cloudwatch_client is None:",
            "lineNumber": 206
          },
          {
            "text": "                if not self.authenticate(aws_config):",
            "lineNumber": 207
          },
          {
            "text": "                    raise RuntimeError(\"AWS authentication failed\")",
            "lineNumber": 208
          },
          {
            "text": "            ",
            "lineNumber": 209
          },
          {
            "text": "            # Get time window from settings",
            "lineNumber": 210
          },
          {
            "text": "            time_window_minutes = int(",
            "lineNumber": 211
          },
          {
            "text": "                os.getenv(\"CLOUD_METRICS_TIME_WINDOW_MINUTES\", \"5\")",
            "lineNumber": 212
          },
          {
            "text": "            )",
            "lineNumber": 213
          },
          {
            "text": "            end_time = datetime.utcnow()",
            "lineNumber": 214
          },
          {
            "text": "            start_time = end_time - timedelta(minutes=time_window_minutes)",
            "lineNumber": 215
          },
          {
            "text": "            ",
            "lineNumber": 216
          },
          {
            "text": "            metrics = []",
            "lineNumber": 217
          },
          {
            "text": "            ",
            "lineNumber": 218
          },
          {
            "text": "            # Get specific instance IDs from config if provided",
            "lineNumber": 219
          },
          {
            "text": "            instance_ids_filter = os.getenv(\"AWS_INSTANCE_IDS\", \"\").strip()",
            "lineNumber": 220
          },
          {
            "text": "            instance_ids = [i.strip() for i in instance_ids_filter.split(\",\") if i.strip()] if instance_ids_filter else None",
            "lineNumber": 221
          },
          {
            "text": "            ",
            "lineNumber": 222
          },
          {
            "text": "            # Discover EC2 instances",
            "lineNumber": 223
          },
          {
            "text": "            try:",
            "lineNumber": 224
          }
        ]
      },
      "score": 0.35216960310935974
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\cloud_metrics.py",
        "range": {
          "startPosition": {
            "line": 1148,
            "column": 38
          },
          "endPosition": {
            "line": 1217
          }
        },
        "contents": "def get_azure_metrics() -&gt; List[Dict]:\n    \"\"\"\n    Fetch Azure cloud usage metrics (compute, storage, network).\n    \n    This is a standalone function that collects metrics from Azure Monitor\n    for all Virtual Machines (CPU utilization), Blob Storage accounts\n    (storage consumption), and network bandwidth metrics.\n    \n    Returns:\n        List of standardized metric dictionaries with format:\n        {\n            'provider': 'azure',\n            'metric_name': str,\n            'metric_value': float,\n            'timestamp': str (ISO format),\n            'resource_type': str ('Compute', 'Storage', 'Network')\n        }\n    \n    Raises:\n        RuntimeError: If Azure Monitor not available or authentication fails\n    \"\"\"\n    settings = get_settings()\n    if settings is None:\n        raise RuntimeError(\"Settings not available\")\n    \n    azure_config = settings.get_cloud_config('azure')\n    collector = AzureMetricsCollector()\n    \n    if not collector.authenticate(azure_config):\n        raise RuntimeError(\"Azure authentication failed. Check your Azure credentials.\")\n    \n    return collector.get_azure_metrics()\n\n\ndef collect_cloud_metrics(provider: str, credentials: Dict) -&gt; Dict:\n    \"\"\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "def get_azure_metrics() -&gt; List[Dict]:",
            "lineNumber": 1152,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 1153
          },
          {
            "text": "    Fetch Azure cloud usage metrics (compute, storage, network).",
            "lineNumber": 1154
          },
          {
            "text": "    ",
            "lineNumber": 1155
          },
          {
            "text": "    This is a standalone function that collects metrics from Azure Monitor",
            "lineNumber": 1156
          },
          {
            "text": "    for all Virtual Machines (CPU utilization), Blob Storage accounts",
            "lineNumber": 1157
          },
          {
            "text": "    (storage consumption), and network bandwidth metrics.",
            "lineNumber": 1158
          },
          {
            "text": "    ",
            "lineNumber": 1159
          },
          {
            "text": "    Returns:",
            "lineNumber": 1160
          },
          {
            "text": "        List of standardized metric dictionaries with format:",
            "lineNumber": 1161
          },
          {
            "text": "        {",
            "lineNumber": 1162
          },
          {
            "text": "            'provider': 'azure',",
            "lineNumber": 1163
          },
          {
            "text": "            'metric_name': str,",
            "lineNumber": 1164
          },
          {
            "text": "            'metric_value': float,",
            "lineNumber": 1165
          },
          {
            "text": "            'timestamp': str (ISO format),",
            "lineNumber": 1166
          },
          {
            "text": "            'resource_type': str ('Compute', 'Storage', 'Network')",
            "lineNumber": 1167
          },
          {
            "text": "        }",
            "lineNumber": 1168
          },
          {
            "text": "    ",
            "lineNumber": 1169
          },
          {
            "text": "    Raises:",
            "lineNumber": 1170
          },
          {
            "text": "        RuntimeError: If Azure Monitor not available or authentication fails",
            "lineNumber": 1171
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 1172
          },
          {
            "text": "    settings = get_settings()",
            "lineNumber": 1173
          },
          {
            "text": "    if settings is None:",
            "lineNumber": 1174
          },
          {
            "text": "        raise RuntimeError(\"Settings not available\")",
            "lineNumber": 1175
          },
          {
            "text": "    ",
            "lineNumber": 1176
          },
          {
            "text": "    azure_config = settings.get_cloud_config('azure')",
            "lineNumber": 1177
          },
          {
            "text": "    collector = AzureMetricsCollector()",
            "lineNumber": 1178
          },
          {
            "text": "    ",
            "lineNumber": 1179
          },
          {
            "text": "    if not collector.authenticate(azure_config):",
            "lineNumber": 1180
          },
          {
            "text": "        raise RuntimeError(\"Azure authentication failed. Check your Azure credentials.\")",
            "lineNumber": 1181
          },
          {
            "text": "    ",
            "lineNumber": 1182
          },
          {
            "text": "    return collector.get_azure_metrics()",
            "lineNumber": 1183,
            "isSignature": true
          },
          {
            "lineNumber": 1184
          },
          {
            "lineNumber": 1185
          },
          {
            "text": "def collect_cloud_metrics(provider: str, credentials: Dict) -&gt; Dict:",
            "lineNumber": 1186,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 1187
          }
        ]
      },
      "score": 0.35038599371910095
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 496,
            "column": 20
          },
          "endPosition": {
            "line": 602
          }
        },
        "contents": "def store_metrics(cpu_data: Dict, memory_data: Dict, network_data: Dict) -&gt; bool:\n    \"\"\"\n    Store system metrics (CPU, memory, network) in the PostgreSQL database.\n    \n    Each metric type is stored as a separate row with the appropriate\n    resource_type. The function uses a single transaction to ensure\n    all three inserts succeed or fail together.\n    \n    Args:\n        cpu_data: Dictionary from get_cpu_usage() containing cpu_percent and timestamp\n        memory_data: Dictionary from get_memory_usage() containing percent/used and timestamp\n        network_data: Dictionary from get_network_traffic() containing bytes_sent/bytes_recv and timestamp\n    \n    Returns:\n        True if all metrics stored successfully, False otherwise\n    \"\"\"\n    conn = None\n    try:\n        # Establish database connection\n        conn = connect_to_db()\n        if conn is None:\n            print(\"Failed to establish database connection\")\n            return False\n        \n        cursor = conn.cursor()\n        \n        # Extract values from metric dictionaries\n        # CPU metric\n        cpu_usage = cpu_data.get('cpu_percent', 0.0)\n        cpu_timestamp = cpu_data.get('timestamp')\n        if isinstance(cpu_timestamp, datetime):\n            cpu_timestamp = cpu_timestamp\n        else:\n            cpu_timestamp = datetime.now()\n        \n        # Memory metric - use percent if available, otherwise use used bytes\n        memory_usage = memory_data.get('percent')\n        if memory_usage is None:\n            memory_usage = memory_data.get('used', 0)\n        memory_timestamp = memory_data.get('timestamp')\n        if isinstance(memory_timestamp, datetime):\n            memory_timestamp = memory_timestamp\n        else:\n            memory_timestamp = datetime.now()\n        \n        # Network metric - sum of bytes sent and received\n        bytes_sent = network_data.get('bytes_sent', 0)\n        bytes_recv = network_data.get('bytes_recv', 0)\n        network_traffic = bytes_sent + bytes_recv\n        network_timestamp = network_data.get('timestamp')\n        if isinstance(network_timestamp, datetime):",
        "signatures": {},
        "detailedLines": [
          {
            "text": "def store_metrics(cpu_data: Dict, memory_data: Dict, network_data: Dict) -&gt; bool:",
            "lineNumber": 500,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 501
          },
          {
            "text": "    Store system metrics (CPU, memory, network) in the PostgreSQL database.",
            "lineNumber": 502
          },
          {
            "text": "    ",
            "lineNumber": 503
          },
          {
            "text": "    Each metric type is stored as a separate row with the appropriate",
            "lineNumber": 504
          },
          {
            "text": "    resource_type. The function uses a single transaction to ensure",
            "lineNumber": 505
          },
          {
            "text": "    all three inserts succeed or fail together.",
            "lineNumber": 506
          },
          {
            "text": "    ",
            "lineNumber": 507
          },
          {
            "text": "    Args:",
            "lineNumber": 508
          },
          {
            "text": "        cpu_data: Dictionary from get_cpu_usage() containing cpu_percent and timestamp",
            "lineNumber": 509
          },
          {
            "text": "        memory_data: Dictionary from get_memory_usage() containing percent/used and timestamp",
            "lineNumber": 510
          },
          {
            "text": "        network_data: Dictionary from get_network_traffic() containing bytes_sent/bytes_recv and timestamp",
            "lineNumber": 511
          },
          {
            "text": "    ",
            "lineNumber": 512
          },
          {
            "text": "    Returns:",
            "lineNumber": 513
          },
          {
            "text": "        True if all metrics stored successfully, False otherwise",
            "lineNumber": 514
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 515
          },
          {
            "text": "    conn = None",
            "lineNumber": 516
          },
          {
            "text": "    try:",
            "lineNumber": 517
          },
          {
            "text": "        # Establish database connection",
            "lineNumber": 518
          },
          {
            "text": "        conn = connect_to_db()",
            "lineNumber": 519
          },
          {
            "text": "        if conn is None:",
            "lineNumber": 520
          },
          {
            "text": "            print(\"Failed to establish database connection\")",
            "lineNumber": 521
          },
          {
            "text": "            return False",
            "lineNumber": 522
          },
          {
            "text": "        ",
            "lineNumber": 523
          },
          {
            "text": "        cursor = conn.cursor()",
            "lineNumber": 524
          },
          {
            "text": "        ",
            "lineNumber": 525
          },
          {
            "text": "        # Extract values from metric dictionaries",
            "lineNumber": 526
          },
          {
            "text": "        # CPU metric",
            "lineNumber": 527
          },
          {
            "text": "        cpu_usage = cpu_data.get('cpu_percent', 0.0)",
            "lineNumber": 528
          },
          {
            "text": "        cpu_timestamp = cpu_data.get('timestamp')",
            "lineNumber": 529
          },
          {
            "text": "        if isinstance(cpu_timestamp, datetime):",
            "lineNumber": 530
          },
          {
            "text": "            cpu_timestamp = cpu_timestamp",
            "lineNumber": 531
          },
          {
            "text": "        else:",
            "lineNumber": 532
          },
          {
            "text": "            cpu_timestamp = datetime.now()",
            "lineNumber": 533
          },
          {
            "text": "        ",
            "lineNumber": 534
          },
          {
            "text": "        # Memory metric - use percent if available, otherwise use used bytes",
            "lineNumber": 535
          },
          {
            "text": "        memory_usage = memory_data.get('percent')",
            "lineNumber": 536
          },
          {
            "text": "        if memory_usage is None:",
            "lineNumber": 537
          },
          {
            "text": "            memory_usage = memory_data.get('used', 0)",
            "lineNumber": 538
          },
          {
            "text": "        memory_timestamp = memory_data.get('timestamp')",
            "lineNumber": 539
          },
          {
            "text": "        if isinstance(memory_timestamp, datetime):",
            "lineNumber": 540
          },
          {
            "text": "            memory_timestamp = memory_timestamp",
            "lineNumber": 541
          },
          {
            "text": "        else:",
            "lineNumber": 542
          },
          {
            "text": "            memory_timestamp = datetime.now()",
            "lineNumber": 543
          },
          {
            "text": "        ",
            "lineNumber": 544
          },
          {
            "text": "        # Network metric - sum of bytes sent and received",
            "lineNumber": 545
          },
          {
            "text": "        bytes_sent = network_data.get('bytes_sent', 0)",
            "lineNumber": 546
          },
          {
            "text": "        bytes_recv = network_data.get('bytes_recv', 0)",
            "lineNumber": 547
          },
          {
            "text": "        network_traffic = bytes_sent + bytes_recv",
            "lineNumber": 548
          },
          {
            "text": "        network_timestamp = network_data.get('timestamp')",
            "lineNumber": 549
          },
          {
            "text": "        if isinstance(network_timestamp, datetime):",
            "lineNumber": 550
          }
        ]
      },
      "score": 0.3469938039779663
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 885
          },
          "endPosition": {
            "line": 1024
          }
        },
        "contents": "def store_all_metrics_unified(all_metrics: Dict) -&gt; bool:\n\n                if not isinstance(metrics_list, list) or len(metrics_list) == 0:\n                    continue\n                \n                try:\n                    # Initialize aggregation variables\n                    cloud_compute_sum = 0.0\n                    cloud_storage_sum = 0.0\n                    cloud_bandwidth_sum = 0.0\n                    provider_timestamp = server_timestamp  # Default to server timestamp\n                    \n                    # Aggregate cloud metrics by resource type\n                    for metric in metrics_list:\n                        if not isinstance(metric, dict):\n                            continue\n                        \n                        resource_type = metric.get('resource_type', '').lower()\n                        metric_name = metric.get('metric_name', '').lower()\n                        metric_value = metric.get('metric_value', 0.0)\n                        \n                        # Get timestamp from first metric (or use server timestamp)\n                        metric_timestamp = metric.get('timestamp')\n                        if metric_timestamp and provider_timestamp == server_timestamp:\n                            if isinstance(metric_timestamp, str):\n                                try:\n                                    provider_timestamp = datetime.fromisoformat(metric_timestamp.replace('Z', '+00:00'))\n                                except (ValueError, AttributeError):\n                                    pass\n                            elif isinstance(metric_timestamp, datetime):\n                                provider_timestamp = metric_timestamp\n                        \n                        ",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 886,
                "column": 1
              },
              "endPosition": {
                "line": 887,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "def store_all_metrics_unified(all_metrics: Dict) -&gt; bool:",
            "lineNumber": 886,
            "isSignature": true
          },
          {
            "lineNumber": 946
          },
          {
            "text": "                if not isinstance(metrics_list, list) or len(metrics_list) == 0:",
            "lineNumber": 947
          },
          {
            "text": "                    continue",
            "lineNumber": 948
          },
          {
            "text": "                ",
            "lineNumber": 949
          },
          {
            "text": "                try:",
            "lineNumber": 950
          },
          {
            "text": "                    # Initialize aggregation variables",
            "lineNumber": 951
          },
          {
            "text": "                    cloud_compute_sum = 0.0",
            "lineNumber": 952
          },
          {
            "text": "                    cloud_storage_sum = 0.0",
            "lineNumber": 953
          },
          {
            "text": "                    cloud_bandwidth_sum = 0.0",
            "lineNumber": 954
          },
          {
            "text": "                    provider_timestamp = server_timestamp  # Default to server timestamp",
            "lineNumber": 955
          },
          {
            "text": "                    ",
            "lineNumber": 956
          },
          {
            "text": "                    # Aggregate cloud metrics by resource type",
            "lineNumber": 957
          },
          {
            "text": "                    for metric in metrics_list:",
            "lineNumber": 958
          },
          {
            "text": "                        if not isinstance(metric, dict):",
            "lineNumber": 959
          },
          {
            "text": "                            continue",
            "lineNumber": 960
          },
          {
            "text": "                        ",
            "lineNumber": 961
          },
          {
            "text": "                        resource_type = metric.get('resource_type', '').lower()",
            "lineNumber": 962
          },
          {
            "text": "                        metric_name = metric.get('metric_name', '').lower()",
            "lineNumber": 963
          },
          {
            "text": "                        metric_value = metric.get('metric_value', 0.0)",
            "lineNumber": 964
          },
          {
            "text": "                        ",
            "lineNumber": 965
          },
          {
            "text": "                        # Get timestamp from first metric (or use server timestamp)",
            "lineNumber": 966
          },
          {
            "text": "                        metric_timestamp = metric.get('timestamp')",
            "lineNumber": 967
          },
          {
            "text": "                        if metric_timestamp and provider_timestamp == server_timestamp:",
            "lineNumber": 968
          },
          {
            "text": "                            if isinstance(metric_timestamp, str):",
            "lineNumber": 969
          },
          {
            "text": "                                try:",
            "lineNumber": 970
          },
          {
            "text": "                                    provider_timestamp = datetime.fromisoformat(metric_timestamp.replace('Z', '+00:00'))",
            "lineNumber": 971
          },
          {
            "text": "                                except (ValueError, AttributeError):",
            "lineNumber": 972
          },
          {
            "text": "                                    pass",
            "lineNumber": 973
          },
          {
            "text": "                            elif isinstance(metric_timestamp, datetime):",
            "lineNumber": 974
          },
          {
            "text": "                                provider_timestamp = metric_timestamp",
            "lineNumber": 975
          },
          {
            "text": "                        ",
            "lineNumber": 976
          },
          {
            "text": "                        ",
            "lineNumber": 977
          }
        ]
      },
      "score": 0.3438166379928589
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\cloud_metrics.py",
        "range": {
          "startPosition": {
            "line": 1114,
            "column": 38
          },
          "endPosition": {
            "line": 1182
          }
        },
        "contents": "def get_gcp_metrics() -&gt; List[Dict]:\n    \"\"\"\n    Fetch GCP cloud usage metrics (compute, storage, network).\n    \n    This is a standalone function that collects metrics from Google Cloud\n    Monitoring for all Compute Engine instances (CPU utilization), Cloud\n    Storage buckets (storage), and network egress metrics.\n    \n    Returns:\n        List of standardized metric dictionaries with format:\n        {\n            'provider': 'gcp',\n            'metric_name': str,\n            'metric_value': float,\n            'timestamp': str (ISO format),\n            'resource_type': str ('Compute', 'Storage', 'Network')\n        }\n    \n    Raises:\n        RuntimeError: If Google Cloud Monitoring not available or authentication fails\n    \"\"\"\n    settings = get_settings()\n    if settings is None:\n        raise RuntimeError(\"Settings not available\")\n    \n    gcp_config = settings.get_cloud_config('gcp')\n    collector = GCPMetricsCollector()\n    \n    if not collector.authenticate(gcp_config):\n        raise RuntimeError(\"GCP authentication failed. Check your GCP credentials.\")\n    \n    return collector.get_gcp_metrics()\n\n\ndef get_azure_metrics() -&gt; List[Dict]:\n    \"\"\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "def get_gcp_metrics() -&gt; List[Dict]:",
            "lineNumber": 1118,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 1119
          },
          {
            "text": "    Fetch GCP cloud usage metrics (compute, storage, network).",
            "lineNumber": 1120
          },
          {
            "text": "    ",
            "lineNumber": 1121
          },
          {
            "text": "    This is a standalone function that collects metrics from Google Cloud",
            "lineNumber": 1122
          },
          {
            "text": "    Monitoring for all Compute Engine instances (CPU utilization), Cloud",
            "lineNumber": 1123
          },
          {
            "text": "    Storage buckets (storage), and network egress metrics.",
            "lineNumber": 1124
          },
          {
            "text": "    ",
            "lineNumber": 1125
          },
          {
            "text": "    Returns:",
            "lineNumber": 1126
          },
          {
            "text": "        List of standardized metric dictionaries with format:",
            "lineNumber": 1127
          },
          {
            "text": "        {",
            "lineNumber": 1128
          },
          {
            "text": "            'provider': 'gcp',",
            "lineNumber": 1129
          },
          {
            "text": "            'metric_name': str,",
            "lineNumber": 1130
          },
          {
            "text": "            'metric_value': float,",
            "lineNumber": 1131
          },
          {
            "text": "            'timestamp': str (ISO format),",
            "lineNumber": 1132
          },
          {
            "text": "            'resource_type': str ('Compute', 'Storage', 'Network')",
            "lineNumber": 1133
          },
          {
            "text": "        }",
            "lineNumber": 1134
          },
          {
            "text": "    ",
            "lineNumber": 1135
          },
          {
            "text": "    Raises:",
            "lineNumber": 1136
          },
          {
            "text": "        RuntimeError: If Google Cloud Monitoring not available or authentication fails",
            "lineNumber": 1137
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 1138
          },
          {
            "text": "    settings = get_settings()",
            "lineNumber": 1139
          },
          {
            "text": "    if settings is None:",
            "lineNumber": 1140
          },
          {
            "text": "        raise RuntimeError(\"Settings not available\")",
            "lineNumber": 1141
          },
          {
            "text": "    ",
            "lineNumber": 1142
          },
          {
            "text": "    gcp_config = settings.get_cloud_config('gcp')",
            "lineNumber": 1143
          },
          {
            "text": "    collector = GCPMetricsCollector()",
            "lineNumber": 1144
          },
          {
            "text": "    ",
            "lineNumber": 1145
          },
          {
            "text": "    if not collector.authenticate(gcp_config):",
            "lineNumber": 1146
          },
          {
            "text": "        raise RuntimeError(\"GCP authentication failed. Check your GCP credentials.\")",
            "lineNumber": 1147
          },
          {
            "text": "    ",
            "lineNumber": 1148
          },
          {
            "text": "    return collector.get_gcp_metrics()",
            "lineNumber": 1149,
            "isSignature": true
          },
          {
            "lineNumber": 1150
          },
          {
            "lineNumber": 1151
          },
          {
            "text": "def get_azure_metrics() -&gt; List[Dict]:",
            "lineNumber": 1152,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 1153
          }
        ]
      },
      "score": 0.3421142101287842
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 499
          },
          "endPosition": {
            "line": 758
          }
        },
        "contents": "def store_metrics(cpu_data: Dict, memory_data: Dict, network_data: Dict) -&gt; bool:\n\n        network_timestamp = network_data.get('timestamp')\n        if isinstance(network_timestamp, datetime):\n            network_timestamp = network_timestamp\n        else:\n            network_timestamp = datetime.now()\n        \n        # Use the earliest timestamp from all metrics (or current time)\n        # This ensures all three rows have the same timestamp\n        timestamps = [cpu_timestamp, memory_timestamp, network_timestamp]\n        metric_timestamp = min(timestamps) if timestamps else datetime.now()\n        \n        # Insert query template\n        insert_query = \"\"\"\n            INSERT INTO system_metrics (cpu_usage, memory_usage, network_traffic, timestamp, resource_type)\n            VALUES (%s, %s, %s, %s, %s);\n        \"\"\"\n        \n        # Insert CPU metric\n        cursor.execute(\n            insert_query,\n            (cpu_usage, None, None, metric_timestamp, 'CPU')\n        )\n        \n        # Insert Memory metric\n        cursor.execute(\n            insert_query,\n            (None, memory_usage, None, metric_timestamp, 'Memory')\n        )\n        \n        # Insert Network metric\n        cursor.execute(\n            insert_query,\n            (None, None, network_traffic, metric_timestamp, 'Network')\n        )\n        \n        # Commit transaction only after all three inserts succeed\n        conn.commit()\n        cursor.close()\n        \n        return True\n    \n    except Error as e:\n        print(f\"Error storing metrics in database: {e}\")\n        if conn:\n            conn.rollback()\n        return False\n    except Exception as e:\n        print(f\"Unexpected error storing metrics: {e}\")\n        if conn:\n            conn.rollback()\n        return False\n    finally:\n        # Ensure connection is closed\n        if conn:\n            conn.close()\n\n\ndef store_all_metrics(all_metrics: Dict) -&gt; bool:\n    \"\"\"",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 500,
                "column": 1
              },
              "endPosition": {
                "line": 501,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "def store_metrics(cpu_data: Dict, memory_data: Dict, network_data: Dict) -&gt; bool:",
            "lineNumber": 500,
            "isSignature": true
          },
          {
            "lineNumber": 548
          },
          {
            "text": "        network_timestamp = network_data.get('timestamp')",
            "lineNumber": 549
          },
          {
            "text": "        if isinstance(network_timestamp, datetime):",
            "lineNumber": 550
          },
          {
            "text": "            network_timestamp = network_timestamp",
            "lineNumber": 551
          },
          {
            "text": "        else:",
            "lineNumber": 552
          },
          {
            "text": "            network_timestamp = datetime.now()",
            "lineNumber": 553
          },
          {
            "text": "        ",
            "lineNumber": 554
          },
          {
            "text": "        # Use the earliest timestamp from all metrics (or current time)",
            "lineNumber": 555
          },
          {
            "text": "        # This ensures all three rows have the same timestamp",
            "lineNumber": 556
          },
          {
            "text": "        timestamps = [cpu_timestamp, memory_timestamp, network_timestamp]",
            "lineNumber": 557
          },
          {
            "text": "        metric_timestamp = min(timestamps) if timestamps else datetime.now()",
            "lineNumber": 558
          },
          {
            "text": "        ",
            "lineNumber": 559
          },
          {
            "text": "        # Insert query template",
            "lineNumber": 560
          },
          {
            "text": "        insert_query = \"\"\"",
            "lineNumber": 561
          },
          {
            "text": "            INSERT INTO system_metrics (cpu_usage, memory_usage, network_traffic, timestamp, resource_type)",
            "lineNumber": 562
          },
          {
            "text": "            VALUES (%s, %s, %s, %s, %s);",
            "lineNumber": 563
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 564
          },
          {
            "text": "        ",
            "lineNumber": 565
          },
          {
            "text": "        # Insert CPU metric",
            "lineNumber": 566
          },
          {
            "text": "        cursor.execute(",
            "lineNumber": 567
          },
          {
            "text": "            insert_query,",
            "lineNumber": 568
          },
          {
            "text": "            (cpu_usage, None, None, metric_timestamp, 'CPU')",
            "lineNumber": 569
          },
          {
            "text": "        )",
            "lineNumber": 570
          },
          {
            "text": "        ",
            "lineNumber": 571
          },
          {
            "text": "        # Insert Memory metric",
            "lineNumber": 572
          },
          {
            "text": "        cursor.execute(",
            "lineNumber": 573
          },
          {
            "text": "            insert_query,",
            "lineNumber": 574
          },
          {
            "text": "            (None, memory_usage, None, metric_timestamp, 'Memory')",
            "lineNumber": 575
          },
          {
            "text": "        )",
            "lineNumber": 576
          },
          {
            "text": "        ",
            "lineNumber": 577
          },
          {
            "text": "        # Insert Network metric",
            "lineNumber": 578
          },
          {
            "text": "        cursor.execute(",
            "lineNumber": 579
          },
          {
            "text": "            insert_query,",
            "lineNumber": 580
          },
          {
            "text": "            (None, None, network_traffic, metric_timestamp, 'Network')",
            "lineNumber": 581
          },
          {
            "text": "        )",
            "lineNumber": 582
          },
          {
            "text": "        ",
            "lineNumber": 583
          },
          {
            "text": "        # Commit transaction only after all three inserts succeed",
            "lineNumber": 584
          },
          {
            "text": "        conn.commit()",
            "lineNumber": 585
          },
          {
            "text": "        cursor.close()",
            "lineNumber": 586
          },
          {
            "text": "        ",
            "lineNumber": 587
          },
          {
            "text": "        return True",
            "lineNumber": 588
          },
          {
            "text": "    ",
            "lineNumber": 589
          },
          {
            "text": "    except Error as e:",
            "lineNumber": 590
          },
          {
            "text": "        print(f\"Error storing metrics in database: {e}\")",
            "lineNumber": 591
          },
          {
            "text": "        if conn:",
            "lineNumber": 592
          },
          {
            "text": "            conn.rollback()",
            "lineNumber": 593
          },
          {
            "text": "        return False",
            "lineNumber": 594
          },
          {
            "text": "    except Exception as e:",
            "lineNumber": 595
          },
          {
            "text": "        print(f\"Unexpected error storing metrics: {e}\")",
            "lineNumber": 596
          },
          {
            "text": "        if conn:",
            "lineNumber": 597
          },
          {
            "text": "            conn.rollback()",
            "lineNumber": 598
          },
          {
            "text": "        return False",
            "lineNumber": 599
          },
          {
            "text": "    finally:",
            "lineNumber": 600
          },
          {
            "text": "        # Ensure connection is closed",
            "lineNumber": 601
          },
          {
            "text": "        if conn:",
            "lineNumber": 602
          },
          {
            "text": "            conn.close()",
            "lineNumber": 603,
            "isSignature": true
          },
          {
            "lineNumber": 604
          },
          {
            "lineNumber": 605
          },
          {
            "text": "def store_all_metrics(all_metrics: Dict) -&gt; bool:",
            "lineNumber": 606,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 607
          }
        ]
      },
      "score": 0.3410125970840454
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\system_metrics.py",
        "range": {
          "startPosition": {
            "line": 256,
            "column": 71
          },
          "endPosition": {
            "line": 347
          }
        },
        "contents": "def get_server_metrics() -&gt; Dict:\n    \"\"\"\n    Collect server load metrics (CPU and memory) with timestamp.\n    \n    Returns:\n        Dictionary containing:\n            - cpu_usage: float (CPU usage percentage)\n            - memory_usage: float (Memory usage percentage)\n            - timestamp: datetime (exact capture time)\n    \n    Raises:\n        RuntimeError: If psutil is not available or metrics cannot be collected\n    \"\"\"\n    if not PSUTIL_AVAILABLE:\n        raise RuntimeError(\"psutil library is not available. Please install it using: pip install psutil\")\n    \n    try:\n        # Collect CPU and memory usage percentages\n        cpu_usage = get_cpu_usage_percent()\n        memory_usage = get_memory_usage_percent()\n        \n        # Capture timestamp when metrics are collected\n        timestamp = datetime.now()\n        \n        return {\n            'cpu_usage': cpu_usage,\n            'memory_usage': memory_usage,\n            'timestamp': timestamp\n        }\n    except RuntimeError:\n        # Re-raise RuntimeError from helper functions\n        raise\n    except Exception as e:\n        raise RuntimeError(f\"Failed to collect server metrics: {str(e)}\")\n\n\ndef collect_and_store_metrics() -&gt; bool:\n    \"\"\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "def get_server_metrics() -&gt; Dict:",
            "lineNumber": 260,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 261
          },
          {
            "text": "    Collect server load metrics (CPU and memory) with timestamp.",
            "lineNumber": 262
          },
          {
            "text": "    ",
            "lineNumber": 263
          },
          {
            "text": "    Returns:",
            "lineNumber": 264
          },
          {
            "text": "        Dictionary containing:",
            "lineNumber": 265
          },
          {
            "text": "            - cpu_usage: float (CPU usage percentage)",
            "lineNumber": 266
          },
          {
            "text": "            - memory_usage: float (Memory usage percentage)",
            "lineNumber": 267
          },
          {
            "text": "            - timestamp: datetime (exact capture time)",
            "lineNumber": 268
          },
          {
            "text": "    ",
            "lineNumber": 269
          },
          {
            "text": "    Raises:",
            "lineNumber": 270
          },
          {
            "text": "        RuntimeError: If psutil is not available or metrics cannot be collected",
            "lineNumber": 271
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 272
          },
          {
            "text": "    if not PSUTIL_AVAILABLE:",
            "lineNumber": 273
          },
          {
            "text": "        raise RuntimeError(\"psutil library is not available. Please install it using: pip install psutil\")",
            "lineNumber": 274
          },
          {
            "text": "    ",
            "lineNumber": 275
          },
          {
            "text": "    try:",
            "lineNumber": 276
          },
          {
            "text": "        # Collect CPU and memory usage percentages",
            "lineNumber": 277
          },
          {
            "text": "        cpu_usage = get_cpu_usage_percent()",
            "lineNumber": 278
          },
          {
            "text": "        memory_usage = get_memory_usage_percent()",
            "lineNumber": 279
          },
          {
            "text": "        ",
            "lineNumber": 280
          },
          {
            "text": "        # Capture timestamp when metrics are collected",
            "lineNumber": 281
          },
          {
            "text": "        timestamp = datetime.now()",
            "lineNumber": 282
          },
          {
            "text": "        ",
            "lineNumber": 283
          },
          {
            "text": "        return {",
            "lineNumber": 284
          },
          {
            "text": "            'cpu_usage': cpu_usage,",
            "lineNumber": 285
          },
          {
            "text": "            'memory_usage': memory_usage,",
            "lineNumber": 286
          },
          {
            "text": "            'timestamp': timestamp",
            "lineNumber": 287
          },
          {
            "text": "        }",
            "lineNumber": 288
          },
          {
            "text": "    except RuntimeError:",
            "lineNumber": 289
          },
          {
            "text": "        # Re-raise RuntimeError from helper functions",
            "lineNumber": 290
          },
          {
            "text": "        raise",
            "lineNumber": 291
          },
          {
            "text": "    except Exception as e:",
            "lineNumber": 292
          },
          {
            "text": "        raise RuntimeError(f\"Failed to collect server metrics: {str(e)}\")",
            "lineNumber": 293,
            "isSignature": true
          },
          {
            "lineNumber": 294
          },
          {
            "lineNumber": 295
          },
          {
            "text": "def collect_and_store_metrics() -&gt; bool:",
            "lineNumber": 296,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 297
          }
        ]
      },
      "score": 0.3373599052429199
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 29,
            "column": 19
          },
          "endPosition": {
            "line": 246
          }
        },
        "contents": "class DatabaseConnection:\n    \"\"\"Manages database connection and operations.\"\"\"\n    \n    def __init__(self, connection_string: str):\n        \"\"\"\n        Initialize database connection.\n        \n        Args:\n            connection_string: PostgreSQL connection string\n        \n        TODO: Implement database connection initialization\n        \"\"\"\n        self.connection_string = connection_string\n        self.connection = None\n        # TODO: Initialize database connection using psycopg2 or SQLAlchemy\n    \n    def connect(self) -&gt; bool:\n        \"\"\"\n        Establish database connection.\n        \n        Returns:\n            True if connection successful, False otherwise\n        \n        TODO: Implement connection establishment\n        \"\"\"\n        # TODO: Implement database connection\n        return False\n    \n    def disconnect(self):\n        \"\"\"Close database connection.\"\"\"\n        # TODO: Implement connection cleanup\n        if self.connection:\n            # TODO: Close connection\n            self.connection = None\n    \n    def execute_query(self, query: str, params: Optional[Dict] = None) -&gt; List[Dict]:\n        \"\"\"\n        Execute a SQL query.\n        \n        Args:\n            query: SQL query string\n            params: Optional query parameters\n        \n        Returns:\n            List of result dictionaries\n        \n        TODO: Implement query execution\n        \"\"\"\n        # TODO: Implement query execution with parameter binding\n        return []\n    \n    def insert_metrics(self, metrics: Dict) -&gt; bool:\n        \"\"\"\n        Insert metrics into database.\n        \n        Args:\n            metrics: Dictionary containing metrics data\n        \n        Returns:\n            True if insertion successful, False otherwise\n        \n        TODO: Implement metrics insertion\n        \"\"\"\n        # TODO: Implement metrics insertion into metrics table\n        return False\n    \n    def get_metrics(\n        self,\n        start_time: datetime,\n        end_time: datetime,\n        metric_type: Optional[str] = None\n    ) -&gt; List[Dict]:\n        ",
        "signatures": {},
        "detailedLines": [
          {
            "text": "class DatabaseConnection:",
            "lineNumber": 33,
            "isSignature": true
          },
          {
            "text": "    \"\"\"Manages database connection and operations.\"\"\"",
            "lineNumber": 34
          },
          {
            "text": "    ",
            "lineNumber": 35
          },
          {
            "text": "    def __init__(self, connection_string: str):",
            "lineNumber": 36
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 37
          },
          {
            "text": "        Initialize database connection.",
            "lineNumber": 38
          },
          {
            "text": "        ",
            "lineNumber": 39
          },
          {
            "text": "        Args:",
            "lineNumber": 40
          },
          {
            "text": "            connection_string: PostgreSQL connection string",
            "lineNumber": 41
          },
          {
            "text": "        ",
            "lineNumber": 42
          },
          {
            "text": "        TODO: Implement database connection initialization",
            "lineNumber": 43
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 44
          },
          {
            "text": "        self.connection_string = connection_string",
            "lineNumber": 45
          },
          {
            "text": "        self.connection = None",
            "lineNumber": 46
          },
          {
            "text": "        # TODO: Initialize database connection using psycopg2 or SQLAlchemy",
            "lineNumber": 47
          },
          {
            "text": "    ",
            "lineNumber": 48
          },
          {
            "text": "    def connect(self) -&gt; bool:",
            "lineNumber": 49
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 50
          },
          {
            "text": "        Establish database connection.",
            "lineNumber": 51
          },
          {
            "text": "        ",
            "lineNumber": 52
          },
          {
            "text": "        Returns:",
            "lineNumber": 53
          },
          {
            "text": "            True if connection successful, False otherwise",
            "lineNumber": 54
          },
          {
            "text": "        ",
            "lineNumber": 55
          },
          {
            "text": "        TODO: Implement connection establishment",
            "lineNumber": 56
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 57
          },
          {
            "text": "        # TODO: Implement database connection",
            "lineNumber": 58
          },
          {
            "text": "        return False",
            "lineNumber": 59
          },
          {
            "text": "    ",
            "lineNumber": 60
          },
          {
            "text": "    def disconnect(self):",
            "lineNumber": 61
          },
          {
            "text": "        \"\"\"Close database connection.\"\"\"",
            "lineNumber": 62
          },
          {
            "text": "        # TODO: Implement connection cleanup",
            "lineNumber": 63
          },
          {
            "text": "        if self.connection:",
            "lineNumber": 64
          },
          {
            "text": "            # TODO: Close connection",
            "lineNumber": 65
          },
          {
            "text": "            self.connection = None",
            "lineNumber": 66
          },
          {
            "text": "    ",
            "lineNumber": 67
          },
          {
            "text": "    def execute_query(self, query: str, params: Optional[Dict] = None) -&gt; List[Dict]:",
            "lineNumber": 68
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 69
          },
          {
            "text": "        Execute a SQL query.",
            "lineNumber": 70
          },
          {
            "text": "        ",
            "lineNumber": 71
          },
          {
            "text": "        Args:",
            "lineNumber": 72
          },
          {
            "text": "            query: SQL query string",
            "lineNumber": 73
          },
          {
            "text": "            params: Optional query parameters",
            "lineNumber": 74
          },
          {
            "text": "        ",
            "lineNumber": 75
          },
          {
            "text": "        Returns:",
            "lineNumber": 76
          },
          {
            "text": "            List of result dictionaries",
            "lineNumber": 77
          },
          {
            "text": "        ",
            "lineNumber": 78
          },
          {
            "text": "        TODO: Implement query execution",
            "lineNumber": 79
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 80
          },
          {
            "text": "        # TODO: Implement query execution with parameter binding",
            "lineNumber": 81
          },
          {
            "text": "        return []",
            "lineNumber": 82
          },
          {
            "text": "    ",
            "lineNumber": 83
          },
          {
            "text": "    def insert_metrics(self, metrics: Dict) -&gt; bool:",
            "lineNumber": 84
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 85
          },
          {
            "text": "        Insert metrics into database.",
            "lineNumber": 86
          },
          {
            "text": "        ",
            "lineNumber": 87
          },
          {
            "text": "        Args:",
            "lineNumber": 88
          },
          {
            "text": "            metrics: Dictionary containing metrics data",
            "lineNumber": 89
          },
          {
            "text": "        ",
            "lineNumber": 90
          },
          {
            "text": "        Returns:",
            "lineNumber": 91
          },
          {
            "text": "            True if insertion successful, False otherwise",
            "lineNumber": 92
          },
          {
            "text": "        ",
            "lineNumber": 93
          },
          {
            "text": "        TODO: Implement metrics insertion",
            "lineNumber": 94
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 95
          },
          {
            "text": "        # TODO: Implement metrics insertion into metrics table",
            "lineNumber": 96
          },
          {
            "text": "        return False",
            "lineNumber": 97
          },
          {
            "text": "    ",
            "lineNumber": 98
          },
          {
            "text": "    def get_metrics(",
            "lineNumber": 99
          },
          {
            "text": "        self,",
            "lineNumber": 100
          },
          {
            "text": "        start_time: datetime,",
            "lineNumber": 101
          },
          {
            "text": "        end_time: datetime,",
            "lineNumber": 102
          },
          {
            "text": "        metric_type: Optional[str] = None",
            "lineNumber": 103
          },
          {
            "text": "    ) -&gt; List[Dict]:",
            "lineNumber": 104
          },
          {
            "text": "        ",
            "lineNumber": 105
          }
        ]
      },
      "score": 0.3371562063694
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\data_collection\\database.py",
        "range": {
          "startPosition": {
            "line": 761
          },
          "endPosition": {
            "line": 1024
          }
        },
        "contents": "def store_unified_metrics(\n    cpu_usage: float,\n    memory_usage: float,\n    network_traffic: float,\n    resource_type: str,\n    cloud_compute: Optional[float] = None,\n    cloud_storage: Optional[float] = None,\n    cloud_bandwidth: Optional[float] = None,\n    timestamp: Optional[datetime] = None\n) -&gt; bool:\n\n        memory_usage_float = float(memory_usage)\n        network_traffic_float = float(network_traffic)\n        \n        # Execute insert\n        cursor.execute(\n            insert_query,\n            (\n                cpu_usage_float,\n                memory_usage_float,\n                network_traffic_float,\n                float(cloud_compute) if cloud_compute is not None else None,\n                float(cloud_storage) if cloud_storage is not None else None,\n                float(cloud_bandwidth) if cloud_bandwidth is not None else None,\n                metric_timestamp,\n                resource_type\n            )\n        )\n        \n        conn.commit()\n        cursor.close()\n        \n        return True\n    \n    except (Error, ValueError, TypeError) as e:\n        print(f\"Error storing unified metrics in database: {e}\")\n        if conn:\n            conn.rollback()\n        return False\n    except Exception as e:\n        print(f\"Unexpected error storing unified metrics: {e}\")\n        if conn:\n            conn.rollback()\n        return False\n    finally:\n        # Ensure connection is closed\n        if conn:\n            conn.close()\n\n\ndef store_all_metrics_unified(all_metrics: Dict) -&gt; bool:\n    \"\"\"",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 762,
                "column": 1
              },
              "endPosition": {
                "line": 772,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "def store_unified_metrics(",
            "lineNumber": 762,
            "isSignature": true
          },
          {
            "text": "    cpu_usage: float,",
            "lineNumber": 763,
            "isSignature": true
          },
          {
            "text": "    memory_usage: float,",
            "lineNumber": 764,
            "isSignature": true
          },
          {
            "text": "    network_traffic: float,",
            "lineNumber": 765,
            "isSignature": true
          },
          {
            "text": "    resource_type: str,",
            "lineNumber": 766,
            "isSignature": true
          },
          {
            "text": "    cloud_compute: Optional[float] = None,",
            "lineNumber": 767,
            "isSignature": true
          },
          {
            "text": "    cloud_storage: Optional[float] = None,",
            "lineNumber": 768,
            "isSignature": true
          },
          {
            "text": "    cloud_bandwidth: Optional[float] = None,",
            "lineNumber": 769,
            "isSignature": true
          },
          {
            "text": "    timestamp: Optional[datetime] = None",
            "lineNumber": 770,
            "isSignature": true
          },
          {
            "text": ") -&gt; bool:",
            "lineNumber": 771,
            "isSignature": true
          },
          {
            "lineNumber": 846
          },
          {
            "text": "        memory_usage_float = float(memory_usage)",
            "lineNumber": 847
          },
          {
            "text": "        network_traffic_float = float(network_traffic)",
            "lineNumber": 848
          },
          {
            "text": "        ",
            "lineNumber": 849
          },
          {
            "text": "        # Execute insert",
            "lineNumber": 850
          },
          {
            "text": "        cursor.execute(",
            "lineNumber": 851
          },
          {
            "text": "            insert_query,",
            "lineNumber": 852
          },
          {
            "text": "            (",
            "lineNumber": 853
          },
          {
            "text": "                cpu_usage_float,",
            "lineNumber": 854
          },
          {
            "text": "                memory_usage_float,",
            "lineNumber": 855
          },
          {
            "text": "                network_traffic_float,",
            "lineNumber": 856
          },
          {
            "text": "                float(cloud_compute) if cloud_compute is not None else None,",
            "lineNumber": 857
          },
          {
            "text": "                float(cloud_storage) if cloud_storage is not None else None,",
            "lineNumber": 858
          },
          {
            "text": "                float(cloud_bandwidth) if cloud_bandwidth is not None else None,",
            "lineNumber": 859
          },
          {
            "text": "                metric_timestamp,",
            "lineNumber": 860
          },
          {
            "text": "                resource_type",
            "lineNumber": 861
          },
          {
            "text": "            )",
            "lineNumber": 862
          },
          {
            "text": "        )",
            "lineNumber": 863
          },
          {
            "text": "        ",
            "lineNumber": 864
          },
          {
            "text": "        conn.commit()",
            "lineNumber": 865
          },
          {
            "text": "        cursor.close()",
            "lineNumber": 866
          },
          {
            "text": "        ",
            "lineNumber": 867
          },
          {
            "text": "        return True",
            "lineNumber": 868
          },
          {
            "text": "    ",
            "lineNumber": 869
          },
          {
            "text": "    except (Error, ValueError, TypeError) as e:",
            "lineNumber": 870
          },
          {
            "text": "        print(f\"Error storing unified metrics in database: {e}\")",
            "lineNumber": 871
          },
          {
            "text": "        if conn:",
            "lineNumber": 872
          },
          {
            "text": "            conn.rollback()",
            "lineNumber": 873
          },
          {
            "text": "        return False",
            "lineNumber": 874
          },
          {
            "text": "    except Exception as e:",
            "lineNumber": 875
          },
          {
            "text": "        print(f\"Unexpected error storing unified metrics: {e}\")",
            "lineNumber": 876
          },
          {
            "text": "        if conn:",
            "lineNumber": 877
          },
          {
            "text": "            conn.rollback()",
            "lineNumber": 878
          },
          {
            "text": "        return False",
            "lineNumber": 879
          },
          {
            "text": "    finally:",
            "lineNumber": 880
          },
          {
            "text": "        # Ensure connection is closed",
            "lineNumber": 881
          },
          {
            "text": "        if conn:",
            "lineNumber": 882
          },
          {
            "text": "            conn.close()",
            "lineNumber": 883,
            "isSignature": true
          },
          {
            "lineNumber": 884
          },
          {
            "lineNumber": 885
          },
          {
            "text": "def store_all_metrics_unified(all_metrics: Dict) -&gt; bool:",
            "lineNumber": 886,
            "isSignature": true
          },
          {
            "text": "    \"\"\"",
            "lineNumber": 887
          }
        ]
      },
      "score": 0.33559244871139526
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\config\\settings.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 178
          }
        },
        "contents": "\"\"\"\nConfiguration settings for Monitor/Drift Agent.\n\nThis module provides configuration management for the agent including\nthresholds, alert channels, database connections, and other settings.\n\"\"\"\n\nimport os\nfrom typing import Dict, Optional, Any\n\n\nclass Settings:\n    \"\"\"Manages application settings.\"\"\"\n    \n    def __init__(self):\n        \"\"\"Initialize settings from environment variables and defaults.\"\"\"\n        # Database settings\n        self.database_url = os.getenv(\n            \"DATABASE_URL\",\n            \"postgresql://user:password@localhost:5432/monitor_drift\"\n        )\n        \n        # Metric collection settings\n        self.metric_collection_interval = int(\n            os.getenv(\"METRIC_COLLECTION_INTERVAL\", \"60\")\n        )  # seconds\n        \n        # Threshold settings\n        self.default_cpu_threshold = float(\n            os.getenv(\"DEFAULT_CPU_THRESHOLD\", \"80.0\")\n        )\n        self.default_memory_threshold = float(\n            os.getenv(\"DEFAULT_MEMORY_THRESHOLD\", \"80.0\")\n        )\n        self.default_disk_threshold = float(\n            os.getenv(\"DEFAULT_DISK_THRESHOLD\", \"80.0\")\n        )\n        \n        # Cloud provider settings\n        self.aws_access_key = os.getenv(\"AWS_ACCESS_KEY_ID\", \"\")\n        self.aws_secret_key = os.getenv(\"AWS_SECRET_ACCESS_KEY\", \"\")\n        self.aws_region = os.getenv(\"AWS_REGION\", \"us-east-1\")\n        \n        self.azure_subscription_id = os.getenv(\"AZURE_SUBSCRIPTION_ID\", \"\")\n        self.azure_client_id = os.getenv(\"AZURE_CLIENT_ID\", \"\")\n        self.azure_client_secret = os.getenv(\"AZURE_CLIENT_SECRET\", \"\")\n        self.azure_tenant_id = os.getenv(\"AZURE_TENANT_ID\", \"\")\n        \n        self.gcp_project_id = os.getenv(\"GCP_PROJECT_ID\", \"\")\n        self.gcp_credentials_path = os.getenv(\"GCP_CREDENTIALS_PATH\", \"\")\n        \n        # Cloud metrics collection settings\n        self.cloud_metrics_time_window_minutes = int(\n            os.getenv(\"CLOUD_METRICS_TIME_WINDOW_MINUTES\", \"5\")\n        )\n        self.enable_cloud_metrics = os.getenv(\n            \"ENABLE_CLOUD_METRICS\", \"false\"\n        ).lower() == \"true\"",
        "signatures": {},
        "detailedLines": [
          {
            "text": "\"\"\"",
            "lineNumber": 1
          },
          {
            "text": "Configuration settings for Monitor/Drift Agent.",
            "lineNumber": 2
          },
          {
            "lineNumber": 3
          },
          {
            "text": "This module provides configuration management for the agent including",
            "lineNumber": 4
          },
          {
            "text": "thresholds, alert channels, database connections, and other settings.",
            "lineNumber": 5
          },
          {
            "text": "\"\"\"",
            "lineNumber": 6
          },
          {
            "lineNumber": 7
          },
          {
            "text": "import os",
            "lineNumber": 8
          },
          {
            "text": "from typing import Dict, Optional, Any",
            "lineNumber": 9
          },
          {
            "lineNumber": 10
          },
          {
            "lineNumber": 11
          },
          {
            "text": "class Settings:",
            "lineNumber": 12,
            "isSignature": true
          },
          {
            "text": "    \"\"\"Manages application settings.\"\"\"",
            "lineNumber": 13
          },
          {
            "text": "    ",
            "lineNumber": 14
          },
          {
            "text": "    def __init__(self):",
            "lineNumber": 15
          },
          {
            "text": "        \"\"\"Initialize settings from environment variables and defaults.\"\"\"",
            "lineNumber": 16
          },
          {
            "text": "        # Database settings",
            "lineNumber": 17
          },
          {
            "text": "        self.database_url = os.getenv(",
            "lineNumber": 18
          },
          {
            "text": "            \"DATABASE_URL\",",
            "lineNumber": 19
          },
          {
            "text": "            \"postgresql://user:password@localhost:5432/monitor_drift\"",
            "lineNumber": 20
          },
          {
            "text": "        )",
            "lineNumber": 21
          },
          {
            "text": "        ",
            "lineNumber": 22
          },
          {
            "text": "        # Metric collection settings",
            "lineNumber": 23
          },
          {
            "text": "        self.metric_collection_interval = int(",
            "lineNumber": 24
          },
          {
            "text": "            os.getenv(\"METRIC_COLLECTION_INTERVAL\", \"60\")",
            "lineNumber": 25
          },
          {
            "text": "        )  # seconds",
            "lineNumber": 26
          },
          {
            "text": "        ",
            "lineNumber": 27
          },
          {
            "text": "        # Threshold settings",
            "lineNumber": 28
          },
          {
            "text": "        self.default_cpu_threshold = float(",
            "lineNumber": 29
          },
          {
            "text": "            os.getenv(\"DEFAULT_CPU_THRESHOLD\", \"80.0\")",
            "lineNumber": 30
          },
          {
            "text": "        )",
            "lineNumber": 31
          },
          {
            "text": "        self.default_memory_threshold = float(",
            "lineNumber": 32
          },
          {
            "text": "            os.getenv(\"DEFAULT_MEMORY_THRESHOLD\", \"80.0\")",
            "lineNumber": 33
          },
          {
            "text": "        )",
            "lineNumber": 34
          },
          {
            "text": "        self.default_disk_threshold = float(",
            "lineNumber": 35
          },
          {
            "text": "            os.getenv(\"DEFAULT_DISK_THRESHOLD\", \"80.0\")",
            "lineNumber": 36
          },
          {
            "text": "        )",
            "lineNumber": 37
          },
          {
            "text": "        ",
            "lineNumber": 38
          },
          {
            "text": "        # Cloud provider settings",
            "lineNumber": 39
          },
          {
            "text": "        self.aws_access_key = os.getenv(\"AWS_ACCESS_KEY_ID\", \"\")",
            "lineNumber": 40
          },
          {
            "text": "        self.aws_secret_key = os.getenv(\"AWS_SECRET_ACCESS_KEY\", \"\")",
            "lineNumber": 41
          },
          {
            "text": "        self.aws_region = os.getenv(\"AWS_REGION\", \"us-east-1\")",
            "lineNumber": 42
          },
          {
            "text": "        ",
            "lineNumber": 43
          },
          {
            "text": "        self.azure_subscription_id = os.getenv(\"AZURE_SUBSCRIPTION_ID\", \"\")",
            "lineNumber": 44
          },
          {
            "text": "        self.azure_client_id = os.getenv(\"AZURE_CLIENT_ID\", \"\")",
            "lineNumber": 45
          },
          {
            "text": "        self.azure_client_secret = os.getenv(\"AZURE_CLIENT_SECRET\", \"\")",
            "lineNumber": 46
          },
          {
            "text": "        self.azure_tenant_id = os.getenv(\"AZURE_TENANT_ID\", \"\")",
            "lineNumber": 47
          },
          {
            "text": "        ",
            "lineNumber": 48
          },
          {
            "text": "        self.gcp_project_id = os.getenv(\"GCP_PROJECT_ID\", \"\")",
            "lineNumber": 49
          },
          {
            "text": "        self.gcp_credentials_path = os.getenv(\"GCP_CREDENTIALS_PATH\", \"\")",
            "lineNumber": 50
          },
          {
            "text": "        ",
            "lineNumber": 51
          },
          {
            "text": "        # Cloud metrics collection settings",
            "lineNumber": 52
          },
          {
            "text": "        self.cloud_metrics_time_window_minutes = int(",
            "lineNumber": 53
          },
          {
            "text": "            os.getenv(\"CLOUD_METRICS_TIME_WINDOW_MINUTES\", \"5\")",
            "lineNumber": 54
          },
          {
            "text": "        )",
            "lineNumber": 55
          },
          {
            "text": "        self.enable_cloud_metrics = os.getenv(",
            "lineNumber": 56
          },
          {
            "text": "            \"ENABLE_CLOUD_METRICS\", \"false\"",
            "lineNumber": 57
          },
          {
            "text": "        ).lower() == \"true\"",
            "lineNumber": 58
          }
        ]
      },
      "score": 0.33212709426879883
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---


Creating the implementation plan:


---

<tool-use data-tool-type="unknown" data-tool-name="create_plan">
<details>
<summary>Tool use: **create_plan**</summary>


Parameters:

```json
{
  "plan": "# API Endpoint to Retrieve Metrics\n\n## Overview\nImplement a new FastAPI endpoint &#96;/api/metrics/cloud-and-server&#96; in &#96;api/metrics.py&#96; that retrieves stored metrics from the &#96;cloud_server_metrics&#96; database table. The endpoint will support filtering, pagination, and API key authentication.\n\n## Database Schema\nThe &#96;cloud_server_metrics&#96; table contains:\n- &#96;id&#96;: Primary key\n- &#96;cpu_usage&#96;: Server CPU usage (NUMERIC)\n- &#96;memory_usage&#96;: Server memory usage (NUMERIC)\n- &#96;network_traffic&#96;: Server network traffic (NUMERIC)\n- &#96;cloud_compute&#96;: Cloud compute usage (NUMERIC, nullable)\n- &#96;cloud_storage&#96;: Cloud storage usage (NUMERIC, nullable)\n- &#96;cloud_bandwidth&#96;: Cloud bandwidth usage (NUMERIC, nullable)\n- &#96;timestamp&#96;: Timestamp when metrics were collected\n- &#96;resource_type&#96;: Resource type (Server, AWS, GCP, Azure)\n\n## Implementation Steps\n\n### 1. Add API Key Configuration to Settings\n**File**: &#96;config/settings.py&#96;\n\nAdd API key configuration to the &#96;Settings&#96; class:\n- &#96;api_key&#96;: Read from &#96;API_KEY&#96; environment variable (default: empty string)\n- &#96;api_key_enabled&#96;: Read from &#96;API_KEY_ENABLED&#96; environment variable (default: \"false\")\n\nThis allows API key authentication to be enabled/disabled via configuration.\n\n### 2. Create Database Query Function\n**File**: &#96;data_collection/database.py&#96;\n\nAdd a new function &#96;get_metrics_from_db()&#96; that:\n- Accepts optional parameters: &#96;timestamp&#96;, &#96;resource_type&#96;, &#96;metric_type&#96;, &#96;limit&#96;, &#96;offset&#96;\n- Connects to the database using &#96;connect_to_db()&#96;\n- Builds a dynamic SQL query with WHERE clauses based on provided filters\n- For &#96;timestamp&#96;: Filter rows where &#96;timestamp &gt;= timestamp&#96; (supports ISO format strings)\n- For &#96;resource_type&#96;: Filter by exact match (Server, AWS, GCP, Azure)\n- For &#96;metric_type&#96;: Filter rows where the corresponding column is NOT NULL:\n  - \"CPU\" → &#96;cpu_usage IS NOT NULL&#96;\n  - \"Memory\" → &#96;memory_usage IS NOT NULL&#96;\n  - \"Network\" → &#96;network_traffic IS NOT NULL&#96;\n  - \"Cloud Compute\" → &#96;cloud_compute IS NOT NULL&#96;\n  - \"Cloud Storage\" → &#96;cloud_storage IS NOT NULL&#96;\n  - \"Cloud Bandwidth\" → &#96;cloud_bandwidth IS NOT NULL&#96;\n- Implements pagination using &#96;LIMIT&#96; and &#96;OFFSET&#96;\n- Returns a list of dictionaries with all metric fields\n- Handles database errors gracefully and closes connections properly\n\n### 3. Implement API Key Authentication\n**File**: &#96;api/metrics.py&#96;\n\nCreate an authentication dependency function:\n- Read API key from &#96;X-API-KEY&#96; header\n- Compare against API key from settings\n- If API key authentication is enabled and key doesn't match, raise &#96;HTTPException&#96; with 401 status\n- If API key authentication is disabled, allow access without key\n- Use FastAPI's &#96;Depends&#96; mechanism for dependency injection\n\n### 4. Add New Endpoint\n**File**: &#96;api/metrics.py&#96;\n\nAdd a new GET endpoint &#96;/api/metrics/cloud-and-server&#96; that:\n- Uses the authentication dependency\n- Accepts query parameters:\n  - &#96;timestamp&#96; (optional): ISO format timestamp string\n  - &#96;resource_type&#96; (optional): Server, AWS, GCP, or Azure\n  - &#96;metric_type&#96; (optional): CPU, Memory, Network, Cloud Compute, Cloud Storage, or Cloud Bandwidth\n  - &#96;limit&#96; (optional, default: 50): Number of records to return\n  - &#96;offset&#96; (optional, default: 0): Number of records to skip\n- Calls &#96;get_metrics_from_db()&#96; with the provided parameters\n- Returns JSON response with:\n  - &#96;metrics&#96;: Array of metric objects\n  - &#96;total&#96;: Total number of records matching filters (for pagination metadata)\n  - &#96;limit&#96;: Current limit\n  - &#96;offset&#96;: Current offset\n- Handles errors and returns appropriate HTTP status codes (500 for database errors, 400 for invalid parameters)\n\n### 5. Response Format\nThe endpoint will return JSON in this format:\n&#96;&#96;&#96;json\n{\n  \"metrics\": [\n    {\n      \"id\": 1,\n      \"cpu_usage\": 45.2,\n      \"memory_usage\": 67.8,\n      \"network_traffic\": 1024000,\n      \"cloud_compute\": 12.5,\n      \"cloud_storage\": null,\n      \"cloud_bandwidth\": 500000,\n      \"timestamp\": \"2026-01-14T18:00:00\",\n      \"resource_type\": \"AWS\"\n    }\n  ],\n  \"total\": 100,\n  \"limit\": 50,\n  \"offset\": 0\n}\n&#96;&#96;&#96;\n\n## Security Considerations\n- API key is stored in environment variable, not hardcoded\n- API key authentication can be disabled for development\n- Database queries use parameterized statements to prevent SQL injection\n- Connection pooling and proper connection cleanup\n\n## Error Handling\n- Invalid API key: 401 Unauthorized\n- Database connection errors: 500 Internal Server Error\n- Invalid query parameters: 400 Bad Request\n- Missing or invalid timestamp format: 400 Bad Request\n\n## Testing Considerations\n- Test with valid API key\n- Test with invalid/missing API key\n- Test filtering by each parameter individually and in combination\n- Test pagination with various limit/offset values\n- Test with empty result sets",
  "name": "API Endpoint for Metrics Retrieval",
  "todos": [
    {
      "content": "Add API key configuration to Settings class in config/settings.py",
      "status": "pending",
      "id": "add-api-key-settings"
    },
    {
      "content": "Create get_metrics_from_db() function in data_collection/database.py with filtering and pagination",
      "status": "pending",
      "id": "create-db-query-function"
    },
    {
      "content": "Implement API key authentication dependency in api/metrics.py",
      "status": "pending",
      "id": "implement-auth"
    },
    {
      "content": "Add /api/metrics/cloud-and-server GET endpoint in api/metrics.py with query parameters and error handling",
      "status": "pending",
      "id": "add-endpoint"
    }
  ],
  "overview": "Implement a secure FastAPI endpoint &#96;/api/metrics/cloud-and-server&#96; to retrieve stored cloud and server metrics from the database with filtering, pagination, and API key authentication."
}
```
Additional data:

```json
{
  "reviewData": {
    "status": "Requested",
    "selectedOption": "none",
    "isShowingInput": false
  },
  "planUri": "file:///c%3A/Users/Administrator/.cursor/plans/api_endpoint_for_metrics_retrieval_663d0ba5.plan.md",
  "hasOpenedEditor": true
}
```
Result:

```json
{
  "rejected": {}
}
```
Status: **completed**


</details>
</tool-use>

---

_**User**_

Implement the plan as specified, it is attached for your reference. Do NOT edit the plan file itself.

To-do's from the plan have already been created. Do not create them again. Mark them as in_progress as you work, starting with the first one. Don't stop until you have completed all the to-dos.

---

